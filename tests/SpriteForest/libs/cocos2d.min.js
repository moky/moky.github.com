
var cc=cc||{},ClassManager={id:0|Math.random()*998,instanceId:0|Math.random()*998,compileSuper:function(e,t,n){var r=e.toString(),i=r.indexOf("("),s=r.indexOf(")"),o=r.substring(i+1,s);o=o.trim();var u=r.indexOf("{"),a=r.lastIndexOf("}"),r=r.substring(u+1,a);while(r.indexOf("this._super")!=-1){var f=r.indexOf("this._super"),l=r.indexOf("(",f),c=r.indexOf(")",l),h=r.substring(l+1,c);h=h.trim();var p=h?",":"";r=r.substring(0,f)+"ClassManager["+n+"]."+t+".call(this"+p+r.substring(l+1)}return Function(o,r)},getNewID:function(){return this.id++},getNewInstanceId:function(){return this.instanceId++}};ClassManager.compileSuper.ClassManager=ClassManager,function(){var e=!1,t=/\b_super\b/,n=document.ccConfig&&document.ccConfig.CLASS_RELEASE_MODE?document.ccConfig.CLASS_RELEASE_MODE:null;n&&console.log("release Mode"),cc.Class=function(){},cc.Class.extend=function(e){function a(){this.__instanceId=ClassManager.getNewInstanceId(),this.ctor&&this.ctor.apply(this,arguments)}var r=this.prototype,i=Object.create(r),s=ClassManager.getNewID();ClassManager[s]=r;var o={writable:!0,enumerable:!1,configurable:!0};for(var u in e)n&&typeof e[u]=="function"&&typeof r[u]=="function"&&t.test(e[u])?(o.value=ClassManager.compileSuper(e[u],u,s),Object.defineProperty(i,u,o)):typeof e[u]=="function"&&typeof r[u]=="function"&&t.test(e[u])?(o.value=function(e,t){return function(){var n=this._super;this._super=r[e];var i=t.apply(this,arguments);return this._super=n,i}}(u,e[u]),Object.defineProperty(i,u,o)):typeof e[u]=="function"?(o.value=e[u],Object.defineProperty(i,u,o)):i[u]=e[u];return i.__instanceId=null,a.id=s,o.value=s,Object.defineProperty(i,"__pid",o),a.prototype=i,o.value=a,Object.defineProperty(a.prototype,"constructor",o),a.extend=cc.Class.extend,a.implement=function(e){for(var t in e)i[t]=e[t]},a},Function.prototype.bind=Function.prototype.bind||function(e){var t=this;return function(){var n=Array.prototype.slice.call(arguments);return t.apply(e||null,n)}}}(),cc.inherits=function(e,t){function n(){}n.prototype=t.prototype,e.superClass_=t.prototype,e.prototype=new n,e.prototype.constructor=e},cc.base=function(e,t,n){var r=arguments.callee.caller;if(r.superClass_)return ret=r.superClass_.constructor.apply(e,Array.prototype.slice.call(arguments,1)),ret;var i=Array.prototype.slice.call(arguments,2),s=!1;for(var o=e.constructor;o;o=o.superClass_&&o.superClass_.constructor)if(o.prototype[t]===r)s=!0;else if(s)return o.prototype[t].apply(e,i);if(e[t]===r)return e.constructor.prototype[t].apply(e,i);throw Error("cc.base called from a method of one name to a method of a different name")},cc.concatObjectProperties=function(e,t){e||(e={});for(var n in t)e[n]=t[n];return e},cc.Point=function(e,t){e!==undefined&&t===undefined?(this.x=e.x,this.y=e.y):(this.x=e||0,this.y=t||0)},cc._PointConst=function(e,t){this._x=e||0,this._y=t||0,this.setX=function(e){this._x=e},this.setY=function(e){this._y=e}},cc._pConst=function(e,t){return new cc._PointConst(e,t)},Object.defineProperties(cc._PointConst.prototype,{x:{get:function(){return this._x},set:function(){console.warn("Warning of _PointConst: Modification to const or private property is forbidden")},enumerable:!0},y:{get:function(){return this._y},set:function(){console.warn("Warning of _PointConst: Modification to const or private property is forbidden")},enumerable:!0}}),cc.PointMake=function(e,t){return cc.log("cc.PointMake will be deprecated sooner or later. Use cc.p instead."),new cc.Point(e,t)},cc.p=function(e,t){return e!==undefined&&t===undefined?{x:e.x,y:e.y}:{x:e||0,y:t||0}},cc._p=cc.p,cc.PointZero=function(){return cc.p(0,0)},cc.pointEqualToPoint=function(e,t){return!e||!t?!1:e.x===t.x&&e.y===t.y},cc.Size=function(e,t){e!==undefined&&t===undefined?(this.width=e.width,this.height=e.height):(this.width=e||0,this.height=t||0)},cc._SizeConst=function(e,t){this._width=e||0,this._height=t||0,this.setWidth=function(e){this._width=e},this.setHeight=function(e){this._height=e}},cc._sizeConst=function(e,t){return new cc._SizeConst(e,t)},Object.defineProperties(cc._SizeConst.prototype,{width:{get:function(){return this._width},set:function(){console.warn("Warning of _SizeConst: Modification to const or private property is forbidden")},enumerable:!0},height:{get:function(){return this._height},set:function(){console.warn("Warning of _SizeConst: Modification to const or private property is forbidden")},enumerable:!0}}),cc.SizeMake=function(e,t){return cc.log("cc.SizeMake will be deprecated sooner or later. Use cc.size instead."),cc.size(e,t)},cc.size=function(e,t){return e!==undefined&&t===undefined?{width:e.width,height:e.height}:{width:e||0,height:t||0}},cc._size=cc.size,cc.SizeZero=function(){return cc.size(0,0)},cc._zeroConsts={pointZero:cc._pConst(0,0),sizeZero:cc._sizeConst(0,0)},Object.defineProperties(cc,{POINT_ZERO:{get:function(){return cc._zeroConsts.pointZero}},SIZE_ZERO:{get:function(){return cc._zeroConsts.sizeZero}},RECT_ZERO:{get:function(){return cc.rect(0,0,0,0)}}}),cc.sizeEqualToSize=function(e,t){return!e||!t?!1:e.width==t.width&&e.height==t.height},cc.Rect=function(e,t,n,r){var i=arguments.length;if(i===4){this._origin=new cc.Point(e||0,t||0),this._size=new cc.Size(n||0,r||0);return}if(i===1){this._origin=new cc.Point(e._origin.x,e._origin.y),this._size=new cc.Size(e._size.width,e._size.height);return}if(i===0){this._origin=new cc.Point(0,0),this._size=new cc.Size(0,0);return}if(i===2){this._origin=new cc.Point(e.x,e.y),this._size=new cc.Size(t.width,t.height);return}throw"unknown argument type"},cc.RectMake=function(e,t,n,r){return cc.log("cc.RectMake will be deprecated sooner or later. Use cc.rect instead."),cc.rect(e,t,n,r)},cc.rect=function(e,t,n,r){var i=arguments.length;if(i===0)return new cc.Rect(0,0,0,0);if(i===1)return new cc.Rect(e.x,e.y,e.width,e.height);if(i===2)return new cc.Rect(e.x,e.y,t.width,t.height);if(i===4)return new cc.Rect(e,t,n,r);throw"unknown argument type"},cc._rect=cc.rect,cc.RectZero=function(){return cc.rect(0,0,0,0)},cc.rectEqualToRect=function(e,t){return!e||!t?!1:cc.pointEqualToPoint(e._origin,t._origin)&&cc.sizeEqualToSize(e._size,t._size)},cc._rectEqualToZero=function(e){return e?e.x===0&&e.y===0&&e.width===0&&e.height===0:!1},cc.rectContainsRect=function(e,t){return!e||!t?!1:!(e.x>=t.x||e.y>=t.y||e.x+e.width<=t.x+t.width||e.y+e.height<=t.y+t.height)},cc.rectGetMaxX=function(e){return e.x+e.width},cc.rectGetMidX=function(e){return e.x+e.width/2},cc.rectGetMinX=function(e){return e.x},cc.rectGetMaxY=function(e){return e.y+e.height},cc.rectGetMidY=function(e){return e.y+e.height/2},cc.rectGetMinY=function(e){return e.y},cc.rectContainsPoint=function(e,t){return t.x>=cc.rectGetMinX(e)&&t.x<=cc.rectGetMaxX(e)&&t.y>=cc.rectGetMinY(e)&&t.y<=cc.rectGetMaxY(e)},cc.rectIntersectsRect=function(e,t){return!(cc.rectGetMaxX(e)<cc.rectGetMinX(t)||cc.rectGetMaxX(t)<cc.rectGetMinX(e)||cc.rectGetMaxY(e)<cc.rectGetMinY(t)||cc.rectGetMaxY(t)<cc.rectGetMinY(e))},cc.rectOverlapsRect=function(e,t){return!(e.x+e.width<t.x||t.x+t.width<e.x||e.y+e.height<t.y||t.y+t.height<e.y)},cc.rectUnion=function(e,t){var n=cc.rect(0,0,0,0);return n.x=Math.min(e.x,t.x),n.y=Math.min(e.y,t.y),n.width=Math.max(e.x+e.width,t.x+t.width)-n.x,n.height=Math.max(e.y+e.height,t.y+t.height)-n.y,n},cc.rectIntersection=function(e,t){var n=cc.rect(Math.max(cc.rectGetMinX(e),cc.rectGetMinX(t)),Math.max(cc.rectGetMinY(e),cc.rectGetMinY(t)),0,0);return n.width=Math.min(cc.rectGetMaxX(e),cc.rectGetMaxX(t))-cc.rectGetMinX(n),n.height=Math.min(cc.rectGetMaxY(e),cc.rectGetMaxY(t))-cc.rectGetMinY(n),n},cc.Rect.prototype.getX=function(){return this._origin.x},cc.Rect.prototype.setX=function(e){this._origin.x=e},cc.Rect.prototype.getY=function(){return this._origin.y},cc.Rect.prototype.setY=function(e){this._origin.y=e},cc.Rect.prototype.getWidth=function(){return this._size.width},cc.Rect.prototype.setWidth=function(e){this._size.width=e},cc.Rect.prototype.getHeight=function(){return this._size.height},cc.Rect.prototype.setHeight=function(e){this._size.height=e},Object.defineProperties(cc.Rect.prototype,{x:{get:function(){return this.getX()},set:function(e){this.setX(e)},enumerable:!0,configurable:!0},y:{get:function(){return this.getY()},set:function(e){this.setY(e)},enumerable:!0,configurable:!0},width:{get:function(){return this.getWidth()},set:function(e){this.setWidth(e)},enumerable:!0,configurable:!0},height:{get:function(){return this.getHeight()},set:function(e){this.setHeight(e)},enumerable:!0,configurable:!0}});var sys=sys||{};try{sys.localStorage=window.localStorage,window.localStorage.setItem("storage",""),window.localStorage.removeItem("storage")}catch(e){(e.name==="SECURITY_ERR"||e.name==="QuotaExceededError")&&console.log("Warning: localStorage isn't enabled. Please confirm browser cookie or privacy option"),sys.localStorage=function(){}}Object.defineProperties(sys,{capabilities:{get:function(){var e={canvas:!0};cc.Browser.supportWebGL&&(e.opengl=!0),document.documentElement.ontouchstart!==undefined||window.navigator.msPointerEnabled?e.touches=!0:document.documentElement.onmouseup!==undefined&&(e.mouse=!0),document.documentElement.onkeyup!==undefined&&(e.keyboard=!0);if(window.DeviceMotionEvent||window.DeviceOrientationEvent)e.accelerometer=!0;return e},enumerable:!0,configurable:!0},os:{get:function(){var e=navigator.userAgent.match(/(iPad|iPhone|iPod)/i)?!0:!1,t=navigator.userAgent.match(/android/i)||navigator.platform.match(/android/i)?!0:!1,n=navigator.appVersion;return navigator.appVersion.indexOf("Win")!=-1?n="Windows":e?n="iOS":navigator.appVersion.indexOf("Mac")!=-1?n="OS X":navigator.appVersion.indexOf("X11")!=-1?n="UNIX":navigator.appVersion.indexOf("Linux")!=-1?n="Linux":t&&(n="Android"),n},enumerable:!0,configurable:!0},platform:{get:function(){return"browser"},enumerable:!0,configurable:!0},version:{get:function(){return cc.ENGINE_VERSION},enumerable:!0,configurable:!0}}),sys.garbageCollect=function(){},sys.dumpRoot=function(){},sys.restartVM=function(){},cc.ENGINE_VERSION="Cocos2d-html5-v2.2.2",cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL=0,cc.DIRECTOR_STATS_POSITION=cc.p(0,0),cc.DIRECTOR_FPS_INTERVAL=.5,cc.COCOSNODE_RENDER_SUBPIXEL=1,cc.SPRITEBATCHNODE_RENDER_SUBPIXEL=1,cc.OPTIMIZE_BLEND_FUNC_FOR_PREMULTIPLIED_ALPHA=0,cc.TEXTURE_ATLAS_USE_TRIANGLE_STRIP=0,cc.TEXTURE_ATLAS_USE_VAO=0,cc.TEXTURE_NPOT_SUPPORT=0,cc.RETINA_DISPLAY_SUPPORT=1,cc.RETINA_DISPLAY_FILENAME_SUFFIX="-hd",cc.USE_LA88_LABELS=1,cc.SPRITE_DEBUG_DRAW=0,cc.SPRITEBATCHNODE_DEBUG_DRAW=0,cc.LABELBMFONT_DEBUG_DRAW=0,cc.LABELATLAS_DEBUG_DRAW=0,cc.IS_RETINA_DISPLAY_SUPPORTED=1,cc.DEFAULT_ENGINE=cc.ENGINE_VERSION+"-canvas",cc.config={platform:sys.platform},cc.dumpConfig=function(){for(var e in sys)cc.log(e+" = "+sys[e])},cc.ENABLE_STACKABLE_ACTIONS=1,cc.ENABLE_GL_STATE_CACHE=1,cc.create3DContext=function(e,t){var n=["webgl","experimental-webgl","webkit-3d","moz-webgl"],r=null;for(var i=0;i<n.length;++i){try{r=e.getContext(n[i],t)}catch(s){}if(r)break}return r},cc.Browser={},cc.Browser.webglWhiteList=["baidubrowser","opera","firefox","chrome","safari"],cc.Browser.multipleAudioWhiteList=["baidubrowser","opera","firefox","chrome","safari","ucbrowser","qqbrowser","mqqbrowser"],function(){var e=navigator.userAgent;cc.Browser.ua=e.toLowerCase(),cc.Browser.platform=navigator.platform.toLowerCase(),cc.Browser.isMobile=cc.Browser.ua.indexOf("mobile")!=-1||cc.Browser.ua.indexOf("android")!=-1,cc.Browser.type=function(){var e=cc.Browser.ua.match(/micromessenger|qqbrowser|mqqbrowser|ucbrowser|360browser|baiduboxapp|baidubrowser|maxthon|ie|opera|miuibrowser|firefox/)||cc.Browser.ua.match(/chrome|safari/);if(e&&e.length>0){var t=e[0];return t=="micromessenger"?"wechat":t==="safari"&&cc.Browser.ua.match(/android.*applewebkit/)!=null?"androidbrowser":t}return"unknow"}(),cc.Browser.mode=cc.Browser.type=="ie"&&document.documentMode,document.ccConfig||(document.ccConfig={});var t=document.ccConfig;cc._userRenderMode=parseInt(t.renderMode)||0;var n=cc.Browser.webglWhiteList.indexOf(cc.Browser.type)==-1;if(cc._userRenderMode===1||cc._userRenderMode===0&&(cc.Browser.isMobile||n))cc.Browser.supportWebGL=!1;else{cc.Browser.supportWebGL=window.WebGLRenderingContext!=null;var r=document.createElement("Canvas"),i=cc.create3DContext(r,{stencil:!0,preserveDrawingBuffer:!0});cc.Browser.supportWebGL=i!=null}cc._userRenderMode===2&&!cc.Browser.supportWebGL&&(cc.__renderDoesnotSupport=!0),cc.Browser.supportWebAudio=function(){try{var e=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext);return e?!0:!1}catch(t){return!1}}(),cc.Browser.openURL=function(e){if(this.isMobile){var t=cc.Director.getInstance().getWinSize(),n=t.width+"px",r=t.height+"px",i=cc.$new("div");i.style.backgroundColor="#ffffff",i.style.width=n,i.style.height=r,i.style.zindex=1e3,i.style.position="absolute",i.style.top="0px",i.style.left="0px",i.id="cocos2d-browser";var s=cc.$new("iframe");s.src=e,s.style.width=n,s.style.height=r,s.setAttribute("frameborder","no"),s.setAttribute("scrolling","no"),i.appendChild(s),s.onload=function(){var e=document.createElement("img");e.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo5OERBMEM3OUQzRTMxMUUyODg2Q0RFNjU1QkU1RjlFQSIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDo5OERBMEM3QUQzRTMxMUUyODg2Q0RFNjU1QkU1RjlFQSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjk4REEwQzc3RDNFMzExRTI4ODZDREU2NTVCRTVGOUVBIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjk4REEwQzc4RDNFMzExRTI4ODZDREU2NTVCRTVGOUVBIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+NwBuoAAAA/tJREFUeNrEWF0sW3EUb6+28zFhbGadsBaNhazV+kpDYhFWKRGWbHvwFV5IvPiIFw9evElEPEiWSUgsIWoIglhmUomPxj6aKC0zKVJjtPU5o9j5J7dLdbf33jKc5Jfc3v+v5/+755x7/j1lMoiNBRDh4AO88HvO2m+ACbAC+AJQAyz2JCbBFyMBWQA/xv+3DUAXLuivudhcY4BMwCuAB+NqDPmNAnAAOsCZvQgk4BnjeiwEwAbM2YoQA14yrteQEANgDcML7gXjZgw9OAuJkADu3JAIb7Q/hr+GtCwuLs6LDq+iooLvhBAREhFEl11ZWRne0tIiIeNIpVKv4uJi4dTUVApNt0EY3ohILSIiwqO7u1sql8vD8vLyJJ2dnXH2HDabzczPz3/Y1taWzOfz78XExDxSq9Vyd3d3jMK9F2pWr6lEtLa2RmVnZ4tt7w0NDWlTU1OVtkK7urqSQ0NDzzW5hYWFjcTExAGDwXDkyD+VSkZ7e3tsWlpamP19mUwWplQqk9B1UlKST3NzczxE4K49D4mCiDwn24PyPMjIyHjs6urKIVpLSEgInp6eZsM6Kzw8nEvEMZvNBxC1BbI9KCMhkUgUy8vLRpL1QIFA4EcSyZmcnJzpS4mYnZ3dj46O7p2fn193xIGi/CeiFovlFIp5pqGhYZ5qD1qFiQxCjk1OTsqEQmEAFReloL+/X0sVAadFWE2n02VA+O+TcVZXV01QkO8ODw9P6fjEnO2zvb2936g4XC7XG4rWm65P2iL8/f05kN8nBQUFQkqnGMYcGBjIys3N5dLxjY7ydDrE6urqsNLSUqmbmxuH1tOBkMzMTIHRaNxSqVTmS4soKyvjFRUViTw9PV2dTR901WAOh7M/MjKyeeHCbGpqEhcWFkY5Wl9aWtpUKBRaONziSbsii/Xm5OTk7EIdU6/X7zpaW1xc/Al5HxkfH9/e2dk5rqmpeUrE6+vr06ADzpEIlI5kMjFwPhh5PB5DJBKdK7KDg4Oj2tpaVUdHxw/0eWxszIjyj8Jvy4N60FdVVX2Grnt4dkaowYJESAG3yaLR09Oz5uvrexwbGxuAR2erpKTkI6RqxW5DM6RnLT09PQQV5vDwsDYlJWUU+I4EIDMhEQLAA6q0DA4OrqMCg/c/qL6+XtXY2Kgn4sGJuavRaFbFYrFPeXn5FIj6ReFa64KnIpJOpaMK39vbM9XV1X13lF9kc3Nz+xMTEwZo89s03A4ycRE1N/RjF/WPKgyfDRU39Gu7w1qYyNYAtwDB1yhgGPDBfgzU4bMi7xoEjAI6iWZRdGMGH80Cr2goRlP5W8B7qwBHfw1YO6kEH4yC8EnJ5QKbnuDFh17nr4BPRP9P/BFgAHo7ZNgI9EbHAAAAAElFTkSuQmCC",i.appendChild(e),e.style.zindex=1e3,e.style.position="absolute",e.style.bottom="10px",e.style.right="10px",e.onclick=function(){i.remove()}};var o=document.ccConfig.tag,u=document.getElementById(o).parentNode;u&&u.appendChild(i)}else window.open(e)}}(),cc.RenderDoesnotSupport=function(){return cc.__renderDoesnotSupport==="undefined"?!1:cc.__renderDoesnotSupport},cc.$=function(e){var t=this==cc?document:this,n=e instanceof HTMLElement?e:t.querySelector(e);return n&&(n.find=n.find||cc.$,n.hasClass=n.hasClass||function(e){return this.className.match(new RegExp("(\\s|^)"+e+"(\\s|$)"))},n.addClass=n.addClass||function(e){return this.hasClass(e)||(this.className&&(this.className+=" "),this.className+=e),this},n.removeClass=n.removeClass||function(e){return this.hasClass(e)&&(this.className=this.className.replace(e,"")),this},n.remove=n.remove||function(){return this.parentNode&&this.parentNode.removeChild(this),this},n.appendTo=n.appendTo||function(e){return e.appendChild(this),this},n.prependTo=n.prependTo||function(e){return e.childNodes[0]?e.insertBefore(this,e.childNodes[0]):e.appendChild(this),this},n.transforms=n.transforms||function(){return this.style[cc.$.trans]=cc.$.translate(this.position)+cc.$.rotate(this.rotation)+cc.$.scale(this.scale)+cc.$.skew(this.skew),this},n.position=n.position||{x:0,y:0},n.rotation=n.rotation||0,n.scale=n.scale||{x:1,y:1},n.skew=n.skew||{x:0,y:0},n.translates=function(e,t){return this.position.x=e,this.position.y=t,this.transforms(),this},n.rotate=function(e){return this.rotation=e,this.transforms(),this},n.resize=function(e,t){return this.scale.x=e,this.scale.y=t,this.transforms(),this},n.setSkew=function(e,t){return this.skew.x=e,this.skew.y=t,this.transforms(),this}),n};switch(cc.Browser.type){case"firefox":cc.$.pfx="Moz",cc.$.hd=!0;break;case"chrome":case"safari":cc.$.pfx="webkit",cc.$.hd=!0;break;case"opera":cc.$.pfx="O",cc.$.hd=!1;break;case"ie":cc.$.pfx="ms",cc.$.hd=!1;break;default:cc.$.pfx="webkit",cc.$.hd=!0}cc.$.trans=cc.$.pfx+"Transform",cc.$.translate=cc.$.hd?function(e){return"translate3d("+e.x+"px, "+e.y+"px, 0) "}:function(e){return"translate("+e.x+"px, "+e.y+"px) "},cc.$.rotate=cc.$.hd?function(e){return"rotateZ("+e+"deg) "}:function(e){return"rotate("+e+"deg) "},cc.$.scale=function(e){return"scale("+e.x+", "+e.y+") "},cc.$.skew=function(e){return"skewX("+ -e.x+"deg) skewY("+e.y+"deg)"},cc.$new=function(e){return cc.$(document.createElement(e))},cc.$.findpos=function(e){var t=0,n=0;do t+=e.offsetLeft,n+=e.offsetTop;while(e=e.offsetParent);return{x:t,y:n}},cc.clone=function(e){var t=e.constructor?new e.constructor:{};for(var n in e){var r=e[n];typeof r!="object"||!r||r instanceof cc.Node||r instanceof HTMLElement?t[n]=r:t[n]=cc.clone(r)}return t},cc.associateWithNative=function(e,t){},cc.IS_SHOW_DEBUG_ON_PAGE=cc.IS_SHOW_DEBUG_ON_PAGE||!1,cc._logToWebPage=function(e){var t=document.getElementById("logInfoList");if(!t){var n=document.createElement("Div");n.setAttribute("id","logInfoDiv"),cc.canvas.parentNode.appendChild(n),n.setAttribute("width","200"),n.setAttribute("height",cc.canvas.height),n.style.zIndex="99999",n.style.position="absolute",n.style.top="0",n.style.left="0",t=document.createElement("ul"),n.appendChild(t),t.setAttribute("id","logInfoList"),t.style.height=cc.canvas.height+"px",t.style.color="#fff",t.style.textAlign="left",t.style.listStyle="disc outside",t.style.fontSize="12px",t.style.fontFamily="arial",t.style.padding="0 0 0 20px",t.style.margin="0",t.style.textShadow="0 0 3px #000",t.style.zIndex="99998",t.style.position="absolute",t.style.top="0",t.style.left="0",t.style.overflowY="hidden";var r=document.createElement("Div");n.appendChild(r),r.style.width="200px",r.style.height=cc.canvas.height+"px",r.style.opacity="0.1",r.style.background="#fff",r.style.border="1px solid #dfdfdf",r.style.borderRadius="8px"}var i=document.createElement("li");i.innerHTML=e,t.childNodes.length==0?t.appendChild(i):t.insertBefore(i,t.childNodes[0])},cc.log=function(e){cc.IS_SHOW_DEBUG_ON_PAGE?cc._logToWebPage(e):console.log.apply(console,arguments)},cc.MessageBox=function(e){console.log(e)},cc.Assert=function(e,t){console.assert?console.assert(e,t):e||t&&alert(t)},cc.initDebugSetting=function(){cc.COCOS2D_DEBUG==0?(cc.log=function(){},cc.logINFO=function(){},cc.logERROR=function(){},cc.Assert=function(){}):cc.COCOS2D_DEBUG==1?(cc.logINFO=cc.log,cc.logERROR=function(){}):cc.COCOS2D_DEBUG>1&&(cc.logINFO=cc.log,cc.logERROR=cc.log)},cc.LANGUAGE_ENGLISH=0,cc.LANGUAGE_CHINESE=1,cc.LANGUAGE_FRENCH=2,cc.LANGUAGE_ITALIAN=3,cc.LANGUAGE_GERMAN=4,cc.LANGUAGE_SPANISH=5,cc.LANGUAGE_RUSSIAN=6,cc.LANGUAGE_KOREAN=7,cc.LANGUAGE_JAPANESE=8,cc.LANGUAGE_HUNGARIAN=9,cc.LANGUAGE_PORTUGUESE=10,cc.LANGUAGE_ARABIC=11,cc.LANGUAGE_NORWEGIAN=12,cc.LANGUAGE_POLISH=13,cc.KEY={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,capslock:20,escape:27,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,Delete:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,num0:96,num1:97,num2:98,num3:99,num4:100,num5:101,num6:102,num7:103,num8:104,num9:105,"*":106,"+":107,"-":109,numdel:110,"/":111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numlock:144,scrolllock:145,semicolon:186,",":186,equal:187,"=":187,";":188,comma:188,dash:189,".":190,period:190,forwardslash:191,grave:192,"[":219,openbracket:219,"]":221,closebracket:221,backslash:220,quote:222,space:32},cc.FMT_JPG=0,cc.FMT_PNG=1,cc.FMT_TIFF=2,cc.FMT_RAWDATA=3,cc.FMT_WEBP=4,cc.FMT_UNKNOWN=5,cc.getImageFormatByData=function(e){if(e.length>8&&e[0]==137&&e[1]==80&&e[2]==78&&e[3]==71&&e[4]==13&&e[5]==10&&e[6]==26&&e[7]==10)return cc.FMT_PNG;if(e.length>2)if(e[0]==73&&e[1]==73||e[0]==77&&e[1]==77||e[0]==255&&e[1]==216)return cc.FMT_TIFF;return cc.FMT_UNKNOWN};var CCNS_REG1=/^\s*\{\s*([\-]?\d+[.]?\d*)\s*,\s*([\-]?\d+[.]?\d*)\s*\}\s*$/,CCNS_REG2=/^\s*\{\s*\{\s*([\-]?\d+[.]?\d*)\s*,\s*([\-]?\d+[.]?\d*)\s*\}\s*,\s*\{\s*([\-]?\d+[.]?\d*)\s*,\s*([\-]?\d+[.]?\d*)\s*\}\s*\}\s*$/;cc.RectFromString=function(e){var t=CCNS_REG2.exec(e);return t?cc.rect(parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3]),parseFloat(t[4])):cc.RectZero()},cc.PointFromString=function(e){var t=CCNS_REG1.exec(e);return t?cc.p(parseFloat(t[1]),parseFloat(t[2])):cc.PointZero()},cc.SizeFromString=function(e){var t=CCNS_REG1.exec(e);return t?cc.size(parseFloat(t[1]),parseFloat(t[2])):cc.SizeZero()},cc.doCallback=function(e,t,n){if(!e)return;t&&typeof e=="string"?t[e](n):t&&typeof e=="function"?e.call(t,n):e(n)},cc.INVALID_INDEX=-1,cc.PI=Math.PI,cc.FLT_MAX=parseFloat("3.402823466e+38F"),cc.RAD=cc.PI/180,cc.DEG=180/cc.PI,cc.UINT_MAX=4294967295,cc.SWAP=function(e,t,n){if(typeof n=="object"&&typeof n.x!="undefined"&&typeof n.y!="undefined"){var r=n[e];n[e]=n[t],n[t]=r}else cc.log("cc.SWAP is being modified from original macro, please check usage")},cc.lerp=function(e,t,n){return e+(t-e)*n},cc.RANDOM_MINUS1_1=function(){return(Math.random()-.5)*2},cc.RANDOM_0_1=function(){return Math.random()},cc.DEGREES_TO_RADIANS=function(e){return e*cc.RAD},cc.RADIANS_TO_DEGREES=function(e){return e*cc.DEG},cc.REPEAT_FOREVER=Number.MAX_VALUE-1,cc.BLEND_SRC=cc.OPTIMIZE_BLEND_FUNC_FOR_PREMULTIPLIED_ALPHA?1:770,cc.BLEND_DST=771,cc.NODE_DRAW_SETUP=function(e){e._shaderProgram&&(e._shaderProgram.use(),e._shaderProgram.setUniformForModelViewAndProjectionMatrixWithMat4())},cc.ENABLE_DEFAULT_GL_STATES=function(){},cc.DISABLE_DEFAULT_GL_STATES=function(){},cc.INCREMENT_GL_DRAWS=function(e){cc.g_NumberOfDraws+=e},cc.FLT_EPSILON=1.192092896e-7,cc.CONTENT_SCALE_FACTOR=cc.IS_RETINA_DISPLAY_SUPPORTED?function(){return cc.Director.getInstance().getContentScaleFactor()}:function(){return 1},cc.POINT_POINTS_TO_PIXELS=function(e){var t=cc.CONTENT_SCALE_FACTOR();return cc.p(e.x*t,e.y*t)},cc._POINT_POINTS_TO_PIXELS_OUT=function(e,t){var n=cc.CONTENT_SCALE_FACTOR();t._x=e.x*n,t._y=e.y*n},cc.SIZE_POINTS_TO_PIXELS=function(e){var t=cc.CONTENT_SCALE_FACTOR();return cc.size(e.width*t,e.height*t)},cc.SIZE_PIXELS_TO_POINTS=function(e){var t=cc.CONTENT_SCALE_FACTOR();return cc.size(e.width/t,e.height/t)},cc._SIZE_PIXELS_TO_POINTS_OUT=function(e,t){var n=cc.CONTENT_SCALE_FACTOR();t._width=e.width/n,t._height=e.height/n},cc.POINT_PIXELS_TO_POINTS=function(e){var t=cc.CONTENT_SCALE_FACTOR();return cc.p(e.x/t,e.y/t)},cc._POINT_PIXELS_TO_POINTS_OUT=function(e,t){var n=cc.CONTENT_SCALE_FACTOR();t._x=e.x/n,t._y=e.y/n},cc.RECT_PIXELS_TO_POINTS=cc.IS_RETINA_DISPLAY_SUPPORTED?function(e){var t=cc.CONTENT_SCALE_FACTOR();return cc.rect(e.x/t,e.y/t,e.width/t,e.height/t)}:function(e){return e},cc.RECT_POINTS_TO_PIXELS=cc.IS_RETINA_DISPLAY_SUPPORTED?function(e){var t=cc.CONTENT_SCALE_FACTOR();return cc.rect(e.x*t,e.y*t,e.width*t,e.height*t)}:function(e){return e};if(!cc.Browser.supportWebGL){var gl=gl||{};gl.ONE=1,gl.ZERO=0,gl.SRC_ALPHA=770,gl.ONE_MINUS_SRC_ALPHA=771,gl.ONE_MINUS_DST_COLOR=775}cc.CHECK_GL_ERROR_DEBUG=function(){if(cc.renderMode==cc.WEBGL){var e=cc.renderContext.getError();e&&cc.log("WebGL error "+e)}},cc.SAX_NONE=0,cc.SAX_KEY=1,cc.SAX_DICT=2,cc.SAX_INT=3,cc.SAX_REAL=4,cc.SAX_STRING=5,cc.SAX_ARRAY=6;var Uint8Array=Uint8Array||Array;if(/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent)){var IEBinaryToArray_ByteStr_Script='<!-- IEBinaryToArray_ByteStr -->\r\nFunction IEBinaryToArray_ByteStr(Binary)\r\n   IEBinaryToArray_ByteStr = CStr(Binary)\r\nEnd Function\r\nFunction IEBinaryToArray_ByteStr_Last(Binary)\r\n   Dim lastIndex\r\n   lastIndex = LenB(Binary)\r\n   if lastIndex mod 2 Then\r\n       IEBinaryToArray_ByteStr_Last = Chr( AscB( MidB( Binary, lastIndex, 1 ) ) )\r\n   Else\r\n       IEBinaryToArray_ByteStr_Last = ""\r\n   End If\r\nEnd Function\r\n',myVBScript=document.createElement("script");myVBScript.type="text/vbscript",myVBScript.textContent=IEBinaryToArray_ByteStr_Script,document.body.appendChild(myVBScript),cc._convertResponseBodyToText=function(e){var t={};for(var n=0;n<256;n++)for(var r=0;r<256;r++)t[String.fromCharCode(n+r*256)]=String.fromCharCode(n)+String.fromCharCode(r);var i=IEBinaryToArray_ByteStr(e),s=IEBinaryToArray_ByteStr_Last(e);return i.replace(/[\s\S]/g,function(e){return t[e]})+s}}cc.FileUtils=cc.Class.extend({_fileDataCache:null,_textFileCache:null,_directory:null,_filenameLookupDict:null,_searchResolutionsOrderArray:null,_searchPathArray:null,_defaultResRootPath:"",ctor:function(){this._fileDataCache={},this._textFileCache={},this._searchPathArray=[],this._searchPathArray.push(this._defaultResRootPath),this._searchResolutionsOrderArray=[],this._searchResolutionsOrderArray.push("")},purgeCachedEntries:function(){this._searchPathArray.length=0},getByteArrayFromFile:function(e,t,n){return e=this.fullPathForFilename(e),this._fileDataCache[e]?this._fileDataCache[e]:this._loadBinaryFileData(e)},_getXMLHttpRequest:function(){return window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP")},unloadBinaryFileData:function(e){this._fileDataCache[e]&&delete this._fileDataCache[e]},preloadBinaryFileData:function(e,t,n){e=this.fullPathForFilename(e);var r=this,i=this._getXMLHttpRequest();i.open("GET",e,!0),/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent)?(i.setRequestHeader("Accept-Charset","x-user-defined"),i.onreadystatechange=function(s){if(i.readyState==4){if(i.status==200){var o=cc._convertResponseBodyToText(i.responseBody);o&&(r._fileDataCache[e]=r._stringConvertToArray(o))}else cc.doCallback(t,n,e);cc.doCallback(t,n)}}):(i.overrideMimeType&&i.overrideMimeType("text/plain; charset=x-user-defined"),i.onload=function(s){var o=i.responseText;o?r._fileDataCache[e]=r._stringConvertToArray(o):cc.doCallback(t,n,e),cc.doCallback(t,n)}),i.send(null)},_loadBinaryFileData:function(e){var t=this._getXMLHttpRequest();t.open("GET",e,!1);var n=null;if(/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent)){t.setRequestHeader("Accept-Charset","x-user-defined"),t.send(null);if(t.status!=200)return cc.log("cocos2d: Unable to load file: "+e),null;var r=cc._convertResponseBodyToText(t.responseBody);r&&(n=this._stringConvertToArray(r),this._fileDataCache[e]=n)}else{t.overrideMimeType&&t.overrideMimeType("text/plain; charset=x-user-defined"),t.send(null);if(t.status!=200)return cc.log("cocos2d: Unable to load file: "+e),null;n=this._stringConvertToArray(t.responseText),this._fileDataCache[e]=n}return n},_stringConvertToArray:function(e){if(!e)return null;var t=new Uint8Array(e.length);for(var n=0;n<e.length;n++)t[n]=e.charCodeAt(n)&255;return t},unloadTextFileData:function(e){e=this.fullPathForFilename(e),this._textFileCache[e]&&delete this._textFileCache[e]},preloadTextFileData:function(e,t,n){e=this.fullPathForFilename(e);var r=this,i=this._getXMLHttpRequest();i.open("GET",e,!0),/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent)?(i.setRequestHeader("Accept-Charset","utf-8"),i.onreadystatechange=function(s){if(i.readyState==4){if(i.status==200){var o=i.responseText;o&&(r._textFileCache[e]=o)}else cc.doCallback(t,n,e);cc.doCallback(t,n)}}):(i.overrideMimeType&&i.overrideMimeType("text/plain; charset=utf-8"),i.onload=function(s){i.responseText?r._textFileCache[e]=i.responseText:cc.doCallback(t,n,e),cc.doCallback(t,n)}),i.send(null)},_loadTextFileData:function(e){var t=this._getXMLHttpRequest();t.open("GET",e,!1);var n=null;return/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent)?t.setRequestHeader("Accept-Charset","utf-8"):t.overrideMimeType&&t.overrideMimeType("text/plain; charset=utf-8"),t.send(null),t.status!=200?null:(n=t.responseText,n&&(this._textFileCache[e]=n),n)},getTextFileData:function(e){return e=this.fullPathForFilename(e),this._textFileCache[e]?this._textFileCache[e]:this._loadTextFileData(e)},getFileDataFromZip:function(e,t,n){},removeSuffixFromFile:function(e){},popupNotify:!0,fullPathFromRelativePath:function(e){return e},fullPathForFilename:function(e){if(e.indexOf("://")>0)return e;var t=!1,n=this._getNewFilename(e),r;for(var i=0;i<this._searchPathArray.length;i++){var s=this._searchPathArray[i];for(var o=0;o<this._searchResolutionsOrderArray.length;o++){var u=this._searchResolutionsOrderArray[o];r=this._getPathForFilename(n,u,s);if(r){t=!0;break}}if(t)break}return t?r:n},loadFilenameLookup:function(e){var t=this.fullPathForFilename(e);if(t.length>0){var n=cc.SAXParser.getInstance().parse(t),r=n.metadata,i=parseInt(r.version);if(i!=1){cc.log("cocos2d: ERROR: Invalid filenameLookup dictionary version: "+i+". Filename: "+e);return}this.setFilenameLookupDictionary(n.filenames)}},setFilenameLookupDictionary:function(e){this._filenameLookupDict=e},fullPathFromRelativeFile:function(e,t){var n;return e?(n=t.substring(0,t.lastIndexOf("/")+1),n+e):(n=t.substring(0,t.lastIndexOf(".")),n+=".png",n)},setSearchResolutionsOrder:function(e){this._searchResolutionsOrderArray=e},getSearchResolutionsOrder:function(){return this._searchResolutionsOrderArray},setSearchPath:function(e){this._searchPathArray=e},getSearchPath:function(){return this._searchPathArray},getResourceDirectory:function(){return this._directory},setResourcePath:function(e){},dictionaryWithContentsOfFile:function(e){return cc.log("dictionaryWithContentsOfFile is deprecated. Use createDictionaryWithContentsOfFile instead"),this.createDictionaryWithContentsOfFile(e)},createDictionaryWithContentsOfFile:function(e){return cc.SAXParser.getInstance().parse(e)},getStringFromFile:function(e){return this.getTextFileData(e)},dictionaryWithContentsOfFileThreadSafe:function(e){return cc.SAXParser.getInstance().parse(e)},getWritablePath:function(){return""},setPopupNotify:function(e){cc.popupNotify=e},isPopupNotify:function(){return cc.popupNotify},_resourceRootPath:"",getResourceRootPath:function(){return this._resourceRootPath},setResourceRootPath:function(e){this._resourceRootPath=e},_getNewFilename:function(e){var t=null,n=this._filenameLookupDict?this._filenameLookupDict[e]:null;return!n||n.length===0?t=e:(t=n,cc.log("FOUND NEW FILE NAME: "+t)),t},_getPathForFilename:function(e,t,n){var r,i=this.getResourceRootPath();e&&e.length>0&&(e.indexOf("/")===0||e.indexOf("\\")===0)?r="":i.length>0?(r=i,r[r.length-1]!="\\"&&r[r.length-1]!="/"&&(r+="/")):r=i;var s=e,o="",u=e.lastIndexOf("/");u!=-1&&(o=e.substr(0,u+1),s=e.substr(u+1));var a=n;return a.length>0&&a.lastIndexOf("/")!==a.length-1&&(a+="/"),a+=o,a+=t,a.length>0&&a.lastIndexOf("/")!==a.length-1&&(a+="/"),a+=s,r+=a,r},_getFullPathForDirectoryAndFilename:function(e,t){},setSearchPaths:function(e){var t=!1,n=this._searchPathArray;n.length=0;for(var r=0;r<e.length;r++){var i=e[r],s,o;this.isAbsolutePath(i)||(s=this._defaultResRootPath),o=s+i,o.length>0&&o[o.length-1]!="/"&&(o+="/"),!t&&o==this._defaultResRootPath&&(t=!0),n.push(o)}t||n.push(this._defaultResRootPath)},addSearchPath:function(e){var t;this.isAbsolutePath(e)||(t=this._defaultResRootPath),e=t+e,e.length>0&&e[e.length-1]!="/"&&(e+="/"),this._searchPathArray.push(e)},getSearchPaths:function(){},isAbsolutePath:function(
e){return e[0]=="/"}}),cc.s_SharedFileUtils=null,cc.FileUtils.getInstance=function(){return cc.s_SharedFileUtils==null&&(cc.s_SharedFileUtils=new cc.FileUtils),cc.s_SharedFileUtils},cc.Color3B=function(e,t,n){switch(arguments.length){case 0:this.r=0,this.g=0,this.b=0;break;case 1:e&&e instanceof cc.Color3B?(this.r=0|e.r||0,this.g=0|e.g||0,this.b=0|e.b||0):(this.r=0,this.g=0,this.b=0);break;case 3:this.r=0|e||0,this.g=0|t||0,this.b=0|n||0;break;default:throw"unknown argument type"}},cc.c3b=function(e,t,n){return new cc.Color3B(e,t,n)},cc.integerToColor3B=function(e){e=e||0;var t=255,n=new cc.Color3B;return n.r=e&t,n.g=e>>8&t,n.b=e>>16&t,n},cc.c3=cc.c3b,cc.c3BEqual=function(e,t){return e.r===t.r&&e.g===t.g&&e.b===t.b},Object.defineProperties(cc,{WHITE:{get:function(){return cc.c3b(255,255,255)}},YELLOW:{get:function(){return cc.c3b(255,255,0)}},BLUE:{get:function(){return cc.c3b(0,0,255)}},GREEN:{get:function(){return cc.c3b(0,255,0)}},RED:{get:function(){return cc.c3b(255,0,0)}},MAGENTA:{get:function(){return cc.c3b(255,0,255)}},BLACK:{get:function(){return cc.c3b(0,0,0)}},ORANGE:{get:function(){return cc.c3b(255,127,0)}},GRAY:{get:function(){return cc.c3b(166,166,166)}}}),cc.white=function(){return new cc.Color3B(255,255,255)},cc.yellow=function(){return new cc.Color3B(255,255,0)},cc.blue=function(){return new cc.Color3B(0,0,255)},cc.green=function(){return new cc.Color3B(0,255,0)},cc.red=function(){return new cc.Color3B(255,0,0)},cc.magenta=function(){return new cc.Color3B(255,0,255)},cc.black=function(){return new cc.Color3B(0,0,0)},cc.orange=function(){return new cc.Color3B(255,127,0)},cc.gray=function(){return new cc.Color3B(166,166,166)},cc.Color4B=function(e,t,n,r){this.r=0|e,this.g=0|t,this.b=0|n,this.a=0|r},cc.c4b=function(e,t,n,r){return new cc.Color4B(e,t,n,r)},cc.c4=cc.c4b,cc.Color4F=function(e,t,n,r){this.r=e,this.g=t,this.b=n,this.a=r},cc.c4f=function(e,t,n,r){return new cc.Color4F(e,t,n,r)},cc.c4FFromccc3B=function(e){return new cc.Color4F(e.r/255,e.g/255,e.b/255,1)},cc.c4FFromccc4B=function(e){return new cc.Color4F(e.r/255,e.g/255,e.b/255,e.a/255)},cc.c4BFromccc4F=function(e){return new cc.Color4B(0|e.r*255,0|e.g*255,0|e.b*255,0|e.a*255)},cc.c4FEqual=function(e,t){return e.r==t.r&&e.g==t.g&&e.b==t.b&&e.a==t.a},cc.Vertex2F=function(e,t){this.x=e||0,this.y=t||0},cc.Vertex2=function(e,t){return new cc.Vertex2F(e,t)},cc.Vertex3F=function(e,t,n){this.x=e||0,this.y=t||0,this.z=n||0},cc.vertex3=function(e,t,n){return new cc.Vertex3F(e,t,n)},cc.Tex2F=function(e,t){this.u=e||0,this.v=t||0},cc.tex2=function(e,t){return new cc.Tex2F(e,t)},cc.PointSprite=function(e,t,n){this.pos=e||new cc.Vertex2F(0,0),this.color=t||new cc.Color4B(0,0,0,0),this.size=n||0},cc.Quad2=function(e,t,n,r){this.tl=e||new cc.Vertex2F(0,0),this.tr=t||new cc.Vertex2F(0,0),this.bl=n||new cc.Vertex2F(0,0),this.br=r||new cc.Vertex2F(0,0)},cc.Quad3=function(e,t,n,r){this.bl=e||new cc.Vertex3F(0,0,0),this.br=t||new cc.Vertex3F(0,0,0),this.tl=n||new cc.Vertex3F(0,0,0),this.tr=r||new cc.Vertex3F(0,0,0)},cc.GridSize=function(e,t){this.x=e,this.y=t},cc.g=function(e,t){return new cc.GridSize(e,t)},cc.V2F_C4B_T2F=function(e,t,n){this.vertices=e||new cc.Vertex2F(0,0),this.colors=t||new cc.Color4B(0,0,0,0),this.texCoords=n||new cc.Tex2F(0,0)},cc.V2F_C4F_T2F=function(e,t,n){this.vertices=e||new cc.Vertex2F(0,0),this.colors=t||new cc.Color4F(0,0,0,0),this.texCoords=n||new cc.Tex2F(0,0)},cc.V3F_C4B_T2F=function(e,t,n){this.vertices=e||new cc.Vertex3F(0,0,0),this.colors=t||new cc.Color4B(0,0,0,0),this.texCoords=n||new cc.Tex2F(0,0)},cc.V2F_C4B_T2F_Triangle=function(e,t,n){this.a=e||new cc.V2F_C4B_T2F,this.b=t||new cc.V2F_C4B_T2F,this.c=n||new cc.V2F_C4B_T2F},cc.V2F_C4B_T2F_Quad=function(e,t,n,r){this.bl=e||new cc.V2F_C4B_T2F,this.br=t||new cc.V2F_C4B_T2F,this.tl=n||new cc.V2F_C4B_T2F,this.tr=r||new cc.V2F_C4B_T2F},cc.V2F_C4B_T2F_QuadZero=function(){return new cc.V2F_C4B_T2F_Quad(new cc.V2F_C4B_T2F(new cc.Vertex2F(0,0),new cc.Color4B(0,0,0,255),new cc.Tex2F(0,0)),new cc.V2F_C4B_T2F(new cc.Vertex2F(0,0),new cc.Color4B(0,0,0,255),new cc.Tex2F(0,0)),new cc.V2F_C4B_T2F(new cc.Vertex2F(0,0),new cc.Color4B(0,0,0,255),new cc.Tex2F(0,0)),new cc.V2F_C4B_T2F(new cc.Vertex2F(0,0),new cc.Color4B(0,0,0,255),new cc.Tex2F(0,0)))},cc.V3F_C4B_T2F_Quad=function(e,t,n,r){this.tl=e||new cc.V3F_C4B_T2F,this.bl=t||new cc.V3F_C4B_T2F,this.tr=n||new cc.V3F_C4B_T2F,this.br=r||new cc.V3F_C4B_T2F},cc.V3F_C4B_T2F_QuadZero=function(){return new cc.V3F_C4B_T2F_Quad(new cc.V3F_C4B_T2F(new cc.Vertex3F(0,0,0),new cc.Color4B(0,0,0,255),new cc.Tex2F(0,0)),new cc.V3F_C4B_T2F(new cc.Vertex3F(0,0,0),new cc.Color4B(0,0,0,255),new cc.Tex2F(0,0)),new cc.V3F_C4B_T2F(new cc.Vertex3F(0,0,0),new cc.Color4B(0,0,0,255),new cc.Tex2F(0,0)),new cc.V3F_C4B_T2F(new cc.Vertex3F(0,0,0),new cc.Color4B(0,0,0,255),new cc.Tex2F(0,0)))},cc.V3F_C4B_T2F_QuadCopy=function(e){if(!e)return cc.V3F_C4B_T2F_QuadZero();var t=e.tl,n=e.bl,r=e.tr,i=e.br;return new cc.V3F_C4B_T2F_Quad(new cc.V3F_C4B_T2F(new cc.Vertex3F(e.tl.vertices.x,e.tl.vertices.y,e.tl.vertices.z),new cc.Color4B(e.tl.colors.r,e.tl.colors.g,e.tl.colors.b,e.tl.colors.a),new cc.Tex2F(e.tl.texCoords.u,e.tl.texCoords.v)),new cc.V3F_C4B_T2F(new cc.Vertex3F(e.bl.vertices.x,e.bl.vertices.y,e.bl.vertices.z),new cc.Color4B(e.bl.colors.r,e.bl.colors.g,e.bl.colors.b,e.bl.colors.a),new cc.Tex2F(e.bl.texCoords.u,e.bl.texCoords.v)),new cc.V3F_C4B_T2F(new cc.Vertex3F(e.tr.vertices.x,e.tr.vertices.y,e.tr.vertices.z),new cc.Color4B(e.tr.colors.r,e.tr.colors.g,e.tr.colors.b,e.tr.colors.a),new cc.Tex2F(e.tr.texCoords.u,e.tr.texCoords.v)),new cc.V3F_C4B_T2F(new cc.Vertex3F(e.br.vertices.x,e.br.vertices.y,e.br.vertices.z),new cc.Color4B(e.br.colors.r,e.br.colors.g,e.br.colors.b,e.br.colors.a),new cc.Tex2F(e.br.texCoords.u,e.br.texCoords.v)))},cc.V3F_C4B_T2F_QuadsCopy=function(e){if(!e)return[];var t=[];for(var n=0;n<e.length;n++)t.push(cc.V3F_C4B_T2F_QuadCopy(e[n]));return t},cc.V2F_C4F_T2F_Quad=function(e,t,n,r){this.bl=e||new cc.V2F_C4F_T2F,this.br=t||new cc.V2F_C4F_T2F,this.tl=n||new cc.V2F_C4F_T2F,this.tr=r||new cc.V2F_C4F_T2F},cc.BlendFunc=function(e,t){this.src=e,this.dst=t},cc.BlendFuncDisable=function(){return new cc.BlendFunc(gl.ONE,gl.ZERO)},cc.T2F_Quad=function(e,t,n,r){this.bl=e,this.br=t,this.tl=n,this.tr=r},cc.AnimationFrameData=function(e,t,n){this.texCoords=e,this.delay=t,this.size=n},cc.convertColor3BtoHexString=function(e){var t=e.r.toString(16),n=e.g.toString(16),r=e.b.toString(16),i="#"+(e.r<16?"0"+t:t)+(e.g<16?"0"+n:n)+(e.b<16?"0"+r:r);return i},cc.Browser.supportWebGL&&(cc.Color4B=function(e,t,n,r,i,s){this._arrayBuffer=i||new ArrayBuffer(cc.Color4B.BYTES_PER_ELEMENT),this._offset=s||0;var o=this._arrayBuffer,u=this._offset,a=Uint8Array.BYTES_PER_ELEMENT;this._rU8=new Uint8Array(o,u,1),this._gU8=new Uint8Array(o,u+a,1),this._bU8=new Uint8Array(o,u+a*2,1),this._aU8=new Uint8Array(o,u+a*3,1),this._rU8[0]=e||0,this._gU8[0]=t||0,this._bU8[0]=n||0,this._aU8[0]=r||0},cc.Color4B.BYTES_PER_ELEMENT=4,Object.defineProperties(cc.Color4B.prototype,{r:{get:function(){return this._rU8[0]},set:function(e){this._rU8[0]=e},enumerable:!0},g:{get:function(){return this._gU8[0]},set:function(e){this._gU8[0]=e},enumerable:!0},b:{get:function(){return this._bU8[0]},set:function(e){this._bU8[0]=e},enumerable:!0},a:{get:function(){return this._aU8[0]},set:function(e){this._aU8[0]=e},enumerable:!0}}),cc.Color4F=function(e,t,n,r,i,s){this._arrayBuffer=i||new ArrayBuffer(cc.Color4F.BYTES_PER_ELEMENT),this._offset=s||0;var o=this._arrayBuffer,u=this._offset,a=Float32Array.BYTES_PER_ELEMENT;this._rF32=new Float32Array(o,u,1),this._rF32[0]=e||0,this._gF32=new Float32Array(o,u+a,1),this._gF32[0]=t||0,this._bF32=new Float32Array(o,u+a*2,1),this._bF32[0]=n||0,this._aF32=new Float32Array(o,u+a*3,1),this._aF32[0]=r||0},cc.Color4F.BYTES_PER_ELEMENT=16,Object.defineProperties(cc.Color4F.prototype,{r:{get:function(){return this._rF32[0]},set:function(e){this._rF32[0]=e},enumerable:!0},g:{get:function(){return this._gF32[0]},set:function(e){this._gF32[0]=e},enumerable:!0},b:{get:function(){return this._bF32[0]},set:function(e){this._bF32[0]=e},enumerable:!0},a:{get:function(){return this._aF32[0]},set:function(e){this._aF32[0]=e},enumerable:!0}}),cc.Vertex2F=function(e,t,n,r){this._arrayBuffer=n||new ArrayBuffer(cc.Vertex2F.BYTES_PER_ELEMENT),this._offset=r||0,this._xF32=new Float32Array(this._arrayBuffer,this._offset,1),this._yF32=new Float32Array(this._arrayBuffer,this._offset+4,1),this._xF32[0]=e||0,this._yF32[0]=t||0},cc.Vertex2F.BYTES_PER_ELEMENT=8,Object.defineProperties(cc.Vertex2F.prototype,{x:{get:function(){return this._xF32[0]},set:function(e){this._xF32[0]=e},enumerable:!0},y:{get:function(){return this._yF32[0]},set:function(e){this._yF32[0]=e},enumerable:!0}}),cc.Vertex3F=function(e,t,n,r,i){this._arrayBuffer=r||new ArrayBuffer(cc.Vertex3F.BYTES_PER_ELEMENT),this._offset=i||0;var s=this._arrayBuffer,o=this._offset;this._xF32=new Float32Array(s,o,1),this._xF32[0]=e||0,this._yF32=new Float32Array(s,o+Float32Array.BYTES_PER_ELEMENT,1),this._yF32[0]=t||0,this._zF32=new Float32Array(s,o+Float32Array.BYTES_PER_ELEMENT*2,1),this._zF32[0]=n||0},cc.Vertex3F.BYTES_PER_ELEMENT=12,Object.defineProperties(cc.Vertex3F.prototype,{x:{get:function(){return this._xF32[0]},set:function(e){this._xF32[0]=e},enumerable:!0},y:{get:function(){return this._yF32[0]},set:function(e){this._yF32[0]=e},enumerable:!0},z:{get:function(){return this._zF32[0]},set:function(e){this._zF32[0]=e},enumerable:!0}}),cc.Tex2F=function(e,t,n,r){this._arrayBuffer=n||new ArrayBuffer(cc.Tex2F.BYTES_PER_ELEMENT),this._offset=r||0,this._uF32=new Float32Array(this._arrayBuffer,this._offset,1),this._vF32=new Float32Array(this._arrayBuffer,this._offset+4,1),this._uF32[0]=e||0,this._vF32[0]=t||0},cc.Tex2F.BYTES_PER_ELEMENT=8,Object.defineProperties(cc.Tex2F.prototype,{u:{get:function(){return this._uF32[0]},set:function(e){this._uF32[0]=e},enumerable:!0},v:{get:function(){return this._vF32[0]},set:function(e){this._vF32[0]=e},enumerable:!0}}),cc.Quad2=function(e,t,n,r,i,s){this._arrayBuffer=i||new ArrayBuffer(cc.Quad2.BYTES_PER_ELEMENT),this._offset=s||0;var o=this._arrayBuffer,u=cc.Vertex2F.BYTES_PER_ELEMENT;this._tl=e?new cc.Vertex2F(e.x,e.y,o,0):new cc.Vertex2F(0,0,o,0),this._tr=t?new cc.Vertex2F(t.x,t.y,o,u):new cc.Vertex2F(0,0,o,u),this._bl=n?new cc.Vertex2F(n.x,n.y,o,u*2):new cc.Vertex2F(0,0,o,u*2),this._br=r?new cc.Vertex2F(r.x,r.y,o,u*3):new cc.Vertex2F(0,0,o,u*3)},cc.Quad2.BYTES_PER_ELEMENT=32,Object.defineProperties(cc.Quad2.prototype,{tl:{get:function(){return this._tl},set:function(e){this._tl.x=e.x,this._tl.y=e.y},enumerable:!0},tr:{get:function(){return this._tr},set:function(e){this._tr.x=e.x,this._tr.y=e.y},enumerable:!0},bl:{get:function(){return this._bl},set:function(e){this._bl.x=e.x,this._bl.y=e.y},enumerable:!0},br:{get:function(){return this._br},set:function(e){this._br.x=e.x,this._br.y=e.y},enumerable:!0}}),cc.V3F_C4B_T2F=function(e,t,n,r,i){this._arrayBuffer=r||new ArrayBuffer(cc.V3F_C4B_T2F.BYTES_PER_ELEMENT),this._offset=i||0;var s=this._arrayBuffer,o=this._offset,u=cc.Vertex3F.BYTES_PER_ELEMENT;this._vertices=e?new cc.Vertex3F(e.x,e.y,e.z,s,o):new cc.Vertex3F(0,0,0,s,o),this._colors=t?new cc.Color4B(t.r,t.g,t.b,t.a,s,o+u):new cc.Color4B(0,0,0,0,s,o+u),this._texCoords=n?new cc.Tex2F(n.u,n.v,s,o+u+cc.Color4B.BYTES_PER_ELEMENT):new cc.Tex2F(0,0,s,o+u+cc.Color4B.BYTES_PER_ELEMENT)},cc.V3F_C4B_T2F.BYTES_PER_ELEMENT=24,Object.defineProperties(cc.V3F_C4B_T2F.prototype,{vertices:{get:function(){return this._vertices},set:function(e){var t=this._vertices;t.x=e.x,t.y=e.y,t.z=e.z},enumerable:!0},colors:{get:function(){return this._colors},set:function(e){var t=this._colors;t.r=e.r,t.g=e.g,t.b=e.b,t.a=e.a},enumerable:!0},texCoords:{get:function(){return this._texCoords},set:function(e){this._texCoords.u=e.u,this._texCoords.v=e.v},enumerable:!0}}),cc.V3F_C4B_T2F_Quad=function(e,t,n,r,i,s){this._arrayBuffer=i||new ArrayBuffer(cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT),this._offset=s||0;var o=this._arrayBuffer,u=this._offset,a=cc.V3F_C4B_T2F.BYTES_PER_ELEMENT;this._tl=e?new cc.V3F_C4B_T2F(e.vertices,e.colors,e.texCoords,o,u):new cc.V3F_C4B_T2F(null,null,null,o,u),this._bl=t?new cc.V3F_C4B_T2F(t.vertices,t.colors,t.texCoords,o,u+a):new cc.V3F_C4B_T2F(null,null,null,o,u+a),this._tr=n?new cc.V3F_C4B_T2F(n.vertices,n.colors,n.texCoords,o,u+a*2):new cc.V3F_C4B_T2F(null,null,null,o,u+a*2),this._br=r?new cc.V3F_C4B_T2F(r.vertices,r.colors,r.texCoords,o,u+a*3):new cc.V3F_C4B_T2F(null,null,null,o,u+a*3)},cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT=96,Object.defineProperties(cc.V3F_C4B_T2F_Quad.prototype,{tl:{get:function(){return this._tl},set:function(e){var t=this._tl;t.vertices=e.vertices,t.colors=e.colors,t.texCoords=e.texCoords},enumerable:!0},bl:{get:function(){return this._bl},set:function(e){var t=this._bl;t.vertices=e.vertices,t.colors=e.colors,t.texCoords=e.texCoords},enumerable:!0},tr:{get:function(){return this._tr},set:function(e){var t=this._tr;t.vertices=e.vertices,t.colors=e.colors,t.texCoords=e.texCoords},enumerable:!0},br:{get:function(){return this._br},set:function(e){var t=this._br;t.vertices=e.vertices,t.colors=e.colors,t.texCoords=e.texCoords},enumerable:!0},arrayBuffer:{get:function(){return this._arrayBuffer},enumerable:!0}}),cc.V3F_C4B_T2F_QuadZero=function(){return new cc.V3F_C4B_T2F_Quad},cc.V3F_C4B_T2F_QuadCopy=function(e){if(!e)return cc.V3F_C4B_T2F_QuadZero();var t=e.tl,n=e.bl,r=e.tr,i=e.br;return{tl:{vertices:{x:t.vertices.x,y:t.vertices.y,z:t.vertices.z},colors:{r:t.colors.r,g:t.colors.g,b:t.colors.b,a:t.colors.a},texCoords:{u:t.texCoords.u,v:t.texCoords.v}},bl:{vertices:{x:n.vertices.x,y:n.vertices.y,z:n.vertices.z},colors:{r:n.colors.r,g:n.colors.g,b:n.colors.b,a:n.colors.a},texCoords:{u:n.texCoords.u,v:n.texCoords.v}},tr:{vertices:{x:r.vertices.x,y:r.vertices.y,z:r.vertices.z},colors:{r:r.colors.r,g:r.colors.g,b:r.colors.b,a:r.colors.a},texCoords:{u:r.texCoords.u,v:r.texCoords.v}},br:{vertices:{x:i.vertices.x,y:i.vertices.y,z:i.vertices.z},colors:{r:i.colors.r,g:i.colors.g,b:i.colors.b,a:i.colors.a},texCoords:{u:i.texCoords.u,v:i.texCoords.v}}}},cc.V2F_C4B_T2F=function(e,t,n,r,i){this._arrayBuffer=r||new ArrayBuffer(cc.V2F_C4B_T2F.BYTES_PER_ELEMENT),this._offset=i||0;var s=this._arrayBuffer,o=this._offset,u=cc.Vertex2F.BYTES_PER_ELEMENT;this._vertices=e?new cc.Vertex2F(e.x,e.y,s,o):new cc.Vertex2F(0,0,s,o),this._colors=t?new cc.Color4B(t.r,t.g,t.b,t.a,s,o+u):new cc.Color4B(0,0,0,0,s,o+u),this._texCoords=n?new cc.Tex2F(n.u,n.v,s,o+u+cc.Color4B.BYTES_PER_ELEMENT):new cc.Tex2F(0,0,s,o+u+cc.Color4B.BYTES_PER_ELEMENT)},cc.V2F_C4B_T2F.BYTES_PER_ELEMENT=20,Object.defineProperties(cc.V2F_C4B_T2F.prototype,{vertices:{get:function(){return this._vertices},set:function(e){this._vertices.x=e.x,this._vertices.y=e.y},enumerable:!0},colors:{get:function(){return this._colors},set:function(e){var t=this._colors;t.r=e.r,t.g=e.g,t.b=e.b,t.a=e.a},enumerable:!0},texCoords:{get:function(){return this._texCoords},set:function(e){this._texCoords.u=e.u,this._texCoords.v=e.v},enumerable:!0}}),cc.V2F_C4B_T2F_Triangle=function(e,t,n,r,i){this._arrayBuffer=r||new ArrayBuffer(cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT),this._offset=i||0;var s=this._arrayBuffer,o=this._offset,u=cc.V2F_C4B_T2F.BYTES_PER_ELEMENT;this._a=e?new cc.V2F_C4B_T2F(e.vertices,e.colors,e.texCoords,s,o):new cc.V2F_C4B_T2F(null,null,null,s,o),this._b=t?new cc.V2F_C4B_T2F(t.vertices,t.colors,t.texCoords,s,o+u):new cc.V2F_C4B_T2F(null,null,null,s,o+u),this._c=n?new cc.V2F_C4B_T2F(n.vertices,n.colors,n.texCoords,s,o+u*2):new cc.V2F_C4B_T2F(null,null,null,s,o+u*2)},cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT=60,Object.defineProperties(cc.V2F_C4B_T2F_Triangle.prototype,{a:{get:function(){return this._a},set:function(e){var t=this._a;t.vertices=e.vertices,t.colors=e.colors,t.texCoords=e.texCoords},enumerable:!0},b:{get:function(){return this._b},set:function(e){var t=this._b;t.vertices=e.vertices,t.colors=e.colors,t.texCoords=e.texCoords},enumerable:!0},c:{get:function(){return this._c},set:function(e){var t=this._c;t.vertices=e.vertices,t.colors=e.colors,t.texCoords=e.texCoords},enumerable:!0}})),cc.convertHexNumToColor3B=function(e){var t=e.substr(1).split(""),n=parseInt("0x"+t[0]+t[1]),r=parseInt("0x"+t[2]+t[3]),i=parseInt("0x"+t[4]+t[5]);return new cc.Color3B(n,r,i)},cc.TEXT_ALIGNMENT_LEFT=0,cc.TEXT_ALIGNMENT_CENTER=1,cc.TEXT_ALIGNMENT_RIGHT=2,cc.VERTICAL_TEXT_ALIGNMENT_TOP=0,cc.VERTICAL_TEXT_ALIGNMENT_CENTER=1,cc.VERTICAL_TEXT_ALIGNMENT_BOTTOM=2,cc._Dictionary=cc.Class.extend({_keyMapTb:null,_valueMapTb:null,__currId:0,ctor:function(){this._keyMapTb={},this._valueMapTb={},this.__currId=2<<(0|Math.random()*10)},__getKey:function(){return this.__currId++,"key_"+this.__currId},setObject:function(e,t){if(t==null)return;var n=this.__getKey();this._keyMapTb[n]=t,this._valueMapTb[n]=e},objectForKey:function(e){if(e==null)return null;var t=this._keyMapTb;for(var n in t)if(t[n]===e)return this._valueMapTb[n];return null},valueForKey:function(e){return this.objectForKey(e)},removeObjectForKey:function(e){if(e==null)return;var t=this._keyMapTb;for(var n in t)if(t[n]===e){delete this._valueMapTb[n],delete t[n];return}},removeObjectsForKeys:function(e){if(e==null)return;for(var t=0;t<e.length;t++)this.removeObjectForKey(e[t])},allKeys:function(){var e=[],t=this._keyMapTb;for(var n in t)e.push(t[n]);return e},removeAllObjects:function(){this._keyMapTb={},this._valueMapTb={}},count:function(){return this.allKeys().length}}),cc.FontDefinition=function(){this.fontName="Arial",this.fontSize=12,this.fontAlignmentH=cc.TEXT_ALIGNMENT_CENTER,this.fontAlignmentV=cc.VERTICAL_TEXT_ALIGNMENT_TOP,this.fontFillColor=cc.white(),this.fontDimensions=cc.size(0,0),this.strokeEnabled=!1,this.strokeColor=cc.white(),this.strokeSize=1,this.shadowEnabled=!1,this.shadowOffset=cc.size(0,0),this.shadowBlur=0,this.shadowOpacity=1},cc.RESOLUTION_POLICY={EXACT_FIT:0,NO_BORDER:1,SHOW_ALL:2,FIXED_HEIGHT:3,FIXED_WIDTH:4,UNKNOWN:5},cc.Touches=[],cc.TouchesIntergerDict={},cc.EGLView=cc.Class.extend({_delegate:null,_frameSize:null,_designResolutionSize:null,_originalDesignResolutionSize:null,_viewPortRect:null,_visibleRect:null,_devicePixelRatio:1,_viewName:"",_resizeCallback:null,_scaleX:1,_originalScaleX:1,_scaleY:1,_originalScaleY:1,_indexBitsUsed:0,_maxTouches:5,_resolutionPolicy:null,_rpExactFit:null,_rpShowAll:null,_rpNoBorder:null,_rpFixedHeight:null,_rpFixedWidth:null,_initialized:!1,_captured:!1,_wnd:null,_hDC:null,_hRC:null,_accelerometerKeyHook:null,_supportTouch:!1,_contentTranslateLeftTop:null,_menu:null,_frame:null,_frameZoomFactor:1,__resizeWithBrowserSize:!1,_isAdjustViewPort:!0,ctor:function(){this._frame=cc.container.parentNode===document.body?document.documentElement:cc.container.parentNode,this._frameSize=cc.size(0,0),this._initFrameSize();var e=cc.canvas.width,t=cc.canvas.height;this._designResolutionSize=cc.size(e,t),this._originalDesignResolutionSize=cc.size(e,t),this._viewPortRect=cc.rect(0,0,e,t),this._visibleRect=cc.rect(0,0,e,t),this._delegate=cc.Director.getInstance().getTouchDispatcher(),this._contentTranslateLeftTop={left:0,top:0},this._viewName="Cocos2dHTML5",cc.VisibleRect.init(this._designResolutionSize),this._rpExactFit=new cc.ResolutionPolicy(cc.ContainerStrategy.EQUAL_TO_FRAME,cc.ContentStrategy.EXACT_FIT),this._rpShowAll=new cc.ResolutionPolicy(cc.ContainerStrategy.PROPORTION_TO_FRAME,cc.ContentStrategy.SHOW_ALL),this._rpNoBorder=new cc.ResolutionPolicy(cc.ContainerStrategy.EQUAL_TO_FRAME,cc.ContentStrategy.NO_BORDER),this._rpFixedHeight=new cc.ResolutionPolicy(cc.ContainerStrategy.EQUAL_TO_FRAME,cc.ContentStrategy.FIXED_HEIGHT),this._rpFixedWidth=new cc.ResolutionPolicy(cc.ContainerStrategy.EQUAL_TO_FRAME,cc.ContentStrategy.FIXED_WIDTH),this._hDC=cc.canvas,this._hRC=cc.renderContext},_resizeEvent:function(){var e=this._originalDesignResolutionSize.width,t=this._originalDesignResolutionSize.height;this._resizeCallback&&(this._initFrameSize(),this._resizeCallback.call()),e>0&&this.setDesignResolutionSize(e,t,this._resolutionPolicy)},resizeWithBrowserSize:function(e){var t;e?this.__resizeWithBrowserSize||(this.__resizeWithBrowserSize=!0,t=this._resizeEvent.bind(this),window.addEventListener("resize",t,!1)):this.__resizeWithBrowserSize&&(this.__resizeWithBrowserSize=!0,t=this._resizeEvent.bind(this),window.removeEventListener("resize",t,!1))},setResizeCallback:function(e){if(typeof e=="function"||e==null)this._resizeCallback=e},_initFrameSize:function(){var e=this._frameSize;e.width=this._frame.clientWidth,e.height=this._frame.clientHeight},_adjustSizeKeepCanvasSize:function(e,t){var n=this._originalDesignResolutionSize.width,r=this._originalDesignResolutionSize.height;n>0&&this.setDesignResolutionSize(n,r,this._resolutionPolicy)},_setViewPortMeta:function(e,t){if(this._isAdjustViewPort){var n={"user-scalable":"no","maximum-scale":"1.0","initial-scale":"1.0"},r=document.getElementsByName("viewport"),i,s;r.length==0?(i=document.createElement("meta"),i.name="viewport",i.content="",document.head.appendChild(i)):i=r[0];if(cc.Browser.isMobile&&cc.Browser.type=="firefox"){i.content="initial-scale:1";return}s=i.content;for(var o in n){var u=new RegExp(o);u.test(s)||(s+=(s==""?"":",")+o+"="+n[o])}i.content=s}},_setScaleXYForRenderTexture:function(){var e=cc.CONTENT_SCALE_FACTOR();this._scaleX=e,this._scaleY=e},_resetScale:function(){this._scaleX=this._originalScaleX,this._scaleY=this._originalScaleY},_getUnUsedIndex:function(){var e,t=this._indexBitsUsed;for(e=0;e<this._maxTouches;e++){if(!(t&1))return this._indexBitsUsed|=1<<e,e;t>>=1}return-1},_removeUsedIndexBit:function(e){if(e<0||e>=this._maxTouches)return;var t=1<<e;t=~t,this._indexBitsUsed&=t},_adjustSizeToBrowser:function(){},initialize:function(){this._initialized=!0},adjustViewPort:function(e){this._isAdjustViewPort=e},end:function(){},isOpenGLReady:function(){return this._hDC!=null&&this._hRC!=null},setFrameZoomFactor:function(e){this._frameZoomFactor=e,this.centerWindow(),cc.Director.getInstance().setProjection(cc.Director.getInstance().getProjection())},swapBuffers:function(){},setIMEKeyboardState:function(e){e},setContentTranslateLeftTop:function(e,t){this._contentTranslateLeftTop={left:e,top:t}},getContentTranslateLeftTop:function(){return this._contentTranslateLeftTop},getFrameSize:function(){return cc.size(this._frameSize.width,this._frameSize.height)},setFrameSize:function(e,t){this._frameSize.width=e,this._frameSize.height=t,this._frame.style.width=e+"px",this._frame.style.height=t+"px",this._resizeEvent(),cc.Director.getInstance().setProjection(cc.Director.getInstance().getProjection())},centerWindow:function(){},setAccelerometerKeyHook:function(e){this._accelerometerKeyHook=e},getVisibleSize:function(){return this._visibleRect._size},getVisibleOrigin:function(){return this._visibleRect._origin},canSetContentScaleFactor:function(){return!0},getResolutionPolicy:function(){return this._resolutionPolicy},setResolutionPolicy:function(e){if(e instanceof cc.ResolutionPolicy)this._resolutionPolicy=e;else switch(e){case cc.RESOLUTION_POLICY.EXACT_FIT:this._resolutionPolicy=this._rpExactFit;break;case cc.RESOLUTION_POLICY.SHOW_ALL:this._resolutionPolicy=this._rpShowAll;break;case cc.RESOLUTION_POLICY.NO_BORDER:this._resolutionPolicy=this._rpNoBorder;break;case cc.RESOLUTION_POLICY.FIXED_HEIGHT:this._resolutionPolicy=this._rpFixedHeight;break;case cc.RESOLUTION_POLICY.FIXED_WIDTH:this._resolutionPolicy=this._rpFixedWidth}},setDesignResolutionSize:function(e,t,n){if(isNaN(e)||e==0||isNaN(t)||t==0){cc.log("Resolution not valid");return}this.setResolutionPolicy(n);var r=this._resolutionPolicy;if(!r){cc.log("should set resolutionPolicy");return}r.preApply(this);var i=this._frameSize.width,s=this._frameSize.height;cc.Browser.isMobile&&this._setViewPortMeta(this._frameSize.width,this._frameSize.height),this._initFrameSize();if(n==this._resolutionPolicy&&e==this._originalDesignResolutionSize.width&&t==this._originalDesignResolutionSize.height&&i==this._frameSize.width&&s==this._frameSize.height)return;this._designResolutionSize=cc.size(e,t),this._originalDesignResolutionSize=cc.size(e,t);var o=r.apply(this,this._designResolutionSize);o.scale&&o.scale.length==2&&(this._scaleX=o.scale[0],this._scaleY=o.scale[1]);if(o.viewport instanceof cc.Rect){var u=this._viewPortRect=o.viewport,a=this._visibleRect;a._size.width=cc.canvas.width/this._scaleX,a._size.height=cc.canvas.height/this._scaleY,a._origin.x=-u.x/this._scaleX,a._origin.y=-u.y/this._scaleY}var f=cc.Director.getInstance();f._winSizeInPoints=this.getDesignResolutionSize(),r.postApply(this),cc.renderContextType==cc.WEBGL&&(f._createStatsLabel(),f.setGLDefaultValues()),this._originalScaleX=this._scaleX,this._originalScaleY=this._scaleY,cc.DOM&&cc.DOM._resetEGLViewDiv(),cc.VisibleRect.init(this.getVisibleSize())},getDesignResolutionSize:function(){return cc.size(this._designResolutionSize.width,this._designResolutionSize.height)},setTouchDelegate:function(e){this._delegate=e},setViewPortInPoints:function(e,t,n,r){var i=this._frameZoomFactor,s=this._scaleX,o=this._scaleY;cc.renderContext.viewport(e*s*i+this._viewPortRect.x*i,t*o*i+this._viewPortRect.y*i,n*s*i,r*o*i)},setScissorInPoints:function(e,t,n,r){var i=this._frameZoomFactor,s=this._scaleX,o=this._scaleY;cc.renderContext.scissor(e*s*i+this._viewPortRect.x*i,t*o*i+this._viewPortRect.y*i,n*s*i,r*o*i)},isScissorEnabled:function(){var e=cc.renderContext;return e.isEnabled(e.SCISSOR_TEST)},getScissorRect:function(){var e=cc.renderContext,t=this._scaleX,n=this._scaleY,r=e.getParameter(e.SCISSOR_BOX);return cc.rect((r[0]-this._viewPortRect.x)/t,(r[1]-this._viewPortRect.y)/n,r[2]/t,r[3]/n)},setViewName:function(e){e!=null&&e.length>0&&(this._viewName=e)},getViewName:function(){return this._viewName},getViewPortRect:function(){return this._viewPortRect},getScaleX:function(){return this._scaleX},getScaleY:function(){return this._scaleY},getDevicePixelRatio:function(){return this._devicePixelRatio},convertToLocationInView:function(e,t,n){return{x:this._devicePixelRatio*(e-n.left),y:this._devicePixelRatio*(n.top+n.height-t)}},handleTouchesBegin:function(e,t,n,r){var i=[],s=this._viewPortRect,o=this._scaleX,u=this._scaleY;for(var a=0;a<e;++a){var f=t[a],l=n[a],c=r[a],h=cc.TouchesIntergerDict[f],p=0;if(h==null){p=this._getUnUsedIndex();if(p==-1){cc.log("The touches is more than MAX_TOUCHES, nUnusedIndex = "+p);continue}var d=cc.Touches[p]=new cc.Touch;d.setTouchInfo(p,(l-s.x)/o,(c-s.y)/u),cc.TouchesIntergerDict[f]=0|p,i.push(d)}}i.length!==0&&this._delegate.touchesBegan(i,null)},handleTouchesMove:function(e,t,n,r){var i=[],s=this._scaleX,o=this._scaleY,u=this._viewPortRect.x,a=this._viewPortRect.y;for(var f=0;f<e;++f){var l=t[f],c=n[f],h=r[f],p=cc.TouchesIntergerDict[l];if(p==null)continue;var d=cc.Touches[p];if(!d)return;d.setTouchInfo(p,(c-u)/s,(h-a)/o),i.push(d)}if(i.length==0)return;this._delegate.touchesMoved(i,null)},handleTouchesEnd:function(e,t,n,r){var i=[];this.getSetOfTouchesEndOrCancel(i,e,t,n,r),this._delegate.touchesEnded(i,null)},handleTouchesCancel:function(e,t,n,r){var i=[];this.getSetOfTouchesEndOrCancel(i,e,t,n,r),this._delegate.touchesCancelled(i,null)},getSetOfTouchesEndOrCancel:function(e,t,n,r,i){var s=this._scaleX,o=this._scaleY,u=this._viewPortRect;for(var a=0;a<t;++a){var f=n[a],l=r[a],c=i[a],h=cc.TouchesIntergerDict[f];if(h==null)continue;var p=cc.Touches[h];if(!p)return;p.setTouchInfo(h,(l-u.x)/s,(c-u.y)/o),e.push(p),cc.Touches[h]=null,this._removeUsedIndexBit(h),delete cc.TouchesIntergerDict[f]}},touchesBegan:function(e,t){var n=[],r=[],i=[],s=0,o;for(var u=0;u<e.length;u++)o=e[u],n[s]=o.getId()||u,r[s]=o.getLocation().x,i[s]=o.getLocation().y,++s;this.handleTouchesBegin(s,n,r,i)},touchesMoved:function(e,t){var n=[],r=[],i=[],s=0,o;for(var u=0;u<e.length;u++)o=e[u],n[s]=o.getId()||u,r[s]=o.getLocation().x,i[s]=o.getLocation().y,++s;this.handleTouchesMove(s,n,r,i)},touchesEnded:function(e,t){var n=[],r=[],i=[],s=0,o;for(var u=0;u<e.length;u++)o=e[u],n[s]=o.getId()||u,r[s]=o.getLocation().x,i[s]=o.getLocation().y,++s;this.handleTouchesEnd(s,n,r,i)},touchesCancelled:function(e,t){var n=[],r=[],i=[],s=0,o;for(var u=0;u<e.length;u++)o=e[u],n[s]=o.getId()||u,r[s]=o.getLocation().x,i[s]=o.getLocation().y,++s;this.handleTouchesCancel(s,n,r,i)}}),cc.EGLView.getInstance=function(){return this._instance||(cc.Director.getInstance(),this._instance=this._instance||new cc.EGLView,this._instance.initialize()),this._instance},cc.ContainerStrategy=cc.Class.extend({_adjustRetina:!1,preApply:function(e){if(sys.os=="iOS"||sys.os=="OS X")this._adjustRetina=!0},apply:function(e,t){},postApply:function(e){},_setupContainer:function(e,t,n){var r=e._frame;cc.Browser.isMobile&&r==document.documentElement&&cc.Screen.getInstance().autoFullScreen(r);var i=cc.canvas,s=cc.container;s.style.width=i.style.width=t+"px",s.style.height=i.style.height=n+"px";var o=e._devicePixelRatio=1;this._adjustRetina&&(o=e._devicePixelRatio=window.devicePixelRatio||1),i.width=t*o,i.height=n*o;var u=document.body,a;u&&(a=u.style)&&(a.paddingTop=a.paddingTop||"0px",a.paddingRight=a.paddingRight||"0px",a.paddingBottom=a.paddingBottom||"0px",a.paddingLeft=a.paddingLeft||"0px",a.borderTop=a.borderTop||"0px",a.borderRight=a.borderRight||"0px",a.borderBottom=a.borderBottom||"0px",a.borderLeft=a.borderLeft||"0px",a.marginTop=a.marginTop||"0px",a.marginRight=a.marginRight||"0px",a.marginBottom=a.marginBottom||"0px",a.marginLeft=a.marginLeft||"0px")},_fixContainer:function(){document.body.insertBefore(cc.container,document.body.firstChild);var e=document.body.style;e.width=window.innerWidth+"px",e.height=window.innerHeight+"px",e.overflow="hidden";var t=cc.container.style;t.position="fixed",t.left=t.top="0px",document.body.scrollTop=0}}),cc.ContentStrategy=cc.Class.extend({_result:{scale:[1,1],viewport:null},_buildResult:function(e,t,n,r,i,s){Math.abs(e-n)<2&&(n=e),Math.abs(t-r)<2&&(r=t);var o=cc.rect(Math.round((e-n)/2),Math.round((t-r)/2),n,r);return cc.renderContextType==cc.CANVAS&&cc.renderContext.translate(o.x,o.y+r),this._result.scale=[i,s],this._result.viewport=o,this._result},preApply:function(e){},apply:function(e,t){return{scale:[1,1]}},postApply:function(e){}}),function(){var e=cc.ContainerStrategy.extend({apply:function(e){this._setupContainer(e,e._frameSize.width,e._frameSize.height)}}),t=cc.ContainerStrategy.extend({apply:function(e,t){var n=e._frameSize.width,r=e._frameSize.height,i=cc.container.style,s=t.width,o=t.height,u=n/s,a=r/o,f,l;u<a?(f=n,l=o*u):(f=s*a,l=r);var c=Math.round((n-f)/2),h=Math.round((r-l)/2);f=n-2*c,l=r-2*h,this._setupContainer(e,f,l),i.marginLeft=c+"px",i.marginRight=c+"px",i.marginTop=h+"px",i.marginBottom=h+"px"}}),n=e.extend({preApply:function(e){this._super(e),e._frame=document.documentElement},apply:function(e){this._super(e),this._fixContainer()}}),r=t.extend({preApply:function(e){this._super(e),e._frame=document.documentElement},apply:function(e,t){this._super(e,t),this._fixContainer()}}),i=cc.ContainerStrategy.extend({apply:function(e){this._setupContainer(e,cc.canvas.width,cc.canvas.height)}});cc.ContainerStrategy.EQUAL_TO_FRAME=new e,cc.ContainerStrategy.PROPORTION_TO_FRAME=new t,cc.ContainerStrategy.ORIGINAL_CONTAINER=new i;var s=cc.ContentStrategy.extend({apply:function(e,t){var n=cc.canvas.width,r=cc.canvas.height,i=n/t.width,s=r/t.height;return this._buildResult(n,r,n,r,i,s)}}),o=cc.ContentStrategy.extend({apply:function(e,t){var n=cc.canvas.width,r=cc.canvas.height,i=t.width,s=t.height,o=n/i,u=r/s,a=0,f,l;return o<u?(a=o,f=n,l=s*a):(a=u,f=i*a,l=r),this._buildResult(n,r,f,l,a,a)}}),u=cc.ContentStrategy.extend({apply:function(e,t){var n=cc.canvas.width,r=cc.canvas.height,i=t.width,s=t.height,o=n/i,u=r/s,a,f,l;return o<u?(a=u,f=i*a,l=r):(a=o,f=n,l=s*a),this._buildResult(n,r,f,l,a,a)}}),a=cc.ContentStrategy.extend({apply:function(e,t){var n=cc.canvas.width,r=cc.canvas.height,i=t.height,s=r/i,o=n,u=r;return this._buildResult(n,r,o,u,s,s)},postApply:function(e){cc.Director.getInstance()._winSizeInPoints=e.getVisibleSize()}}),f=cc.ContentStrategy.extend({apply:function(e,t){var n=cc.canvas.width,r=cc.canvas.height,i=t.width,s=n/i,o=n,u=r;return this._buildResult(n,r,o,u,s,s)},postApply:function(e){cc.Director.getInstance()._winSizeInPoints=e.getVisibleSize()}});cc.ContentStrategy.EXACT_FIT=new s,cc.ContentStrategy.SHOW_ALL=new o,cc.ContentStrategy.NO_BORDER=new u,cc.ContentStrategy.FIXED_HEIGHT=new a,cc.ContentStrategy.FIXED_WIDTH=new f}(),cc.ResolutionPolicy=cc.Class.extend({_containerStrategy:null,_contentStrategy:null,ctor:function(e,t){this.setContainerStrategy(e),this.setContentStrategy(t)},preApply:function(e){this._containerStrategy.preApply(e),this._contentStrategy.preApply(e)},apply:function(e,t){return this._containerStrategy.apply(e,t),this
._contentStrategy.apply(e,t)},postApply:function(e){this._containerStrategy.postApply(e),this._contentStrategy.postApply(e)},setContainerStrategy:function(e){e instanceof cc.ContainerStrategy&&(this._containerStrategy=e)},setContentStrategy:function(e){e instanceof cc.ContentStrategy&&(this._contentStrategy=e)}}),cc.Screen=cc.Class.extend({_supportsFullScreen:!1,_preOnFullScreenChange:null,_touchEvent:"",_fn:null,_fnMap:[["requestFullscreen","exitFullscreen","fullscreenchange","fullscreenEnabled","fullscreenElement"],["requestFullScreen","exitFullScreen","fullScreenchange","fullScreenEnabled","fullScreenElement"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitfullscreenchange","webkitIsFullScreen","webkitCurrentFullScreenElement"],["mozRequestFullScreen","mozCancelFullScreen","mozfullscreenchange","mozFullScreen","mozFullScreenElement"],["msRequestFullscreen","msExitFullscreen","MSFullscreenChange","msFullscreenEnabled","msFullscreenElement"]],init:function(){this._fn={};var e,t,n=this._fnMap,r;for(e=0,l=n.length;e<l;e++){t=n[e];if(t&&t[1]in document){for(e=0,r=t.length;e<r;e++)this._fn[n[0][e]]=t[e];break}}this._supportsFullScreen=this._fn.requestFullscreen!=undefined,this._touchEvent="ontouchstart"in window?"touchstart":"mousedown"},fullScreen:function(){return this._supportsFullScreen&&document[this._fn.fullscreenEnabled]},requestFullScreen:function(e,t){if(!this._supportsFullScreen)return;e=e||document.documentElement,e[this._fn.requestFullscreen]();if(t){var n=this._fn.fullscreenchange;this._preOnFullScreenChange&&document.removeEventListener(n,this._preOnFullScreenChange),this._preOnFullScreenChange=t,document.addEventListener(n,t,!1)}return e[this._fn.requestFullscreen]()},exitFullScreen:function(){return this._supportsFullScreen?document[this._fn.exitFullscreen]():!0},autoFullScreen:function(e,t){function i(){r.requestFullScreen(e,t),n.removeEventListener(r._touchEvent,i)}e=e||document.body;var n=cc.canvas||e,r=this;this.requestFullScreen(e,t),n.addEventListener(this._touchEvent,i)}}),cc.Screen.getInstance=function(){if(!this._instance){var e=new cc.Screen;e.init(),this._instance=e}return this._instance},cc.VisibleRect={_topLeft:cc._pConst(0,0),_topRight:cc._pConst(0,0),_top:cc._pConst(0,0),_bottomLeft:cc._pConst(0,0),_bottomRight:cc._pConst(0,0),_bottom:cc._pConst(0,0),_center:cc._pConst(0,0),_left:cc._pConst(0,0),_right:cc._pConst(0,0),_width:0,_height:0,init:function(e){this._width=e.width,this._height=e.height;var t=this._width,n=this._height;this._topLeft._y=n,this._topRight._x=t,this._topRight._y=n,this._top._x=t/2,this._top._y=n,this._bottomRight._x=t,this._bottom._x=t/2,this._center._x=t/2,this._center._y=n/2,this._left._y=n/2,this._right._x=t,this._right._y=n/2},getWidth:function(){return this._width},getHeight:function(){return this._height},topLeft:function(){return this._topLeft},topRight:function(){return this._topRight},top:function(){return this._top},bottomLeft:function(){return this._bottomLeft},bottomRight:function(){return this._bottomRight},bottom:function(){return this._bottom},center:function(){return this._center},left:function(){return this._left},right:function(){return this._right}},cc.AffineTransform=function(e,t,n,r,i,s){this.a=e,this.b=t,this.c=n,this.d=r,this.tx=i,this.ty=s},cc.__AffineTransformMake=function(e,t,n,r,i,s){return{a:e,b:t,c:n,d:r,tx:i,ty:s}},cc.AffineTransformMake=function(e,t,n,r,i,s){return{a:e,b:t,c:n,d:r,tx:i,ty:s}},cc.__PointApplyAffineTransform=function(e,t){return{x:t.a*e.x+t.c*e.y+t.tx,y:t.b*e.x+t.d*e.y+t.ty}},cc.PointApplyAffineTransform=function(e,t){return{x:t.a*e.x+t.c*e.y+t.tx,y:t.b*e.x+t.d*e.y+t.ty}},cc._PointApplyAffineTransform=function(e,t,n){return{x:n.a*e+n.c*t+n.tx,y:n.b*e+n.d*t+n.ty}},cc.__SizeApplyAffineTransform=function(e,t){return{width:t.a*e.width+t.c*e.height,height:t.b*e.width+t.d*e.height}},cc.SizeApplyAffineTransform=function(e,t){return{width:t.a*e.width+t.c*e.height,height:t.b*e.width+t.d*e.height}},cc.AffineTransformMakeIdentity=function(){return{a:1,b:0,c:0,d:1,tx:0,ty:0}},cc.AffineTransformIdentity=function(){return{a:1,b:0,c:0,d:1,tx:0,ty:0}},cc.RectApplyAffineTransform=function(e,t){var n=cc.rectGetMinY(e),r=cc.rectGetMinX(e),i=cc.rectGetMaxX(e),s=cc.rectGetMaxY(e),o=cc._PointApplyAffineTransform(r,n,t),u=cc._PointApplyAffineTransform(i,n,t),a=cc._PointApplyAffineTransform(r,s,t),f=cc._PointApplyAffineTransform(i,s,t),l=Math.min(o.x,u.x,a.x,f.x),c=Math.max(o.x,u.x,a.x,f.x),h=Math.min(o.y,u.y,a.y,f.y),p=Math.max(o.y,u.y,a.y,f.y);return cc.rect(l,h,c-l,p-h)},cc._RectApplyAffineTransformIn=function(e,t){var n=cc.rectGetMinY(e),r=cc.rectGetMinX(e),i=cc.rectGetMaxX(e),s=cc.rectGetMaxY(e),o=cc._PointApplyAffineTransform(r,n,t),u=cc._PointApplyAffineTransform(i,n,t),a=cc._PointApplyAffineTransform(r,s,t),f=cc._PointApplyAffineTransform(i,s,t),l=Math.min(o.x,u.x,a.x,f.x),c=Math.max(o.x,u.x,a.x,f.x),h=Math.min(o.y,u.y,a.y,f.y),p=Math.max(o.y,u.y,a.y,f.y);return e.x=l,e.y=h,e.width=c-l,e.height=p-h,e},cc.AffineTransformTranslate=function(e,t,n){return{a:e.a,b:e.b,c:e.c,d:e.d,tx:e.tx+e.a*t+e.c*n,ty:e.ty+e.b*t+e.d*n}},cc.AffineTransformScale=function(e,t,n){return{a:e.a*t,b:e.b*t,c:e.c*n,d:e.d*n,tx:e.tx,ty:e.ty}},cc.AffineTransformRotate=function(e,t){var n=Math.sin(t),r=Math.cos(t);return{a:e.a*r+e.c*n,b:e.b*r+e.d*n,c:e.c*r-e.a*n,d:e.d*r-e.b*n,tx:e.tx,ty:e.ty}},cc.AffineTransformConcat=function(e,t){return{a:e.a*t.a+e.b*t.c,b:e.a*t.b+e.b*t.d,c:e.c*t.a+e.d*t.c,d:e.c*t.b+e.d*t.d,tx:e.tx*t.a+e.ty*t.c+t.tx,ty:e.tx*t.b+e.ty*t.d+t.ty}},cc.AffineTransformEqualToTransform=function(e,t){return e.a===t.a&&e.b===t.b&&e.c===t.c&&e.d===t.d&&e.tx===t.tx&&e.ty===t.ty},cc.AffineTransformInvert=function(e){var t=1/(e.a*e.d-e.b*e.c);return{a:t*e.d,b:-t*e.b,c:-t*e.c,d:t*e.a,tx:t*(e.c*e.ty-e.d*e.tx),ty:t*(e.b*e.tx-e.a*e.ty)}},cc.POINT_EPSILON=parseFloat("1.192092896e-07F"),cc.pNeg=function(e){return cc.p(-e.x,-e.y)},cc.pAdd=function(e,t){return cc.p(e.x+t.x,e.y+t.y)},cc.pSub=function(e,t){return cc.p(e.x-t.x,e.y-t.y)},cc.pMult=function(e,t){return cc.p(e.x*t,e.y*t)},cc.pMidpoint=function(e,t){return cc.pMult(cc.pAdd(e,t),.5)},cc.pDot=function(e,t){return e.x*t.x+e.y*t.y},cc.pCross=function(e,t){return e.x*t.y-e.y*t.x},cc.pPerp=function(e){return cc.p(-e.y,e.x)},cc.pRPerp=function(e){return cc.p(e.y,-e.x)},cc.pProject=function(e,t){return cc.pMult(t,cc.pDot(e,t)/cc.pDot(t,t))},cc.pRotate=function(e,t){return cc.p(e.x*t.x-e.y*t.y,e.x*t.y+e.y*t.x)},cc.pUnrotate=function(e,t){return cc.p(e.x*t.x+e.y*t.y,e.y*t.x-e.x*t.y)},cc.pLengthSQ=function(e){return cc.pDot(e,e)},cc.pDistanceSQ=function(e,t){return cc.pLengthSQ(cc.pSub(e,t))},cc.pLength=function(e){return Math.sqrt(cc.pLengthSQ(e))},cc.pDistance=function(e,t){return cc.pLength(cc.pSub(e,t))},cc.pNormalize=function(e){return cc.pMult(e,1/cc.pLength(e))},cc.pForAngle=function(e){return cc.p(Math.cos(e),Math.sin(e))},cc.pToAngle=function(e){return Math.atan2(e.y,e.x)},cc.clampf=function(e,t,n){if(t>n){var r=t;t=n,n=r}return e<t?t:e<n?e:n},cc.pClamp=function(e,t,n){return cc.p(cc.clampf(e.x,t.x,n.x),cc.clampf(e.y,t.y,n.y))},cc.pFromSize=function(e){return cc.p(e.width,e.height)},cc.pCompOp=function(e,t){return cc.p(t(e.x),t(e.y))},cc.pLerp=function(e,t,n){return cc.pAdd(cc.pMult(e,1-n),cc.pMult(t,n))},cc.pFuzzyEqual=function(e,t,n){return e.x-n<=t.x&&t.x<=e.x+n&&e.y-n<=t.y&&t.y<=e.y+n?!0:!1},cc.pCompMult=function(e,t){return cc.p(e.x*t.x,e.y*t.y)},cc.pAngleSigned=function(e,t){var n=cc.pNormalize(e),r=cc.pNormalize(t),i=Math.atan2(n.x*r.y-n.y*r.x,cc.pDot(n,r));return Math.abs(i)<cc.POINT_EPSILON?0:i},cc.pAngle=function(e,t){var n=Math.acos(cc.pDot(cc.pNormalize(e),cc.pNormalize(t)));return Math.abs(n)<cc.POINT_EPSILON?0:n},cc.pRotateByAngle=function(e,t,n){var r=cc.pSub(e,t),i=Math.cos(n),s=Math.sin(n),o=r.x;return r.x=o*i-r.y*s+t.x,r.y=o*s+r.y*i+t.y,r},cc.pLineIntersect=function(e,t,n,r,i){if(e.x==t.x&&e.y==t.y||n.x==r.x&&n.y==r.y)return!1;var s=t.x-e.x,o=t.y-e.y,u=r.x-n.x,a=r.y-n.y,f=e.x-n.x,l=e.y-n.y,c=a*s-u*o;return i.x=u*l-a*f,i.y=s*l-o*f,c==0?i.x==0||i.y==0?!0:!1:(i.x=i.x/c,i.y=i.y/c,!0)},cc.pSegmentIntersect=function(e,t,n,r){var i=cc.p(0,0);return cc.pLineIntersect(e,t,n,r,i)&&i.x>=0&&i.x<=1&&i.y>=0&&i.y<=1?!0:!1},cc.pIntersectPoint=function(e,t,n,r){var i=cc.p(0,0);if(cc.pLineIntersect(e,t,n,r,i)){var s=cc.p(0,0);return s.x=e.x+i.x*(t.x-e.x),s.y=e.y+i.x*(t.y-e.y),s}return cc.PointZero()},cc.pSameAs=function(e,t){return e!=null&&t!=null?e.x==t.x&&e.y==t.y:!1},cc.pZeroIn=function(e){e.x=0,e.y=0},cc.pIn=function(e,t){e.x=t.x,e.y=t.y},cc.pMultIn=function(e,t){e.x*=t,e.y*=t},cc.pSubIn=function(e,t){e.x-=t.x,e.y-=t.y},cc.pAddIn=function(e,t){e.x+=t.x,e.y+=t.y},cc.pNormalizeIn=function(e){cc.pMultIn(e,1/Math.sqrt(e.x*e.x+e.y*e.y))},cc.vertexLineToPolygon=function(e,t,n,r,i){i+=r;if(i<=1)return;t*=.5;var s,o=i-1;for(var u=r;u<i;u++){s=u*2;var a=cc.p(e[u*2],e[u*2+1]),f;if(u===0)f=cc.pPerp(cc.pNormalize(cc.pSub(a,cc.p(e[(u+1)*2],e[(u+1)*2+1]))));else if(u===o)f=cc.pPerp(cc.pNormalize(cc.pSub(cc.p(e[(u-1)*2],e[(u-1)*2+1]),a)));else{var l=cc.p(e[(u-1)*2],e[(u-1)*2+1]),c=cc.p(e[(u+1)*2],e[(u+1)*2+1]),h=cc.pNormalize(cc.pSub(c,a)),p=cc.pNormalize(cc.pSub(l,a)),d=Math.acos(cc.pDot(h,p));d<cc.DEGREES_TO_RADIANS(70)?f=cc.pPerp(cc.pNormalize(cc.pMidpoint(h,p))):d<cc.DEGREES_TO_RADIANS(170)?f=cc.pNormalize(cc.pMidpoint(h,p)):f=cc.pPerp(cc.pNormalize(cc.pSub(c,l)))}f=cc.pMult(f,t),n[s*2]=a.x+f.x,n[s*2+1]=a.y+f.y,n[(s+1)*2]=a.x-f.x,n[(s+1)*2+1]=a.y-f.y}r=r==0?0:r-1;for(u=r;u<o;u++){s=u*2;var v=s+2,m=cc.Vertex2(n[s*2],n[s*2+1]),g=cc.Vertex2(n[(s+1)*2],n[(s+1)*2+1]),y=cc.Vertex2(n[v*2],n[v*2]),b=cc.Vertex2(n[(v+1)*2],n[(v+1)*2+1]),w=!cc.vertexLineIntersect(m.x,m.y,b.x,b.y,g.x,g.y,y.x,y.y);!w.isSuccess&&(w.value<0||w.value>1)&&(w.isSuccess=!0),w.isSuccess&&(n[v*2]=b.x,n[v*2+1]=b.y,n[(v+1)*2]=y.x,n[(v+1)*2+1]=y.y)}},cc.vertexLineIntersect=function(e,t,n,r,i,s,o,u){var a,f,l,c;if(e==n&&t==r||i==o&&s==u)return{isSuccess:!1,value:0};n-=e,r-=t,i-=e,s-=t,o-=e,u-=t,a=Math.sqrt(n*n+r*r),f=n/a,l=r/a,c=i*f+s*l,s=s*f-i*l,i=c,c=o*f+u*l,u=u*f-o*l,o=c;if(s==u)return{isSuccess:!1,value:0};var h=(o+(i-o)*u/(u-s))/a;return{isSuccess:!0,value:h}},cc.CGAffineToGL=function(e,t){t[2]=t[3]=t[6]=t[7]=t[8]=t[9]=t[11]=t[14]=0,t[10]=t[15]=1,t[0]=e.a,t[4]=e.c,t[12]=e.tx,t[1]=e.b,t[5]=e.d,t[13]=e.ty},cc.GLToCGAffine=function(e,t){t.a=e[0],t.c=e[4],t.tx=e[12],t.b=e[1],t.d=e[5],t.ty=e[13]},cc.NODE_TAG_INVALID=-1,cc.NODE_ON_ENTER=null,cc.NODE_ON_EXIT=null,cc.s_globalOrderOfArrival=1,cc.Node=cc.Class.extend({_zOrder:0,_vertexZ:0,_rotationX:0,_rotationY:0,_scaleX:1,_scaleY:1,_position:null,_skewX:0,_skewY:0,_children:null,_visible:!0,_anchorPoint:null,_anchorPointInPoints:null,_contentSize:null,_running:!1,_parent:null,_ignoreAnchorPointForPosition:!1,_tag:cc.NODE_TAG_INVALID,_userData:null,_userObject:null,_transformDirty:!0,_inverseDirty:!0,_cacheDirty:!0,_transformGLDirty:null,_transform:null,_inverse:null,_reorderChildDirty:!1,_shaderProgram:null,_orderOfArrival:0,_actionManager:null,_scheduler:null,_initializedNode:!1,_additionalTransformDirty:!1,_additionalTransform:null,_componentContainer:null,_isTransitionFinished:!1,_rotationRadiansX:0,_rotationRadiansY:0,_initNode:function(){this._anchorPoint=cc._pConst(0,0),this._anchorPointInPoints=cc._pConst(0,0),this._contentSize=cc._sizeConst(0,0),this._position=cc._pConst(0,0),this._children=[],this._transform={a:1,b:0,c:0,d:1,tx:0,ty:0};var e=cc.Director.getInstance();this._actionManager=e.getActionManager(),this._scheduler=e.getScheduler(),this._initializedNode=!0,this._additionalTransform=cc.AffineTransformMakeIdentity(),cc.ComponentContainer&&(this._componentContainer=new cc.ComponentContainer(this))},init:function(){return this._initializedNode===!1&&this._initNode(),!0},_arrayMakeObjectsPerformSelector:function(e,t){if(!e||e.length===0)return;var n,r=e.length,i,s=cc.Node.StateCallbackType;switch(t){case s.onEnter:for(n=0;n<r;n++)i=e[n],i&&i.onEnter();break;case s.onExit:for(n=0;n<r;n++)i=e[n],i&&i.onExit();break;case s.onEnterTransitionDidFinish:for(n=0;n<r;n++)i=e[n],i&&i.onEnterTransitionDidFinish();break;case s.cleanup:for(n=0;n<r;n++)i=e[n],i&&i.cleanup();break;case s.updateTransform:for(n=0;n<r;n++)i=e[n],i&&i.updateTransform();break;case s.onExitTransitionDidStart:for(n=0;n<r;n++)i=e[n],i&&i.onExitTransitionDidStart();break;case s.sortAllChildren:for(n=0;n<r;n++)i=e[n],i&&i.sortAllChildren();break;default:throw"Unknown callback function"}},setNodeDirty:null,_setNodeDirtyForCanvas:function(){this._setNodeDirtyForCache(),this._transformDirty===!1&&(this._transformDirty=this._inverseDirty=!0)},_setNodeDirtyForWebGL:function(){this._transformDirty===!1&&(this._transformDirty=this._inverseDirty=!0)},getSkewX:function(){return this._skewX},setSkewX:function(e){this._skewX=e,this.setNodeDirty()},getSkewY:function(){return this._skewY},setSkewY:function(e){this._skewY=e,this.setNodeDirty()},getZOrder:function(){return this._zOrder},_setZOrder:function(e){this._zOrder=e},setZOrder:function(e){this._setZOrder(e),this._parent&&this._parent.reorderChild(this,e)},getVertexZ:function(){return this._vertexZ},setVertexZ:function(e){this._vertexZ=e},getRotation:function(){return this._rotationX!==this._rotationY&&cc.log("cc.Node.rotation(): RotationX != RotationY. Don't know which one to return"),this._rotationX},setRotation:function(e){this._rotationX=this._rotationY=e,this._rotationRadiansX=this._rotationX*.017453292519943295,this._rotationRadiansY=this._rotationY*.017453292519943295,this.setNodeDirty()},getRotationX:function(){return this._rotationX},setRotationX:function(e){this._rotationX=e,this._rotationRadiansX=this._rotationX*.017453292519943295,this.setNodeDirty()},getRotationY:function(){return this._rotationY},setRotationY:function(e){this._rotationY=e,this._rotationRadiansY=this._rotationY*.017453292519943295,this.setNodeDirty()},getScale:function(){return this._scaleX!==this._scaleY&&cc.log("cc.Node.getScale(): ScaleX != ScaleY. Don't know which one to return"),this._scaleX},setScale:function(e,t){this._scaleX=e,this._scaleY=t||t===0?t:e,this.setNodeDirty()},getScaleX:function(){return this._scaleX},setScaleX:function(e){this._scaleX=e,this.setNodeDirty()},getScaleY:function(){return this._scaleY},setScaleY:function(e){this._scaleY=e,this.setNodeDirty()},setPosition:function(e,t){var n=this._position;t===undefined?(n._x=e.x,n._y=e.y):(n._x=e,n._y=t),this.setNodeDirty()},getPosition:function(){return this._position},getPositionX:function(){return this._position._x},setPositionX:function(e){this._position._x=e,this.setNodeDirty()},getPositionY:function(){return this._position._y},setPositionY:function(e){this._position._y=e,this.setNodeDirty()},getChildrenCount:function(){return this._children.length},getChildren:function(){return this._children},isVisible:function(){return this._visible},setVisible:function(e){this._visible=e,this.setNodeDirty()},getAnchorPoint:function(){return this._anchorPoint},setAnchorPoint:function(e,t){var n=this._anchorPoint;if(t===undefined){if(e.x===n._x&&e.y===n._y)return;n._x=e.x,n._y=e.y}else{if(e===n._x&&t===n._y)return;n._x=e,n._y=t}var r=this._anchorPointInPoints,i=this._contentSize;r._x=i._width*n._x,r._y=i._height*n._y,this.setNodeDirty()},getAnchorPointInPoints:function(){return this._anchorPointInPoints},getContentSize:function(){return this._contentSize},setContentSize:function(e,t){var n=this._contentSize;if(t===undefined){if(e.width===n._width&&e.height===n._height)return;n._width=e.width,n._height=e.height}else{if(e===n._width&&t===n._height)return;n._width=e,n._height=t}var r=this._anchorPointInPoints,i=this._anchorPoint;r._x=n._width*i._x,r._y=n._height*i._y,this.setNodeDirty()},isRunning:function(){return this._running},getParent:function(){return this._parent},setParent:function(e){this._parent=e},isIgnoreAnchorPointForPosition:function(){return this._ignoreAnchorPointForPosition},ignoreAnchorPointForPosition:function(e){e!=this._ignoreAnchorPointForPosition&&(this._ignoreAnchorPointForPosition=e,this.setNodeDirty())},getTag:function(){return this._tag},setTag:function(e){this._tag=e},getUserData:function(){return this._userData},setUserData:function(e){this._userData=e},getUserObject:function(){return this._userObject},setUserObject:function(e){this._userObject!=e&&(this._userObject=e)},getOrderOfArrival:function(){return this._orderOfArrival},setOrderOfArrival:function(e){this._orderOfArrival=e},getActionManager:function(){return this._actionManager||(this._actionManager=cc.Director.getInstance().getActionManager()),this._actionManager},setActionManager:function(e){this._actionManager!=e&&(this.stopAllActions(),this._actionManager=e)},getScheduler:function(){return this._scheduler||(this._scheduler=cc.Director.getInstance().getScheduler()),this._scheduler},setScheduler:function(e){this._scheduler!=e&&(this.unscheduleAllCallbacks(),this._scheduler=e)},getBoundingBox:function(){var e=cc.rect(0,0,this._contentSize._width,this._contentSize._height);return cc._RectApplyAffineTransformIn(e,this.nodeToParentTransform())},cleanup:function(){this.stopAllActions(),this.unscheduleAllCallbacks(),this._arrayMakeObjectsPerformSelector(this._children,cc.Node.StateCallbackType.cleanup)},description:function(){return"<cc.Node | Tag ="+this._tag+">"},getChildByTag:function(e){var t=this._children;if(t!=null)for(var n=0;n<t.length;n++){var r=t[n];if(r&&r._tag==e)return r}return null},addChild:function(e,t,n){if(!e)throw"cc.Node.addChild(): child must be non-null";if(e===this){cc.log("cc.Node.addChild(): An Node can't be added as a child of itself.");return}if(e._parent!==null){cc.log("cc.Node.addChild(): child already added. It can't be added again");return}var r=t!=null?t:e._zOrder;e._tag=n!=null?n:e._tag,this._insertChild(e,r),e._parent=this,this._running&&(e.onEnter(),this._isTransitionFinished&&e.onEnterTransitionDidFinish())},removeFromParent:function(e){this._parent&&(e==null&&(e=!0),this._parent.removeChild(this,e))},removeFromParentAndCleanup:function(e){cc.log("removeFromParentAndCleanup is deprecated. Use removeFromParent instead"),this.removeFromParent(e)},removeChild:function(e,t){if(this._children.length===0)return;t==null&&(t=!0),this._children.indexOf(e)>-1&&this._detachChild(e,t),this.setNodeDirty()},removeChildByTag:function(e,t){e===cc.NODE_TAG_INVALID&&cc.log("cc.Node.removeChildByTag(): argument tag is an invalid tag");var n=this.getChildByTag(e);n==null?cc.log("cocos2d: removeChildByTag(tag = "+e+"): child not found!"):this.removeChild(n,t)},removeAllChildrenWithCleanup:function(e){cc.log("removeAllChildrenWithCleanup is deprecated. Use removeAllChildren instead"),this.removeAllChildren(e)},removeAllChildren:function(e){var t=this._children;if(t!=null){e==null&&(e=!0);for(var n=0;n<t.length;n++){var r=t[n];r&&(this._running&&(r.onExitTransitionDidStart(),r.onExit()),e&&r.cleanup(),r.setParent(null))}this._children.length=0}},_detachChild:function(e,t){this._running&&(e.onExitTransitionDidStart(),e.onExit()),t&&e.cleanup(),e.setParent(null),cc.ArrayRemoveObject(this._children,e)},_insertChild:function(e,t){this._reorderChildDirty=!0,this._children.push(e),e._setZOrder(t)},reorderChild:function(e,t){if(!e)throw"cc.Node.reorderChild(): child must be non-null";this._reorderChildDirty=!0,e.setOrderOfArrival(cc.s_globalOrderOfArrival++),e._setZOrder(t),this.setNodeDirty()},sortAllChildren:function(){if(this._reorderChildDirty){var e=this._children,t,n,r=e.length,i;for(t=0;t<r;t++){var s=e[t];n=t-1,i=e[n];while(n>=0&&(s._zOrder<i._zOrder||s._zOrder==i._zOrder&&s._orderOfArrival<i._orderOfArrival))e[n+1]=i,n-=1,i=e[n];e[n+1]=s}this._reorderChildDirty=!1}},draw:function(e){},transformAncestors:function(){this._parent!=null&&(this._parent.transformAncestors(),this._parent.transform())},onEnter:function(){this._isTransitionFinished=!1,this._running=!0,this._arrayMakeObjectsPerformSelector(this._children,cc.Node.StateCallbackType.onEnter),this.resumeSchedulerAndActions()},onEnterTransitionDidFinish:function(){this._isTransitionFinished=!0,this._arrayMakeObjectsPerformSelector(this._children,cc.Node.StateCallbackType.onEnterTransitionDidFinish)},onExitTransitionDidStart:function(){this._arrayMakeObjectsPerformSelector(this._children,cc.Node.StateCallbackType.onExitTransitionDidStart)},onExit:function(){this._running=!1,this.pauseSchedulerAndActions(),this._arrayMakeObjectsPerformSelector(this._children,cc.Node.StateCallbackType.onExit),this._componentContainer&&this._componentContainer.removeAll()},runAction:function(e){if(!e)throw"cc.Node.runAction(): action must be non-null";return this.getActionManager().addAction(e,this,!this._running),e},stopAllActions:function(){this.getActionManager().removeAllActionsFromTarget(this)},stopAction:function(e){this.getActionManager().removeAction(e)},stopActionByTag:function(e){if(e===cc.ACTION_TAG_INVALID){cc.log("cc.Node.stopActionBy(): argument tag an invalid tag");return}this.getActionManager().removeActionByTag(e,this)},getActionByTag:function(e){return e===cc.ACTION_TAG_INVALID?(cc.log("cc.Node.getActionByTag(): argument tag is an invalid tag"),null):this.getActionManager().getActionByTag(e,this)},getNumberOfRunningActions:function(){return this.getActionManager().numberOfRunningActionsInTarget(this)},scheduleUpdate:function(){this.scheduleUpdateWithPriority(0)},scheduleUpdateWithPriority:function(e){this.getScheduler().scheduleUpdateForTarget(this,e,!this._running)},unscheduleUpdate:function(){this.getScheduler().unscheduleUpdateForTarget(this)},schedule:function(e,t,n,r){t=t||0;if(!e)throw"cc.Node.schedule(): callback function must be non-null";if(t<0)throw"cc.Node.schedule(): interval must be positive";n=n==null?cc.REPEAT_FOREVER:n,r=r||0,this.getScheduler().scheduleCallbackForTarget(this,e,t,n,r,!this._running)},scheduleOnce:function(e,t){this.schedule(e,0,0,t)},unschedule:function(e){if(!e)return;this.getScheduler().unscheduleCallbackForTarget(this,e)},unscheduleAllCallbacks:function(){this.getScheduler().unscheduleAllCallbacksForTarget(this)},resumeSchedulerAndActions:function(){this.getScheduler().resumeTarget(this),this.getActionManager().resumeTarget(this)},pauseSchedulerAndActions:function(){this.getScheduler().pauseTarget(this),this.getActionManager().pauseTarget(this)},setAdditionalTransform:function(e){this._additionalTransform=e,this._transformDirty=!0,this._additionalTransformDirty=!0},parentToNodeTransform:function(){return this._inverseDirty&&(this._inverse=cc.AffineTransformInvert(this.nodeToParentTransform()),this._inverseDirty=!1),this._inverse},nodeToWorldTransform:function(){var e=this.nodeToParentTransform();for(var t=this._parent;t!=null;t=t.getParent())e=cc.AffineTransformConcat(e,t.nodeToParentTransform());return e},worldToNodeTransform:function(){return cc.AffineTransformInvert(this.nodeToWorldTransform())},convertToNodeSpace:function(e){return cc.PointApplyAffineTransform(e,this.worldToNodeTransform())},convertToWorldSpace:function(e){return cc.PointApplyAffineTransform(e,this.nodeToWorldTransform())},convertToNodeSpaceAR:function(e){return cc.pSub(this.convertToNodeSpace(e),this._anchorPointInPoints)},convertToWorldSpaceAR:function(e){var t=cc.pAdd(e,this._anchorPointInPoints);return this.convertToWorldSpace(t)},_convertToWindowSpace:function(e){var t=this.convertToWorldSpace(e);return cc.Director.getInstance().convertToUI(t)},convertTouchToNodeSpace:function(e){var t=e.getLocation();return this.convertToNodeSpace(t)},convertTouchToNodeSpaceAR:function(e){var t=e.getLocation();return t=cc.Director.getInstance().convertToGL(t),this.convertToNodeSpaceAR(t)},update:function(e){this._componentContainer&&!this._componentContainer.isEmpty()&&this._componentContainer.visit(e)},updateTransform:function(){this._arrayMakeObjectsPerformSelector(this._children,cc.Node.StateCallbackType.updateTransform)},retain:function(){},release:function(){},getComponent:function(e){return this._componentContainer.getComponent(e)},addComponent:function(e){this._componentContainer.add(e)},removeComponent:function(e){return this._componentContainer.remove(e)},removeAllComponents:function(){this._componentContainer.removeAll()},_transform4x4:null,_stackMatrix:null,_glServerState:null,_camera:null,_grid:null,ctor:null,_ctorForCanvas:function(){this._initNode()},_ctorForWebGL:function(){this._initNode();var e=new cc.kmMat4;e.mat[2]=e.mat[3]=e.mat[6]=e.mat[7]=e.mat[8]=e.mat[9]=e.mat[11]=e.mat[14]=0,e.mat[10]=e.mat[15]=1,this._transform4x4=e,this._glServerState=0,this._stackMatrix=new cc.kmMat4},visit:null,_visitForCanvas:function(e){if(!this._visible)return;var t=e||cc.renderContext,n,r=this._children,i;t.save(),this.transform(t);var s=r.length;if(s>0){this.sortAllChildren();for(n=0;n<s;n++){i=r[n];if(!(i._zOrder<0))break;i.visit(t)}this.draw(t);for(;n<s;n++)r[n].visit(t)}else this.draw(t);this._orderOfArrival=0,t.restore()},_visitForWebGL:function(){if(!this._visible)return;var e=cc.renderContext,t,n=cc.current_stack;n.stack.push(n.top),cc.kmMat4Assign(this._stackMatrix,n.top),n.top=this._stackMatrix;var r=this._grid;r&&r._active&&r.beforeDraw(),this.transform();var i=this._children;if(i&&i.length>0){var s=i.length;this.sortAllChildren();for(t=0;t<s;t++){if(!(i[t]&&i[t]._zOrder<0))break;i[t].visit()}this.draw(e);for(;t<s;t++)i[t]&&i[t].visit()}else this.draw(e);this._orderOfArrival=0,r&&r._active&&r.afterDraw(this),n.top=n.stack.pop()},transform:null,_transformForCanvas:function(e){var t=e||cc.renderContext,n=cc.EGLView.getInstance(),r=this.nodeToParentTransform();t.transform(r.a,r.c,r.b,r.d,r.tx*n.getScaleX(),-r.ty*n.getScaleY())},_transformForWebGL:function(){var e=this._transform4x4,t=cc.current_stack.top,n=this.nodeToParentTransform(),r=e.mat;r[0]=n.a,r[4]=n.c,r[12]=n.tx,r[1]=n.b,r[5]=n.d,r[13]=n.ty,r[14]=this._vertexZ,cc.kmMat4Multiply(t,t,e);if(this._camera!=null&&(this._grid==null||!this._grid.isActive())){var i=this._anchorPointInPoints._x,s=this._anchorPointInPoints._y,o=i!==0||s!==0;o?(cc.kmGLTranslatef(cc.RENDER_IN_SUBPIXEL(i),cc.RENDER_IN_SUBPIXEL(s),0),this._camera.locate(),cc.kmGLTranslatef(cc.RENDER_IN_SUBPIXEL(-i),cc.RENDER_IN_SUBPIXEL(-s),0)):this._camera.locate()}},nodeToParentTransform:null,_nodeToParentTransformForCanvas:function(){if(this._transformDirty){var e=this._transform;e.tx=this._position._x,e.ty=this._position._y;var t=1,n=0;this._rotationX&&(t=Math.cos(this._rotationRadiansX),n=Math.sin(this._rotationRadiansX)),e.a=e.d=t,e.b=-n,e.c=n;var r=this._scaleX,i=this._scaleY,s=this._anchorPointInPoints._x,o=this._anchorPointInPoints._y,u=r<1e-6&&r>-0.000001?1e-6:r,a=i<1e-6&&i>-0.000001?1e-6:i;if(this._skewX||this._skewY){var f=Math.tan(-this._skewX*Math.PI/180),l=Math.tan(-this._skewY*Math.PI/180),c=o*f*u,h=s*l*a;e.a=t+ -n*l,e.b=t*f+ -n,e.c=n+t*l,e.d=n*f+t,e.tx+=t*c+ -n*h,e.ty+=n*c+t*h}if(r!==1||i!==1)e.a*=u,e.c*=u,e.b*=a,e.d*=a;e.tx+=t*-s*u+ -n*o*a,e.ty-=n*-s*u+t*o*a,this._ignoreAnchorPointForPosition&&(e.tx+=s,e.ty+=o),this._additionalTransformDirty&&(this._transform=cc.AffineTransformConcat(e,this._additionalTransform),this._additionalTransformDirty=!1),this._transformDirty=!1}return this._transform},_nodeToParentTransformForWebGL:function(){if(this._transformDirty){var e=this._position._x,t=this._position._y,n=this._anchorPointInPoints._x,r=-n,i=this._anchorPointInPoints._y,s=-i,o=this._scaleX,u=this._scaleY;this._ignoreAnchorPointForPosition&&(e+=n,t+=i);var a=1,f=0,l=1,c=0;if(this._rotationX!==0||this._rotationY!==0)a=Math.cos(-this._rotationRadiansX),f=Math.sin(-this._rotationRadiansX),l=Math.cos(-this._rotationRadiansY),c=Math.sin(-this._rotationRadiansY);var h=this._skewX||this._skewY;!h&&(n!==0||i!==0)&&(e+=l*r*o+ -f*s*u,t+=c*r*o+a*s*u);var p=this._transform;p.a=l*o,p.b=c*o,p.c=-f*u,p.d=a*u,p.tx=e,p.ty=t;if(h){p=cc.AffineTransformConcat({a:1,b:Math.tan(cc.DEGREES_TO_RADIANS(this._skewY)),c:Math.tan(cc.DEGREES_TO_RADIANS(this._skewX)),d:1,tx:0,ty:0},p);if(n!==0||i!==0)p=cc.AffineTransformTranslate(p,r,s)}this._additionalTransformDirty&&(p=cc.AffineTransformConcat(p,this._additionalTransform),this._additionalTransformDirty=!1),this._transform=p,this._transformDirty=!1}return this._transform},_setNodeDirtyForCache:function(){this._cacheDirty=!0,this._parent&&this._parent._setNodeDirtyForCache()},getCamera:function(){return this._camera||(this._camera=new cc.Camera),this._camera},getGrid:function(){return this._grid},setGrid:function(e){this._grid=e},getShaderProgram:function(){return this._shaderProgram},setShaderProgram:function(e){this._shaderProgram=e},getGLServerState:function(){return this._glServerState},setGLServerState:function(e){this._glServerState=e},getBoundingBoxToWorld:function(){var e=cc.rect(0,0,this._contentSize._width,this._contentSize._height),t=this.nodeToWorldTransform();e=cc.RectApplyAffineTransform(e,this.nodeToWorldTransform());if(!this._children)return e;var n=this._children;for(var r=0;r<n.length;r++){var i=n[r];if(i&&i._visible){var s=i._getBoundingBoxToCurrentNode(t);s&&(e=cc.rectUnion(e,s))}}return e},_getBoundingBoxToCurrentNode:function(e){var t=cc.rect(0,0,this._contentSize._width,this._contentSize._height),n=e==null?this.nodeToParentTransform():cc.AffineTransformConcat(this.nodeToParentTransform(),e);t=cc.RectApplyAffineTransform(t,n);if(!this._children)return t;var r=this._children;for(var i=0;i<r.length;i++){var s=r[i];if(s&&s._visible){var o=s._getBoundingBoxToCurrentNode(n);o&&(t=cc.rectUnion(t,o))}}return t}}),cc.Browser.supportWebGL?(cc.Node.prototype.ctor=cc.Node.prototype._ctorForWebGL,cc.Node.prototype.setNodeDirty=cc.Node.prototype._setNodeDirtyForWebGL,cc.Node.prototype.visit=cc.Node.prototype._visitForWebGL,cc.Node.prototype.transform=cc.Node.prototype._transformForWebGL,cc.Node.prototype.nodeToParentTransform=cc.Node.prototype._nodeToParentTransformForWebGL):(cc.Node.prototype.ctor=cc.Node.prototype._ctorForCanvas,cc.Node.prototype.setNodeDirty=cc.Node.prototype._setNodeDirtyForCanvas,cc.Node.prototype.visit=cc.Node.prototype._visitForCanvas,cc.Node.prototype.transform=cc.Node.prototype._transformForCanvas,cc.Node.prototype.nodeToParentTransform=cc.Node.prototype._nodeToParentTransformForCanvas),cc.Node.create=function(){return new cc.Node},cc.Node.StateCallbackType={onEnter:1,onExit:2,cleanup:3,onEnterTransitionDidFinish:4,updateTransform:5,onExitTransitionDidStart:6,sortAllChildren:7},cc.NodeRGBA=cc.Node.extend({RGBAProtocol:!0,_displayedOpacity:255,_realOpacity:255,_displayedColor:null,_realColor:null,_cascadeColorEnabled:!1,_cascadeOpacityEnabled:!1,ctor:function(){cc.Node.prototype.ctor.call(this),this._displayedOpacity=255,this._realOpacity=255,this._displayedColor=cc.white(),this._realColor=cc.white(),this._cascadeColorEnabled=!1,this._cascadeOpacityEnabled=!1},getOpacity:function(){return this._realOpacity},getDisplayedOpacity:function(){return this._displayedOpacity},setOpacity:function(e){this._displayedOpacity=this._realOpacity=e;var t=255,n=this._parent;n&&n.RGBAProtocol&&n.isCascadeOpacityEnabled()&&(t=n.getDisplayedOpacity()),this.updateDisplayedOpacity(t)},updateDisplayedOpacity:function(e){this._displayedOpacity=this._realOpacity*e/255;if(this._cascadeOpacityEnabled){var t=this._children;for(var n=0;n<t.length;n++){var r=t[n];r&&r.RGBAProtocol&&r.updateDisplayedOpacity(this._displayedOpacity)}}},isCascadeOpacityEnabled:function(){return this._cascadeOpacityEnabled},setCascadeOpacityEnabled:function(e){if(this._cascadeOpacityEnabled===e)return;this._cascadeOpacityEnabled=e,e?this._enableCascadeOpacity():this._disableCascadeOpacity()},_enableCascadeOpacity:function(){var e=255,t=this._parent;t&&t.RGBAProtocol&&t.isCascadeOpacityEnabled()&&(e=t.getDisplayedOpacity()),this.updateDisplayedOpacity(e)},_disableCascadeOpacity:function(){this._displayedOpacity=this._realOpacity;var e=this._children;for(var t=0;t<e.length;t++){var n=e[t];n&&n.RGBAProtocol&&n.updateDisplayedOpacity(255)}},getColor:function(){var e=this._realColor;return new cc.Color3B(e.r,e.g,e.b)},getDisplayedColor:function(){return this._displayedColor},setColor:function(e){var t=this._displayedColor,n=this._realColor;t.r=n.r=e.r,t.g=n.g=e.g,t.b=n.b=e.b;var r,i=this._parent;i&&i.RGBAProtocol&&i.isCascadeColorEnabled()?r=i.getDisplayedColor():r=cc.white(),this.updateDisplayedColor(r)},updateDisplayedColor:function(e){var t=this._displayedColor,n=this._realColor;t.r=0|n.r*e.r/255,t.g=0|n.g*e.g/255,t.b=0|n.b*e.b/255;if(this._cascadeColorEnabled){var r=this._children;for(var i=0;i<r.length;i++){var s=r[i];s&&s.RGBAProtocol&&s.updateDisplayedColor(t)}}},isCascadeColorEnabled:function(){return this._cascadeColorEnabled},setCascadeColorEnabled:function(e){if(this._cascadeColorEnabled===e)return;this._cascadeColorEnabled=e,this._cascadeColorEnabled?this._enableCascadeColor():this._disableCascadeColor()},_enableCascadeColor:function(){var e,t=this._parent;t&&t.RGBAProtocol&&t.isCascadeColorEnabled
()?e=t.getDisplayedColor():e=cc.white(),this.updateDisplayedColor(e)},_disableCascadeColor:function(){var e=this._displayedColor,t=this._realColor;e.r=t.r,e.g=t.g,e.b=t.b;var n=this._children,r=cc.white();for(var i=0;i<n.length;i++){var s=n[i];s&&s.RGBAProtocol&&s.updateDisplayedColor(r)}},addChild:function(e,t,n){cc.Node.prototype.addChild.call(this,e,t,n),this._cascadeColorEnabled&&this._enableCascadeColor(),this._cascadeOpacityEnabled&&this._enableCascadeOpacity()},setOpacityModifyRGB:function(e){},isOpacityModifyRGB:function(){return!1}}),cc.NodeRGBA.create=function(){var e=new cc.NodeRGBA;return e.init(),e},cc.AtlasNode=cc.NodeRGBA.extend({RGBAProtocol:!0,_itemsPerRow:0,_itemsPerColumn:0,_itemWidth:0,_itemHeight:0,_colorUnmodified:null,_textureAtlas:null,_opacityModifyRGB:!1,_blendFunc:null,_quadsToDraw:0,_ignoreContentScaleFactor:!1,ctor:function(){cc.NodeRGBA.prototype.ctor.call(this),this._colorUnmodified=cc.white(),this._blendFunc={src:cc.BLEND_SRC,dst:cc.BLEND_DST},this._ignoreContentScaleFactor=!1},updateAtlasValues:function(){cc.log("cc.AtlasNode.updateAtlasValues(): Shall be overridden in subclasses")},getColor:function(){return this._opacityModifyRGB?this._colorUnmodified:cc.NodeRGBA.prototype.getColor.call(this)},setOpacityModifyRGB:function(e){var t=this.getColor();this._opacityModifyRGB=e,this.setColor(t)},isOpacityModifyRGB:function(){return this._opacityModifyRGB},getBlendFunc:function(){return this._blendFunc},setBlendFunc:function(e,t){t===undefined?this._blendFunc=e:this._blendFunc={src:e,dst:t}},setTextureAtlas:function(e){this._textureAtlas=e},getTextureAtlas:function(){return this._textureAtlas},getQuadsToDraw:function(){return this._quadsToDraw},setQuadsToDraw:function(e){this._quadsToDraw=e},_textureForCanvas:null,_originalTexture:null,_uniformColor:null,_colorF32Array:null,initWithTileFile:function(e,t,n,r){if(!e)throw"cc.AtlasNode.initWithTileFile(): title should not be null";var i=cc.TextureCache.getInstance().addImage(e);return this.initWithTexture(i,t,n,r)},initWithTexture:null,_initWithTextureForCanvas:function(e,t,n,r){return this._itemWidth=t,this._itemHeight=n,this._opacityModifyRGB=!0,this._originalTexture=e,this._originalTexture?(this._textureForCanvas=this._originalTexture,this._calculateMaxItems(),this._quadsToDraw=r,!0):(cc.log("cocos2d: Could not initialize cc.AtlasNode. Invalid Texture."),!1)},_initWithTextureForWebGL:function(e,t,n,r){this._itemWidth=t,this._itemHeight=n,this._colorUnmodified=cc.white(),this._opacityModifyRGB=!0,this._blendFunc.src=cc.BLEND_SRC,this._blendFunc.dst=cc.BLEND_DST;var i=this._realColor;return this._colorF32Array=new Float32Array([i.r/255,i.g/255,i.b/255,this._realOpacity/255]),this._textureAtlas=new cc.TextureAtlas,this._textureAtlas.initWithTexture(e,r),this._textureAtlas?(this._updateBlendFunc(),this._updateOpacityModifyRGB(),this._calculateMaxItems(),this._quadsToDraw=r,this.setShaderProgram(cc.ShaderCache.getInstance().programForKey(cc.SHADER_POSITION_TEXTURE_UCOLOR)),this._uniformColor=cc.renderContext.getUniformLocation(this.getShaderProgram().getProgram(),"u_color"),!0):(cc.log("cocos2d: Could not initialize cc.AtlasNode. Invalid Texture."),!1)},draw:null,_drawForWebGL:function(e){var t=e||cc.renderContext;cc.NODE_DRAW_SETUP(this),cc.glBlendFunc(this._blendFunc.src,this._blendFunc.dst),t.uniform4fv(this._uniformColor,this._colorF32Array),this._textureAtlas.drawNumberOfQuads(this._quadsToDraw,0)},setColor:null,_setColorForCanvas:function(e){var t=this._realColor;if(t.r==e.r&&t.g==e.g&&t.b==e.b)return;var n=new cc.Color3B(e.r,e.g,e.b);this._colorUnmodified=e;if(this._opacityModifyRGB){var r=this._displayedOpacity;n.r=n.r*r/255,n.g=n.g*r/255,n.b=n.b*r/255}cc.NodeRGBA.prototype.setColor.call(this,e);if(this.getTexture()){var i=this._originalTexture.getHtmlElementObj();if(!i)return;var s=cc.TextureCache.getInstance().getTextureColors(i);if(s){var o=cc.rect(0,0,i.width,i.height);i=cc.generateTintImage(i,s,this._realColor,o);var u=new cc.Texture2D;u.initWithElement(i),u.handleLoadedTexture(),this.setTexture(u)}}},_setColorForWebGL:function(e){var t=cc.Color3B(e.r,e.g,e.b);this._colorUnmodified=e;var n=this._displayedOpacity;this._opacityModifyRGB&&(t.r=t.r*n/255,t.g=t.g*n/255,t.b=t.b*n/255),cc.NodeRGBA.prototype.setColor.call(this,e);var r=this._displayedColor;this._colorF32Array=new Float32Array([r.r/255,r.g/255,r.b/255,n/255])},setOpacity:null,_setOpacityForCanvas:function(e){cc.NodeRGBA.prototype.setOpacity.call(this,e),this._opacityModifyRGB&&this.setColor(this._colorUnmodified)},_setOpacityForWebGL:function(e){cc.NodeRGBA.prototype.setOpacity.call(this,e);if(this._opacityModifyRGB)this.setColor(this._colorUnmodified);else{var t=this._displayedColor;this._colorF32Array=new Float32Array([t.r/255,t.g/255,t.b/255,this._displayedOpacity/255])}},getTexture:null,_getTextureForCanvas:function(){return this._textureForCanvas},_getTextureForWebGL:function(){return this._textureAtlas.getTexture()},setTexture:null,_setTextureForCanvas:function(e){this._textureForCanvas=e},_setTextureForWebGL:function(e){this._textureAtlas.setTexture(e),this._updateBlendFunc(),this._updateOpacityModifyRGB()},_calculateMaxItems:null,_calculateMaxItemsForCanvas:function(){var e=this.getTexture(),t=e.getContentSize();this._itemsPerColumn=0|t.height/this._itemHeight,this._itemsPerRow=0|t.width/this._itemWidth},_calculateMaxItemsForWebGL:function(){var e=this.getTexture(),t=e.getContentSize();this._ignoreContentScaleFactor&&(t=e.getContentSizeInPixels()),this._itemsPerColumn=0|t.height/this._itemHeight,this._itemsPerRow=0|t.width/this._itemWidth},_updateBlendFunc:function(){this._textureAtlas.getTexture().hasPremultipliedAlpha()||(this._blendFunc.src=gl.SRC_ALPHA,this._blendFunc.dst=gl.ONE_MINUS_SRC_ALPHA)},_updateOpacityModifyRGB:function(){this._opacityModifyRGB=this._textureAtlas.getTexture().hasPremultipliedAlpha()},_setIgnoreContentScaleFactor:function(e){this._ignoreContentScaleFactor=e}}),cc.Browser.supportWebGL?(cc.AtlasNode.prototype.initWithTexture=cc.AtlasNode.prototype._initWithTextureForWebGL,cc.AtlasNode.prototype.draw=cc.AtlasNode.prototype._drawForWebGL,cc.AtlasNode.prototype.setColor=cc.AtlasNode.prototype._setColorForWebGL,cc.AtlasNode.prototype.setOpacity=cc.AtlasNode.prototype._setOpacityForWebGL,cc.AtlasNode.prototype.getTexture=cc.AtlasNode.prototype._getTextureForWebGL,cc.AtlasNode.prototype.setTexture=cc.AtlasNode.prototype._setTextureForWebGL,cc.AtlasNode.prototype._calculateMaxItems=cc.AtlasNode.prototype._calculateMaxItemsForWebGL):(cc.AtlasNode.prototype.initWithTexture=cc.AtlasNode.prototype._initWithTextureForCanvas,cc.AtlasNode.prototype.draw=cc.Node.prototype.draw,cc.AtlasNode.prototype.setColor=cc.AtlasNode.prototype._setColorForCanvas,cc.AtlasNode.prototype.setOpacity=cc.AtlasNode.prototype._setOpacityForCanvas,cc.AtlasNode.prototype.getTexture=cc.AtlasNode.prototype._getTextureForCanvas,cc.AtlasNode.prototype.setTexture=cc.AtlasNode.prototype._setTextureForCanvas,cc.AtlasNode.prototype._calculateMaxItems=cc.AtlasNode.prototype._calculateMaxItemsForCanvas),cc.AtlasNode.create=function(e,t,n,r){var i=new cc.AtlasNode;return i.initWithTileFile(e,t,n,r)?i:null},cc.TEXTURE_2D_PIXEL_FORMAT_RGBA8888=0,cc.TEXTURE_2D_PIXEL_FORMAT_RGB888=1,cc.TEXTURE_2D_PIXEL_FORMAT_RGB565=2,cc.TEXTURE_2D_PIXEL_FORMAT_A8=3,cc.TEXTURE_2D_PIXEL_FORMAT_I8=4,cc.TEXTURE_2D_PIXEL_FORMAT_AI88=5,cc.TEXTURE_2D_PIXEL_FORMAT_RGBA4444=6,cc.TEXTURE_2D_PIXEL_FORMAT_RGB5A1=7,cc.TEXTURE_2D_PIXEL_FORMAT_PVRTC4=8,cc.TEXTURE_2D_PIXEL_FORMAT_PVRTC2=9,cc.TEXTURE_2D_PIXEL_FORMAT_DEFAULT=cc.TEXTURE_2D_PIXEL_FORMAT_RGBA8888,cc._defaultAlphaPixelFormat=cc.TEXTURE_2D_PIXEL_FORMAT_DEFAULT,cc.PVRHaveAlphaPremultiplied_=!1,cc._texParams=function(e,t,n,r){this.minFilter=e||0,this.magFilter=t||0,this.wrapS=n||0,this.wrapT=r||0},cc.Texture2DWebGL=cc.Class.extend({_pVRHaveAlphaPremultiplied:null,_pixelFormat:null,_pixelsWide:null,_pixelsHigh:null,_name:null,_contentSize:null,_maxS:null,_maxT:null,_hasPremultipliedAlpha:null,_hasMipmaps:!1,_shaderProgram:null,_isLoaded:!1,_htmlElementObj:null,_webTextureObj:null,_loadedEventListeners:null,ctor:function(){this._pixelsWide=0,this._pixelsHigh=0,this._name="",this._maxS=0,this._maxT=0,this._hasPremultipliedAlpha=!1,this._contentSize=cc._sizeConst(0,0),this._hasMipmaps=!1,this._pVRHaveAlphaPremultiplied=!0,this._pixelFormat=cc.Texture2D.defaultAlphaPixelFormat(),this._shaderProgram=null,this._isLoaded=!1,this._htmlElementObj=null,this._webTextureObj=null},releaseTexture:function(){this._webTextureObj&&cc.renderContext.deleteTexture(this._webTextureObj)},getPixelFormat:function(){return this._pixelFormat},getPixelsWide:function(){return this._pixelsWide},getPixelsHigh:function(){return this._pixelsHigh},getName:function(){return this._webTextureObj},getContentSize:function(){return cc.size(this._contentSize.width/cc.CONTENT_SCALE_FACTOR(),this._contentSize.height/cc.CONTENT_SCALE_FACTOR())},getContentSizeInPixels:function(){return this._contentSize},getMaxS:function(){return this._maxS},setMaxS:function(e){this._maxS=e},getMaxT:function(){return this._maxT},setMaxT:function(e){this._maxT=e},getShaderProgram:function(){return this._shaderProgram},setShaderProgram:function(e){this._shaderProgram=e},hasPremultipliedAlpha:function(){return this._hasPremultipliedAlpha},hasMipmaps:function(){return this._hasMipmaps},description:function(){return"<cc.Texture2D | Name = "+this._name+" | Dimensions = "+this._pixelsWide+" x "+this._pixelsHigh+" | Coordinates = ("+this._maxS+", "+this._maxT+")>"},releaseData:function(e){e=null},keepData:function(e,t){return e},initWithData:function(e,t,n,r,i){var s=cc.renderContext,o=0;t===cc.TEXTURE_2D_PIXEL_FORMAT_RGBA8888?o=24:o=this.bitsPerPixelForFormat(t);var u=n*o/8;u%8===0?s.pixelStorei(s.UNPACK_ALIGNMENT,8):u%4===0?s.pixelStorei(s.UNPACK_ALIGNMENT,4):u%2===0?s.pixelStorei(s.UNPACK_ALIGNMENT,2):s.pixelStorei(s.UNPACK_ALIGNMENT,1),this._webTextureObj=s.createTexture(),cc.glBindTexture2D(this),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE);switch(t){case cc.TEXTURE_2D_PIXEL_FORMAT_RGBA8888:s.texImage2D(s.TEXTURE_2D,0,s.RGBA,n,r,0,s.RGBA,s.UNSIGNED_BYTE,e);break;case cc.TEXTURE_2D_PIXEL_FORMAT_RGB888:s.texImage2D(s.TEXTURE_2D,0,s.RGB,n,r,0,s.RGB,s.UNSIGNED_BYTE,e);break;case cc.TEXTURE_2D_PIXEL_FORMAT_RGBA4444:s.texImage2D(s.TEXTURE_2D,0,s.RGBA,n,r,0,s.RGBA,s.UNSIGNED_SHORT_4_4_4_4,e);break;case cc.TEXTURE_2D_PIXEL_FORMAT_RGB5A1:s.texImage2D(s.TEXTURE_2D,0,s.RGBA,n,r,0,s.RGBA,s.UNSIGNED_SHORT_5_5_5_1,e);break;case cc.TEXTURE_2D_PIXEL_FORMAT_RGB565:s.texImage2D(s.TEXTURE_2D,0,s.RGB,n,r,0,s.RGB,s.UNSIGNED_SHORT_5_6_5,e);break;case cc.TEXTURE_2D_PIXEL_FORMAT_AI88:s.texImage2D(s.TEXTURE_2D,0,s.LUMINANCE_ALPHA,n,r,0,s.LUMINANCE_ALPHA,s.UNSIGNED_BYTE,e);break;case cc.TEXTURE_2D_PIXEL_FORMAT_A8:s.texImage2D(s.TEXTURE_2D,0,s.ALPHA,n,r,0,s.ALPHA,s.UNSIGNED_BYTE,e);break;case cc.TEXTURE_2D_PIXEL_FORMAT_I8:s.texImage2D(s.TEXTURE_2D,0,s.LUMINANCE,n,r,0,s.LUMINANCE,s.UNSIGNED_BYTE,e);break;default:throw"NSInternalInconsistencyException"}return this._contentSize._width=i.width,this._contentSize._height=i.height,this._pixelsWide=n,this._pixelsHigh=r,this._pixelFormat=t,this._maxS=i.width/n,this._maxT=i.height/r,this._hasPremultipliedAlpha=!1,this._hasMipmaps=!1,this.setShaderProgram(cc.ShaderCache.getInstance().programForKey(cc.SHADER_POSITION_TEXTURE)),this._isLoaded=!0,!0},drawAtPoint:function(e){var t=[0,this._maxT,this._maxS,this._maxT,0,0,this._maxS,0],n=this._pixelsWide*this._maxS,r=this._pixelsHigh*this._maxT,i=[e.x,e.y,0,n+e.x,e.y,0,e.x,r+e.y,0,n+e.x,r+e.y,0];cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION|cc.VERTEX_ATTRIB_FLAG_TEX_COORDS),this._shaderProgram.use(),this._shaderProgram.setUniformsForBuiltins(),cc.glBindTexture2D(this);var s=cc.renderContext;s.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,s.FLOAT,!1,0,i),s.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,s.FLOAT,!1,0,t),s.drawArrays(s.TRIANGLE_STRIP,0,4)},drawInRect:function(e){var t=[0,this._maxT,this._maxS,this._maxT,0,0,this._maxS,0],n=[e.x,e.y,e.x+e.width,e.y,e.x,e.y+e.height,e.x+e.width,e.y+e.height];cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION|cc.VERTEX_ATTRIB_FLAG_TEX_COORDS),this._shaderProgram.use(),this._shaderProgram.setUniformsForBuiltins(),cc.glBindTexture2D(this);var r=cc.renderContext;r.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,r.FLOAT,!1,0,n),r.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,r.FLOAT,!1,0,t),r.drawArrays(r.TRIANGLE_STRIP,0,4)},initWithImage:function(e){if(e==null)return cc.log("cocos2d: cc.Texture2D. Can't create Texture. UIImage is nil"),!1;var t=e.getWidth(),n=e.getHeight(),r=cc.Configuration.getInstance(),i=r.getMaxTextureSize();return t>i||n>i?(cc.log("cocos2d: WARNING: Image ("+t+" x "+n+") is bigger than the supported "+i+" x "+i),!1):(this._isLoaded=!0,this._initPremultipliedATextureWithImage(e,t,n))},initWithElement:function(e){if(!e)return;this._webTextureObj=cc.renderContext.createTexture(),this._htmlElementObj=e},getHtmlElementObj:function(){return this._htmlElementObj},isLoaded:function(){return this._isLoaded},handleLoadedTexture:function(){this._isLoaded=!0;var e=cc.renderContext;cc.glBindTexture2D(this),e.pixelStorei(e.UNPACK_ALIGNMENT,4),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,this._htmlElementObj),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),this.setShaderProgram(cc.ShaderCache.getInstance().programForKey(cc.SHADER_POSITION_TEXTURE)),cc.glBindTexture2D(null);var t=this._htmlElementObj.width,n=this._htmlElementObj.height;this._pixelsWide=this._contentSize._width=t,this._pixelsHigh=this._contentSize._height=n,this._pixelFormat=cc.TEXTURE_2D_PIXEL_FORMAT_RGBA8888,this._maxS=1,this._maxT=1,this._hasPremultipliedAlpha=!1,this._hasMipmaps=!1,this._callLoadedEventCallbacks()},initWithString:function(e,t,n,r,i,s){arguments.length==3&&(t=arguments[1],n=arguments[2],r=cc.size(0,0),i=cc.TEXT_ALIGNMENT_CENTER,s=cc.VERTICAL_TEXT_ALIGNMENT_TOP);var o=new cc.Image,u;if(cc.VERTICAL_TEXT_ALIGNMENT_TOP===s)u=cc.TEXT_ALIGNMENT_CENTER===i?cc.ALIGN_TOP:cc.TEXT_ALIGNMENT_LEFT===i?cc.ALIGN_TOP_LEFT:cc.ALIGN_TOP_RIGHT;else if(cc.VERTICAL_TEXT_ALIGNMENT_CENTER===s)u=cc.TEXT_ALIGNMENT_CENTER===i?cc.ALIGN_CENTER:cc.TEXT_ALIGNMENT_LEFT===i?cc.ALIGN_LEFT:cc.ALIGN_RIGHT;else{if(cc.VERTICAL_TEXT_ALIGNMENT_BOTTOM!==s)return cc.log("Not supported alignment format!"),!1;u=cc.TEXT_ALIGNMENT_CENTER===i?cc.ALIGN_BOTTOM:cc.TEXT_ALIGNMENT_LEFT===i?cc.ALIGN_BOTTOM_LEFT:cc.ALIGN_BOTTOM_RIGHT}return o.initWithString(e,r.width,r.height,u,t,n)?this.initWithImage(o):!1},initWithETCFile:function(e){return!1},initWithPVRFile:function(e){var t=!1,n=new cc.TexturePVR;return t=n.initWithContentsOfFile(e),t?(n.setRetainName(!0),this._name=n.getName(),this._maxS=1,this._maxT=1,this._pixelsWide=n.getWidth(),this._pixelsHigh=n.getHeight(),this._contentSize._width=this._pixelsWide,this._contentSize._height=this._pixelsHigh,this._hasPremultipliedAlpha=cc.PVRHaveAlphaPremultiplied_,this._pixelFormat=n.getFormat(),this.setAntiAliasTexParameters()):cc.log("cocos2d: Couldn't load PVR image "+e),t},initWithPVRTCData:function(e,t,n,r,i,s){return cc.Configuration.getInstance().supportsPVRTC()?!0:(cc.log("cocos2d: WARNING: PVRTC images is not supported."),!1)},setTexParameters:function(e){var t=cc.renderContext;cc.Assert(this._pixelsWide==cc.NextPOT(this._pixelsWide)&&this._pixelsHigh==cc.NextPOT(this._pixelsHigh)||e.wrapS==t.CLAMP_TO_EDGE&&e.wrapT==t.CLAMP_TO_EDGE,"WebGLRenderingContext.CLAMP_TO_EDGE should be used in NPOT textures"),cc.glBindTexture2D(this),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,e.minFilter),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,e.magFilter),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,e.wrapS),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,e.wrapT)},setAntiAliasTexParameters:function(){var e=cc.renderContext;cc.glBindTexture2D(this),this._hasMipmaps?e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_NEAREST):e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST)},setAliasTexParameters:function(){var e=cc.renderContext;cc.glBindTexture2D(this),this._hasMipmaps?e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST_MIPMAP_NEAREST):e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST)},generateMipmap:function(){cc.Assert(this._pixelsWide==cc.NextPOT(this._pixelsWide)&&this._pixelsHigh==cc.NextPOT(this._pixelsHigh),"Mimpap texture only works in POT textures"),cc.glBindTexture2D(this),cc.renderContext.generateMipmap(cc.renderContext.TEXTURE_2D),this._hasMipmaps=!0},stringForFormat:function(){switch(this._pixelFormat){case cc.TEXTURE_2D_PIXEL_FORMAT_RGBA8888:return"RGBA8888";case cc.TEXTURE_2D_PIXEL_FORMAT_RGB888:return"RGB888";case cc.TEXTURE_2D_PIXEL_FORMAT_RGB565:return"RGB565";case cc.TEXTURE_2D_PIXEL_FORMAT_RGBA4444:return"RGBA4444";case cc.TEXTURE_2D_PIXEL_FORMAT_RGB5A1:return"RGB5A1";case cc.TEXTURE_2D_PIXEL_FORMAT_AI88:return"AI88";case cc.TEXTURE_2D_PIXEL_FORMAT_A8:return"A8";case cc.TEXTURE_2D_PIXEL_FORMAT_I8:return"I8";case cc.TEXTURE_2D_PIXEL_FORMAT_PVRTC4:return"PVRTC4";case cc.TEXTURE_2D_PIXEL_FORMAT_PVRTC2:return"PVRTC2";default:cc.log("stringForFormat: "+this._pixelFormat+", cannot give useful result, it's a unrecognized pixel format")}return""},bitsPerPixelForFormat:function(e){e=e||this._pixelFormat;switch(e){case cc.TEXTURE_2D_PIXEL_FORMAT_RGBA8888:return 32;case cc.TEXTURE_2D_PIXEL_FORMAT_RGB888:return 32;case cc.TEXTURE_2D_PIXEL_FORMAT_RGB565:return 16;case cc.TEXTURE_2D_PIXEL_FORMAT_A8:return 8;case cc.TEXTURE_2D_PIXEL_FORMAT_RGBA4444:return 16;case cc.TEXTURE_2D_PIXEL_FORMAT_RGB5A1:return 16;case cc.TEXTURE_2D_PIXEL_FORMAT_PVRTC4:return 4;case cc.TEXTURE_2D_PIXEL_FORMAT_PVRTC2:return 2;case cc.TEXTURE_2D_PIXEL_FORMAT_I8:return 8;case cc.TEXTURE_2D_PIXEL_FORMAT_AI88:return 16;default:return cc.log("bitsPerPixelForFormat: "+this._pixelFormat+", cannot give useful result, it's a illegal pixel format"),-1}},_initPremultipliedATextureWithImage:function(e,t,n){var r=e.getData(),i=null,s=null,o=null,u=e.hasAlpha(),a=cc.size(e.getWidth(),e.getHeight()),f=cc.TEXTURE_2D_PIXEL_FORMAT_DEFAULT,l=e.getBitsPerComponent(),c;u||(l>=8?f=cc.TEXTURE_2D_PIXEL_FORMAT_RGB888:(cc.log("cocos2d: cc.Texture2D: Using RGB565 texture since image has no alpha"),f=cc.TEXTURE_2D_PIXEL_FORMAT_RGB565));var h=t*n;if(f==cc.TEXTURE_2D_PIXEL_FORMAT_RGB565)if(u){r=new Uint16Array(t*n),i=e.getData();for(c=0;c<h;++c)r[c]=(i[c]>>0&255)>>3<<11|(i[c]>>8&255)>>2<<5|(i[c]>>16&255)>>3<<0}else{r=new Uint16Array(t*n),s=e.getData();for(c=0;c<h;++c)r[c]=(s[c]&255)>>3<<11|(s[c]&255)>>2<<5|(s[c]&255)>>3<<0}else if(f==cc.TEXTURE_2D_PIXEL_FORMAT_RGBA4444){r=new Uint16Array(t*n),i=e.getData();for(c=0;c<h;++c)r[c]=(i[c]>>0&255)>>4<<12|(i[c]>>8&255)>>4<<8|(i[c]>>16&255)>>4<<4|(i[c]>>24&255)>>4<<0}else if(f==cc.TEXTURE_2D_PIXEL_FORMAT_RGB5A1){r=new Uint16Array(t*n),i=e.getData();for(c=0;c<h;++c)r[c]=(i[c]>>0&255)>>3<<11|(i[c]>>8&255)>>3<<6|(i[c]>>16&255)>>3<<1|(i[c]>>24&255)>>7<<0}else if(f==cc.TEXTURE_2D_PIXEL_FORMAT_A8){r=new Uint8Array(t*n),i=e.getData();for(c=0;c<h;++c)r[c]=i>>24&255}if(u&&f==cc.TEXTURE_2D_PIXEL_FORMAT_RGB888){i=e.getData(),r=new Uint8Array(t*n*3);for(c=0;c<h;++c)r[c*3]=i>>0&255,r[c*3+1]=i>>8&255,r[c*3+2]=i>>16&255}return this.initWithData(r,f,t,n,a),r!=e.getData()&&(r=null),this._hasPremultipliedAlpha=e.isPremultipliedAlpha(),!0},addLoadedEventListener:function(e,t){this._loadedEventListeners||(this._loadedEventListeners=[]),this._loadedEventListeners.push({eventCallback:e,eventTarget:t})},removeLoadedEventListener:function(e){if(!this._loadedEventListeners)return;var t=this._loadedEventListeners;for(var n=0;n<t.length;n++){var r=t[n];r.eventTarget==e&&t.splice(n,1)}},_callLoadedEventCallbacks:function(){if(!this._loadedEventListeners)return;var e=this._loadedEventListeners;for(var t=0,n=e.length;t<n;t++){var r=e[t];cc.doCallback(r.eventCallback,r.eventTarget,this)}e.length=0}}),cc.Texture2DCanvas=cc.Class.extend({_contentSize:null,_isLoaded:!1,_htmlElementObj:null,_loadedEventListeners:null,ctor:function(){this._contentSize=cc._sizeConst(0,0),this._isLoaded=!1,this._htmlElementObj=null},getPixelsWide:function(){return this._contentSize._width},getPixelsHigh:function(){return this._contentSize._height},getContentSize:function(){var e=cc.CONTENT_SCALE_FACTOR();return cc.size(this._contentSize._width/e,this._contentSize._height/e)},getContentSizeInPixels:function(){return this._contentSize},initWithElement:function(e){if(!e)return;this._htmlElementObj=e},getHtmlElementObj:function(){return this._htmlElementObj},isLoaded:function(){return this._isLoaded},handleLoadedTexture:function(){this._isLoaded=!0;var e=this._htmlElementObj;this._contentSize._width=e.width,this._contentSize._height=e.height,this._callLoadedEventCallbacks()},description:function(){return"<cc.Texture2D | width = "+this._contentSize._width+" height "+this._contentSize._height+">"},initWithData:function(e,t,n,r,i){return!1},initWithImage:function(e){return!1},initWithString:function(e,t,n,r,i,s){return!1},releaseTexture:function(){},getName:function(){return null},getMaxS:function(){return 1},setMaxS:function(e){},getMaxT:function(){return 1},setMaxT:function(e){},getShaderProgram:function(){return null},setShaderProgram:function(e){},hasPremultipliedAlpha:function(){return!1},hasMipmaps:function(){return!1},releaseData:function(e){e=null},keepData:function(e,t){return e},drawAtPoint:function(e){},drawInRect:function(e){},initWithETCFile:function(e){return!1},initWithPVRFile:function(e){return!1},initWithPVRTCData:function(e,t,n,r,i,s){return!0},setTexParameters:function(e){},setAntiAliasTexParameters:function(){},setAliasTexParameters:function(){},generateMipmap:function(){},stringForFormat:function(){return""},bitsPerPixelForFormat:function(e){return-1},addLoadedEventListener:function(e,t){this._loadedEventListeners||(this._loadedEventListeners=[]),this._loadedEventListeners.push({eventCallback:e,eventTarget:t})},removeLoadedEventListener:function(e){if(!this._loadedEventListeners)return;var t=this._loadedEventListeners;for(var n=0;n<t.length;n++){var r=t[n];r.eventTarget==e&&t.splice(n,1)}},_callLoadedEventCallbacks:function(){if(!this._loadedEventListeners)return;var e=this._loadedEventListeners;for(var t=0,n=e.length;t<n;t++){var r=e[t];cc.doCallback(r.eventCallback,r.eventTarget,this)}e.length=0}}),cc.Texture2D=cc.Browser.supportWebGL?cc.Texture2DWebGL:cc.Texture2DCanvas,cc.Texture2D.setDefaultAlphaPixelFormat=function(e){cc._defaultAlphaPixelFormat=e},cc.Texture2D.defaultAlphaPixelFormat=function(){return cc._defaultAlphaPixelFormat},cc.Texture2D.getDefaultAlphaPixelFormat=function(){return cc._defaultAlphaPixelFormat},cc.Texture2D.PVRImagesHavePremultipliedAlpha=function(e){cc.PVRHaveAlphaPremultiplied_=e},cc.g_sharedTextureCache=null,cc.loadImage=function(e){var t=cc.computeImageFormatType(e);if(t==cc.FMT_UNKNOWN){cc.log("unsupported format:"+e);return}var n=new Image;n.src=e,n.addEventListener("load",cc.loadImage.handler,!1)},cc.loadImage.handler=function(){cc.TextureCache.getInstance().cacheImage(this.src,this),this.removeEventListener("load",cc.loadImage.handler,!1)},cc.computeImageFormatType=function(e){return e.toLowerCase().indexOf(".jpg")>0||e.toLowerCase().indexOf(".jpeg")>0?cc.FMT_JPG:e.toLowerCase().indexOf(".png")>0?cc.FMT_PNG:e.toLowerCase().indexOf(".webp")>0?cc.FMT_WEBP:cc.FMT_UNKNOWN},cc.TextureCache=cc.Class.extend({_textures:null,_textureColorsCache:null,_textureKeySeq:null,_rendererInitialized:!1,_loadedTexturesBefore:null,_loadingTexturesBefore:null,ctor:function(){if(cc.g_sharedTextureCache)throw"Attempted to allocate a second instance of a singleton.";this._textureKeySeq+=0|Math.random()*1e3,this._textures={},this._textureColorsCache={},cc.renderContextType===cc.WEBGL&&(this._loadedTexturesBefore={},this._loadingTexturesBefore={})},_addImageAsyncCallBack:function(e,t){cc.doCallback(t,e)},_initializingRenderer:function(){this._rendererInitialized=!0;var e,t=this._loadedTexturesBefore,n=this._textures;for(e in t){var r=t[e],i=new cc.Texture2D;i.initWithElement(r),i.handleLoadedTexture(),n[e]=i}this._loadedTexturesBefore={}},addPVRTCImage:function(e){cc.log("TextureCache:addPVRTCImage does not support on HTML5")},addETCImage:function(e){cc.log("TextureCache:addPVRTCImage does not support on HTML5")},description:function(){return"<TextureCache | Number of textures = "+this._textures.length+">"},textureForKey:function(e){var t=cc.FileUtils.getInstance().fullPathForFilename(e);return this._textures[t]?this._textures[t]:null},getKeyByTexture:function(e){for(var t in this._textures)if(this._textures[t]==e)return t;return null},_generalTextureKey:function(){return this._textureKeySeq++,"_textureKey_"+this._textureKeySeq},getTextureColors:function(e){var t=this.getKeyByTexture(e);return t||(e instanceof HTMLImageElement?t=e.src:t=this._generalTextureKey()),this._textureColorsCache[t]||(this._textureColorsCache[t]=cc.generateTextureCacheForColor(e)),this._textureColorsCache[t]},addPVRImage:function(e){if(!e)throw"cc.TextureCache.addPVRImage(): path should be non-null";e=cc.FileUtils.getInstance().fullPathForFilename(e);var t=e;if(this._textures[t]!=null)return this._textures[t];var n=new cc.Texture2D;return n.initWithPVRFile(t)?this._textures[t]=n:cc.log("cocos2d: Couldn't add PVRImage:"+t+" in TextureCache"),n},removeAllTextures:function(){var e=this._textures;for(var t in e)e[t]&&e[t].releaseTexture();this._textures={}},removeTexture:function(e){if(!e)return;var t=this._textures;for(var n in t)t[n]==e&&(t[n].releaseTexture(),delete t[n])},removeTextureForKey:function(e){if(e==null)return;var t=cc.FileUtils.getInstance().fullPathForFilename(e);this._textures[t]&&delete this._textures[t]},_loadErrorHandler:function(e,t,n){n[e]&&delete n[e],this.removeEventListener("error",t._loadErrorHandler,!1)},_clientLoadHandler:function(e,t,n,r){e instanceof cc.Texture2D?e.handleLoadedTexture():t._textures[e]&&t._textures[e].handleLoadedTexture(),t._addImageAsyncCallBack(r,n),this.removeEventListener("load",t._addAsyncLoadHandler,!1)},_preloadHandler:function(e,t){e instanceof cc.Texture2D?e.handleLoadedTexture():t._textures[e]&&t._textures[e].handleLoadedTexture(),this.removeEventListener("load",t._addAsyncLoadHandler,!1)},_beforeRendererLoadHandler:function(e,t){var n=t._loadingTexturesBefore;n[e]&&(t._loadedTexturesBefore[e]=n[e],delete n[e]),this.removeEventListener("load",t._beforeRendererLoadHandler,!1)},addImageAsync:function(e,t,n){if(!e)throw"cc.TextureCache.addImageAsync(): path should be non-null";e=cc.FileUtils.getInstance().fullPathForFilename(e);var r=this._textures[e],i,s;if(r)r.isLoaded()?this._addImageAsyncCallBack(n,t):(i=r.getHtmlElementObj(),i.addEventListener("load",this._clientLoadHandler.bind(i,r,this,t,n)));else{i=new Image,i.crossOrigin="Anonymous",i.addEventListener("load",this._clientLoadHandler.bind(i,e,this,t,n)),i.addEventListener("error",this._loadErrorHandler.bind(i,e,this,this._textures)),i.src=e;var o=new cc.Texture2D;o.initWithElement(i),this._textures[e]=o}return this._textures[e]},_addImageBeforeRenderer:function(e){var t=new Image;t.crossOrigin="Anonymous",t.addEventListener("load",this._beforeRendererLoadHandler.bind(t,e,this)),t.addEventListener("error",this._loadErrorHandler.bind(t,e,this,this._loadingTexturesBefore)),t.src=e,this._loadingTexturesBefore[e]=t},addImage:function(e){if(!e)throw"cc.Texture.addImage(): path should be non-null";if(cc.renderContextType===cc.WEBGL&&!this._rendererInitialized)return this._addImageBeforeRenderer(e);e=cc.FileUtils.getInstance().fullPathForFilename(e);var t=this._textures[e],n;if(t)t.isLoaded()||(n=t.getHtmlElementObj(),n.addEventListener("load",this._preloadHandler.bind(n,t,this)));else{n=new Image,n.crossOrigin="Anonymous",n.addEventListener("load",this._preloadHandler.bind(n,e,this)),n.addEventListener("error",this._loadErrorHandler.bind(n,e,this,this._textures)),n.src=e;var r=new cc.Texture2D;r.initWithElement(n),this._textures[e]=r}return this._textures[e]},cacheImage:function(e,t){if(t instanceof cc.Texture2D){this._textures[e]=t;return}var n=new cc.Texture2D;n.initWithElement(t),n.handleLoadedTexture(),this._textures[e]=n},addUIImage:function(e,t){if(!e)throw"cc.Texture.addUIImage(): image should be non-null";if(t&&this._textures[t])return this._textures[t];var n=new cc.Texture2D;return n.initWithImage(e),t!=null&&n!=null?this._textures[t]=n:cc.log("cocos2d: Couldn't add UIImage in TextureCache"),n},dumpCachedTextureInfo:function(){var e=0,t=0,n=this._textures;for(var r in n){var i=n[r];e++,i.getHtmlElementObj()instanceof HTMLImageElement?cc.log("cocos2d: '"+r+"' id="+i.getHtmlElementObj().src+" "+i.getPixelsWide()+" x "+i.getPixelsHigh()):cc.log("cocos2d: '"+r+"' id= HTMLCanvasElement "+i.getPixelsWide()+" x "+i.getPixelsHigh()),t+=i.getPixelsWide()*i.getPixelsHigh()*4}var s=this._textureColorsCache;for(r in s){var o=s[r];for(var u in o){var a=o[u];e++,cc.log("cocos2d: '"+r+"' id= HTMLCanvasElement "+a.width+" x "+a.height),t+=a.width*a.height*4}}cc.log("cocos2d: TextureCache dumpDebugInfo: "+e+" textures, HTMLCanvasElement for "+t/1024+" KB ("+(t/1048576).toFixed(2)+" MB)")}}),cc.TextureCache.getInstance=function(){return cc.g_sharedTextureCache||(cc.g_sharedTextureCache=new cc.TextureCache),cc.g_sharedTextureCache},cc.TextureCache.purgeSharedTextureCache=function(){cc.g_sharedTextureCache=null},cc.TextureAtlas=cc.Class.extend({_indices:null,_buffersVBO:null,_dirty:!1,_capacity:0,_texture:null,_quads:null,_quadsArrayBuffer:null,_quadsWebBuffer:null,_quadsReader:null,ctor:function(){this._buffersVBO=[]},getTotalQuads:function(){return this._totalQuads},getCapacity:function(){return this._capacity},getTexture:function(){return this._texture},setTexture:function(e){this._texture=e},setDirty:function(e){this._dirty=e},isDirty:function(){return this._dirty},getQuads:function(){return this._quads},setQuads:function(e){this._quads=e},_copyQuadsToTextureAtlas:function(e,t){if(!e)return;for(var n=0;n<e.length;n++)this._setQuadToArray(e[n],t+n)},_setQuadToArray:function(e,t){var n=this._quads;if(!n[t]){n[t]=new cc.V3F_C4B_T2F_Quad(e.tl,e.bl,e.tr,e.br,this._quadsArrayBuffer,t*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT);return}n[t].bl=e.bl,n[t].br=e.br,n[t].tl=e.tl,n[t].tr=e.tr},description:function(){return"<cc.TextureAtlas | totalQuads ="+this._totalQuads+">"},_setupIndices:function(){if(this._capacity===0)return;var e=this._indices,t=this._capacity;for(var n=0;n<t;n++)cc.TEXTURE_ATLAS_USE_TRIANGLE_STRIP?(e[n*6+0]=n*4+0,e[n*6+1]=n*4+0,e[n*6+2]=n*4+2,e[n*6+3]=n*4+1,e[n*6+4]=n*4+3,e[n*6+5]=n*4+3):(e[n*6+0]=n*4+0,e[n*6+1]=n*4+1,e[n*6+2]=n*4+2,e[n*6+3]=n*4+3,e[n*6+4]=n*4+2,e[n*6+5]=n*4+1)},_setupVBO:function(){var e=cc.renderContext;this._buffersVBO[0]=e.createBuffer(),this._buffersVBO[1]=e.createBuffer(),this._quadsWebBuffer=e.createBuffer(),this._mapBuffers()},_mapBuffers:function(){var e=cc.renderContext;e.bindBuffer(e.ARRAY_BUFFER,this._quadsWebBuffer),e.bufferData(e.ARRAY_BUFFER,this._quadsArrayBuffer,e.DYNAMIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._buffersVBO[1]),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this._indices,e.STATIC_DRAW)},initWithFile:function(e,t){var n=cc.TextureCache.getInstance().addImage(e);return n?this.initWithTexture(n,t):(cc.log("cocos2d: Could not open file: "+e),!1)},initWithTexture:function(e,t){if(!e)throw"cc.TextureAtlas.initWithTexture():texture should be non-null";t=0|t,this._capacity=t,this._totalQuads=0,this._texture=e,this._quads=[],this._indices=new Uint16Array(t*6);var n=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT;this._quadsArrayBuffer=new ArrayBuffer(n*t),this._quadsReader=new Uint8Array(this._quadsArrayBuffer);if((!this._quads||!this._indices)&&t>0)return!1;var r=this._quads;for(var i=0;i<t;i++)r[i]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,this._quadsArrayBuffer,i*n);return this._setupIndices(),this._setupVBO(),this._dirty=!0,!0},updateQuad:function(e,t){if(!e)throw"cc.TextureAtlas.updateQuad(): quad should be non-null";if(t<0||t>=this._capacity)throw"cc.TextureAtlas.updateQuad(): Invalid index";this._totalQuads=Math.max(t+1,this._totalQuads),this._setQuadToArray(e,t),this._dirty=!0},insertQuad:function(e,t){if(t>=this._capacity)throw"cc.TextureAtlas.insertQuad(): Invalid index";this._totalQuads++;if(this._totalQuads>
this._capacity){cc.log("cc.TextureAtlas.insertQuad(): invalid totalQuads");return}var n=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,r=this._totalQuads-1-t,i=t*n,s=r*n;this._quads[this._totalQuads-1]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,this._quadsArrayBuffer,(this._totalQuads-1)*n),this._quadsReader.set(this._quadsReader.subarray(i,i+s),i+n),this._setQuadToArray(e,t),this._dirty=!0},insertQuads:function(e,t,n){n=n||e.length;if(t+n>this._capacity)throw"cc.TextureAtlas.insertQuad(): Invalid index + amount";var r=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT;this._totalQuads+=n;if(this._totalQuads>this._capacity){cc.log("cc.TextureAtlas.insertQuad(): invalid totalQuads");return}var i=this._totalQuads-1-t-n,s=t*r,o=i*r,u=this._totalQuads-1-n,a;for(a=0;a<n;a++)this._quads[u+a]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,this._quadsArrayBuffer,(this._totalQuads-1)*r);this._quadsReader.set(this._quadsReader.subarray(s,s+o),s+r*n);for(a=0;a<n;a++)this._setQuadToArray(e[a],t+a);this._dirty=!0},insertQuadFromIndex:function(e,t){if(e===t)return;if(t<0&&t>=this._totalQuads)throw"cc.TextureAtlas.insertQuadFromIndex(): Invalid newIndex";if(e<0&&e>=this._totalQuads)throw"cc.TextureAtlas.insertQuadFromIndex(): Invalid fromIndex";var n=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,r=this._quadsReader,i=r.subarray(e*n,n),s,o;e>t?(s=t*n,o=(e-t)*n,r.set(r.subarray(s,s+o),s+n),r.set(i,s)):(s=(e+1)*n,o=(t-e)*n,r.set(r.subarray(s,s+o),s-n),r.set(i,t*n)),this._dirty=!0},removeQuadAtIndex:function(e){if(e>=this._totalQuads)throw"cc.TextureAtlas.removeQuadAtIndex(): Invalid index";var t=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT;this._totalQuads--,this._quads.length=this._totalQuads;if(e!==this._totalQuads){var n=(e+1)*t,r=(this._totalQuads-e)*t;this._quadsReader.set(this._quadsReader.subarray(n,n+r),n-t)}this._dirty=!0},removeQuadsAtIndex:function(e,t){if(e+t>this._totalQuads)throw"cc.TextureAtlas.removeQuadsAtIndex(): index + amount out of bounds";this._totalQuads-=t;if(e!==this._totalQuads){var n=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,r=(e+t)*n,i=(this._totalQuads-e)*n,s=e*n;this._quadsReader.set(this._quadsReader.subarray(r,r+i),s)}this._dirty=!0},removeAllQuads:function(){this._quads.length=0,this._totalQuads=0},_setDirty:function(e){this._dirty=e},resizeCapacity:function(e){if(e==this._capacity)return!0;var t=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,n=this._capacity;this._totalQuads=Math.min(this._totalQuads,e),this._capacity=0|e;var r,i=this._capacity,s=this._totalQuads;if(this._quads==null){this._quads=[],this._quadsArrayBuffer=new ArrayBuffer(t*i),this._quadsReader=new Uint8Array(this._quadsArrayBuffer);for(r=0;r<i;r++)this._quads=new cc.V3F_C4B_T2F_Quad(null,null,null,null,this._quadsArrayBuffer,r*t)}else{var o,u,a=this._quads;if(i>n){o=[],u=new ArrayBuffer(t*i);for(r=0;r<s;r++)o[r]=new cc.V3F_C4B_T2F_Quad(a[r].tl,a[r].bl,a[r].tr,a[r].br,u,r*t);for(;r<i;r++)o[r]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,u,r*t);this._quadsReader=new Uint8Array(u),this._quads=o,this._quadsArrayBuffer=u}else{var f=Math.max(s,i);o=[],u=new ArrayBuffer(t*i);for(r=0;r<f;r++)o[r]=new cc.V3F_C4B_T2F_Quad(a[r].tl,a[r].bl,a[r].tr,a[r].br,u,r*t);this._quadsReader=new Uint8Array(u),this._quads=o,this._quadsArrayBuffer=u}}if(this._indices==null)this._indices=new Uint16Array(i*6);else if(i>n){var l=new Uint16Array(i*6);l.set(this._indices,0),this._indices=l}else this._indices=this._indices.subarray(0,i*6);return this._setupIndices(),this._mapBuffers(),this._dirty=!0,!0},increaseTotalQuadsWith:function(e){this._totalQuads+=e},moveQuadsFromIndex:function(e,t,n){if(n===undefined){n=t,t=this._totalQuads-e;if(n+(this._totalQuads-e)>this._capacity)throw"cc.TextureAtlas.moveQuadsFromIndex(): move is out of bounds";if(t===0)return}else{if(n+t>this._totalQuads)throw"cc.TextureAtlas.moveQuadsFromIndex(): Invalid newIndex";if(e>=this._totalQuads)throw"cc.TextureAtlas.moveQuadsFromIndex(): Invalid oldIndex";if(e==n)return}var r=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,i=e*r,s=t*r,o=this._quadsReader,u=o.subarray(i,i+s),a=n*r,f,l;n<e?(f=(e-n)*r,l=n*r,o.set(o.subarray(l,l+f),l+s)):(f=(n-e)*r,l=(e+t)*r,o.set(o.subarray(l,l+f),i)),o.set(u,a),this._dirty=!0},fillWithEmptyQuadsFromIndex:function(e,t){var n=t*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,r=new Uint8Array(this._quadsArrayBuffer,e*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,n);for(var i=0;i<n;i++)r[i]=0},drawNumberOfQuads:function(e,t){t=t||0;if(0===e||!this._texture||!this._texture.isLoaded())return;var n=cc.renderContext;cc.glBindTexture2D(this._texture),cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POS_COLOR_TEX),n.bindBuffer(n.ARRAY_BUFFER,this._quadsWebBuffer),this._dirty&&n.bufferData(n.ARRAY_BUFFER,this._quadsArrayBuffer,n.DYNAMIC_DRAW),n.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,3,n.FLOAT,!1,24,0),n.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,n.UNSIGNED_BYTE,!0,24,12),n.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,n.FLOAT,!1,24,16),this._dirty&&(this._dirty=!1),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this._buffersVBO[1]),cc.TEXTURE_ATLAS_USE_TRIANGLE_STRIP?n.drawElements(n.TRIANGLE_STRIP,e*6,n.UNSIGNED_SHORT,t*6*this._indices.BYTES_PER_ELEMENT):n.drawElements(n.TRIANGLES,e*6,n.UNSIGNED_SHORT,t*6*this._indices.BYTES_PER_ELEMENT),cc.g_NumberOfDraws++},drawQuads:function(){this.drawNumberOfQuads(this._totalQuads,0)},_releaseBuffer:function(){var e=cc.renderContext;this._buffersVBO&&(this._buffersVBO[0]&&e.deleteBuffer(this._buffersVBO[0]),this._buffersVBO[1]&&e.deleteBuffer(this._buffersVBO[1])),this._quadsWebBuffer&&e.deleteBuffer(this._quadsWebBuffer)}}),cc.TextureAtlas.create=function(e,t){var n=new cc.TextureAtlas;return n&&n.initWithFile(e,t)?n:null},cc.TextureAtlas.createWithTexture=function(e,t){var n=new cc.TextureAtlas;return n&&n.initWithTexture(e,t)?n:null},cc.Scene=cc.Node.extend({ctor:function(){cc.Node.prototype.ctor.call(this),this._ignoreAnchorPointForPosition=!0,this.setAnchorPoint(.5,.5),this.setContentSize(cc.Director.getInstance().getWinSize())}}),cc.Scene.create=function(){return new cc.Scene},cc.TOUCH_ALL_AT_ONCE=0,cc.TOUCH_ONE_BY_ONE=1,cc.Layer=cc.Node.extend({_isTouchEnabled:!1,_isAccelerometerEnabled:!1,_isKeyboardEnabled:!1,_touchPriority:0,_touchMode:cc.TOUCH_ALL_AT_ONCE,_isMouseEnabled:!1,_mousePriority:0,_swallowTouch:!0,ctor:function(){cc.Node.prototype.ctor.call(this),this._isTouchEnabled=!1,this._isAccelerometerEnabled=!1,this._isKeyboardEnabled=!1,this._touchPriority=0,this._touchMode=cc.TOUCH_ALL_AT_ONCE,this._isMouseEnabled=!1,this._mousePriority=0},_initLayer:function(){this.setAnchorPoint(.5,.5),this._ignoreAnchorPointForPosition=!0;var e=cc.Director.getInstance();this.setContentSize(e.getWinSize())},init:function(){return cc.Node.prototype.init.call(this),this._initLayer(),!0},setKeypadEnabled:function(e){},registerWithTouchDispatcher:function(){this._touchMode===cc.TOUCH_ALL_AT_ONCE?cc.registerStandardDelegate(this,this._touchPriority):cc.registerTargetedDelegate(this._touchPriority,this._swallowTouch,this)},isMouseEnabled:function(){return this._isMouseEnabled},setMouseEnabled:function(e){if(!cc.MouseDispatcher)throw"cc.MouseDispatcher is undefined, maybe it has been removed from js loading list.";this._isMouseEnabled!=e&&(this._isMouseEnabled=e,this._running&&(e?cc.Director.getInstance().getMouseDispatcher().addMouseDelegate(this,this._mousePriority):cc.Director.getInstance().getMouseDispatcher().removeMouseDelegate(this)))},setMousePriority:function(e){if(!cc.MouseDispatcher)throw"cc.MouseDispatcher is undefined, maybe it has been removed from js loading list.";this._mousePriority!==e&&(this._mousePriority=e,this._isMouseEnabled&&(this.setMouseEnabled(!1),this.setMouseEnabled(!0)))},getMousePriority:function(){return this._mousePriority},isTouchEnabled:function(){return this._isTouchEnabled},setTouchEnabled:function(e,t){this._isTouchEnabled!==e&&(this._isTouchEnabled=e,this._swallowTouch=t===!1?!1:!0,this._running&&(e?this.registerWithTouchDispatcher():cc.unregisterTouchDelegate(this)))},getTouchPriority:function(){return this._touchPriority},setTouchPriority:function(e){this._touchPriority!==e&&(this._touchPriority=e,this._isTouchEnabled&&(this.setTouchEnabled(!1),this.setTouchEnabled(!0)))},getTouchMode:function(){return this._touchMode},setTouchMode:function(e){this._touchMode!==e&&(this._touchMode=e,this._isTouchEnabled&&(this.setTouchEnabled(!1),this.setTouchEnabled(!0)))},isAccelerometerEnabled:function(){return this._isAccelerometerEnabled},setAccelerometerEnabled:function(e){if(!cc.Accelerometer)throw"cc.Accelerometer is undefined, maybe it has been removed from js loading list.";if(e!==this._isAccelerometerEnabled){this._isAccelerometerEnabled=e;if(this._running){var t=cc.Director.getInstance();e?t.getAccelerometer().setDelegate(this):t.getAccelerometer().setDelegate(null)}}},setAccelerometerInterval:function(e){this._isAccelerometerEnabled&&cc.Accelerometer&&cc.Director.getInstance().getAccelerometer().setAccelerometerInterval(e)},onAccelerometer:function(e){cc.log("onAccelerometer event should be handled.")},isKeyboardEnabled:function(){return this._isKeyboardEnabled},setKeyboardEnabled:function(e){if(!cc.KeyboardDispatcher)throw"cc.KeyboardDispatcher is undefined, maybe it has been removed from js loading list.";if(e!==this._isKeyboardEnabled){this._isKeyboardEnabled=e;if(this._running){var t=cc.Director.getInstance();e?t.getKeyboardDispatcher().addDelegate(this):t.getKeyboardDispatcher().removeDelegate(this)}}},onEnter:function(){var e=cc.Director.getInstance();this._isTouchEnabled&&this.registerWithTouchDispatcher(),cc.Node.prototype.onEnter.call(this),this._isAccelerometerEnabled&&cc.Accelerometer&&e.getAccelerometer().setDelegate(this),this._isKeyboardEnabled&&cc.KeyboardDispatcher&&e.getKeyboardDispatcher().addDelegate(this),this._isMouseEnabled&&cc.MouseDispatcher&&e.getMouseDispatcher().addMouseDelegate(this,this._mousePriority)},onExit:function(){var e=cc.Director.getInstance();this._isTouchEnabled&&cc.unregisterTouchDelegate(this),this._isAccelerometerEnabled&&cc.Accelerometer&&e.getAccelerometer().setDelegate(null),this._isKeyboardEnabled&&cc.KeyboardDispatcher&&e.getKeyboardDispatcher().removeDelegate(this),this._isMouseEnabled&&cc.MouseDispatcher&&e.getMouseDispatcher().removeMouseDelegate(this),cc.Node.prototype.onExit.call(this)},onEnterTransitionDidFinish:function(){this._isAccelerometerEnabled&&cc.Accelerometer&&cc.Director.getInstance().getAccelerometer().setDelegate(this),cc.Node.prototype.onEnterTransitionDidFinish.call(this)},onTouchBegan:function(e,t){return cc.log("onTouchBegan event should be handled."),!0},onTouchMoved:function(e,t){},onTouchEnded:function(e,t){},onTouchCancelled:function(e,t){},onTouchesBegan:function(e,t){},onTouchesMoved:function(e,t){},onTouchesEnded:function(e,t){},onTouchesCancelled:function(e,t){},onMouseDown:function(e){return!1},onMouseDragged:function(e){return!1},onMouseMoved:function(e){return!1},onMouseUp:function(e){return!1},onRightMouseDown:function(e){return!1},onRightMouseDragged:function(e){return!1},onRightMouseUp:function(e){return!1},onOtherMouseDown:function(e){return!1},onOtherMouseDragged:function(e){return!1},onOtherMouseUp:function(e){return!1},onScrollWheel:function(e){return!1},onMouseEntered:function(e){return!1},onMouseExited:function(e){return!1},onKeyDown:function(e){},onKeyUp:function(e){}}),cc.Layer.create=function(){var e=new cc.Layer;return e&&e.init()?e:null},cc.LayerRGBA=cc.Layer.extend({RGBAProtocol:!0,_displayedOpacity:0,_realOpacity:0,_displayedColor:null,_realColor:null,_cascadeOpacityEnabled:!1,_cascadeColorEnabled:!1,ctor:function(){cc.Layer.prototype.ctor.call(this),this.RGBAProtocol=!0,this._displayedOpacity=255,this._realOpacity=255,this._displayedColor=cc.white(),this._realColor=cc.white(),this._cascadeOpacityEnabled=!1,this._cascadeColorEnabled=!1},init:function(){return cc.Layer.prototype.init.call(this)?(this.setCascadeOpacityEnabled(!1),this.setCascadeColorEnabled(!1),!0):!1},getOpacity:function(){return this._realOpacity},getDisplayedOpacity:function(){return this._displayedOpacity},setOpacity:function(e){this._displayedOpacity=this._realOpacity=e;var t=255,n=this._parent;n&&n.RGBAProtocol&&n.isCascadeOpacityEnabled()&&(t=n.getDisplayedOpacity()),this.updateDisplayedOpacity(t)},updateDisplayedOpacity:function(e){this._displayedOpacity=0|this._realOpacity*e/255;if(this._cascadeOpacityEnabled){var t=this._children;for(var n=0;n<t.length;n++){var r=t[n];r&&r.RGBAProtocol&&r.updateDisplayedOpacity(this._displayedOpacity)}}},isCascadeOpacityEnabled:function(){return this._cascadeOpacityEnabled},setCascadeOpacityEnabled:function(e){if(this._cascadeOpacityEnabled===e)return;this._cascadeOpacityEnabled=e,e?this._enableCascadeOpacity():this._disableCascadeOpacity()},_enableCascadeOpacity:function(){var e=255,t=this._parent;t&&t.RGBAProtocol&&t.isCascadeOpacityEnabled()&&(e=t.getDisplayedOpacity()),this.updateDisplayedOpacity(e)},_disableCascadeOpacity:function(){this._displayedOpacity=this._realOpacity;var e=this._children;for(var t=0;t<e.length;t++){var n=e[t];n&&n.RGBAProtocol&&n.updateDisplayedOpacity(255)}},getColor:function(){var e=this._realColor;return cc.c3b(e.r,e.g,e.b)},getDisplayedColor:function(){var e=this._displayedColor;return cc.c3b(e.r,e.g,e.b)},setColor:function(e){var t=this._displayedColor,n=this._realColor;t.r=n.r=e.r,t.g=n.g=e.g,t.b=n.b=e.b;var r,i=this._parent;i&&i.RGBAProtocol&&i.isCascadeColorEnabled()?r=i.getDisplayedColor():r=cc.white(),this.updateDisplayedColor(r)},updateDisplayedColor:function(e){var t=this._displayedColor,n=this._realColor;t.r=0|n.r*e.r/255,t.g=0|n.g*e.g/255,t.b=0|n.b*e.b/255;if(this._cascadeColorEnabled){var r=this._children;for(var i=0;i<r.length;i++){var s=r[i];s&&s.RGBAProtocol&&s.updateDisplayedColor(t)}}},isCascadeColorEnabled:function(){return this._cascadeColorEnabled},setCascadeColorEnabled:function(e){if(this._cascadeColorEnabled===e)return;this._cascadeColorEnabled=e,this._cascadeColorEnabled?this._enableCascadeColor():this._disableCascadeColor()},_enableCascadeColor:function(){var e,t=this._parent;t&&t.RGBAProtocol&&t.isCascadeColorEnabled()?e=t.getDisplayedColor():e=cc.white(),this.updateDisplayedColor(e)},_disableCascadeColor:function(){var e=this._displayedColor,t=this._realColor;e.r=t.r,e.g=t.g,e.b=t.b;var n=this._children,r=cc.white();for(var i=0;i<n.length;i++){var s=n[i];s&&s.RGBAProtocol&&s.updateDisplayedColor(r)}},addChild:function(e,t,n){cc.Node.prototype.addChild.call(this,e,t,n),this._cascadeColorEnabled&&this._enableCascadeColor(),this._cascadeOpacityEnabled&&this._enableCascadeOpacity()},setOpacityModifyRGB:function(e){},isOpacityModifyRGB:function(){return!1}}),cc.LayerColor=cc.LayerRGBA.extend({_blendFunc:null,getBlendFunc:function(){return this._blendFunc},changeWidthAndHeight:function(e,t){this.setContentSize(e,t)},changeWidth:function(e){this.setContentSize(e,this._contentSize._height)},changeHeight:function(e){this.setContentSize(this._contentSize._width,e)},setOpacityModifyRGB:function(e){},isOpacityModifyRGB:function(){return!1},setColor:function(e){cc.LayerRGBA.prototype.setColor.call(this,e),this._updateColor()},setOpacity:function(e){cc.LayerRGBA.prototype.setOpacity.call(this,e),this._updateColor()},_isLighterMode:!1,_squareVertices:null,_squareColors:null,_verticesFloat32Buffer:null,_colorsUint8Buffer:null,_squareVerticesAB:null,_squareColorsAB:null,_ctorForCanvas:function(){cc.LayerRGBA.prototype.ctor.call(this),this._blendFunc=new cc.BlendFunc(cc.BLEND_SRC,cc.BLEND_DST)},_ctorForWebGL:function(){cc.LayerRGBA.prototype.ctor.call(this),this._blendFunc=new cc.BlendFunc(cc.BLEND_SRC,cc.BLEND_DST),this._squareVerticesAB=new ArrayBuffer(32),this._squareColorsAB=new ArrayBuffer(64);var e=this._squareVerticesAB,t=this._squareColorsAB,n=cc.Vertex2F.BYTES_PER_ELEMENT,r=cc.Color4F.BYTES_PER_ELEMENT;this._squareVertices=[new cc.Vertex2F(0,0,e,0),new cc.Vertex2F(0,0,e,n),new cc.Vertex2F(0,0,e,n*2),new cc.Vertex2F(0,0,e,n*3)],this._squareColors=[new cc.Color4F(0,0,0,1,t,0),new cc.Color4F(0,0,0,1,t,r),new cc.Color4F(0,0,0,1,t,r*2),new cc.Color4F(0,0,0,1,t,r*3)],this._verticesFloat32Buffer=cc.renderContext.createBuffer(),this._colorsUint8Buffer=cc.renderContext.createBuffer()},setBlendFunc:function(e,t){t===undefined?this._blendFunc=e:this._blendFunc={src:e,dst:t},cc.renderContextType===cc.CANVAS&&(this._isLighterMode=this._blendFunc&&this._blendFunc.src==1&&this._blendFunc.dst==771)},init:function(e,t,n){if(!cc.Layer.prototype.init.call(this))return!1;cc.renderContextType!==cc.CANVAS&&this.setShaderProgram(cc.ShaderCache.getInstance().programForKey(cc.SHADER_POSITION_COLOR));var r=cc.Director.getInstance().getWinSize();e=e||new cc.Color4B(0,0,0,255),t=t||r.width,n=n||r.height;var i=this._displayedColor;i.r=e.r,i.g=e.g,i.b=e.b;var s=this._realColor;return s.r=e.r,s.g=e.g,s.b=e.b,this._displayedOpacity=e.a,this._realOpacity=e.a,this.setContentSize(t,n),this._updateColor(),!0},setContentSize:null,_setContentSizeForWebGL:function(e,t){var n=this._squareVertices;t===undefined?(n[1].x=e.width,n[2].y=e.height,n[3].x=e.width,n[3].y=e.height):(n[1].x=e,n[2].y=t,n[3].x=e,n[3].y=t),this._bindLayerVerticesBufferData(),cc.Layer.prototype.setContentSize.call(this,e,t)},_updateColor:null,_updateColorForCanvas:function(){},_updateColorForWebGL:function(){var e=this._displayedColor,t=this._displayedOpacity,n=this._squareColors;for(var r=0;r<4;r++)n[r].r=e.r/255,n[r].g=e.g/255,n[r].b=e.b/255,n[r].a=t/255;this._bindLayerColorsBufferData()},updateDisplayedColor:function(e){cc.LayerRGBA.prototype.updateDisplayedColor.call(this,e),this._updateColor()},updateDisplayedOpacity:function(e){cc.LayerRGBA.prototype.updateDisplayedOpacity.call(this,e),this._updateColor()},_bindLayerVerticesBufferData:function(){var e=cc.renderContext;e.bindBuffer(e.ARRAY_BUFFER,this._verticesFloat32Buffer),e.bufferData(e.ARRAY_BUFFER,this._squareVerticesAB,e.STATIC_DRAW)},_bindLayerColorsBufferData:function(){var e=cc.renderContext;e.bindBuffer(e.ARRAY_BUFFER,this._colorsUint8Buffer),e.bufferData(e.ARRAY_BUFFER,this._squareColorsAB,e.STATIC_DRAW)},draw:null,_drawForCanvas:function(e){var t=e||cc.renderContext,n=this.getContentSize(),r=cc.EGLView.getInstance(),i=this._displayedColor;t.fillStyle="rgba("+(0|i.r)+","+(0|i.g)+","+(0|i.b)+","+this._displayedOpacity/255+")",t.fillRect(0,0,n.width*r.getScaleX(),-n.height*r.getScaleY()),cc.g_NumberOfDraws++},_drawForWebGL:function(e){var t=e||cc.renderContext;cc.NODE_DRAW_SETUP(this),cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION|cc.VERTEX_ATTRIB_FLAG_COLOR),t.bindBuffer(t.ARRAY_BUFFER,this._verticesFloat32Buffer),t.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,this._colorsUint8Buffer),t.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,t.FLOAT,!1,0,0),cc.glBlendFunc(this._blendFunc.src,this._blendFunc.dst),t.drawArrays(t.TRIANGLE_STRIP,0,4)}}),cc.Browser.supportWebGL?(cc.LayerColor.prototype.ctor=cc.LayerColor.prototype._ctorForWebGL,cc.LayerColor.prototype.setContentSize=cc.LayerColor.prototype._setContentSizeForWebGL,cc.LayerColor.prototype._updateColor=cc.LayerColor.prototype._updateColorForWebGL,cc.LayerColor.prototype.draw=cc.LayerColor.prototype._drawForWebGL):(cc.LayerColor.prototype.ctor=cc.LayerColor.prototype._ctorForCanvas,cc.LayerColor.prototype.setContentSize=cc.LayerRGBA.prototype.setContentSize,cc.LayerColor.prototype._updateColor=cc.LayerColor.prototype._updateColorForCanvas,cc.LayerColor.prototype.draw=cc.LayerColor.prototype._drawForCanvas),cc.LayerColor.create=function(e,t,n){var r=new cc.LayerColor;switch(arguments.length){case 0:r.init();break;case 1:r.init(e);break;case 3:r.init(e,t,n);break;default:r.init()}return r},cc.LayerGradient=cc.LayerColor.extend({_startColor:null,_endColor:null,_startOpacity:null,_endOpacity:null,_alongVector:null,_compressedInterpolation:!1,_gradientStartPoint:null,_gradientEndPoint:null,ctor:function(){cc.LayerColor.prototype.ctor.call(this),this._startColor=new cc.Color3B(0,0,0),this._endColor=new cc.Color3B(0,0,0),this._alongVector=cc.p(0,-1),this._startOpacity=255,this._endOpacity=255,this._gradientStartPoint=cc.p(0,0),this._gradientEndPoint=cc.p(0,0)},setContentSize:function(e,t){cc.LayerColor.prototype.setContentSize.call(this,e,t),this._updateColor()},getStartColor:function(){return this._realColor},setStartColor:function(e){this.setColor(e)},setEndColor:function(e){this._endColor=e,this._updateColor()},getEndColor:function(){return this._endColor},setStartOpacity:function(e){this._startOpacity=e,this._updateColor()},getStartOpacity:function(){return this._startOpacity},setEndOpacity:function(e){this._endOpacity=e,this._updateColor()},getEndOpacity:function(){return this._endOpacity},setVector:function(e){this._alongVector.x=e.x,this._alongVector.y=e.y,this._updateColor()},getVector:function(){return cc.p(this._alongVector.x,this._alongVector.y)},isCompressedInterpolation:function(){return this._compressedInterpolation},setCompressedInterpolation:function(e){this._compressedInterpolation=e,this._updateColor()},init:function(e,t,n){e=e||cc.c4(0,0,0,255),t=t||cc.c4(0,0,0,255),n=n||cc.p(0,-1);var r=this._startColor,i=this._endColor;return r.r=e.r,r.g=e.g,r.b=e.b,this._startOpacity=e.a,i.r=t.r,i.g=t.g,i.b=t.b,this._endOpacity=t.a,this._alongVector=n,this._compressedInterpolation=!0,cc.LayerColor.prototype.init.call(this,cc.c4b(e.r,e.g,e.b,255)),!0},draw:function(e){if(cc.renderContextType===cc.WEBGL){cc.LayerColor.prototype.draw.call(this,e);return}var t=e||cc.renderContext;this._isLighterMode&&(t.globalCompositeOperation="lighter"),t.save();var n=cc.EGLView.getInstance(),r=this._displayedOpacity/255,i=this.getContentSize().width*n.getScaleX(),s=this.getContentSize().height*n.getScaleY(),o=t.createLinearGradient(this._gradientStartPoint.x,this._gradientStartPoint.y,this._gradientEndPoint.x,this._gradientEndPoint.y),u=this._displayedColor,a=this._endColor;o.addColorStop(0,"rgba("+Math.round(u.r)+","+Math.round(u.g)+","+Math.round(u.b)+","+(r*(this._startOpacity/255)).toFixed(4)+")"),o.addColorStop(1,"rgba("+Math.round(a.r)+","+Math.round(a.g)+","+Math.round(a.b)+","+(r*(this._endOpacity/255)).toFixed(4)+")"),t.fillStyle=o,t.fillRect(0,0,i,-s),this._rotation!=0&&t.rotate(this._rotationRadians),t.restore()},_updateColor:function(){var e=this._alongVector;if(cc.renderContextType===cc.CANVAS){var t=this.getContentSize().width*.5,n=this.getContentSize().height*.5;this._gradientStartPoint.x=t*-e.x+t,this._gradientStartPoint.y=n*e.y-n,this._gradientEndPoint.x=t*e.x+t,this._gradientEndPoint.y=n*-e.y-n}else{var r=cc.pLength(e);if(r===0)return;var i=Math.sqrt(2),s=cc.p(e.x/r,e.y/r);if(this._compressedInterpolation){var o=1/(Math.abs(s.x)+Math.abs(s.y));s=cc.pMult(s,o*i)}var u=this._displayedOpacity/255,a=this._displayedColor,f=this._endColor,l={r:a.r/255,g:a.g/255,b:a.b/255,a:this._startOpacity*u/255},c={r:f.r/255,g:f.g/255,b:f.b/255,a:this._endOpacity*u/255},h=this._squareColors,p=h[0],d=h[1],v=h[2],m=h[3];p.r=c.r+(l.r-c.r)*((i+s.x+s.y)/(2*i)),p.g=c.g+(l.g-c.g)*((i+s.x+s.y)/(2*i)),p.b=c.b+(l.b-c.b)*((i+s.x+s.y)/(2*i)),p.a=c.a+(l.a-c.a)*((i+s.x+s.y)/(2*i)),d.r=c.r+(l.r-c.r)*((i-s.x+s.y)/(2*i)),d.g=c.g+(l.g-c.g)*((i-s.x+s.y)/(2*i)),d.b=c.b+(l.b-c.b)*((i-s.x+s.y)/(2*i)),d.a=c.a+(l.a-c.a)*((i-s.x+s.y)/(2*i)),v.r=c.r+(l.r-c.r)*((i+s.x-s.y)/(2*i)),v.g=c.g+(l.g-c.g)*((i+s.x-s.y)/(2*i)),v.b=c.b+(l.b-c.b)*((i+s.x-s.y)/(2*i)),v.a=c.a+(l.a-c.a)*((i+s.x-s.y)/(2*i)),m.r=c.r+(l.r-c.r)*((i-s.x-s.y)/(2*i)),m.g=c.g+(l.g-c.g)*((i-s.x-s.y)/(2*i)),m.b=c.b+(l.b-c.b)*((i-s.x-s.y)/(2*i)),m.a=c.a+(l.a-c.a)*((i-s.x-s.y)/(2*i)),this._bindLayerColorsBufferData()}}}),cc.LayerGradient.create=function(e,t,n){var r=new cc.LayerGradient;switch(arguments.length){case 2:if(r&&r.init(e,t))return r;break;case 3:if(r&&r.init(e,t,n))return r;break;case 0:if(r&&r.init())return r;break;default:throw"Arguments error "}return null},cc.LayerMultiplex=cc.Layer.extend({_enabledLayer:0,_layers:null,initWithLayer:function(e){return this._layers=[],this._layers.push(e),this._enabledLayer=0,this.addChild(e),!0},initWithLayers:function(e){return this._layers=e,this._enabledLayer=0,this.addChild(this._layers[this._enabledLayer]),!0},switchTo:function(e){if(e>=this._layers.length){cc.log("cc.LayerMultiplex.switchTo():Invalid index in MultiplexLayer switchTo message");return}this.removeChild(this._layers[this._enabledLayer],!0),this._enabledLayer=e,this.addChild(this._layers[e])},switchToAndReleaseMe:function(e){if(e>=this._layers.length){cc.log("cc.LayerMultiplex.switchToAndReleaseMe():Invalid index in MultiplexLayer switchTo message");return}this.removeChild(this._layers[this._enabledLayer],!0),this._layers[this._enabledLayer]=null,this._enabledLayer=e,this.addChild(this._layers[e])},addLayer:function(e){if(!e){cc.log("cc.Layer.addLayer(): layer should be non-null");return}this._layers.push(e)}}),cc.LayerMultiplex.create=function(){arguments.length>0&&arguments[arguments.length-1]==null&&cc.log("parameters should not be ending with null in Javascript");var e=new cc.LayerMultiplex;return e.initWithLayers(arguments)?e:null},cc.SPRITE_INDEX_NOT_INITIALIZED=-1,cc.generateTextureCacheForColor=function(e){function n(){var n=cc.generateTextureCacheForColor,r=e.width,i=e.height;t[0].width=r,t[0].height=i,t[1].width=r,t[1].height=i,t[2].width=r,t[2].height=i,t[3].width=r,t[3].height=i,n.canvas.width=r,n.canvas.height=i;var s=n.canvas.getContext("2d");s.drawImage(e,0,0),n.tempCanvas.width=r,n.tempCanvas.height=i;var o=s.getImageData(0,0,r,i).data;for(var u=0;u<4;u++){var a=t[u].getContext("2d");a.getImageData(0,0,r,i).data,n.tempCtx.drawImage(e,0,0);var f=n.tempCtx.getImageData(0,0,r,i),l=f.data;for(var c=0;c<o.length;c+=4)l[c]=u===0?o[c]:0,l[c+1]=u===1?o[c+1]:0,l[c+2]=u===2?o[c+2]:0,l[c+3]=o[c+3];a.putImageData(f,0,0)}e.onload=null}if(e.channelCache)return e.channelCache;var t=[document.createElement("canvas"),document.createElement("canvas"),document.createElement("canvas"),document.createElement("canvas")];try{n()}catch(r){e.onload=n}return e.channelCache=t,t},cc.generateTextureCacheForColor.canvas=document.createElement("canvas"),cc.generateTextureCacheForColor.tempCanvas=document.createElement("canvas"),cc.generateTextureCacheForColor.tempCtx=cc.generateTextureCacheForColor.tempCanvas.getContext("2d"),cc.generateTintImage2=function(e,t,n){n||(n=cc.rect(0,0,e.width,e.height),n=cc.RECT_PIXELS_TO_POINTS(n));var r;t instanceof cc.Color4F?r=cc.c4b(t.r*255,t.g*255,t.b*255,t.a*255):r=cc.c4b(t.r,t.g,t.b,50);var i=document.createElement("canvas"),s=i.getContext("2d");return i.width!=n.width&&(i.width=n.width),i.height!=n.height&&(i.height=n.height),s.save(),s.drawImage(e,n.x,n.y,n.width,n.height,0,0,n.width,n.height),s.globalCompositeOperation="source-in",s.globalAlpha=r.a/255,s.fillStyle="rgb("+r.r+","+r.g+","+r.b+")",s.fillRect(0,0,n.width,n.height),s.restore(),i},cc.generateTintImage=function(e,t,n,r,i){r||(r=cc.rect(0,0,e.width,e.height));var s;n.a==null?s=cc.c4f(n.r/255,n.g/255,n.b/255,1):s=n;var o=Math.min(r.width,t[0].width),u=Math.min(r.height,t[0].height),a=i,f;a?(f=a.getContext("2d"),f.clearRect(0,0,o,u)):(a=document.createElement("canvas"),a.width=o,a.height=u,f=a.getContext("2d")),f.save(),f.globalCompositeOperation="lighter";var l=f.globalAlpha;return s.r>0&&(f.globalAlpha=s.r*l,f.drawImage(t[0],r.x,r.y,o,u,0,0,o,u)),s.g>0&&(f.globalAlpha=s.g*l,f.drawImage(t[1],r.x,r.y,o,u,0,0,o,u)),s.b>0&&(f.globalAlpha=s.b*l,f.drawImage(t[2],r.x,r.y,o,u,0,0,o,u)),s.r+s.g+s.b<1&&(f.globalAlpha=l,f.drawImage(t[3],r.x,r.y,o,u,0,0,o,u)),f.restore(),a},cc.cutRotateImageToCanvas=function(e,t){if(!e)return null;if(!t)return e;var n=document.createElement("canvas");n.width=t.width,n.height=t.height;var r=n.getContext("2d");return r.translate(n.width/2,n.height/2),r.rotate(-1.5707963267948966),r.drawImage(e,t.x,t.y,t.height,t.width,-t.height/2,-t.width/2,t.height,t.width),n},cc.TransformValues=function(e,t,n,r,i,s){this.pos=e,this.scale=t,this.rotation=n,this.skew=r,this.ap=i,this.visible=s},cc.RENDER_IN_SUBPIXEL=function(e){return 0|e},cc.SPRITEBATCHNODE_RENDER_SUBPIXEL&&(cc.RENDER_IN_SUBPIXEL=function(e){return e}),cc.Sprite=cc.NodeRGBA.extend({RGBAProtocol:!0,_textureAtlas:null,_atlasIndex:0,_batchNode:null,_dirty:!1,_recursiveDirty:null,_hasChildren:null,_shouldBeHidden:!1,_transformToBatch:null,_blendFunc:null,_texture:null,_rect:null,_rectRotated:!1,_offsetPosition:null,_unflippedOffsetPositionFromCenter:null,_opacityModifyRGB:!1,_flippedX:!1,_flippedY:!1,_textureLoaded:!1,_loadedEventListeners:null,_newTextureWhenChangeColor:null,textureLoaded:function(){return this._textureLoaded},addLoadedEventListener:function(e,t){this._loadedEventListeners||(this._loadedEventListeners=[]),this._loadedEventListeners.push({eventCallback:e,eventTarget:t})},_callLoadedEventCallbacks:function(){if(!this._loadedEventListeners)return;var e=this._loadedEventListeners;for(var t=0,n=e.length;t<n;t++){var r=e[t];cc.doCallback(r.eventCallback,r.eventTarget,this)}e.length=0},isDirty:function(){return this._dirty},setDirty:function(e){this._dirty=e},isTextureRectRotated:function(){return this._rectRotated},getAtlasIndex:function(){return this._atlasIndex},setAtlasIndex:function(e){this._atlasIndex=e},getTextureRect:function(){return cc.rect(this._rect.x,this._rect.y,this._rect.width,this._rect.height)},getTextureAtlas:function(){return this._textureAtlas},setTextureAtlas:function(e){this._textureAtlas=e},getSpriteBatchNode:function(){return this._batchNode},setSpriteBatchNode:function(e){this._batchNode=e},getOffsetPosition:function(){return this._offsetPosition},getBlendFunc:function(){return this._blendFunc},initWithSpriteFrame:function(e){if(!e)throw"cc.Sprite.initWithSpriteFrame(): spriteFrame should be non-null";e.textureLoaded()||(this._textureLoaded=!1,e.addLoadedEventListener(this._spriteFrameLoadedCallback,this));var t=this.initWithTexture(e.getTexture(),e.getRect());return this.setDisplayFrame(e),t},_spriteFrameLoadedCallback:null,_spriteFrameLoadedCallbackForWebGL:function(e){this.setNodeDirty(),this.setTextureRect(e.getRect(),e.isRotated(),e.getOriginalSize()),this._callLoadedEventCallbacks()},_spriteFrameLoadedCallbackForCanvas:function(e){this.setNodeDirty(),this.setTextureRect(e.getRect(),e.isRotated(),e.getOriginalSize());var t=this.getColor();(t.r!==255||t.g!==255||t.b!==255)&&this._changeTextureColor(),this._callLoadedEventCallbacks()},initWithSpriteFrameName:function(e){if(!e)throw"cc.Sprite.initWithSpriteFrameName(): spriteFrameName should be non-null";var t=cc.SpriteFrameCache.getInstance().getSpriteFrame(e);return this.initWithSpriteFrame(t)},useBatchNode:function(e){this._textureAtlas=e.getTextureAtlas(),this._batchNode=e},setVertexRect:function(e){this._rect.x=e.x,this._rect.y=e.y,this._rect.width=e.width,this._rect.height=e.height},sortAllChildren:function(){if(this._reorderChildDirty){var e,t,n=this._children,r;for(var i=1;i<n.length;i++){t=n[i],e=i-1,r=n[e];while(e>=0&&(t._zOrder<r._zOrder||t._zOrder==r._zOrder&&t._orderOfArrival<r._orderOfArrival))n[e+1]=r,e-=1,r=n[e];n[e+1]=t}this._batchNode&&this._arrayMakeObjectsPerformSelector(n,cc.Node.StateCallbackType.sortAllChildren),this._reorderChildDirty=!1}},reorderChild:function(e,t){if(!e)throw"cc.Sprite.reorderChild(): child should be non-null";if(this._children.indexOf(e)===-1){cc.log("cc.Sprite.reorderChild(): this child is not in children list");return}if(t===e.getZOrder())return;this._batchNode&&!this._reorderChildDirty&&(this._setReorderChildDirtyRecursively(),this._batchNode.reorderBatch(!0)),cc.Node.prototype.reorderChild.call(this,e,t)},removeChild:function(e,t){this._batchNode&&this._batchNode.removeSpriteFromAtlas(e),cc.Node.prototype.removeChild.call(this,e,t)},removeAllChildren:function(e){var t=this._children,n=this._batchNode;if(n&&t!=null)for(var r=0,i=t.length;r<i;r++)n.removeSpriteFromAtlas(t[r]);cc.Node.prototype.removeAllChildren.call(this,e),this._hasChildren=!1},setDirtyRecursively:function(e){this._recursiveDirty=e,this.setDirty(e);var t=this._children;if(t!=null)for(var n=0;n<t.length;n++)t[n]instanceof cc.Sprite&&t[n].setDirtyRecursively(!0)},SET_DIRTY_RECURSIVELY:function(){this._batchNode&&!this._recursiveDirty&&(this._recursiveDirty=!0,this._dirty=!0,this._hasChildren&&this.setDirtyRecursively(!0))},setPosition:function(e,t){arguments.length>=2?cc.Node.prototype.setPosition.call(this,e,arguments[1]):cc.Node.prototype.setPosition.call(this,e),this.SET_DIRTY_RECURSIVELY()},setRotation:function(e){cc.Node.prototype.setRotation.call(this,e),this.SET_DIRTY_RECURSIVELY()},setRotationX:function(e){cc.Node.prototype.setRotationX.call(this,e),this.SET_DIRTY_RECURSIVELY()},setRotationY:function(e){cc.Node.prototype.setRotationY.call(this,e),this.SET_DIRTY_RECURSIVELY()},setSkewX:function(e){cc.Node.prototype.setSkewX.call(this,e),this.SET_DIRTY_RECURSIVELY()},setSkewY
:function(e){cc.Node.prototype.setSkewY.call(this,e),this.SET_DIRTY_RECURSIVELY()},setScaleX:function(e){cc.Node.prototype.setScaleX.call(this,e),this.SET_DIRTY_RECURSIVELY()},setScaleY:function(e){cc.Node.prototype.setScaleY.call(this,e),this.SET_DIRTY_RECURSIVELY()},setScale:function(e,t){cc.Node.prototype.setScale.call(this,e,t),this.SET_DIRTY_RECURSIVELY()},setVertexZ:function(e){cc.Node.prototype.setVertexZ.call(this,e),this.SET_DIRTY_RECURSIVELY()},setAnchorPoint:function(e,t){cc.Node.prototype.setAnchorPoint.call(this,e,t),this.SET_DIRTY_RECURSIVELY()},setVisible:function(e){cc.Node.prototype.setVisible.call(this,e),this.SET_DIRTY_RECURSIVELY()},ignoreAnchorPointForPosition:function(e){if(this._batchNode){cc.log("cc.Sprite.ignoreAnchorPointForPosition(): it is invalid in cc.Sprite when using SpriteBatchNode");return}cc.Node.prototype.ignoreAnchorPointForPosition.call(this,e)},setFlippedX:function(e){this._flippedX!=e&&(this._flippedX=e,this.setTextureRect(this._rect,this._rectRotated,this._contentSize),this.setNodeDirty())},setFlippedY:function(e){this._flippedY!=e&&(this._flippedY=e,this.setTextureRect(this._rect,this._rectRotated,this._contentSize),this.setNodeDirty())},isFlippedX:function(){return this._flippedX},isFlippedY:function(){return this._flippedY},setOpacityModifyRGB:null,_setOpacityModifyRGBForWebGL:function(e){this._opacityModifyRGB!==e&&(this._opacityModifyRGB=e,this.updateColor())},_setOpacityModifyRGBForCanvas:function(e){this._opacityModifyRGB!==e&&(this._opacityModifyRGB=e,this.setNodeDirty())},isOpacityModifyRGB:function(){return this._opacityModifyRGB},updateDisplayedOpacity:null,_updateDisplayedOpacityForWebGL:function(e){cc.NodeRGBA.prototype.updateDisplayedOpacity.call(this,e),this.updateColor()},_updateDisplayedOpacityForCanvas:function(e){cc.NodeRGBA.prototype.updateDisplayedOpacity.call(this,e),this._setNodeDirtyForCache()},setDisplayFrameWithAnimationName:function(e,t){if(!e)throw"cc.Sprite.setDisplayFrameWithAnimationName(): animationName must be non-null";var n=cc.AnimationCache.getInstance().getAnimation(e);if(!n){cc.log("cc.Sprite.setDisplayFrameWithAnimationName(): Frame not found");return}var r=n.getFrames()[t];if(!r){cc.log("cc.Sprite.setDisplayFrameWithAnimationName(): Invalid frame index");return}this.setDisplayFrame(r.getSpriteFrame())},getBatchNode:function(){return this._batchNode},_setReorderChildDirtyRecursively:function(){if(!this._reorderChildDirty){this._reorderChildDirty=!0;var e=this._parent;while(e&&e!=this._batchNode)e._setReorderChildDirtyRecursively(),e=e.getParent()}},getTexture:function(){return this._texture},_quad:null,_quadWebBuffer:null,_quadDirty:!1,_colorized:!1,_isLighterMode:!1,_originalTexture:null,_textureRect_Canvas:null,_drawSize_Canvas:null,ctor:null,_ctorForWebGL:function(e){cc.NodeRGBA.prototype.ctor.call(this),this._shouldBeHidden=!1,this._offsetPosition=cc._pConst(0,0),this._unflippedOffsetPositionFromCenter=cc._pConst(0,0),this._blendFunc={src:cc.BLEND_SRC,dst:cc.BLEND_DST},this._rect=cc.rect(0,0,0,0),this._quad=new cc.V3F_C4B_T2F_Quad,this._quadWebBuffer=cc.renderContext.createBuffer(),this._quadDirty=!0,this._textureLoaded=!0;if(e)if(typeof e=="string"){var t=cc.SpriteFrameCache.getInstance().getSpriteFrame(e);this.initWithSpriteFrame(t)}else if(typeof e=="object")if(e instanceof cc.SpriteFrame)this.initWithSpriteFrame(e);else if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement){var n=new cc.Texture2D;n.initWithElement(e),n.handleLoadedTexture(),this.initWithTexture(n)}else e instanceof cc.Texture2D&&this.initWithTexture(e)},_ctorForCanvas:function(e){cc.NodeRGBA.prototype.ctor.call(this),this._shouldBeHidden=!1,this._offsetPosition=cc._pConst(0,0),this._unflippedOffsetPositionFromCenter=cc._pConst(0,0),this._blendFunc={src:cc.BLEND_SRC,dst:cc.BLEND_DST},this._rect=cc.rect(0,0,0,0),this._newTextureWhenChangeColor=!1,this._textureLoaded=!0,this._textureRect_Canvas={x:0,y:0,width:0,height:0,validRect:!1},this._drawSize_Canvas=cc.size(0,0);if(e)if(typeof e=="string"){var t=cc.SpriteFrameCache.getInstance().getSpriteFrame(e);this.initWithSpriteFrame(t)}else if(typeof e=="object")if(e instanceof cc.SpriteFrame)this.initWithSpriteFrame(e);else if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement){var n=new cc.Texture2D;n.initWithElement(e),n.handleLoadedTexture(),this.initWithTexture(n)}else e instanceof cc.Texture2D&&this.initWithTexture(e)},getQuad:function(){return this._quad},setBlendFunc:null,_setBlendFuncForWebGL:function(e,t){var n=this._blendFunc;t===undefined?(n.src=e.src,n.dst=e.dst):(n.src=e,n.dst=t)},_setBlendFuncForCanvas:function(e,t){var n=this._blendFunc;t===undefined?(n.src=e.src,n.dst=e.dst):(n.src=e,n.dst=t),this._isLighterMode=n&&(n.src==gl.SRC_ALPHA&&n.dst==gl.ONE||n.src==gl.ONE&&n.dst==gl.ONE)},init:null,_initForWebGL:function(){if(arguments.length>0)return this.initWithFile(arguments[0],arguments[1]);cc.NodeRGBA.prototype.init.call(this),this._dirty=this._recursiveDirty=!1,this._opacityModifyRGB=!0,this._blendFunc.src=cc.BLEND_SRC,this._blendFunc.dst=cc.BLEND_DST,this.setTexture(null),this._textureLoaded=!0,this._flippedX=this._flippedY=!1,this.setAnchorPoint(.5,.5),this._offsetPosition._x=0,this._offsetPosition._y=0,this._hasChildren=!1;var e={r:255,g:255,b:255,a:255};return this._quad.bl.colors=e,this._quad.br.colors=e,this._quad.tl.colors=e,this._quad.tr.colors=e,this._quadDirty=!0,this.setTextureRect(cc.RectZero(),!1,cc.SizeZero()),!0},_initForCanvas:function(){return arguments.length>0?this.initWithFile(arguments[0],arguments[1]):(cc.NodeRGBA.prototype.init.call(this),this._dirty=this._recursiveDirty=!1,this._opacityModifyRGB=!0,this._blendFunc.src=cc.BLEND_SRC,this._blendFunc.dst=cc.BLEND_DST,this.setTexture(null),this._textureLoaded=!0,this._flippedX=this._flippedY=!1,this.setAnchorPoint(.5,.5),this._offsetPosition._x=0,this._offsetPosition._y=0,this._hasChildren=!1,this.setTextureRect(cc.RectZero(),!1,cc.SizeZero()),!0)},initWithFile:function(e,t){if(!e)throw"cc.Sprite.initWithFile(): filename should be non-null";var n=cc.TextureCache.getInstance().textureForKey(e);if(!n)return n=cc.TextureCache.getInstance().addImage(e),this.initWithTexture(n,t);if(!t){var r=n.getContentSize();t=cc.rect(0,0,r.width,r.height)}return this.initWithTexture(n,t)},initWithTexture:null,_initWithTextureForWebGL:function(e,t,n){var r=arguments.length;if(r==0)throw"Sprite.initWithTexture(): Argument must be non-nil ";n=n||!1;if(!cc.NodeRGBA.prototype.init.call(this))return!1;this._batchNode=null,this._recursiveDirty=!1,this._dirty=!1,this._opacityModifyRGB=!0,this._blendFunc.src=cc.BLEND_SRC,this._blendFunc.dst=cc.BLEND_DST,this._flippedX=this._flippedY=!1,this.setAnchorPoint(.5,.5),this._offsetPosition._x=0,this._offsetPosition._y=0,this._hasChildren=!1;var i=new cc.Color4B(255,255,255,255),s=this._quad;s.bl.colors=i,s.br.colors=i,s.tl.colors=i,s.tr.colors=i;var o=e.isLoaded();this._textureLoaded=o;if(!o){this._rectRotated=n||!1;if(t){var u=this._rect;u.x=t.x,u.y=t.y,u.width=t.width,u.height=t.height}return e.addLoadedEventListener(this._textureLoadedCallback,this),!0}if(!t){var a=e.getContentSize();t=cc.rect(0,0,a.width,a.height)}return this.setTexture(e),this.setTextureRect(t,n,t._size),this.setBatchNode(null),this._quadDirty=!0,!0},_initWithTextureForCanvas:function(e,t,n){var r=arguments.length;if(r==0)throw"Sprite.initWithTexture(): Argument must be non-nil ";n=n||!1;if(!cc.NodeRGBA.prototype.init.call(this))return!1;this._batchNode=null,this._recursiveDirty=!1,this._dirty=!1,this._opacityModifyRGB=!0,this._blendFunc.src=cc.BLEND_SRC,this._blendFunc.dst=cc.BLEND_DST,this._flippedX=this._flippedY=!1,this.setAnchorPoint(.5,.5),this._offsetPosition._x=0,this._offsetPosition._y=0,this._hasChildren=!1;var i=e.isLoaded();this._textureLoaded=i;if(!i)return this._rectRotated=n||!1,t&&(this._rect.x=t.x,this._rect.y=t.y,this._rect.width=t.width,this._rect.height=t.height),e.addLoadedEventListener(this._textureLoadedCallback,this),!0;if(!t){var s=e.getContentSize();t=cc.rect(0,0,s.width,s.height)}return this._originalTexture=e,this.setTexture(e),this.setTextureRect(t,n,t._size),this.setBatchNode(null),!0},_textureLoadedCallback:null,_textureLoadedCallbackForWebGL:function(e){if(this._textureLoaded)return;this._textureLoaded=!0;var t=this._rect;if(!t){var n=e.getContentSize();t=cc.rect(0,0,n.width,n.height)}else if(cc._rectEqualToZero(t)){var r=e.getContentSize();t.width=r.width,t.height=r.height}this.setTexture(e),this.setTextureRect(t,this._rectRotated,t._size),this.setBatchNode(null),this._quadDirty=!0,this._callLoadedEventCallbacks()},_textureLoadedCallbackForCanvas:function(e){if(this._textureLoaded)return;this._textureLoaded=!0;var t=this._rect;if(!t){var n=e.getContentSize();t=cc.rect(0,0,n.width,n.height)}else if(cc._rectEqualToZero(t)){var r=e.getContentSize();t.width=r.width,t.height=r.height}this._originalTexture=e,this.setTexture(e),this.setTextureRect(t,this._rectRotated,t._size),this.setBatchNode(null),this._callLoadedEventCallbacks()},setTextureRect:null,_setTextureRectForWebGL:function(e,t,n){this._rectRotated=t||!1,n=n||e._size,this.setContentSize(n),this.setVertexRect(e),this._setTextureCoords(e);var r=this._unflippedOffsetPositionFromCenter;this._flippedX&&(r._x=-r._x),this._flippedY&&(r._y=-r._y);var i=this._rect;this._offsetPosition._x=r._x+(this._contentSize._width-i.width)/2,this._offsetPosition._y=r._y+(this._contentSize._height-i.height)/2;if(this._batchNode)this._dirty=!0;else{var s=0+this._offsetPosition._x,o=0+this._offsetPosition._y,u=s+i.width,a=o+i.height,f=this._quad;f.bl.vertices={x:s,y:o,z:0},f.br.vertices={x:u,y:o,z:0},f.tl.vertices={x:s,y:a,z:0},f.tr.vertices={x:u,y:a,z:0},this._quadDirty=!0}},_setTextureRectForCanvas:function(e,t,n){this._rectRotated=t||!1,n=n||e._size,this.setContentSize(n),this.setVertexRect(e);var r=this._textureRect_Canvas,i=cc.CONTENT_SCALE_FACTOR();r.x=0|e.x*i,r.y=0|e.y*i,r.width=0|e.width*i,r.height=0|e.height*i,r.validRect=!(r.width===0||r.height===0||r.x<0||r.y<0);var s=this._unflippedOffsetPositionFromCenter;this._flippedX&&(s._x=-s._x),this._flippedY&&(s._y=-s._y),this._offsetPosition._x=s._x+(this._contentSize._width-this._rect.width)/2,this._offsetPosition._y=s._y+(this._contentSize._height-this._rect.height)/2,this._batchNode&&(this._dirty=!0)},updateTransform:null,_updateTransformForWebGL:function(){if(this.isDirty()){var e=this._quad,t=this._parent;if(!this._visible||t&&t!=this._batchNode&&t._shouldBeHidden)e.br.vertices={x:0,y:0,z:0},e.tl.vertices={x:0,y:0,z:0},e.tr.vertices={x:0,y:0,z:0},e.bl.vertices={x:0,y:0,z:0},this._shouldBeHidden=!0;else{this._shouldBeHidden=!1,!t||t==this._batchNode?this._transformToBatch=this.nodeToParentTransform():this._transformToBatch=cc.AffineTransformConcat(this.nodeToParentTransform(),t._transformToBatch);var n=this._transformToBatch,r=this._rect._size,i=this._offsetPosition._x,s=this._offsetPosition._y,o=i+r.width,u=s+r.height,a=n.tx,f=n.ty,l=n.a,c=n.b,h=n.d,p=-n.c,d=i*l-s*p+a,v=i*c+s*h+f,m=o*l-s*p+a,g=o*c+s*h+f,y=o*l-u*p+a,b=o*c+u*h+f,w=i*l-u*p+a,E=i*c+u*h+f,S=this._vertexZ;e.bl.vertices={x:cc.RENDER_IN_SUBPIXEL(d),y:cc.RENDER_IN_SUBPIXEL(v),z:S},e.br.vertices={x:cc.RENDER_IN_SUBPIXEL(m),y:cc.RENDER_IN_SUBPIXEL(g),z:S},e.tl.vertices={x:cc.RENDER_IN_SUBPIXEL(w),y:cc.RENDER_IN_SUBPIXEL(E),z:S},e.tr.vertices={x:cc.RENDER_IN_SUBPIXEL(y),y:cc.RENDER_IN_SUBPIXEL(b),z:S}}this._textureAtlas.updateQuad(e,this._atlasIndex),this._recursiveDirty=!1,this.setDirty(!1)}this._hasChildren&&this._arrayMakeObjectsPerformSelector(this._children,cc.Node.StateCallbackType.updateTransform);if(cc.SPRITE_DEBUG_DRAW){var x=[cc.p(this._quad.bl.vertices.x,this._quad.bl.vertices.y),cc.p(this._quad.br.vertices.x,this._quad.br.vertices.y),cc.p(this._quad.tr.vertices.x,this._quad.tr.vertices.y),cc.p(this._quad.tl.vertices.x,this._quad.tl.vertices.y)];cc.drawingUtil.drawPoly(x,4,!0)}},_updateTransformForCanvas:function(){if(this._dirty){var e=this._parent;!this._visible||e&&e!=this._batchNode&&e._shouldBeHidden?this._shouldBeHidden=!0:(this._shouldBeHidden=!1,!e||e==this._batchNode?this._transformToBatch=this.nodeToParentTransform():this._transformToBatch=cc.AffineTransformConcat(this.nodeToParentTransform(),e._transformToBatch)),this._recursiveDirty=!1,this._dirty=!1}this._hasChildren&&this._arrayMakeObjectsPerformSelector(this._children,cc.Node.StateCallbackType.updateTransform)},addChild:null,_addChildForWebGL:function(e,t,n){if(!e)throw"cc.Sprite.addChild(): child should be non-null";t==null&&(t=e._zOrder),n==null&&(n=e._tag);if(this._batchNode){if(!(e instanceof cc.Sprite)){cc.log("cc.Sprite.addChild(): cc.Sprite only supports cc.Sprites as children when using cc.SpriteBatchNode");return}e.getTexture()._webTextureObj!==this._textureAtlas.getTexture()._webTextureObj&&cc.log("cc.Sprite.addChild(): cc.Sprite only supports a sprite using same texture as children when using cc.SpriteBatchNode"),this._batchNode.appendChild(e),this._reorderChildDirty||this._setReorderChildDirtyRecursively()}cc.NodeRGBA.prototype.addChild.call(this,e,t,n),this._hasChildren=!0},_addChildForCanvas:function(e,t,n){if(!e)throw"cc.Sprite.addChild(): child should be non-null";t==null&&(t=e._zOrder),n==null&&(n=e._tag),cc.NodeRGBA.prototype.addChild.call(this,e,t,n),this._hasChildren=!0},updateColor:function(){var e=this._displayedColor,t=this._displayedOpacity,n={r:e.r,g:e.g,b:e.b,a:t};this._opacityModifyRGB&&(n.r*=t/255,n.g*=t/255,n.b*=t/255);var r=this._quad;r.bl.colors=n,r.br.colors=n,r.tl.colors=n,r.tr.colors=n,this._batchNode&&(this._atlasIndex!=cc.SPRITE_INDEX_NOT_INITIALIZED?this._textureAtlas.updateQuad(r,this._atlasIndex):this._dirty=!0),this._quadDirty=!0},setOpacity:null,_setOpacityForWebGL:function(e){cc.NodeRGBA.prototype.setOpacity.call(this,e),this.updateColor()},_setOpacityForCanvas:function(e){cc.NodeRGBA.prototype.setOpacity.call(this,e),this._setNodeDirtyForCache()},setColor:null,_setColorForWebGL:function(e){cc.NodeRGBA.prototype.setColor.call(this,e),this.updateColor()},_setColorForCanvas:function(e){var t=this.getColor();if(t.r===e.r&&t.g===e.g&&t.b===e.b)return;cc.NodeRGBA.prototype.setColor.call(this,e),this._changeTextureColor(),this._setNodeDirtyForCache()},updateDisplayedColor:null,_updateDisplayedColorForWebGL:function(e){cc.NodeRGBA.prototype.updateDisplayedColor.call(this,e),this.updateColor()},_updateDisplayedColorForCanvas:function(e){var t=this.getColor();cc.NodeRGBA.prototype.updateDisplayedColor.call(this,e);var n=this._displayedColor;if(t.r===n.r&&t.g===n.g&&t.b===n.b)return;this._changeTextureColor(),this._setNodeDirtyForCache()},setDisplayFrame:null,_setDisplayFrameForWebGL:function(e){this.setNodeDirty();var t=e.getOffset();this._unflippedOffsetPositionFromCenter._x=t.x,this._unflippedOffsetPositionFromCenter._y=t.y;var n=e.getTexture(),r=e.textureLoaded();r||(this._textureLoaded=!1,e.addLoadedEventListener(function(e){this._textureLoaded=!0;var t=e.getTexture();t!=this._texture&&this.setTexture(t),this.setTextureRect(e.getRect(),e.isRotated(),e.getOriginalSize()),this._callLoadedEventCallbacks()},this)),n!=this._texture&&this.setTexture(n),this._rectRotated=e.isRotated(),this.setTextureRect(e.getRect(),this._rectRotated,e.getOriginalSize())},_setDisplayFrameForCanvas:function(e){this.setNodeDirty();var t=e.getOffset();this._unflippedOffsetPositionFromCenter._x=t.x,this._unflippedOffsetPositionFromCenter._y=t.y,this._rectRotated=e.isRotated();var n=e.getTexture(),r=e.textureLoaded();r||(this._textureLoaded=!1,e.addLoadedEventListener(function(e){this._textureLoaded=!0;var t=e.getTexture();t!=this._texture&&this.setTexture(t),this.setTextureRect(e.getRect(),e.isRotated(),e.getOriginalSize()),this._callLoadedEventCallbacks()},this)),n!=this._texture&&this.setTexture(n),this._rectRotated&&(this._originalTexture=n),this.setTextureRect(e.getRect(),this._rectRotated,e.getOriginalSize()),this._colorized=!1;if(r){var i=this.getColor();(i.r!==255||i.g!==255||i.b!==255)&&this._changeTextureColor()}},isFrameDisplayed:null,_isFrameDisplayedForWebGL:function(e){return cc.rectEqualToRect(e.getRect(),this._rect)&&e.getTexture().getName()==this._texture.getName()&&cc.pointEqualToPoint(e.getOffset(),this._unflippedOffsetPositionFromCenter)},_isFrameDisplayedForCanvas:function(e){return e.getTexture()!=this._texture?!1:cc.rectEqualToRect(e.getRect(),this._rect)},displayFrame:function(){return cc.SpriteFrame.createWithTexture(this._texture,cc.RECT_POINTS_TO_PIXELS(this._rect),this._rectRotated,cc.POINT_POINTS_TO_PIXELS(this._unflippedOffsetPositionFromCenter),cc.SIZE_POINTS_TO_PIXELS(this._contentSize))},setBatchNode:null,_setBatchNodeForWebGL:function(e){this._batchNode=e;if(!this._batchNode){this._atlasIndex=cc.SPRITE_INDEX_NOT_INITIALIZED,this.setTextureAtlas(null),this._recursiveDirty=!1,this.setDirty(!1);var t=this._offsetPosition._x,n=this._offsetPosition._y,r=t+this._rect.width,i=n+this._rect.height,s=this._quad;s.bl.vertices={x:t,y:n,z:0},s.br.vertices={x:r,y:n,z:0},s.tl.vertices={x:t,y:i,z:0},s.tr.vertices={x:r,y:i,z:0},this._quadDirty=!0}else this._transformToBatch=cc.AffineTransformIdentity(),this.setTextureAtlas(this._batchNode.getTextureAtlas())},_setBatchNodeForCanvas:function(e){this._batchNode=e,this._batchNode?(this._transformToBatch=cc.AffineTransformIdentity(),this.setTextureAtlas(this._batchNode.getTextureAtlas())):(this._atlasIndex=cc.SPRITE_INDEX_NOT_INITIALIZED,this.setTextureAtlas(null),this._recursiveDirty=!1,this.setDirty(!1))},setTexture:null,_setTextureForWebGL:function(e){if(!(!e||e instanceof cc.Texture2D))throw"cc.Sprite.setTexture(): setTexture expects a CCTexture2D. Invalid argument";if(this._batchNode&&this._batchNode.getTexture()!=e){cc.log("cc.Sprite.setTexture(): Batched sprites should use the same texture as the batchnode");return}e?this.setShaderProgram(cc.ShaderCache.getInstance().programForKey(cc.SHADER_POSITION_TEXTURECOLOR)):this.setShaderProgram(cc.ShaderCache.getInstance().programForKey(cc.SHADER_POSITION_COLOR)),!this._batchNode&&this._texture!=e&&(this._texture=e,this._updateBlendFunc())},_setTextureForCanvas:function(e){if(!(!e||e instanceof cc.Texture2D))throw"cc.Sprite.setTexture(): setTexture expects a CCTexture2D. Invalid argument";this._texture!=e&&(e&&e.getHtmlElementObj()instanceof HTMLImageElement&&(this._originalTexture=e),this._texture=e)},_updateBlendFunc:function(){if(this._batchNode){cc.log("cc.Sprite._updateBlendFunc(): _updateBlendFunc doesn't work when the sprite is rendered using a cc.CCSpriteBatchNode");return}!this._texture||!this._texture.hasPremultipliedAlpha()?(this._blendFunc.src=gl.SRC_ALPHA,this._blendFunc.dst=gl.ONE_MINUS_SRC_ALPHA,this.setOpacityModifyRGB(!1)):(this._blendFunc.src=cc.BLEND_SRC,this._blendFunc.dst=cc.BLEND_DST,this.setOpacityModifyRGB(!0))},_changeTextureColor:function(){var e,t=this._texture,n=this._textureRect_Canvas;if(t&&n.validRect&&this._originalTexture){e=t.getHtmlElementObj();if(!e)return;var r=cc.TextureCache.getInstance().getTextureColors(this._originalTexture.getHtmlElementObj());r&&(this._colorized=!0,e instanceof HTMLCanvasElement&&!this._rectRotated&&!this._newTextureWhenChangeColor?cc.generateTintImage(e,r,this._displayedColor,n,e):(e=cc.generateTintImage(e,r,this._displayedColor,n),t=new cc.Texture2D,t.initWithElement(e),t.handleLoadedTexture(),this.setTexture(t)))}},_setTextureCoords:function(e){e=cc.RECT_POINTS_TO_PIXELS(e);var t=this._batchNode?this._textureAtlas.getTexture():this._texture;if(!t)return;var n=t.getPixelsWide(),r=t.getPixelsHigh(),i,s,o,u,a,f=this._quad;this._rectRotated?(cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL?(i=(2*e.x+1)/(2*n),s=i+(e.height*2-2)/(2*n),o=(2*e.y+1)/(2*r),u=o+(e.width*2-2)/(2*r)):(i=e.x/n,s=(e.x+e.height)/n,o=e.y/r,u=(e.y+e.width)/r),this._flippedX&&(a=o,o=u,u=a),this._flippedY&&(a=i,i=s,s=a),f.bl.texCoords.u=i,f.bl.texCoords.v=o,f.br.texCoords.u=i,f.br.texCoords.v=u,f.tl.texCoords.u=s,f.tl.texCoords.v=o,f.tr.texCoords.u=s,f.tr.texCoords.v=u):(cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL?(i=(2*e.x+1)/(2*n),s=i+(e.width*2-2)/(2*n),o=(2*e.y+1)/(2*r),u=o+(e.height*2-2)/(2*r)):(i=e.x/n,s=(e.x+e.width)/n,o=e.y/r,u=(e.y+e.height)/r),this._flippedX&&(a=i,i=s,s=a),this._flippedY&&(a=o,o=u,u=a),f.bl.texCoords.u=i,f.bl.texCoords.v=u,f.br.texCoords.u=s,f.br.texCoords.v=u,f.tl.texCoords.u=i,f.tl.texCoords.v=o,f.tr.texCoords.u=s,f.tr.texCoords.v=o),this._quadDirty=!0},draw:null,_drawForWebGL:function(){if(!this._textureLoaded)return;var e=cc.renderContext,t=this._texture;t?t._isLoaded&&(this._shaderProgram.use(),this._shaderProgram.setUniformForModelViewAndProjectionMatrixWithMat4(),cc.glBlendFunc(this._blendFunc.src,this._blendFunc.dst),cc.glBindTexture2DN(0,t),cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POS_COLOR_TEX),e.bindBuffer(e.ARRAY_BUFFER,this._quadWebBuffer),this._quadDirty&&(e.bufferData(e.ARRAY_BUFFER,this._quad.arrayBuffer,e.DYNAMIC_DRAW),this._quadDirty=!1),e.vertexAttribPointer(0,3,e.FLOAT,!1,24,0),e.vertexAttribPointer(1,4,e.UNSIGNED_BYTE,!0,24,12),e.vertexAttribPointer(2,2,e.FLOAT,!1,24,16),e.drawArrays(e.TRIANGLE_STRIP,0,4)):(this._shaderProgram.use(),this._shaderProgram.setUniformForModelViewAndProjectionMatrixWithMat4(),cc.glBlendFunc(this._blendFunc.src,this._blendFunc.dst),cc.glBindTexture2D(null),cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION|cc.VERTEX_ATTRIB_FLAG_COLOR),e.bindBuffer(e.ARRAY_BUFFER,this._quadWebBuffer),this._quadDirty&&(cc.renderContext.bufferData(cc.renderContext.ARRAY_BUFFER,this._quad.arrayBuffer,cc.renderContext.STATIC_DRAW),this._quadDirty=!1),e.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,3,e.FLOAT,!1,24,0),e.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,e.UNSIGNED_BYTE,!0,24,12),e.drawArrays(e.TRIANGLE_STRIP,0,4)),cc.g_NumberOfDraws++;if(cc.SPRITE_DEBUG_DRAW===0)return;if(cc.SPRITE_DEBUG_DRAW===1){var n=this._quad,r=[cc.p(n.tl.vertices.x,n.tl.vertices.y),cc.p(n.bl.vertices.x,n.bl.vertices.y),cc.p(n.br.vertices.x,n.br.vertices.y),cc.p(n.tr.vertices.x,n.tr.vertices.y)];cc.drawingUtil.drawPoly(r,4,!0)}else if(cc.SPRITE_DEBUG_DRAW===2){var i=this.getTextureRect()._size,s=this.getOffsetPosition(),o=[cc.p(s.x,s.y),cc.p(s.x+i.width,s.y),cc.p(s.x+i.width,s.y+i.height),cc.p(s.x,s.y+i.height)];cc.drawingUtil.drawPoly(o,4,!0)}},_drawForCanvas:function(e){if(!this._textureLoaded)return;var t=e||cc.renderContext;this._isLighterMode&&(t.globalCompositeOperation="lighter");var n=cc.EGLView.getInstance().getScaleX(),r=cc.EGLView.getInstance().getScaleY();t.globalAlpha=this._displayedOpacity/255;var i=this._rect,s=this._contentSize,o=this._offsetPosition,u=this._drawSize_Canvas,a=0|o._x,f=-o._y-i.height,l=this._textureRect_Canvas;u.width=i.width*n,u.height=i.height*r;if(this._flippedX||this._flippedY)t.save(),this._flippedX&&(a=-o._x-i.width,t.scale(-1,1)),this._flippedY&&(f=o._y,t.scale(1,-1));a*=n,f*=r;if(this._texture&&l.validRect){var c=this._texture.getHtmlElementObj();this._colorized?t.drawImage(c,0,0,l.width,l.height,a,f,u.width,u.height):t.drawImage(c,l.x,l.y,l.width,l.height,a,f,u.width,u.height)}else if(s._width!==0){var h=this.getColor();t.fillStyle="rgba("+h.r+","+h.g+","+h.b+",1)",t.fillRect(a,f,s._width*n,s._height*r)}if(cc.SPRITE_DEBUG_DRAW===1){t.strokeStyle="rgba(0,255,0,1)",a/=n,f/=r,f=-f;var p=[cc.p(a,f),cc.p(a+i.width,f),cc.p(a+i.width,f-i.height),cc.p(a,f-i.height)];cc.drawingUtil.drawPoly(p,4,!0)}else if(cc.SPRITE_DEBUG_DRAW===2){t.strokeStyle="rgba(0,255,0,1)";var d=this._rect._size;f=-f;var v=[cc.p(a,f),cc.p(a+d.width,f),cc.p(a+d.width,f-d.height),cc.p(a,f-d.height)];cc.drawingUtil.drawPoly(v,4,!0)}(this._flippedX||this._flippedY)&&t.restore(),cc.g_NumberOfDraws++}}),cc.Browser.supportWebGL?(cc.Sprite.prototype._spriteFrameLoadedCallback=cc.Sprite.prototype._spriteFrameLoadedCallbackForWebGL,cc.Sprite.prototype.setOpacityModifyRGB=cc.Sprite.prototype._setOpacityModifyRGBForWebGL,cc.Sprite.prototype.updateDisplayedOpacity=cc.Sprite.prototype._updateDisplayedOpacityForWebGL,cc.Sprite.prototype.ctor=cc.Sprite.prototype._ctorForWebGL,cc.Sprite.prototype.setBlendFunc=cc.Sprite.prototype._setBlendFuncForWebGL,cc.Sprite.prototype.init=cc.Sprite.prototype._initForWebGL,cc.Sprite.prototype.initWithTexture=cc.Sprite.prototype._initWithTextureForWebGL,cc.Sprite.prototype._textureLoadedCallback=cc.Sprite.prototype._textureLoadedCallbackForWebGL,cc.Sprite.prototype.setTextureRect=cc.Sprite.prototype._setTextureRectForWebGL,cc.Sprite.prototype.updateTransform=cc.Sprite.prototype._updateTransformForWebGL,cc.Sprite.prototype.addChild=cc.Sprite.prototype._addChildForWebGL,cc.Sprite.prototype.setOpacity=cc.Sprite.prototype._setOpacityForWebGL,cc.Sprite.prototype.setColor=cc.Sprite.prototype._setColorForWebGL,cc.Sprite.prototype.updateDisplayedColor=cc.Sprite.prototype._updateDisplayedColorForWebGL,cc.Sprite.prototype.setDisplayFrame=cc.Sprite.prototype._setDisplayFrameForWebGL,cc.Sprite.prototype.isFrameDisplayed=cc.Sprite.prototype._isFrameDisplayedForWebGL,cc.Sprite.prototype.setBatchNode=cc.Sprite.prototype._setBatchNodeForWebGL,cc.Sprite.prototype.setTexture=cc.Sprite.prototype._setTextureForWebGL,cc.Sprite.prototype.draw=cc.Sprite.prototype._drawForWebGL):(cc.Sprite.prototype._spriteFrameLoadedCallback=cc.Sprite.prototype._spriteFrameLoadedCallbackForCanvas,cc.Sprite.prototype.setOpacityModifyRGB=cc.Sprite.prototype._setOpacityModifyRGBForCanvas,cc.Sprite.prototype.updateDisplayedOpacity=cc.Sprite.prototype._updateDisplayedOpacityForCanvas,cc.Sprite.prototype.ctor=cc.Sprite.prototype._ctorForCanvas,cc.Sprite.prototype.setBlendFunc=cc.Sprite.prototype._setBlendFuncForCanvas,cc.Sprite.prototype.init=cc.Sprite.prototype._initForCanvas,cc.Sprite.prototype.initWithTexture=cc.Sprite.prototype._initWithTextureForCanvas,cc.Sprite.prototype._textureLoadedCallback=cc.Sprite.prototype._textureLoadedCallbackForCanvas,cc.Sprite.prototype.setTextureRect=cc.Sprite.prototype._setTextureRectForCanvas,cc.Sprite.prototype.updateTransform=cc.Sprite.prototype._updateTransformForCanvas,cc.Sprite.prototype.addChild=cc.Sprite.prototype._addChildForCanvas,cc.Sprite.prototype.setOpacity=cc.Sprite.prototype._setOpacityForCanvas,cc.Sprite.prototype.setColor=cc.Sprite.prototype._setColorForCanvas,cc.Sprite.prototype.updateDisplayedColor=cc.Sprite.prototype._updateDisplayedColorForCanvas,cc.Sprite.prototype.setDisplayFrame=cc.Sprite.prototype._setDisplayFrameForCanvas,cc.Sprite.prototype.isFrameDisplayed=cc.Sprite.prototype._isFrameDisplayedForCanvas,cc.Sprite.prototype.setBatchNode=cc.Sprite.prototype._setBatchNodeForCanvas,cc.Sprite.prototype.setTexture=cc.Sprite.prototype._setTextureForCanvas,cc.Sprite.prototype.draw=cc.Sprite.prototype._drawForCanvas),cc.Sprite.createWithTexture=function(e,t){var n=arguments.length,r=new cc.Sprite;switch(n){case 1:if(r&&r.initWithTexture(e))return r;return null;case 2:if(r&&r.initWithTexture(e,t))return r;return null;default:throw"Sprite.createWithTexture(): Argument must be non-nil "}},cc.Sprite.create=function(e,t){var n=arguments.length,r=new cc.Sprite;if(n===0){if(r.init())return r}else if(r&&r.init(e,t))return r;return null},cc.Sprite.createWithSpriteFrameName=function(e){var t=null;if(typeof e!="string")return cc.log("Invalid argument. Expecting string."),null;t=cc.SpriteFrameCache.getInstance().getSpriteFrame(e);if(!t)return cc.log("Invalid spriteFrameName: "+e),null;var n=new cc.Sprite;return n&&n.initWithSpriteFrame(t)?n:null},cc.Sprite.createWithSpriteFrame=function(e){var t=new cc.Sprite;return t&&t.initWithSpriteFrame(e)?t:null},cc.AnimationFrame=cc.Class.extend({_spriteFrame:null,_delayPerUnit:0,_userInfo:null,ctor:function(){this._delayPerUnit=0},clone:function(){var e=new cc.AnimationFrame;return e.initWithSpriteFrame(this._spriteFrame.clone(),this._delayPerUnit,this._userInfo),e},copyWithZone:function(e){return cc.clone(this)},copy:function(e){var t=new cc.AnimationFrame;return t.initWithSpriteFrame(this._spriteFrame.clone(),this._delayPerUnit,this._userInfo),t},initWithSpriteFrame:function(e,t,n){return this._spriteFrame=e,this._delayPerUnit=t,this._userInfo=n,!0},getSpriteFrame:function(){return this._spriteFrame},setSpriteFrame:function(e){this._spriteFrame=e},getDelayUnits:function(){return this._delayPerUnit},setDelayUnits:function(e){this._delayPerUnit=e},getUserInfo:function(){return this._userInfo},setUserInfo:function(e){this._userInfo=e}}),cc.Animation=cc.Class.extend({_frames:null,_loops:0,_restoreOriginalFrame:!1,_duration:0,_delayPerUnit:0,_totalDelayUnits:0,ctor:function(){this._frames=[]},getFrames:function(){return this._frames},setFrames:function(e){this._frames=e},addSpriteFrame:function(e){var t=new cc.AnimationFrame;t.initWithSpriteFrame(e,1,null),this._frames.push(t),this._totalDelayUnits++},addSpriteFrameWithFile:function(e){var t=cc.TextureCache.getInstance().addImage(e),n=cc.RectZero();n._size=t.getContentSize();var r=cc.SpriteFrame.createWithTexture(t,n);this.addSpriteFrame(r)},addSpriteFrameWithTexture:function(e,t){var n=cc.SpriteFrame.createWithTexture(e,t);this.addSpriteFrame(n)},initWithAnimationFrames:function(e,t,n){cc.ArrayVerifyType(e,cc.AnimationFrame),this._delayPerUnit=t,this._loops=n,this._totalDelayUnits=0;var r=this._frames;r.length=0;for(var i=0;i<e.length;i++){var s=e[i];r.push(s),this._totalDelayUnits+=s.getDelayUnits()}return!0},clone:function(){var e=new cc.Animation;return e.initWithAnimationFrames(this._copyFrames(),this._delayPerUnit,this._loops),e.setRestoreOriginalFrame(this._restoreOriginalFrame),e},copyWithZone:function(e){var t=new cc.Animation;return t.initWithAnimationFrames(this._copyFrames(),this._delayPerUnit,this._loops),t.setRestoreOriginalFrame(this._restoreOriginalFrame),t},_copyFrames:function(){var e=[];for(var t=0;t<this._frames.length;t++)e.push(this._frames[t].clone());return e},copy:function(e){return this.copyWithZone(null)},getLoops:function(){return this._loops},setLoops:function(e){this._loops=e},setRestoreOriginalFrame:function(e){this._restoreOriginalFrame=e},getRestoreOriginalFrame:function(){return this._restoreOriginalFrame},getDuration:function(){return this._totalDelayUnits*this._delayPerUnit},getDelayPerUnit:function(){return this._delayPerUnit},setDelayPerUnit:function(e){this._delayPerUnit=e},getTotalDelayUnits:function(){return this._totalDelayUnits},initWithSpriteFrames:function(e,t){cc.ArrayVerifyType(e,cc.SpriteFrame),this._loops=1,t=t||0,this._delayPerUnit=t,this._totalDelayUnits=0;var n=this._frames;n.length=0;if(e){for(var r=0;r<e.length;r++){var i=e[r],s=new cc.AnimationFrame;s.initWithSpriteFrame(i,1,null),n.push(s)}this._totalDelayUnits+=e.length}return!0},retain:function(){},release:function(){}}),cc.Animation.create=function(e,t,n){var r=arguments.length,i=new cc.Animation;return r==0?i.initWithSpriteFrames(null,0):r==2?(t=t||0,i.initWithSpriteFrames(e,t)):r==3&&i.initWithAnimationFrames(e,t,n),i},cc.Animation.createWithAnimationFrames=function(e,t,n){var r=new cc.Animation;return r.initWithAnimationFrames(e,t,n),r},cc.AnimationCache=cc.Class.extend({addAnimation:function(e,t){this._animations[t]=e},removeAnimation:function(e){if(!e)return;this._animations[e]&&delete this._animations[e]},getAnimation:function(e){return this._animations[e]?this._animations[e]:null},_addAnimationsWithDictionary:function(e,t){var n=e.animations;if(!n){cc.log("cocos2d: cc.AnimationCache: No animations were found in provided dictionary.");return}var r=1,i=e.properties;if(i){r=i["format"]!=null?parseInt(i.format):r;var s=i.spritesheets,o=cc.SpriteFrameCache.getInstance(),u=cc.FileUtils.getInstance(),a;for(var f=0;f<s.length;f++)a=u.fullPathFromRelativeFile(s[f],t),o.addSpriteFrames(a)}switch(r){case 1:this._parseVersion1(n);break;case 2:this._parseVersion2(n);break;default:cc.log("cc.AnimationCache. Invalid animation format")}},addAnimations:function(e){if(!e)throw"cc.AnimationCache.addAnimations(): Invalid texture file name";var t=cc.FileUtils.getInstance(),n=t.fullPathForFilename(e),r=t.dictionaryWithContentsOfFileThreadSafe(n);if(!r){cc.log("cc.AnimationCache.addAnimations(): File could not be found");return}this._addAnimationsWithDictionary(r,e)},_parseVersion1:function(e){var t=cc.SpriteFrameCache.getInstance();for(var n in e){var r=e[n],i=r.frames,s=parseFloat(r.delay)||0,o=null;if(!i){cc.log("cocos2d: cc.AnimationCache: Animation '"+n+"' found in dictionary without any frames - cannot add to animation cache.");continue}var u=[];for(var a=0;a<i.length;a++){var f=t.getSpriteFrame(i[a]);if(!f){cc.log("cocos2d: cc.AnimationCache: Animation '"+n+"' refers to frame '"+i[a]+"' which is not currently in the cc.SpriteFrameCache. This frame will not be added to the animation.");continue}var l=new cc.AnimationFrame;l.initWithSpriteFrame(f,1,null),u.push(l)}if(u.length===0){cc.log("cocos2d: cc.AnimationCache: None of the frames for animation '"+n+"' were found in the cc.SpriteFrameCache. Animation is not being added to the Animation Cache."
);continue}u.length!=i.length&&cc.log("cocos2d: cc.AnimationCache: An animation in your dictionary refers to a frame which is not in the cc.SpriteFrameCache. Some or all of the frames for the animation '"+n+"' may be missing."),o=cc.Animation.createWithAnimationFrames(u,s,1),cc.AnimationCache.getInstance().addAnimation(o,n)}},_parseVersion2:function(e){var t=cc.SpriteFrameCache.getInstance();for(var n in e){var r=e[n],i=r.loop,s=parseInt(r.loops),o=i?cc.REPEAT_FOREVER:isNaN(s)?1:s,u=r.restoreOriginalFrame&&r["restoreOriginalFrame"]==1?!0:!1,a=r.frames;if(!a){cc.log("cocos2d: CCAnimationCache: Animation '"+n+"' found in dictionary without any frames - cannot add to animation cache.");continue}var f=[];for(var l=0;l<a.length;l++){var c=a[l],h=c.spriteframe,p=t.getSpriteFrame(h);if(!p){cc.log("cocos2d: cc.AnimationCache: Animation '"+n+"' refers to frame '"+h+"' which is not currently in the cc.SpriteFrameCache. This frame will not be added to the animation.");continue}var d=parseFloat(c.delayUnits)||0,v=c.notification,m=new cc.AnimationFrame;m.initWithSpriteFrame(p,d,v),f.push(m)}var g=parseFloat(r.delayPerUnit)||0,y=new cc.Animation;y.initWithAnimationFrames(f,g,o),y.setRestoreOriginalFrame(u),cc.AnimationCache.getInstance().addAnimation(y,n)}},init:function(){return this._animations={},!0},_animations:null}),cc.AnimationCache.purgeSharedAnimationCache=function(){cc.s_sharedAnimationCache&&(cc.s_sharedAnimationCache._animations=null,cc.s_sharedAnimationCache=null)},cc.AnimationCache.getInstance=function(){return cc.s_sharedAnimationCache===null&&(cc.s_sharedAnimationCache=new cc.AnimationCache,cc.s_sharedAnimationCache.init()),cc.s_sharedAnimationCache},cc.s_sharedAnimationCache=null,cc.SpriteFrame=cc.Class.extend({_offset:null,_originalSize:null,_rectInPixels:null,_rotated:!1,_rect:null,_offsetInPixels:null,_originalSizeInPixels:null,_texture:null,_textureFilename:"",_textureLoaded:!1,_eventListeners:null,ctor:function(){this._offset=cc._pConst(0,0),this._offsetInPixels=cc._pConst(0,0),this._originalSize=cc._sizeConst(0,0),this._rotated=!1,this._originalSizeInPixels=cc._sizeConst(0,0),this._textureFilename="",this._texture=null,this._textureLoaded=!1},textureLoaded:function(){return this._textureLoaded},addLoadedEventListener:function(e,t){this._eventListeners==null&&(this._eventListeners=[]),this._eventListeners.push({eventCallback:e,eventTarget:t})},_callLoadedEventCallbacks:function(){var e=this._eventListeners;if(!e)return;for(var t=0,n=e.length;t<n;t++){var r=e[t];cc.doCallback(r.eventCallback,r.eventTarget,this)}e.length=0},getRectInPixels:function(){var e=this._rectInPixels;return cc.rect(e.x,e.y,e.width,e.height)},setRectInPixels:function(e){this._rectInPixels||(this._rectInPixels=cc.rect(0,0,0,0)),this._rectInPixels.x=e.x,this._rectInPixels.y=e.y,this._rectInPixels.width=e.width,this._rectInPixels.height=e.height,this._rect=cc.RECT_PIXELS_TO_POINTS(e)},isRotated:function(){return this._rotated},setRotated:function(e){this._rotated=e},getRect:function(){var e=this._rect;return cc.rect(e.x,e.y,e.width,e.height)},setRect:function(e){this._rect||(this._rect=cc.rect(0,0,0,0)),this._rect.x=e.x,this._rect.y=e.y,this._rect.width=e.width,this._rect.height=e.height,this._rectInPixels=cc.RECT_POINTS_TO_PIXELS(this._rect)},getOffsetInPixels:function(){return this._offsetInPixels},setOffsetInPixels:function(e){this._offsetInPixels._x=e.x,this._offsetInPixels._y=e.y,cc._POINT_PIXELS_TO_POINTS_OUT(this._offsetInPixels,this._offset)},getOriginalSizeInPixels:function(){return this._originalSizeInPixels},setOriginalSizeInPixels:function(e){this._originalSizeInPixels._width=e.width,this._originalSizeInPixels._height=e.height},getOriginalSize:function(){return this._originalSize},setOriginalSize:function(e){this._originalSize._width=e.width,this._originalSize._height=e.height},getTexture:function(){if(this._texture)return this._texture;if(this._textureFilename!==""){var e=cc.TextureCache.getInstance().addImage(this._textureFilename);return e&&(this._textureLoaded=e.isLoaded()),e}return null},setTexture:function(e){if(this._texture!=e){var t=e.isLoaded();this._textureLoaded=t,this._texture=e,t||e.addLoadedEventListener(function(e){this._textureLoaded=!0;if(this._rotated&&cc.renderContextType===cc.CANVAS){var t=e.getHtmlElementObj();t=cc.cutRotateImageToCanvas(t,this.getRect());var n=new cc.Texture2D;n.initWithElement(t),n.handleLoadedTexture(),this.setTexture(n);var r=this.getRect();this.setRect(cc.rect(0,0,r.width,r.height))}var i=this._rect;if(i.width===0&&i.height===0){var s=e.getContentSize();this._rect.width=s.width,this._rect.height=s.height,this._rectInPixels=cc.RECT_POINTS_TO_PIXELS(this._rect),this._originalSizeInPixels._width=this._rectInPixels.width,this._originalSizeInPixels._height=this._rectInPixels.height,this._originalSize._width=s.width,this._originalSize._height=s.height}this._callLoadedEventCallbacks()},this)}},getOffset:function(){return this._offset},setOffset:function(e){this._offset._x=e.x,this._offset._y=e.y},clone:function(){var e=new cc.SpriteFrame;return e.initWithTextureFilename(this._textureFilename,this._rectInPixels,this._rotated,this._offsetInPixels,this._originalSizeInPixels),e.setTexture(this._texture),e},copyWithZone:function(){var e=new cc.SpriteFrame;return e.initWithTextureFilename(this._textureFilename,this._rectInPixels,this._rotated,this._offsetInPixels,this._originalSizeInPixels),e.setTexture(this._texture),e},copy:function(){return this.copyWithZone()},initWithTexture:function(e,t,n,r,i){return arguments.length===2&&(t=cc.RECT_POINTS_TO_PIXELS(t)),r=r||cc.p(0,0),i=i||t._size,this.setTexture(e),this._rectInPixels=t,this._rect=cc.RECT_PIXELS_TO_POINTS(t),this._offsetInPixels._x=r.x,this._offsetInPixels._y=r.y,cc._POINT_PIXELS_TO_POINTS_OUT(r,this._offset),this._originalSizeInPixels._width=i.width,this._originalSizeInPixels._height=i.height,cc._SIZE_PIXELS_TO_POINTS_OUT(i,this._originalSize),this._rotated=n||!1,!0},initWithTextureFilename:function(e,t,n,r,i){return arguments.length===2&&(t=cc.RECT_POINTS_TO_PIXELS(t)),r=r||cc.p(0,0),i=i||t._size,this._texture=null,this._textureFilename=e,this._rectInPixels=t,this._rect=cc.RECT_PIXELS_TO_POINTS(t),this._rotated=n||!1,this._offsetInPixels._x=r.x,this._offsetInPixels._y=r.y,cc._POINT_PIXELS_TO_POINTS_OUT(r,this._offset),this._originalSizeInPixels._width=i.width,this._originalSizeInPixels._height=i.height,cc._SIZE_PIXELS_TO_POINTS_OUT(i,this._originalSize),!0}}),cc.SpriteFrame.create=function(e,t,n,r,i){var s=new cc.SpriteFrame;switch(arguments.length){case 2:s.initWithTextureFilename(e,t);break;case 5:s.initWithTextureFilename(e,t,n,r,i);break;default:throw"Argument must be non-nil "}return s},cc.SpriteFrame.createWithTexture=function(e,t,n,r,i){var s=new cc.SpriteFrame;switch(arguments.length){case 2:s.initWithTexture(e,t);break;case 5:s.initWithTexture(e,t,n,r,i);break;default:throw"Argument must be non-nil "}return s},cc.SpriteFrame._frameWithTextureForCanvas=function(e,t,n,r,i){var s=new cc.SpriteFrame;return s._texture=e,s._rectInPixels=t,s._rect=cc.RECT_PIXELS_TO_POINTS(t),s._offsetInPixels._x=r.x,s._offsetInPixels._y=r.y,cc._POINT_PIXELS_TO_POINTS_OUT(s._offsetInPixels,s._offset),s._originalSizeInPixels._width=i.width,s._originalSizeInPixels._height=i.height,cc._SIZE_PIXELS_TO_POINTS_OUT(s._originalSizeInPixels,s._originalSize),s._rotated=n,s},cc.SpriteFrameCache=cc.Class.extend({_spriteFrames:null,_spriteFramesAliases:null,_loadedFileNames:null,ctor:function(){this._spriteFrames={},this._spriteFramesAliases={},this._loadedFileNames=[]},_addSpriteFramesWithDictionary:function(e,t){var n=e.metadata||e.meta,r=e.frames,i=0;if(n){var s=n.format;i=s.length<=1?parseInt(s):s}if(i<0||i>3){cc.log("format is not supported for cc.SpriteFrameCache.addSpriteFramesWithDictionary");return}for(var o in r){var u=r[o];if(u){var a=this._spriteFrames[o];if(a)continue;if(i==0){var f=parseFloat(u.x),l=parseFloat(u.y),c=parseFloat(u.width),h=parseFloat(u.height),p=parseFloat(u.offsetX),d=parseFloat(u.offsetY),v=parseInt(u.originalWidth),m=parseInt(u.originalHeight);(!v||!m)&&cc.log("cocos2d: WARNING: originalWidth/Height not found on the cc.SpriteFrame. AnchorPoint won't work as expected. Regenrate the .plist"),v=Math.abs(v),m=Math.abs(m),a=cc.SpriteFrame.createWithTexture(t,cc.rect(f,l,c,h),!1,cc.p(p,d),cc.size(v,m))}else if(i==1||i==2){var g=cc.RectFromString(u.frame),y=!1;i==2&&(y=u.rotated);var b=cc.PointFromString(u.offset),w=cc.SizeFromString(u.sourceSize);a=cc.SpriteFrame.createWithTexture(t,g,y,b,w)}else if(i==3){var E,S,x,T,N;E=cc.SizeFromString(u.spriteSize),S=cc.PointFromString(u.spriteOffset),x=cc.SizeFromString(u.spriteSourceSize),T=cc.RectFromString(u.textureRect),N=u.textureRotated;var C=u.aliases,k=o.toString();for(var L in C){var A=C[L];this._spriteFramesAliases[A]&&cc.log("cocos2d: WARNING: an alias with name "+L+" already exists"),this._spriteFramesAliases[A]=k}u.spriteSize!==undefined&&(T=cc.rect(T.x,T.y,E.width,E.height)),a=cc.SpriteFrame.createWithTexture(t,T,N,S,x)}else{var O=u.filename,M=u.frame,_=u.sourceSize,D=cc.rect(M.x,M.y,M.w,M.h),P=u.rotated,H=cc.p(0,0),B=cc.size(_.w,_.h);a=cc.SpriteFrame.createWithTexture(t,D,P,H,B)}if(cc.renderContextType===cc.CANVAS&&a.isRotated()){var j=a.getTexture();if(j.isLoaded()){var F=a.getTexture().getHtmlElementObj();F=cc.cutRotateImageToCanvas(F,a.getRectInPixels());var I=new cc.Texture2D;I.initWithElement(F),I.handleLoadedTexture(),a.setTexture(I);var q=a._rect;a.setRect(cc.rect(0,0,q.width,q.height))}}var R=O!=null?O:o;this._spriteFrames[R]=a}}},addSpriteFrames:function(e,t){if(!e)throw"cc.SpriteFrameCache.addSpriteFrames(): plist should be non-null";var n=cc.FileUtils.getInstance(),r,i=e.substr(e.lastIndexOf(".",e.length)+1,e.length);if(i=="plist"){var s=n.fullPathForFilename(e);r=n.dictionaryWithContentsOfFileThreadSafe(s)}else r=JSON.parse(n.getTextFileData(e));switch(arguments.length){case 1:if(!cc.ArrayContainsObject(this._loadedFileNames,e)){var o="",u=r.metadata||r.meta;u&&(o=u.textureFileName||u.image);if(o!="")o=n.fullPathFromRelativeFile(o,e);else{o=e;var a=o.lastIndexOf(".",o.length);o=o.substr(0,a),o+=".png"}var f=cc.TextureCache.getInstance().addImage(o);f?(this._addSpriteFramesWithDictionary(r,f),this._loadedFileNames.push(e)):cc.log("cocos2d: cc.SpriteFrameCache: Couldn't load texture")}break;case 2:if(t instanceof cc.Texture2D)this._loadedFileNames.indexOf(e)===-1&&this._checkConflict(r),this._addSpriteFramesWithDictionary(r,t);else{var l=t;if(!l)throw"cc.SpriteFrameCache.addSpriteFrames(): texture name should not be null";var c=cc.TextureCache.getInstance().addImage(l);c?(this._loadedFileNames.indexOf(e)===-1&&(this._checkConflict(r),this._loadedFileNames.push(e)),this._addSpriteFramesWithDictionary(r,c)):cc.log("cocos2d: cc.SpriteFrameCache: couldn't load texture file. File not found "+l)}break;default:throw"Argument must be non-nil "}},_checkConflict:function(e){var t=e.frames;for(var n in t)this._spriteFrames[n]&&cc.log("cocos2d: WARNING: Sprite frame: "+n+" has already been added by another source, please fix name conflit")},addSpriteFrame:function(e,t){this._spriteFrames[t]=e},removeSpriteFrames:function(){this._spriteFrames={},this._spriteFramesAliases={},this._loadedFileNames.length=0},removeSpriteFrameByName:function(e){if(!e)return;this._spriteFramesAliases[e]&&delete this._spriteFramesAliases[e],this._spriteFrames[e]&&delete this._spriteFrames[e],this._loadedFileNames.length=0},removeSpriteFramesFromFile:function(e){var t=cc.FileUtils.getInstance(),n=t.fullPathForFilename(e),r=t.dictionaryWithContentsOfFileThreadSafe(n);this._removeSpriteFramesFromDictionary(r),cc.ArrayContainsObject(this._loadedFileNames,e)&&cc.ArrayRemoveObject(this._loadedFileNames,e)},_removeSpriteFramesFromDictionary:function(e){var t=e.frames;for(var n in t)this._spriteFrames[n]&&delete this._spriteFrames[n]},removeSpriteFramesFromTexture:function(e){for(var t in this._spriteFrames){var n=this._spriteFrames[t];n&&n.getTexture()==e&&delete this._spriteFrames[t]}},getSpriteFrame:function(e){var t;this._spriteFrames[e]&&(t=this._spriteFrames[e]);if(!t){var n;this._spriteFramesAliases[e]&&(n=this._spriteFramesAliases[e]);if(n){var r=n.toString();this._spriteFrames[r]&&(t=this._spriteFrames[r]),t||cc.log("cocos2d: cc.SpriteFrameCahce: Frame "+e+" not found")}}return t}}),cc.s_sharedSpriteFrameCache=null,cc.SpriteFrameCache.getInstance=function(){return cc.s_sharedSpriteFrameCache||(cc.s_sharedSpriteFrameCache=new cc.SpriteFrameCache),cc.s_sharedSpriteFrameCache},cc.SpriteFrameCache.purgeSharedSpriteFrameCache=function(){cc.s_sharedSpriteFrameCache=null},cc.DEFAULT_SPRITE_BATCH_CAPACITY=29,cc.SpriteBatchNode=cc.Node.extend({_textureAtlas:null,_blendFunc:null,_descendants:null,addSpriteWithoutQuad:function(e,t,n){if(!e)throw"cc.SpriteBatchNode.addQuadFromSprite(): child should be non-null";if(e instanceof cc.Sprite){e.setAtlasIndex(t);var r=0,i=this._descendants;if(i&&i.length>0)for(var s=0;s<i.length;s++){var o=i[s];if(o&&o.getAtlasIndex()>=t)break;++r}return this._descendants=cc.ArrayAppendObjectToIndex(i,e,r),cc.Node.prototype.addChild.call(this,e,t,n),this.reorderBatch(!1),this}return cc.log("cc.SpriteBatchNode.addQuadFromSprite(): SpriteBatchNode only supports cc.Sprites as children"),null},getTextureAtlas:function(){return this._textureAtlas},setTextureAtlas:function(e){e!=this._textureAtlas&&(this._textureAtlas=e)},getDescendants:function(){return this._descendants},initWithFile:function(e,t){var n=cc.TextureCache.getInstance().textureForKey(e);return n||(n=cc.TextureCache.getInstance().addImage(e)),this.initWithTexture(n,t)},_setNodeDirtyForCache:function(){this._cacheDirty=!0},init:function(e,t){var n=cc.TextureCache.getInstance().textureForKey(e);return n||(n=cc.TextureCache.getInstance().addImage(e)),this.initWithTexture(n,t)},increaseAtlasCapacity:function(){var e=this._textureAtlas.getCapacity(),t=Math.floor((e+1)*4/3);cc.log("cocos2d: CCSpriteBatchNode: resizing TextureAtlas capacity from "+e+" to "+t+"."),this._textureAtlas.resizeCapacity(t)||cc.log("cocos2d: WARNING: Not enough memory to resize the atlas")},removeChildAtIndex:function(e,t){this.removeChild(this._children[e],t)},rebuildIndexInOrder:function(e,t){var n=e.getChildren();if(n&&n.length>0)for(var r=0;r<n.length;r++){var i=n[r];i&&i.getZOrder()<0&&(t=this.rebuildIndexInOrder(i,t))}!e==this&&(e.setAtlasIndex(t),t++);if(n&&n.length>0)for(r=0;r<n.length;r++)i=n[r],i&&i.getZOrder()>=0&&(t=this.rebuildIndexInOrder(i,t));return t},highestAtlasIndexInChild:function(e){var t=e.getChildren();return!t||t.length==0?e.getAtlasIndex():this.highestAtlasIndexInChild(t[t.length-1])},lowestAtlasIndexInChild:function(e){var t=e.getChildren();return!t||t.length==0?e.getAtlasIndex():this.lowestAtlasIndexInChild(t[t.length-1])},atlasIndexForChild:function(e,t){var n=e.getParent().getChildren(),r=cc.ArrayGetIndexOfObject(n,e),i=e.getParent()==this,s=null;r>0&&r<cc.UINT_MAX&&(s=n[r-1]);if(i)return r==0?0:this.highestAtlasIndexInChild(s)+1;var o;return r==0?(o=e.getParent(),t<0?o.getAtlasIndex():o.getAtlasIndex()+1):s.getZOrder()<0&&t<0||s.getZOrder()>=0&&t>=0?this.highestAtlasIndexInChild(s)+1:(o=e.getParent(),o.getAtlasIndex()+1)},reorderBatch:function(e){this._reorderChildDirty=e},setBlendFunc:function(e,t){t===undefined?this._blendFunc=e:this._blendFunc={src:e,dst:t}},getBlendFunc:function(){return this._blendFunc},reorderChild:function(e,t){if(!e)throw"cc.SpriteBatchNode.addChild():child should be non-null";if(this._children.indexOf(e)===-1){cc.log("cc.SpriteBatchNode.addChild(): Child doesn't belong to Sprite");return}if(t===e.getZOrder())return;cc.Node.prototype.reorderChild.call(this,e,t),this.setNodeDirty()},removeChild:function(e,t){if(e==null)return;if(this._children.indexOf(e)===-1){cc.log("cc.SpriteBatchNode.addChild(): sprite batch node should contain the child");return}this.removeSpriteFromAtlas(e),cc.Node.prototype.removeChild.call(this,e,t)},_mvpMatrix:null,_textureForCanvas:null,_useCache:!1,_originalTexture:null,ctor:null,_ctorForCanvas:function(e){cc.Node.prototype.ctor.call(this),e&&this.init(e,cc.DEFAULT_SPRITE_BATCH_CAPACITY)},_ctorForWebGL:function(e){cc.Node.prototype.ctor.call(this),this._mvpMatrix=new cc.kmMat4,e&&this.init(e,cc.DEFAULT_SPRITE_BATCH_CAPACITY)},updateQuadFromSprite:null,_updateQuadFromSpriteForCanvas:function(e,t){if(!e)throw"cc.SpriteBatchNode.updateQuadFromSprite(): sprite should be non-null";if(!(e instanceof cc.Sprite)){cc.log("cc.SpriteBatchNode.updateQuadFromSprite(): cc.SpriteBatchNode only supports cc.Sprites as children");return}e.setBatchNode(this),e.setAtlasIndex(t),e.setDirty(!0),e.updateTransform()},_updateQuadFromSpriteForWebGL:function(e,t){if(!e)throw"cc.SpriteBatchNode.updateQuadFromSprite(): sprite should be non-null";if(!(e instanceof cc.Sprite)){cc.log("cc.SpriteBatchNode.updateQuadFromSprite(): cc.SpriteBatchNode only supports cc.Sprites as children");return}var n=this._textureAtlas.getCapacity();while(t>=n||n==this._textureAtlas.getTotalQuads())this.increaseAtlasCapacity();e.setBatchNode(this),e.setAtlasIndex(t),e.setDirty(!0),e.updateTransform()},_swap:function(e,t){var n=this._descendants,r=this._textureAtlas,i=r.getQuads(),s=n[e],o=cc.V3F_C4B_T2F_QuadCopy(i[e]);n[t].setAtlasIndex(e),n[e]=n[t],r.updateQuad(i[t],e),n[t]=s,r.updateQuad(o,t)},insertQuadFromSprite:null,_insertQuadFromSpriteForCanvas:function(e,t){if(!e)throw"cc.SpriteBatchNode.insertQuadFromSprite(): sprite should be non-null";if(!(e instanceof cc.Sprite)){cc.log("cc.SpriteBatchNode.insertQuadFromSprite(): cc.SpriteBatchNode only supports cc.Sprites as children");return}e.setBatchNode(this),e.setAtlasIndex(t),e.setDirty(!0),e.updateTransform(),this._children=cc.ArrayAppendObjectToIndex(this._children,e,t)},_insertQuadFromSpriteForWebGL:function(e,t){if(!e)throw"cc.SpriteBatchNode.insertQuadFromSprite(): sprite should be non-null";if(!(e instanceof cc.Sprite)){cc.log("cc.SpriteBatchNode.insertQuadFromSprite(): cc.SpriteBatchNode only supports cc.Sprites as children");return}var n=this._textureAtlas;while(t>=n.getCapacity()||n.getCapacity()===n.getTotalQuads())this.increaseAtlasCapacity();e.setBatchNode(this),e.setAtlasIndex(t),n.insertQuad(e.getQuad(),t),e.setDirty(!0),e.updateTransform()},_updateAtlasIndex:function(e,t){var n=0,r=e.getChildren();r&&(n=r.length);var i=0;if(n===0)i=e.getAtlasIndex(),e.setAtlasIndex(t),e.setOrderOfArrival(0),i!=t&&this._swap(i,t),t++;else{var s=!0;r[0].getZOrder()>=0&&(i=e.getAtlasIndex(),e.setAtlasIndex(t),e.setOrderOfArrival(0),i!=t&&this._swap(i,t),t++,s=!1);for(var o=0;o<r.length;o++){var u=r[o];s&&u.getZOrder()>=0&&(i=e.getAtlasIndex(),e.setAtlasIndex(t),e.setOrderOfArrival(0),i!=t&&this._swap(i,t),t++,s=!1),t=this._updateAtlasIndex(u,t)}s&&(i=e.getAtlasIndex(),e.setAtlasIndex(t),e.setOrderOfArrival(0),i!=t&&this._swap(i,t),t++)}return t},_updateBlendFunc:function(){this._textureAtlas.getTexture().hasPremultipliedAlpha()||(this._blendFunc.src=gl.SRC_ALPHA,this._blendFunc.dst=gl.ONE_MINUS_SRC_ALPHA)},initWithTexture:null,_initWithTextureForCanvas:function(e,t){return this._children=[],this._descendants=[],this._blendFunc=new cc.BlendFunc(cc.BLEND_SRC,cc.BLEND_DST),this._originalTexture=e,this._textureForCanvas=e,!0},_initWithTextureForWebGL:function(e,t){return this._children=[],this._descendants=[],this._blendFunc=new cc.BlendFunc(cc.BLEND_SRC,cc.BLEND_DST),t=t||cc.DEFAULT_SPRITE_BATCH_CAPACITY,this._textureAtlas=new cc.TextureAtlas,this._textureAtlas.initWithTexture(e,t),this._updateBlendFunc(),this.setShaderProgram(cc.ShaderCache.getInstance().programForKey(cc.SHADER_POSITION_TEXTURECOLOR)),!0},insertChild:function(e,t){e.setBatchNode(this),e.setAtlasIndex(t),e.setDirty(!0);var n=this._textureAtlas;n.getTotalQuads()>=n.getCapacity()&&this.increaseAtlasCapacity(),n.insertQuad(e.getQuad(),t),this._descendants=cc.ArrayAppendObjectToIndex(this._descendants,e,t);var r=t+1,i=this._descendants;if(i&&i.length>0)for(;r<i.length;r++)i[r].setAtlasIndex(i[r].getAtlasIndex()+1);var s=e.getChildren();if(s&&s.length>0)for(r=0;r<s.length;r++)if(s[r]){var o=this.atlasIndexForChild(s[r],s[r].getZOrder());this.insertChild(s[r],o)}},appendChild:null,_appendChildForCanvas:function(e){this._reorderChildDirty=!0,e.setBatchNode(this),e.setDirty(!0),this._descendants.push(e);var t=this._descendants.length-1;e.setAtlasIndex(t);var n=e.getChildren();for(var r=0;r<n.length;r++)this.appendChild(n[r])},_appendChildForWebGL:function(e){this._reorderChildDirty=!0,e.setBatchNode(this),e.setDirty(!0),this._descendants.push(e);var t=this._descendants.length-1;e.setAtlasIndex(t);var n=this._textureAtlas;n.getTotalQuads()==n.getCapacity()&&this.increaseAtlasCapacity(),n.insertQuad(e.getQuad(),t);var r=e.getChildren();for(var i=0;i<r.length;i++)this.appendChild(r[i])},removeSpriteFromAtlas:null,_removeSpriteFromAtlasForCanvas:function(e){e.setBatchNode(null);var t=this._descendants,n=cc.ArrayGetIndexOfObject(t,e);if(n!=-1){cc.ArrayRemoveObjectAtIndex(t,n);var r=t.length;for(;n<r;++n){var i=t[n];i.setAtlasIndex(i.getAtlasIndex()-1)}}var s=e.getChildren();if(s&&s.length>0)for(var o=0;o<s.length;o++)s[o]&&this.removeSpriteFromAtlas(s[o])},_removeSpriteFromAtlasForWebGL:function(e){this._textureAtlas.removeQuadAtIndex(e.getAtlasIndex()),e.setBatchNode(null);var t=this._descendants,n=cc.ArrayGetIndexOfObject(t,e);if(n!=-1){cc.ArrayRemoveObjectAtIndex(t,n);var r=t.length;for(;n<r;++n){var i=t[n];i.setAtlasIndex(i.getAtlasIndex()-1)}}var s=e.getChildren();if(s&&s.length>0)for(var o=0;o<s.length;o++)s[o]&&this.removeSpriteFromAtlas(s[o])},getTexture:null,_getTextureForCanvas:function(){return this._textureForCanvas},_getTextureForWebGL:function(){return this._textureAtlas.getTexture()},setTexture:null,_setTextureForCanvas:function(e){this._textureForCanvas=e;var t=this._children;for(var n=0;n<t.length;n++)t[n].setTexture(e)},_setTextureForWebGL:function(e){this._textureAtlas.setTexture(e),this._updateBlendFunc()},visit:null,_visitForCanvas:function(e){var t=e||cc.renderContext;if(!this._visible)return;t.save(),this.transform(e);var n,r=this._children;if(r){this.sortAllChildren();for(n=0;n<r.length;n++)r[n]&&r[n].visit(t)}t.restore()},_visitForWebGL:function(e){var t=e||cc.renderContext;if(!this._visible)return;cc.kmGLPushMatrix();var n=this._grid;n&&n.isActive()&&(n.beforeDraw(),this.transformAncestors()),this.sortAllChildren(),this.transform(t),this.draw(t),n&&n.isActive()&&n.afterDraw(this),cc.kmGLPopMatrix(),this.setOrderOfArrival(0)},addChild:null,_addChildForCanvas:function(e,t,n){if(e==null)throw"cc.SpriteBatchNode.addChild(): child should be non-null";if(!(e instanceof cc.Sprite)){cc.log("cc.SpriteBatchNode.addChild(): cc.SpriteBatchNode only supports cc.Sprites as children");return}t=t==null?e.getZOrder():t,n=n==null?e.getTag():n,cc.Node.prototype.addChild.call(this,e,t,n),this.appendChild(e),this.setNodeDirty()},_addChildForWebGL:function(e,t,n){if(e==null)throw"cc.SpriteBatchNode.addChild(): child should be non-null";if(!(e instanceof cc.Sprite)){cc.log("cc.SpriteBatchNode.addChild(): cc.SpriteBatchNode only supports cc.Sprites as children");return}if(e.getTexture()!=this._textureAtlas.getTexture()){cc.log("cc.SpriteBatchNode.addChild(): cc.Sprite is not using the same texture");return}t=t==null?e.getZOrder():t,n=n==null?e.getTag():n,cc.Node.prototype.addChild.call(this,e,t,n),this.appendChild(e),this.setNodeDirty()},removeAllChildren:null,_removeAllChildrenForCanvas:function(e){var t=this._descendants;if(t&&t.length>0)for(var n=0,r=t.length;n<r;n++)t[n]&&t[n].setBatchNode(null);cc.Node.prototype.removeAllChildren.call(this,e),this._descendants.length=0},_removeAllChildrenForWebGL:function(e){var t=this._descendants;if(t&&t.length>0)for(var n=0,r=t.length;n<r;n++)t[n]&&t[n].setBatchNode(null);cc.Node.prototype.removeAllChildren.call(this,e),this._descendants.length=0,this._textureAtlas.removeAllQuads()},sortAllChildren:null,_sortAllChildrenForCanvas:function(){if(this._reorderChildDirty){var e,t=0,n=this._children,r=n.length,i;for(e=1;e<r;e++){var s=n[e];t=e-1,i=n[t];while(t>=0&&(s._zOrder<i._zOrder||s._zOrder==i._zOrder&&s._orderOfArrival<i._orderOfArrival))n[t+1]=i,t-=1,i=n[t];n[t+1]=s}n.length>0&&this._arrayMakeObjectsPerformSelector(n,cc.Node.StateCallbackType.sortAllChildren),this._reorderChildDirty=!1}},_sortAllChildrenForWebGL:function(){if(this._reorderChildDirty){var e=this._children,t,n=0,r=e.length,i;for(t=1;t<r;t++){var s=e[t];n=t-1,i=e[n];while(n>=0&&(s._zOrder<i._zOrder||s._zOrder==i._zOrder&&s._orderOfArrival<i._orderOfArrival))e[n+1]=i,n-=1,i=e[n];e[n+1]=s}if(e.length>0){this._arrayMakeObjectsPerformSelector(e,cc.Node.StateCallbackType.sortAllChildren);var o=0;for(t=0;t<e.length;t++)o=this._updateAtlasIndex(e[t],o)}this._reorderChildDirty=!1}},draw:null,_drawForWebGL:function(){if(this._textureAtlas.getTotalQuads()===0)return;this._shaderProgram.use(),this._shaderProgram.setUniformForModelViewAndProjectionMatrixWithMat4(),this._arrayMakeObjectsPerformSelector(this._children,cc.Node.StateCallbackType.updateTransform),cc.glBlendFunc(this._blendFunc.src,this._blendFunc.dst),this._textureAtlas.drawQuads()}}),cc.Browser.supportWebGL?(cc.SpriteBatchNode.prototype.ctor=cc.SpriteBatchNode.prototype._ctorForWebGL,cc.SpriteBatchNode.prototype.updateQuadFromSprite=cc.SpriteBatchNode.prototype._updateQuadFromSpriteForWebGL,cc.SpriteBatchNode.prototype.insertQuadFromSprite=cc.SpriteBatchNode.prototype._insertQuadFromSpriteForWebGL,cc.SpriteBatchNode.prototype.initWithTexture=cc.SpriteBatchNode.prototype._initWithTextureForWebGL,cc.SpriteBatchNode.prototype.appendChild=cc.SpriteBatchNode.prototype._appendChildForWebGL,cc.SpriteBatchNode.prototype.removeSpriteFromAtlas=cc.SpriteBatchNode.prototype._removeSpriteFromAtlasForWebGL,cc.SpriteBatchNode.prototype.getTexture=cc.SpriteBatchNode.prototype._getTextureForWebGL,cc.SpriteBatchNode.prototype.setTexture=cc.SpriteBatchNode.prototype._setTextureForWebGL,cc.SpriteBatchNode.prototype.visit=cc.SpriteBatchNode.prototype._visitForWebGL,cc.SpriteBatchNode.prototype.addChild=cc.SpriteBatchNode.prototype._addChildForWebGL,cc.SpriteBatchNode.prototype.removeAllChildren=cc.SpriteBatchNode.prototype._removeAllChildrenForWebGL,cc.SpriteBatchNode.prototype.sortAllChildren=cc.SpriteBatchNode.prototype._sortAllChildrenForWebGL,cc.SpriteBatchNode.prototype.draw=cc.SpriteBatchNode.prototype._drawForWebGL):(cc.SpriteBatchNode.prototype.ctor=cc.SpriteBatchNode.prototype._ctorForCanvas,cc.SpriteBatchNode.prototype.updateQuadFromSprite=cc.SpriteBatchNode.prototype._updateQuadFromSpriteForCanvas,cc.SpriteBatchNode.prototype.insertQuadFromSprite=cc.SpriteBatchNode.prototype._insertQuadFromSpriteForCanvas,cc.SpriteBatchNode.prototype.initWithTexture=cc.SpriteBatchNode.prototype._initWithTextureForCanvas,cc.SpriteBatchNode.prototype.appendChild=cc.SpriteBatchNode.prototype._appendChildForCanvas,cc.SpriteBatchNode.prototype.removeSpriteFromAtlas=cc.SpriteBatchNode.prototype._removeSpriteFromAtlasForCanvas,cc.SpriteBatchNode.prototype.getTexture=cc.SpriteBatchNode.prototype._getTextureForCanvas,cc.SpriteBatchNode.prototype.setTexture=cc.SpriteBatchNode.prototype._setTextureForCanvas,cc.SpriteBatchNode.prototype.visit=cc.SpriteBatchNode.prototype._visitForCanvas,cc.SpriteBatchNode.prototype.removeAllChildren=cc.SpriteBatchNode.prototype._removeAllChildrenForCanvas,cc.SpriteBatchNode.prototype.addChild=cc.SpriteBatchNode.prototype._addChildForCanvas,cc.SpriteBatchNode.prototype.sortAllChildren=cc.SpriteBatchNode.prototype._sortAllChildrenForCanvas,cc.SpriteBatchNode.prototype.draw=cc.Node.prototype.draw),cc.SpriteBatchNode.create=function(e,t){t=t||cc.DEFAULT_SPRITE_BATCH_CAPACITY;var n=new cc.SpriteBatchNode;return n.init(e,t),n},cc.SpriteBatchNode.createWithTexture=function(e,t){t=t||cc.DEFAULT_SPRITE_BATCH_CAPACITY;var n=new cc.SpriteBatchNode;return n.initWithTexture(e,t),n},cc.ConfigurationType={ConfigurationError:0,ConfigurationString:1,ConfigurationInt:2,ConfigurationDouble:3,ConfigurationBoolean:4},cc.Configuration=cc.Class.extend({_maxTextureSize:0,_maxModelviewStackDepth:0,_supportsPVRTC:!1,_supportsNPOT:!1,_supportsBGRA8888:!1,_supportsDiscardFramebuffer:!1,_supportsShareableVAO:!1,_maxSamplesAllowed:0,_maxTextureUnits:0,_GlExtensions:"",_valueDict:null,ctor:function(){this._maxTextureSize=0,this._maxModelviewStackDepth=0,this._supportsPVRTC=!1,this._supportsNPOT=!1,this._supportsBGRA8888=!1,this._supportsDiscardFramebuffer=!1,this._supportsShareableVAO=!1,this._maxSamplesAllowed=0,this._maxTextureUnits=0,this._GlExtensions="",this._valueDict={}},getMaxTextureSize:function(){return this._maxTextureSize},getMaxModelviewStackDepth:function(){return this._maxModelviewStackDepth},getMaxTextureUnits:function(){return this._maxTextureUnits},supportsNPOT:function(){return this._supportsNPOT},supportsPVRTC:function(){return this._supportsPVRTC},supportsBGRA8888:function(){return this._supportsBGRA8888},supportsDiscardFramebuffer:function(){return this._supportsDiscardFramebuffer},supportsShareableVAO:function(){return this._supportsShareableVAO},checkForGLExtension:function(e){return this._GlExtensions.indexOf(e)>-1},init:function(){var e=this._valueDict;return e["cocos2d.x.version"]=cc.ENGINE_VERSION,e["cocos2d.x.compiled_with_profiler"]=!1,e["cocos2d.x.compiled_with_gl_state_cache"]=cc.ENABLE_GL_STATE_CACHE,!0},getCString:function(e,t){var n=this._valueDict;return n[e]?n[e]:t},getBool:function(e,t){t==null&&(t=!1);var n=this._valueDict;return n[e]?n[e]:t},getNumber:function(e,t){t==null&&(t=0);var n=this._valueDict;return n[e]?n[e]:t},getObject:function(e){var t=this._valueDict;return t[e]?t[e]:null},setObject:function(e,t){this._valueDict[e]=t},dumpInfo:function(){cc.ENABLE_GL_STATE_CACHE===0&&(cc.log(""),cc.log("cocos2d: **** WARNING **** CC_ENABLE_PROFILERS is defined. Disable it when you finish profiling (from ccConfig.js)"),cc.log(""))},gatherGPUInfo:function(){if(cc.renderContextType===cc.CANVAS)return;var e=cc.renderContext,t=this._valueDict;t["gl.vendor"]=e.getParameter(e.VENDOR),t["gl.renderer"]=e.getParameter(e.RENDERER),t["gl.version"]=e.getParameter(e.VERSION),this._GlExtensions="";var n=e.getSupportedExtensions();for(var r=0;r<n.length;r++)this._GlExtensions+=n[r]+" ";this._maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),t["gl.max_texture_size"]=this._maxTextureSize,this._maxTextureUnits=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS),t["gl.max_texture_units"]=this._maxTextureUnits,this._supportsPVRTC=this.checkForGLExtension("GL_IMG_texture_compression_pvrtc"),t["gl.supports_PVRTC"]=this._supportsPVRTC,this._supportsNPOT=!1,t["gl.supports_NPOT"]=this._supportsNPOT,this._supportsBGRA8888=this.checkForGLExtension("GL_IMG_texture_format_BGRA888"),t["gl.supports_BGRA8888"]=this._supportsBGRA8888,this._supportsDiscardFramebuffer=this.checkForGLExtension("GL_EXT_discard_framebuffer"),t["gl.supports_discard_framebuffer"]=this._supportsDiscardFramebuffer,this._supportsShareableVAO=this.checkForGLExtension("vertex_array_object"),t["gl.supports_vertex_array_object"]=this._supportsShareableVAO,cc.CHECK_GL_ERROR_DEBUG()},loadConfigFile:function(e){var t=cc.FileUtils.getInstance(),n=t.fullPathForFilename(e),r=t.dictionaryWithContentsOfFileThreadSafe(n);if(r==null)return;var i=r.data;if(!i){cc.log("Expected 'data' dict, but not found. Config file: "+e);return}for(var s in i)this._valueDict[s]=i[s]}}),cc.Configuration._sharedConfiguration=null,cc.Configuration.getInstance=function(){return cc.Configuration._sharedConfiguration||(cc.Configuration._sharedConfiguration=new cc.Configuration,cc.Configuration._sharedConfiguration.init()),cc.Configuration._sharedConfiguration},cc.Configuration.purgeConfiguration=function(){cc.Configuration._sharedConfiguration=null},cc.g_NumberOfDraws=0,cc.DIRECTOR_PROJECTION_2D=0,cc.DIRECTOR_PROJECTION_3D=1,cc.DIRECTOR_PROJECTION_CUSTOM=3,cc.DIRECTOR_PROJECTION_DEFAULT=cc.DIRECTOR_PROJECTION_3D,cc.DEVICE_ORIENTATION_PORTRAIT=0,cc.DEVICE_ORIENTATION_LANDSCAPE_LEFT=1,cc.DEVICE_ORIENTATION_PORTRAIT_UPSIDE_DOWN=2,cc.DEVICE_ORIENTATION_LANDSCAPE_RIGHT=3,cc.DEVICE_MAX_ORIENTATIONS=2,cc.DirectorDelegate=cc.Class.extend({updateProjection:function(){}}),cc.GLToClipTransform=function(e){var t=new cc.kmMat4;cc.kmGLGetMatrix(cc.KM_GL_PROJECTION,t);var n=new cc.kmMat4;cc.kmGLGetMatrix(cc.KM_GL_MODELVIEW,n),cc.kmMat4Multiply(e,t,n)},cc.Director=cc.Class.extend({_landscape:!1,_nextDeltaTimeZero:!1,_paused:!1,_purgeDirecotorInNextLoop:!1,_sendCleanupToScene:!1,_animationInterval:0,_oldAnimationInterval:0,_projection:0,_accumDt:0,_contentScaleFactor:1,_displayStats:!1,_deltaTime:0,_frameRate:0,_FPSLabel:null,_SPFLabel:null,_drawsLabel:null,_winSizeInPoints:null,_lastUpdate:null,_nextScene:null,_notificationNode:null,_openGLView:null,_scenesStack:null,_projectionDelegate:null,_runningScene:null,_frames
:0,_totalFrames:0,_secondsPerFrame:0,_dirtyRegion:null,_scheduler:null,_actionManager:null,_touchDispatcher:null,_keyboardDispatcher:null,_accelerometer:null,_mouseDispatcher:null,_isBlur:!1,ctor:function(){this._lastUpdate=Date.now();if(!cc.isAddedHiddenEvent){var e=this;window.addEventListener("focus",function(){e._lastUpdate=Date.now()},!1)}},_resetLastUpdate:function(){this._lastUpdate=Date.now()},init:function(){return this._oldAnimationInterval=this._animationInterval=1/cc.defaultFPS,this._scenesStack=[],this._projection=cc.DIRECTOR_PROJECTION_DEFAULT,this._projectionDelegate=null,this._accumDt=0,this._frameRate=0,this._displayStats=!1,this._totalFrames=this._frames=0,this._lastUpdate=Date.now(),this._paused=!1,this._purgeDirecotorInNextLoop=!1,this._winSizeInPoints=cc._sizeConst(0,0),this._openGLView=null,this._contentScaleFactor=1,this._scheduler=new cc.Scheduler,this._actionManager=new cc.ActionManager,this._scheduler.scheduleUpdateForTarget(this._actionManager,cc.PRIORITY_SYSTEM,!1),cc.TouchDispatcher&&(this._touchDispatcher=new cc.TouchDispatcher,this._touchDispatcher.init()),cc.KeyboardDispatcher&&(this._keyboardDispatcher=cc.KeyboardDispatcher.getInstance()),cc.Accelerometer&&(this._accelerometer=new cc.Accelerometer),cc.MouseDispatcher&&(this._mouseDispatcher=new cc.MouseDispatcher,this._mouseDispatcher.init()),!0},calculateDeltaTime:function(){var e=Date.now();this._nextDeltaTimeZero?(this._deltaTime=0,this._nextDeltaTimeZero=!1):this._deltaTime=(e-this._lastUpdate)/1e3,cc.COCOS2D_DEBUG>0&&this._deltaTime>.2&&(this._deltaTime=1/60),this._lastUpdate=e},convertToGL:function(e){var t=new cc.kmMat4;cc.GLToClipTransform(t);var n=new cc.kmMat4;cc.kmMat4Inverse(n,t);var r=t.mat[14]/t.mat[15],i=this._openGLView.getDesignResolutionSize(),s=new cc.kmVec3(2*e.x/i.width-1,1-2*e.y/i.height,r),o=new cc.kmVec3;return cc.kmVec3TransformCoord(o,s,n),cc.p(o.x,o.y)},convertToUI:function(e){var t=new cc.kmMat4;cc.GLToClipTransform(t);var n=new cc.kmVec3,r=new cc.kmVec3(e.x,e.y,0);cc.kmVec3TransformCoord(n,r,t);var i=this._openGLView.getDesignResolutionSize();return cc.p(i.width*(n.x*.5+.5),i.height*(-n.y*.5+.5))},drawScene:function(){this.calculateDeltaTime(),this._paused||this._scheduler.update(this._deltaTime),this._clear(),this._nextScene&&this.setNextScene(),this._beforeVisitScene&&this._beforeVisitScene(),this._runningScene&&this._runningScene.visit(),this._notificationNode&&this._notificationNode.visit(),this._displayStats&&this._showStats(),this._afterVisitScene&&this._afterVisitScene(),this._totalFrames++,this._displayStats&&this._calculateMPF()},_clearCanvas:function(){var e=this._openGLView.getViewPortRect();cc.renderContext.clearRect(-e.x,e.y,e.width,-e.height)},_clearWebGL:function(){var e=cc.renderContext;e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)},_beforeVisitScene:null,_afterVisitScene:null,_beforeVisitSceneWebGL:function(){cc.kmGLPushMatrix()},_afterVisitSceneWebGL:function(){cc.kmGLPopMatrix()},end:function(){this._purgeDirecotorInNextLoop=!0},getContentScaleFactor:function(){return this._contentScaleFactor},getNotificationNode:function(){return this._notificationNode},getWinSize:function(){return this._winSizeInPoints},getWinSizeInPixels:function(){return cc.size(this._winSizeInPoints.width*this._contentScaleFactor,this._winSizeInPoints.height*this._contentScaleFactor)},getVisibleSize:function(){return this._openGLView?this._openGLView.getVisibleSize():this.getWinSize()},getVisibleOrigin:function(){return this._openGLView?this._openGLView.getVisibleOrigin():cc.POINT_ZERO},getZEye:function(){return this._winSizeInPoints.height/1.1566},pause:function(){if(this._paused)return;this._oldAnimationInterval=this._animationInterval,this.setAnimationInterval(.25),this._paused=!0},popScene:function(){if(!this._runningScene)throw"running scene should not null";this._scenesStack.pop();var e=this._scenesStack.length;e==0?this.end():(this._sendCleanupToScene=!0,this._nextScene=this._scenesStack[e-1])},purgeCachedData:function(){cc.LabelBMFont.purgeCachedData()},purgeDirector:function(){this.getScheduler().unscheduleAllCallbacks(),this._touchDispatcher&&this._touchDispatcher.removeAllDelegates(),this._runningScene&&(this._runningScene.onExitTransitionDidStart(),this._runningScene.onExit(),this._runningScene.cleanup()),this._runningScene=null,this._nextScene=null,this._scenesStack.length=0,this.stopAnimation(),cc.LabelBMFont.purgeCachedData(),cc.AnimationCache.purgeSharedAnimationCache(),cc.SpriteFrameCache.purgeSharedSpriteFrameCache(),cc.TextureCache.purgeSharedTextureCache(),cc.CHECK_GL_ERROR_DEBUG()},pushScene:function(e){if(!e)throw"the scene should not null";this._sendCleanupToScene=!1,this._scenesStack.push(e),this._nextScene=e},replaceScene:function(e){if(!this._runningScene)throw"Use runWithScene: instead to start the director";if(!e)throw"the scene should not be null";var t=this._scenesStack.length;t===0?(this._sendCleanupToScene=!0,this._scenesStack[t]=e,this._nextScene=e):(this._sendCleanupToScene=!0,this._scenesStack[t-1]=e,this._nextScene=e)},resume:function(){if(!this._paused)return;this.setAnimationInterval(this._oldAnimationInterval),this._lastUpdate=Date.now(),this._lastUpdate||cc.log("cocos2d: Director: Error in gettimeofday"),this._paused=!1,this._deltaTime=0},runWithScene:function(e){if(!e)throw"This command can only be used to start the CCDirector. There is already a scene present.";if(this._runningScene)throw"_runningScene should be null";this.pushScene(e),this.startAnimation()},setAlphaBlending:function(e){e?cc.glBlendFunc(cc.BLEND_SRC,cc.BLEND_DST):cc.glBlendFunc(cc.renderContext.ONE,cc.renderContext.ZERO)},setContentScaleFactor:function(e){e!=this._contentScaleFactor&&(this._contentScaleFactor=e,this._createStatsLabel())},setDepthTest:function(e){if(cc.renderContextType===cc.CANVAS)return;var t=cc.renderContext;e?(t.clearDepth(1),t.enable(t.DEPTH_TEST),t.depthFunc(t.LEQUAL)):t.disable(t.DEPTH_TEST)},setDefaultValues:function(){},setGLDefaultValues:function(){this.setAlphaBlending(!0),this.setDepthTest(!1),this.setProjection(this._projection),cc.renderContext.clearColor(0,0,0,1)},setNextDeltaTimeZero:function(e){this._nextDeltaTimeZero=e},setNextScene:function(){var e=!1,t=!1;cc.TransitionScene&&(e=this._runningScene?this._runningScene instanceof cc.TransitionScene:!1,t=this._nextScene?this._nextScene instanceof cc.TransitionScene:!1);if(!t){var n=this._runningScene;n&&(n.onExitTransitionDidStart(),n.onExit()),this._sendCleanupToScene&&n&&n.cleanup()}this._runningScene=this._nextScene,this._nextScene=null,!e&&this._runningScene!=null&&(this._runningScene.onEnter(),this._runningScene.onEnterTransitionDidFinish())},setNotificationNode:function(e){this._notificationNode=e},getDelegate:function(){return this._projectionDelegate},setDelegate:function(e){this._projectionDelegate=e},setOpenGLView:function(e){this._winSizeInPoints.setWidth(cc.canvas.width),this._winSizeInPoints.setHeight(cc.canvas.height),this._openGLView=e||cc.EGLView.getInstance();if(cc.renderContextType===cc.CANVAS)return;var t=cc.Configuration.getInstance();t.gatherGPUInfo(),t.dumpInfo(),this._createStatsLabel(),this.setGLDefaultValues(),this._touchDispatcher&&this._touchDispatcher.setDispatchEvents(!0)},setViewport:function(){if(this._openGLView){var e=this._winSizeInPoints;this._openGLView.setViewPortInPoints(0,0,e.width,e.height)}},setProjection:function(e){var t=this._winSizeInPoints;if(cc.renderContextType===cc.WEBGL){this.setViewport();switch(e){case cc.DIRECTOR_PROJECTION_2D:cc.kmGLMatrixMode(cc.KM_GL_PROJECTION),cc.kmGLLoadIdentity();var n=new cc.kmMat4;cc.kmMat4OrthographicProjection(n,0,t.width,0,t.height,-1024,1024),cc.kmGLMultMatrix(n),cc.kmGLMatrixMode(cc.KM_GL_MODELVIEW),cc.kmGLLoadIdentity();break;case cc.DIRECTOR_PROJECTION_3D:var r=this.getZEye(),i=new cc.kmMat4,s=new cc.kmMat4;cc.kmGLMatrixMode(cc.KM_GL_PROJECTION),cc.kmGLLoadIdentity(),cc.kmMat4PerspectiveProjection(i,60,t.width/t.height,.1,r*2),cc.kmGLMultMatrix(i),cc.kmGLMatrixMode(cc.KM_GL_MODELVIEW),cc.kmGLLoadIdentity();var o=cc.kmVec3Fill(null,t.width/2,t.height/2,r),u=cc.kmVec3Fill(null,t.width/2,t.height/2,0),a=cc.kmVec3Fill(null,0,1,0);cc.kmMat4LookAt(s,o,u,a),cc.kmGLMultMatrix(s);break;case cc.DIRECTOR_PROJECTION_CUSTOM:this._projectionDelegate&&this._projectionDelegate.updateProjection();break;default:cc.log("cocos2d: Director: unrecognized projection")}this._projection=e,cc.setProjectionMatrixDirty();return}this._projection=e},_showStats:function(){this._frames++,this._accumDt+=this._deltaTime,this._FPSLabel&&this._SPFLabel&&this._drawsLabel?(this._accumDt>cc.DIRECTOR_FPS_INTERVAL&&(this._SPFLabel.setString(this._secondsPerFrame.toFixed(3)),this._frameRate=this._frames/this._accumDt,this._frames=0,this._accumDt=0,this._FPSLabel.setString(this._frameRate.toFixed(1)),this._drawsLabel.setString((0|cc.g_NumberOfDraws).toString())),this._FPSLabel.visit(),this._SPFLabel.visit(),this._drawsLabel.visit()):this._createStatsLabel(),cc.g_NumberOfDraws=0},isSendCleanupToScene:function(){return this._sendCleanupToScene},getRunningScene:function(){return this._runningScene},getAnimationInterval:function(){return this._animationInterval},isDisplayStats:function(){return this._displayStats},setDisplayStats:function(e){this._displayStats=e},getSecondsPerFrame:function(){return this._secondsPerFrame},getOpenGLView:function(){return this._openGLView},isNextDeltaTimeZero:function(){return this._nextDeltaTimeZero},isPaused:function(){return this._paused},getTotalFrames:function(){return this._totalFrames},getProjection:function(){return this._projection},popToRootScene:function(){this.popToSceneStackLevel(1)},popToSceneStackLevel:function(e){if(!this._runningScene)throw"A running Scene is needed";var t=this._scenesStack,n=t.length;if(n==0){this.end();return}if(e>n)return;while(n>e){var r=t.pop();r.isRunning()&&(r.onExitTransitionDidStart(),r.onExit()),r.cleanup(),n--}this._nextScene=t[t.length-1],this._sendCleanupToScene=!1},getScheduler:function(){return this._scheduler},setScheduler:function(e){this._scheduler!=e&&(this._scheduler=e)},getActionManager:function(){return this._actionManager},setActionManager:function(e){this._actionManager!=e&&(this._actionManager=e)},getTouchDispatcher:function(){return this._touchDispatcher},setTouchDispatcher:function(e){this._touchDispatcher!=e&&(this._touchDispatcher=e)},getKeyboardDispatcher:function(){if(!cc.KeyboardDispatcher)throw"cc.KeyboardDispatcher is undefined, maybe it has been removed from js loading list.";return this._keyboardDispatcher},setKeyboardDispatcher:function(e){if(!cc.KeyboardDispatcher)throw"cc.KeyboardDispatcher is undefined, maybe it has been removed from js loading list.";this._keyboardDispatcher=e},getAccelerometer:function(){if(!cc.Accelerometer)throw"cc.Accelerometer is undefined, maybe it has been removed from js loading list.";return this._accelerometer},setAccelerometer:function(e){if(!cc.Accelerometer)throw"cc.Accelerometer is undefined, maybe it has been removed from js loading list.";this._accelerometer!=e&&(this._accelerometer=e)},getDeltaTime:function(){return this._deltaTime},getMouseDispatcher:function(){if(!cc.MouseDispatcher)throw"cc.MouseDispatcher is undefined, maybe it has been removed from js loading list.";return this._mouseDispatcher},setMouseDispatcher:function(e){if(!cc.MouseDispatcher)throw"cc.MouseDispatcher is undefined, maybe it has been removed from js loading list.";this._mouseDispatcher!=e&&(this._mouseDispatcher=e)},_createStatsLabel:null,_createStatsLabelForWebGL:function(){if(!cc.LabelAtlas)return this._createStatsLabelForCanvas();if(cc.Director._fpsImageLoaded==null||cc.Director._fpsImageLoaded==0)return;var e=new cc.Texture2D;e.initWithElement(cc.Director._fpsImage),e.handleLoadedTexture();var t=cc.EGLView.getInstance().getDesignResolutionSize().height/320;t===0&&(t=this._winSizeInPoints.height/320);var n=new cc.LabelAtlas;n._setIgnoreContentScaleFactor(!0),n.initWithString("00.0",e,12,32,"."),n.setScale(t),this._FPSLabel=n,n=new cc.LabelAtlas,n._setIgnoreContentScaleFactor(!0),n.initWithString("0.000",e,12,32,"."),n.setScale(t),this._SPFLabel=n,n=new cc.LabelAtlas,n._setIgnoreContentScaleFactor(!0),n.initWithString("000",e,12,32,"."),n.setScale(t),this._drawsLabel=n;var r=cc.DIRECTOR_STATS_POSITION;this._drawsLabel.setPosition(cc.pAdd(cc.p(0,34*t),r)),this._SPFLabel.setPosition(cc.pAdd(cc.p(0,17*t),r)),this._FPSLabel.setPosition(r)},_createStatsLabelForCanvas:function(){var e=0;this._winSizeInPoints.width>this._winSizeInPoints.height?e=0|this._winSizeInPoints.height/320*24:e=0|this._winSizeInPoints.width/320*24,this._FPSLabel=cc.LabelTTF.create("000.0","Arial",e),this._SPFLabel=cc.LabelTTF.create("0.000","Arial",e),this._drawsLabel=cc.LabelTTF.create("0000","Arial",e);var t=cc.DIRECTOR_STATS_POSITION,n=this._drawsLabel.getContentSize();this._drawsLabel.setPosition(cc.pAdd(cc.p(n.width/2,n.height*5/2),t)),n=this._SPFLabel.getContentSize(),this._SPFLabel.setPosition(cc.pAdd(cc.p(n.width/2,n.height*3/2),t)),n=this._FPSLabel.getContentSize(),this._FPSLabel.setPosition(cc.pAdd(cc.p(n.width/2,n.height/2),t))},_calculateMPF:function(){var e=Date.now();this._secondsPerFrame=(e-this._lastUpdate)/1e3}}),cc.Browser.supportWebGL?(cc.Director.prototype._clear=cc.Director.prototype._clearWebGL,cc.Director.prototype._beforeVisitScene=cc.Director.prototype._beforeVisitSceneWebGL,cc.Director.prototype._afterVisitScene=cc.Director.prototype._afterVisitSceneWebGL,cc.Director.prototype._createStatsLabel=cc.Director.prototype._createStatsLabelForWebGL):(cc.Director.prototype._clear=cc.Director.prototype._clearCanvas,cc.Director.prototype._createStatsLabel=cc.Director.prototype._createStatsLabelForCanvas),cc.DisplayLinkDirector=cc.Director.extend({invalid:!1,startAnimation:function(){this._nextDeltaTimeZero=!0,this.invalid=!1,cc.Application.getInstance().setAnimationInterval(this._animationInterval)},mainLoop:function(){this._purgeDirecotorInNextLoop?(this._purgeDirecotorInNextLoop=!1,this.purgeDirector()):this.invalid||this.drawScene()},stopAnimation:function(){this.invalid=!0},setAnimationInterval:function(e){this._animationInterval=e,this.invalid||(this.stopAnimation(),this.startAnimation())}}),cc.s_SharedDirector=null,cc.firstUseDirector=!0,cc.Director.getInstance=function(){return cc.firstUseDirector&&(cc.firstUseDirector=!1,cc.s_SharedDirector=new cc.DisplayLinkDirector,cc.s_SharedDirector.init(),cc.s_SharedDirector.setOpenGLView(cc.EGLView.getInstance())),cc.s_SharedDirector},Object.defineProperties(cc,{windowSize:{get:function(){return cc.director.getWinSize()},enumerable:!0}}),cc.firstRun=!0,cc.defaultFPS=60,cc.Director._fpsImage=new Image,cc.Director._fpsImage.addEventListener("load",function(){cc.Director._fpsImageLoaded=!0}),cc.Director._fpsImage.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAAgCAYAAAD9qabkAAAKQ2lDQ1BJQ0MgcHJvZmlsZQAAeNqdU3dYk/cWPt/3ZQ9WQtjwsZdsgQAiI6wIyBBZohCSAGGEEBJAxYWIClYUFRGcSFXEgtUKSJ2I4qAouGdBiohai1VcOO4f3Ke1fXrv7e371/u855zn/M55zw+AERImkeaiagA5UoU8Otgfj09IxMm9gAIVSOAEIBDmy8JnBcUAAPADeXh+dLA//AGvbwACAHDVLiQSx+H/g7pQJlcAIJEA4CIS5wsBkFIAyC5UyBQAyBgAsFOzZAoAlAAAbHl8QiIAqg0A7PRJPgUA2KmT3BcA2KIcqQgAjQEAmShHJAJAuwBgVYFSLALAwgCgrEAiLgTArgGAWbYyRwKAvQUAdo5YkA9AYACAmUIszAAgOAIAQx4TzQMgTAOgMNK/4KlfcIW4SAEAwMuVzZdL0jMUuJXQGnfy8ODiIeLCbLFCYRcpEGYJ5CKcl5sjE0jnA0zODAAAGvnRwf44P5Dn5uTh5mbnbO/0xaL+a/BvIj4h8d/+vIwCBAAQTs/v2l/l5dYDcMcBsHW/a6lbANpWAGjf+V0z2wmgWgrQevmLeTj8QB6eoVDIPB0cCgsL7SViob0w44s+/zPhb+CLfvb8QB7+23rwAHGaQJmtwKOD/XFhbnauUo7nywRCMW735yP+x4V//Y4p0eI0sVwsFYrxWIm4UCJNx3m5UpFEIcmV4hLpfzLxH5b9CZN3DQCshk/ATrYHtctswH7uAQKLDljSdgBAfvMtjBoLkQAQZzQyefcAAJO/+Y9AKwEAzZek4wAAvOgYXKiUF0zGCAAARKCBKrBBBwzBFKzADpzBHbzAFwJhBkRADCTAPBBCBuSAHAqhGJZBGVTAOtgEtbADGqARmuEQtMExOA3n4BJcgetwFwZgGJ7CGLyGCQRByAgTYSE6iBFijtgizggXmY4EImFINJKApCDpiBRRIsXIcqQCqUJqkV1II/ItchQ5jVxA+pDbyCAyivyKvEcxlIGyUQPUAnVAuagfGorGoHPRdDQPXYCWomvRGrQePYC2oqfRS+h1dAB9io5jgNExDmaM2WFcjIdFYIlYGibHFmPlWDVWjzVjHVg3dhUbwJ5h7wgkAouAE+wIXoQQwmyCkJBHWExYQ6gl7CO0EroIVwmDhDHCJyKTqE+0JXoS+cR4YjqxkFhGrCbuIR4hniVeJw4TX5NIJA7JkuROCiElkDJJC0lrSNtILaRTpD7SEGmcTCbrkG3J3uQIsoCsIJeRt5APkE+S+8nD5LcUOsWI4kwJoiRSpJQSSjVlP+UEpZ8yQpmgqlHNqZ7UCKqIOp9aSW2gdlAvU4epEzR1miXNmxZDy6Qto9XQmmlnafdoL+l0ugndgx5Fl9CX0mvoB+nn6YP0dwwNhg2Dx0hiKBlrGXsZpxi3GS+ZTKYF05eZyFQw1zIbmWeYD5hvVVgq9ip8FZHKEpU6lVaVfpXnqlRVc1U/1XmqC1SrVQ+rXlZ9pkZVs1DjqQnUFqvVqR1Vu6k2rs5Sd1KPUM9RX6O+X/2C+mMNsoaFRqCGSKNUY7fGGY0hFsYyZfFYQtZyVgPrLGuYTWJbsvnsTHYF+xt2L3tMU0NzqmasZpFmneZxzQEOxrHg8DnZnErOIc4NznstAy0/LbHWaq1mrX6tN9p62r7aYu1y7Rbt69rvdXCdQJ0snfU6bTr3dQm6NrpRuoW623XP6j7TY+t56Qn1yvUO6d3RR/Vt9KP1F+rv1u/RHzcwNAg2kBlsMThj8MyQY+hrmGm40fCE4agRy2i6kcRoo9FJoye4Ju6HZ+M1eBc+ZqxvHGKsNN5l3Gs8YWJpMtukxKTF5L4pzZRrmma60bTTdMzMyCzcrNisyeyOOdWca55hvtm82/yNhaVFnMVKizaLx5balnzLBZZNlvesmFY+VnlW9VbXrEnWXOss623WV2xQG1ebDJs6m8u2qK2brcR2m23fFOIUjynSKfVTbtox7PzsCuya7AbtOfZh9iX2bfbPHcwcEh3WO3Q7fHJ0dcx2bHC866ThNMOpxKnD6VdnG2ehc53zNRemS5DLEpd2lxdTbaeKp26fesuV5RruutK10/Wjm7ub3K3ZbdTdzD3Ffav7TS6bG8ldwz3vQfTw91jicczjnaebp8LzkOcvXnZeWV77vR5Ps5wmntYwbcjbxFvgvct7YDo+PWX6zukDPsY+Ap96n4e+pr4i3z2+I37Wfpl+B/ye+zv6y/2P+L/hefIW8U4FYAHBAeUBvYEagbMDawMfBJkEpQc1BY0FuwYvDD4VQgwJDVkfcpNvwBfyG/ljM9xnLJrRFcoInRVaG/owzCZMHtYRjobPCN8Qfm+m+UzpzLYIiOBHbIi4H2kZmRf5fRQpKjKqLupRtFN0cXT3LNas5Fn7Z72O8Y+pjLk722q2cnZnrGpsUmxj7Ju4gLiquIF4h/hF8ZcSdBMkCe2J5MTYxD2J43MC52yaM5zkmlSWdGOu5dyiuRfm6c7Lnnc8WTVZkHw4hZgSl7I/5YMgQlAvGE/lp25NHRPyhJuFT0W+oo2iUbG3uEo8kuadVpX2ON07fUP6aIZPRnXGMwlPUit5kRmSuSPzTVZE1t6sz9lx2S05lJyUnKNSDWmWtCvXMLcot09mKyuTDeR55m3KG5OHyvfkI/lz89sVbIVM0aO0Uq5QDhZML6greFsYW3i4SL1IWtQz32b+6vkjC4IWfL2QsFC4sLPYuHhZ8eAiv0W7FiOLUxd3LjFdUrpkeGnw0n3LaMuylv1Q4lhSVfJqedzyjlKD0qWlQyuCVzSVqZTJy26u9Fq5YxVhlWRV72qX1VtWfyoXlV+scKyorviwRrjm4ldOX9V89Xlt2treSrfK7etI66Trbqz3Wb+vSr1qQdXQhvANrRvxjeUbX21K3nShemr1js20zcrNAzVhNe1bzLas2/KhNqP2ep1/XctW/a2rt77ZJtrWv913e/MOgx0VO97vlOy8tSt4V2u9RX31btLugt2PGmIbur/mft24R3dPxZ6Pe6V7B/ZF7+tqdG9s3K+/v7IJbVI2jR5IOnDlm4Bv2pvtmne1cFoqDsJB5cEn36Z8e+NQ6KHOw9zDzd+Zf7f1COtIeSvSOr91rC2jbaA9ob3v6IyjnR1eHUe+t/9+7zHjY3XHNY9XnqCdKD3x+eSCk+OnZKeenU4/PdSZ3Hn3TPyZa11RXb1nQ8+ePxd07ky3X/fJ897nj13wvHD0Ivdi2yW3S609rj1HfnD94UivW2/rZffL7Vc8rnT0Tes70e/Tf/pqwNVz1/jXLl2feb3vxuwbt24m3Ry4Jbr1+Hb27Rd3Cu5M3F16j3iv/L7a/eoH+g/qf7T+sWXAbeD4YMBgz8NZD+8OCYee/pT/04fh0kfMR9UjRiONj50fHxsNGr3yZM6T4aeypxPPyn5W/3nrc6vn3/3i+0vPWPzY8Av5i8+/rnmp83Lvq6mvOscjxx+8znk98ab8rc7bfe+477rfx70fmSj8QP5Q89H6Y8en0E/3Pud8/vwv94Tz+4A5JREAAAAGYktHRAD/AP8A/6C9p5MAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAHdElNRQfcAgcQLxxUBNp/AAAQZ0lEQVR42u2be3QVVZbGv1N17829eRLyIKAEOiISEtPhJTJAYuyBDmhWjAEx4iAGBhxA4wABbVAMWUAeykMCM+HRTcBRWkNH2l5moS0LCCrQTkYeQWBQSCAIgYRXEpKbW/XNH5zS4noR7faPEeu31l0h4dSpvc+t/Z199jkFWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhY/H9D/MR9qfKnLj/00U71aqfJn9+HCkCR/Wk36ddsgyJ/1wF4fkDfqqm9/gPsUeTnVr6a2xlQfnxdI7zs0W7irzD17Ytb2WT7EeNv/r4ox1O3Quf2QP2pgt9utwfout4FQE8AVBSlnaRmfvAURQkg2RlAbwB9AThlW5L0GaiKojhJhgOIBqDa7XaPrusdPtr5kQwF0BVAAoBIABRCKDd5aFUhRDAAw57eAOwAhKIoupft3zoqhB1AqLwuHIBut9uFt02qqvqRDJR2dAEQJj/BAOjn56dqmma+xiaECAEQAWAggLsB6A6HQ2iaZggBhBAqgEAAnQB0kzaEmT4hAITT6VQ8Ho/HJAKKECJQtr8LwD1y/A1/vcdfEUIEyfZ9AcQbYvZ942Px88L2UwlJR0dH0EMPPbRj5syZPUeNGrXR7Xb/641xIwJ1XY9NSUlZm52dfW+XLl1w8uRJzJ8//+OGhoYJqqqe1TSt1Wsm9NN1PSIqKmr12rVrR5WUlHy1bdu2AQCumWc3IYRD1/UwVVXnFRQUTIuNjUVzczN2797dWFJSkq8oymZd15sAGAEnFEUJ1nX9nzIzM1dnZmZGh4SE4OTJk5g5c+Zf29vbp9pstrMej6fVOyhIhgAYU1hY+B+hoaGoqKg4XVlZea+XTULTNFdCQsLGiRMnPuR2u3UhBOV9eeDAAWXTpk095DUe6WsoyRE5OTlr0tLSAux2O/bs2cO5c+e+pijKUpIXSHaQVAGkvPLKK++6XK4OksJLCFlXV2cvKSlJBFAjhU+x2WwhHo9nUHp6+urMzMy7wsLCUF9fjxdffPHjxsbGiTab7WuPx9NiEutOuq4PyMjI+M+srKyYqKgoHD58GDNmzNjq8XhyVFU9b/q+LH7hBAEYu3PnTlZVVRFAGgCX6f/tAHoOHDjwa0p27txp/JO9e/f+QM7cipw9nfL3kQBKt2zZQpJ87rnn6mQmoHilw2EACs+cOUOSrK+vZ1NTE0nyo48+IoBpxswoBcMJ4Ndjx471kOTFixe5d+9ekqTH42H//v13A4jyzpAURfEH0H/OnDnthu1z5sw558MmFUCPWbNmnaMP3nrrLZoyDmP8Hl68eDFJ8siRI9/Yc+zYMQKYKdtAztrTrl27xptRXV1NAKMAOAyBBBA/Y8aMdpLs6Ojgxx9//E37+++//29yvFXppwvAwMcee8xjtDHsuXLlCqOjo//ia3wsfpkoALqFhoZuIckJEyackimm3dQmEMDUmpoakmRISMhhAHOHDx/eQJIbN24kgKEyMAHAFRMTs2XXrl1saWkhSZ0kp0+ffhrAr3wEW/S8efOukORLL72kA1gKYMPWrVtJkk899dRJAHeYrgsEsIQkjx8/TgDvAPjd448/3kaSb7zxBmUa7vC6z53BwcFbSHL9+vU6Sc6aNes8gF5ewWAH0PfVV18lSQL4DMBGIcQ6AKtcLleBFC2jXtFt8ODBe0iyoqKCAJYByC8qKmJDQwOzsrK+MAmqo1OnTveHhoa+GRkZ+XZkZOSWiIiIvzgcjk9mzpypkWRmZuZpmbYbGV4AgPnNzc1sa2sjgN0A5iQmJtaSZHl5OQHcb/K3s81mW0uSTU1NBFAFYFbfvn1Pk+Tbb79NAA8IIVzW42/hByA+Pz/fLR/2ZXIda05NI/z9/TeR5J49ewhgqlxTrtI0jY2NjQQw3zTLuWJiYjaUlJToS5Ys6fjkk080kwDEeAmADcA9GzZsIElGRUW9CyAWwLApU6Y0kOSKFSsog9QICGdERMTGsrIyZmVlEcC9AB4IDw/fTpLbtm0jgN94CUAnAJmVlZVcs2aNZ/LkyRdJcvbs2b4EwAkgZfPmzTxw4AABFAN4BkC6vFeUSewcAO5duXIlSTIhIaEawGMAxgKYAmAGgCS73e5vrKVk/yGythANYEhCQsIhkly+fDkBpKqqGmL6DgIALDKN/3yZpVWQZGVlJQE8aPI3KiMjo5okV61aRQAjAPQBMPfIkSN0u90EUCBtsPiFEwpgbn19PdetW2fM5N4zQ9ekpKQqkty0aRMBpMjiWM6JEydIkoqirJUFJ6iq6pAPVy8A6cZMehMBUACEuVyuFwG8HBwcPEIWx367ZMkSjSQXLVrUJouTRorrkAHdA8BdQogsAOsKCwtJkmPGjDkvMw2bDDo/ADEjRoz4XylyFbm5uY0mAbjLyyZ/AOOrq6tZVlbWsWDBgo69e/eyoqKCgwcPPg4gSQaoIRbp27dvN7KF+tLSUr28vJwFBQXtMpvpYRIM7+wrAkDeqVOnePbsWQIoNKfzpiXPg8uXLydJJicnNwF4f+nSpW6STEtLq5fjYwhk1wkTJtSQ5Ouvv04AqTKj+N2xY8dIkgEBAW/Ie1v8wncRegwZMmQvSfbr12+3Ua33WqPfOWbMmP0kWVpaSgCDZAqcfejQIWNZsEGKgvnh9gfQb9myZd8nAEJVVZtMkUNk8CcNHTq0liR1XWdYWNhmH1mJIme80OnTp18x1rp5eXkEsNJms92Fb7e/IgEsvHz5Mp999tkmAI/l5uZeMC0B7vEqqAYAyL106RJJsra2lpWVld+sucePH38ZQG+5NncBeOrgwYMkqbe3t/Po0aOsra011wAWyl0H7x0JJ4DE+fPnu0kyPT29DsDdUrBuyNKEEAkAdpw/f/6GeoEM8GUmfwEgPCIiopwkGxsbabPZPgOw6L777vvm4p49e26VGYjFLxUhhD+ApLKyMp44ccIoVnXybgbgzkcfffRzklyzZg0BDJYCMMmoCwQFBXkLgLGWvvcWAgBToSsKwNPTp09vMR7UuLi4rwH0lgU8c/Db5ezbeeTIkRWzZ8++aMxu+fn5BPCADBwHgP4LFy701NXVEUAJgAnPP/98kyxMNgHo53A4zH77BQQETMvPz7+Um5vbBuAlAFMSExPPmdbVL0qh8Acw8fDhw5SCchVAEYAVb775JknyhRdeaJYztHfxMwLAaqNwCGC2FArv8x0hAHKNLGPKlCme5OTk/Zs3bzb7O0wKiiG8KXl5ed8IxenTp0mSR48e1UmyW7duWywBuD2xyQcgFECgoih+8H1gyJgZV5Lkyy+/3CbTRIePtl2HDBmyw1QBHyGDdXZdXR1JUghRKkXBjOMHCoBdpr0L3nvvPZLkF198wejo6O0A4lVVDTb74HQ6AwD8Wq7Jh8rgGgDgQ13XjVR8qaxJuADMbmlpYXl5uV5UVNRWUFDgfv/993Vj/ZydnU1c37eHXML4S3viAcQqitJD2l104cIFY8lTKsXSBWBMVVWVcd9yed2A1NTUQ6Zl00CvLMMOoHdubm6zFIlWOf5+PsY/Kj09vdrU11QAwwGsv3jxIk21m2DZr10I0RXAuAcffPBgaWkpV69eTYfDcdiwUxY0w6xw+flX8L1xApjevXv3lREREaW6rofB93aPDUDQpEmTMgHgtddeqwBwEd/utZvpqK6uPgEAcXFxkA94NwB9unfvjrNnz4LklwDcf08iIqv66Zs2bXrl4YcfxooVKxAbG7uqrq5uAYA2TdOEqqpGYIi2tjbl6aeffu/YsWPv5uTk7JaC1wHg4Pnz542MwoVvTx+21dbWYvjw4WLixIl+2dnZ9lGjRgmSTE1NRUpKCkwFTGiaxtTU1OXTpk3707Bhw/6g67pDipnT4biuj7qut+Lbk3Vf1tTUXI9qu91Pjq1QFEUBgJaWFgBo8yGOQ8eNGxcAAOvXr/8QwBUfYygAKL169eoCABcuXACAWtn2hOGv0+kMNO1KiPDw8F4A4rZv3/7R1KlTR0+bNu1ht9u9r1+/fqitrQXJgwDarRC6/QjPzs4+QJIffPCB9/aQmSAA43ft2mW0e1QGoi8CAPyLsZccExNTC2BlRkbGRdOyYJCP2csBIN6UAZzCd7cBbQCijYp/dXU1ExMTz6SmptaMHj36f9LS0vYlJCRsl6mxIWSdu3fv/g5J7t+/nwC2AShMTk6+SJKff/45AWRLYbD7+fndAeDf5BJnLoCCyZMnt5JkdnZ2C4B/F0KEm1Pu+Pj4rST55ZdfEsBWAK+mpaVdMo3raDn7KwDuSEpK+m+S3LBhAwG8DuCtHTt2UBbpjgC408vvcFVV15HkuXPnjMp+p5uMf0RcXNyHJNnQ0EBVVfcCWBQXF3fG+Jv0yxABPwB5LS0tRmFxN4BlTzzxxGWSXLx4sS5F3GGFy+1Hp5SUlJq6ujoWFxdTpsZ2H+0iIyMj/0iSWVlZX5mr5jfJFroPGzasxlhTnjp1iiTZ3NxMl8tlrCd9pfa9SkpKSJI5OTmnZOageLUZZqxvfVFWVkZcPwdgNwnSCKPqb17jkmR8fPzfZMDZ5CRsFBmNI7h95s2b1yhT7/MAYmStwCx4vy0uLqa3v5qmEcCfvSr1QQAeXb16NY3Cm3HQ55133iGAp+SxZTNhKSkpfzUddkrFjYevzAQCeGjp0qXfsYckY2NjTwD4leGDLCL2HTdunNtoY+zWSHFcIHdsFCtcfuZ1vO9Eqs3m7/F47sb1k2qX/f3997W2tl7BjWfpBYDOzzzzzIVJkyZh0KBBCwEsB3AJvl9AETabLcDj8dwRFRW1ctasWb8JCgpSzp07d62wsPC/Wltb8xRFadR1/ZqPXYbgAQMGbI2Pjw/+6quv9ldVVT0r01ezuPRJSUn5Y9euXXVd11WzDaqq6kePHm3+7LPPRgO4KlNuxWazhXo8nuTk5OSXMjIyEl0uFxoaGtqKior+dPXq1VdUVT0jj7r68ieoT58+vx8yZMjdx48fP1JVVTVF9m20VW02WyfZf97YsWPjXS4X6urqWvPy8jYCWCyEuEDS8FdVFKWzruv//OSTTy5OTk7uqWkaPv3007qysrJ8RVH+LI8ym8/rB3Tu3HnRI488knLo0KG2ffv2ZQI4C98vP6mqqoZqmpaclpa2cOTIkX39/f3R0NDQUVxc/G5TU9PLqqrWa5rWLH1QVFUN0TStX1JSUvH48eP7BwYG4uDBg1cKCgpeBbBe2u+2Qug2EwD5N5sMPuNtMe8XP4TT6Qxoa2sbIGeXvUKIK7d4IISiKC5d1wPljOfA9bPwzYqiXNV13dd6Uqiq6qdpml2mpe02m63d4/G4vcTF5fF47LJf71nJA6BZVVW3pmntuPHlmAD5wk6Q9NnbHp9vHaqq6tA0zU/64PZhk1FfCZB9G/23ALiqKEqzD39tpvbGUqoFwFUhRLP3yzpCCDtJpxyXDulfG27+pqRR3DXsUWVd4Yq0x/taVQjhIhksC8L+ABpM9ljBf5sKwI8pIBr75L5E4vvu+UNeG/a+hv+AL7yFH8qPtOfHjtOP6V/Bja8D6z/B2Nys/1u9Xv33tLf4GfF/LC4GCJwByWIAAAAASUVORK5CYII=",cc.Camera=cc.Class.extend({_eyeX:null,_eyeY:null,_eyeZ:null,_centerX:null,_centerY:null,_centerZ:null,_upX:null,_upY:null,_upZ:null,_dirty:null,_lookupMatrix:null,ctor:function(){this._lookupMatrix=new cc.kmMat4,this.restore()},description:function(){return"<CCCamera | center =("+this._centerX+","+this._centerY+","+this._centerZ+")>"},setDirty:function(e){this._dirty=e},isDirty:function(){return this._dirty},restore:function(){this._eyeX=this._eyeY=0,this._eyeZ=cc.Camera.getZEye(),this._centerX=this._centerY=this._centerZ=0,this._upX=0,this._upY=1,this._upZ=0,cc.kmMat4Identity(this._lookupMatrix),this._dirty=!1},locate:function(){if(this._dirty){var e=new cc.kmVec3,t=new cc.kmVec3,n=new cc.kmVec3;cc.kmVec3Fill(e,this._eyeX,this._eyeY,this._eyeZ),cc.kmVec3Fill(t,this._centerX,this._centerY,this._centerZ),cc.kmVec3Fill(n,this._upX,this._upY,this._upZ),cc.kmMat4LookAt(this._lookupMatrix,e,t,n),this._dirty=!1}cc.kmGLMultMatrix(this._lookupMatrix)},setEyeXYZ:function(e,t,n){this.setEye(e,t,n)},setEye:function(e,t,n){this._eyeX=e,this._eyeY=t,this._eyeZ=n,this._dirty=!0},setCenterXYZ:function(e,t,n){this.setCenter(e,t,n)},setCenter:function(e,t,n){this._centerX=e,this._centerY=t,this._centerZ=n,this._dirty=!0},setUpXYZ:function(e,t,n){this.setUp(e,t,n)},setUp:function(e,t,n){this._upX=e,this._upY=t,this._upZ=n,this._dirty=!0},getEyeXYZ:function(e,t,n){return{x:this._eyeX,y:this._eyeY,z:this._eyeZ}},getEye:function(){return{x:this._eyeX,y:this._eyeY,z:this._eyeZ}},getCenterXYZ:function(e,t,n){return{x:this._centerX,y:this._centerY,z:this._centerZ}},getCenter:function(){return{x:this._centerX,y:this._centerY,z:this._centerZ}},getUpXYZ:function(e,t,n){return{x:this._upX,y:this._upY,z:this._upZ}},getUp:function(){return{x:this._upX,y:this._upY,z:this._upZ}},_DISALLOW_COPY_AND_ASSIGN:function(e){}}),cc.Camera.getZEye=function(){return cc.FLT_EPSILON},cc.PRIORITY_SYSTEM=-2147483648,cc.PRIORITY_NON_SYSTEM=cc.PRIORITY_SYSTEM+1,cc.ArrayVerifyType=function(e,t){if(e&&e.length>0)for(var n=0;n<e.length;n++)if(!(e[n]instanceof t))return cc.log("element type is wrong!"),!1;return!0},cc.ArrayRemoveObjectAtIndex=function(e,t){e.splice(t,1)},cc.ArrayRemoveObject=function(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]==t){e.splice(n,1);break}},cc.ArrayRemoveArray=function(e,t){for(var n=0,r=t.length;n<r;n++)cc.ArrayRemoveObject(e,t[n])},cc.ArrayGetIndexOfValue=function(e,t){return e.indexOf(t)},cc.ArrayAppendObject=function(e,t){e.push(t)},cc.ArrayAppendObjectToIndex=function(e,t,n){return e.splice(n,0,t),e},cc.ArrayAppendObjectsToIndex=function(e,t,n){return e.splice.apply(e,[n,0].concat(t)),e},cc.ArrayGetIndexOfObject=function(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]==t)return n;return-1},cc.ArrayContainsObject=function(e,t){return e.indexOf(t)!=-1},cc.HASH_FIND_INT=function(e,t){if(e==null)return null;for(var n=0;n<e.length;n++)if(e[n].target===t)return e[n];return null},cc.ListEntry=function(e,t,n,r,i,s){this.prev=e,this.next=t,this.target=n,this.priority=r,this.paused=i,this.markedForDeletion=s},cc.HashUpdateEntry=function(e,t,n,r){this.list=e,this.entry=t,this.target=n,this.hh=r},cc.HashTimerEntry=function(e,t,n,r,i,s,o){this.timers=e,this.target=t,this.timerIndex=n,this.currentTimer=r,this.currentTimerSalvaged=i,this.paused=s,this.hh=o},cc.Timer=cc.Class.extend({_interval:0,_selector:null,_target:null,_elapsed:0,_runForever:!1,_useDelay:!1,_timesExecuted:0,_repeat:0,_delay:0,ctor:function(){},getInterval:function(){return this._interval},setInterval:function(e){},getSelector:function(){return this._selector},initWithTarget:function(e,t,n,r,i){return this._target=e,this._selector=t,this._elapsed=-1,this._interval=n||0,this._delay=i||0,this._useDelay=this._delay>0,this._repeat=r==null?cc.REPEAT_FOREVER:r,this._runForever=this._repeat==cc.REPEAT_FOREVER,!0},_callSelector:function(){cc.doCallback(this._selector,this._target,this._elapsed)},update:function(e){if(this._elapsed==-1)this._elapsed=0,this._timesExecuted=0;else{var t=this._target,n=this._selector;this._runForever&&!this._useDelay?(this._elapsed+=e,this._elapsed>=this._interval&&(t&&n&&this._callSelector(),this._elapsed=0)):(this._elapsed+=e,this._useDelay?this._elapsed>=this._delay&&(t&&n&&this._callSelector(),this._elapsed=this._elapsed-this._delay,this._timesExecuted+=1,this._useDelay=!1):this._elapsed>=this._interval&&(t&&n&&this._callSelector(),this._elapsed=0,this._timesExecuted+=1),this._timesExecuted>this._repeat&&cc.Director.getInstance().getScheduler().unscheduleCallbackForTarget(t,n))}}}),cc.Timer.timerWithTarget=function(e,t,n){if(arguments.length<2)throw new Error("timerWithTarget'argument can't is null");var r=new cc.Timer;return n=n||0,r.initWithTarget(e,t,n,cc.REPEAT_FOREVER,0),r},cc._sharedScheduler=null,cc.Scheduler=cc.Class.extend({_timeScale:1,_updatesNegList:null,_updates0List:null,_updatesPosList:null,_hashForUpdates:null,_arrayForUpdates:null,_hashForTimers:null,_arrayForTimes:null,_currentTarget:null,_currentTargetSalvaged:!1,_updateHashLocked:!1,ctor:function(){this._timeScale=1,this._updatesNegList=[],this._updates0List=[],this._updatesPosList=[],this._hashForUpdates={},this._arrayForUpdates=[],this._hashForTimers={},this._arrayForTimers=[],this._currentTarget=null,this._currentTargetSalvaged=!1,this._updateHashLocked=!1},_removeHashElement:function(e){delete this._hashForTimers[e.target.__instanceId],cc.ArrayRemoveObject(this._arrayForTimers,e),e.Timer=null,e.target=null,e=null},_findElementFromArray:function(e,t){for(var n=0;n<e.length;n++)if(e[n].target==t)return e[n];return null},_removeUpdateFromHash:function(e){var t=this._hashForUpdates[e.target.__instanceId];t&&(cc.ArrayRemoveObject(t.list,t.entry),delete this._hashForUpdates[t.target.__instanceId],cc.ArrayRemoveObject(this._arrayForUpdates,t),t.entry=null,t.target=null)},_priorityIn:function(e,t,n,r){var i=new cc.ListEntry(null,null,t,n,r,!1);if(!e)e=[],e.push(i);else{var s=!1;for(var o=0;o<e.length;o++)if(n<e[o].priority){e=cc.ArrayAppendObjectToIndex(e,i,o),s=!0;break}s||e.push(i)}var u=new cc.HashUpdateEntry(e,i,t,null);return this._arrayForUpdates.push(u),this._hashForUpdates[t.__instanceId]=u,e},_appendIn:function(e,t,n){var r=new cc.ListEntry(null,null,t,0,n,!1);e.push(r);var i=new cc.HashUpdateEntry(e,r,t,null);this._arrayForUpdates.push(i),this._hashForUpdates[t.__instanceId]=i},setTimeScale:function(e){this._timeScale=e},getTimeScale:function(){return this._timeScale},update:function(e){this._updateHashLocked=!0,this._timeScale!=1&&(e*=this._timeScale);var t,n;for(n=0;n<this._updatesNegList.length;n++)t=this._updatesNegList[n],!t.paused&&!t.markedForDeletion&&t.target.update(e);for(n=0;n<this._updates0List.length;n++)t=this._updates0List[n],!t.paused&&!t.markedForDeletion&&t.target.update(e);for(n=0;n<this._updatesPosList.length;n++)t=this._updatesPosList[n],!t.paused&&!t.markedForDeletion&&t.target.update(e);var r;for(n=0;n<this._arrayForTimers.length;n++){this._currentTarget=this._arrayForTimers[n],r=this._currentTarget,this._currentTargetSalvaged=!1;if(!this._currentTarget.paused)for(r.timerIndex=0;r.timerIndex<r.timers.length;r.timerIndex++)r.currentTimer=r.timers[r.timerIndex],r.currentTimerSalvaged=!1,r.currentTimer.update(e),r.currentTimer=null;this._currentTargetSalvaged&&this._currentTarget.timers.length==0&&this._removeHashElement(this._currentTarget)}for(n=0;n<this._updatesNegList.length;n++)this._updatesNegList[n].markedForDeletion&&this._removeUpdateFromHash(this._updatesNegList[n]);for(n=0;n<this._updates0List.length;n++)this._updates0List[n].markedForDeletion&&this._removeUpdateFromHash(this._updates0List[n]);for(n=0;n<this._updatesPosList.length;n++)this._updatesPosList[n].markedForDeletion&&this._removeUpdateFromHash(this._updatesPosList[n]);this._updateHashLocked=!1,this._currentTarget=null},scheduleCallbackForTarget:function(e,t,n,r,i,s){if(!t)throw"cc.scheduler.scheduleCallbackForTarget(): callback_fn should be non-null.";if(!e)throw"cc.scheduler.scheduleCallbackForTarget(): target should be non-null.";n=n||0,r=r==null?cc.REPEAT_FOREVER:r,i=i||0,s=s||!1;var o=this._hashForTimers[e.__instanceId];o||(o=new cc.HashTimerEntry(null,e,0,null,null,s,null),this._arrayForTimers.push(o),this._hashForTimers[e.__instanceId]=o);var u;if(o.timers==null)o.timers=[];else for(var a=0;a<o.timers.length;a++){u=o.timers[a];if(t==u._selector){cc.log("CCSheduler#scheduleCallback. Callback already scheduled. Updating interval from:"+u.getInterval().toFixed(4)+" to "+n.toFixed(4)),u._interval=n;return}}u=new cc.Timer,u.initWithTarget(e,t,n,r,i),o.timers.push(u)},scheduleUpdateForTarget:function(e,t,n){var r=this._hashForUpdates[e.__instanceId];if(r){r.entry.markedForDeletion=!1;return}t==0?this._appendIn(this
._updates0List,e,n):t<0?this._updatesNegList=this._priorityIn(this._updatesNegList,e,t,n):this._updatesPosList=this._priorityIn(this._updatesPosList,e,t,n)},unscheduleCallbackForTarget:function(e,t){if(e==null||t==null)return;var n=this._hashForTimers[e.__instanceId];if(n!=null)for(var r=0;r<n.timers.length;r++){var i=n.timers[r];if(t==i._selector){i==n.currentTimer&&!n.currentTimerSalvaged&&(n.currentTimerSalvaged=!0),cc.ArrayRemoveObjectAtIndex(n.timers,r),n.timerIndex>=r&&n.timerIndex--,n.timers.length==0&&(this._currentTarget==n?this._currentTargetSalvaged=!0:this._removeHashElement(n));return}}},unscheduleUpdateForTarget:function(e){if(e==null)return;var t=this._hashForUpdates[e.__instanceId];t!=null&&(this._updateHashLocked?t.entry.markedForDeletion=!0:this._removeUpdateFromHash(t.entry))},unscheduleAllCallbacksForTarget:function(e){if(e==null)return;var t=this._hashForTimers[e.__instanceId];t&&(!t.currentTimerSalvaged&&cc.ArrayContainsObject(t.timers,t.currentTimer)&&(t.currentTimerSalvaged=!0),t.timers.length=0,this._currentTarget==t?this._currentTargetSalvaged=!0:this._removeHashElement(t)),this.unscheduleUpdateForTarget(e)},unscheduleAllCallbacks:function(){this.unscheduleAllCallbacksWithMinPriority(cc.PRIORITY_SYSTEM)},unscheduleAllCallbacksWithMinPriority:function(e){var t;for(t=0;t<this._arrayForTimers.length;t++)this.unscheduleAllCallbacksForTarget(this._arrayForTimers[t].target);if(e<0)for(t=0;t<this._updatesNegList.length;t++)this.unscheduleUpdateForTarget(this._updatesNegList[t].target);if(e<=0)for(t=0;t<this._updates0List.length;t++)this.unscheduleUpdateForTarget(this._updates0List[t].target);for(t=0;t<this._updatesPosList.length;t++)this._updatesPosList[t].priority>=e&&this.unscheduleUpdateForTarget(this._updatesPosList[t].target)},pauseAllTargets:function(){return this.pauseAllTargetsWithMinPriority(cc.PRIORITY_SYSTEM)},pauseAllTargetsWithMinPriority:function(e){var t=[],n,r;for(n=0;n<this._arrayForTimers.length;n++)r=this._arrayForTimers[n],r&&(r.paused=!0,t.push(r.target));if(e<0)for(n=0;n<this._updatesNegList.length;n++)r=this._updatesNegList[n],r&&(r.paused=!0,t.push(r.target));if(e<=0)for(n=0;n<this._updates0List.length;n++)r=this._updates0List[n],r&&(r.paused=!0,t.push(r.target));for(n=0;n<this._updatesPosList.length;n++)r=this._updatesPosList[n],r&&(r.paused=!0,t.push(r.target));return t},resumeTargets:function(e){if(!e)return;for(var t=0;t<e.length;t++)this.resumeTarget(e[t])},pauseTarget:function(e){if(!e)throw"cc.Scheduler.pauseTarget():target should be non-null";var t=this._hashForTimers[e.__instanceId];t&&(t.paused=!0);var n=this._hashForUpdates[e.__instanceId];n&&(n.entry.paused=!0)},resumeTarget:function(e){if(!e)throw"cc.Scheduler.resumeTarget():target should be non-null";var t=this._hashForTimers[e.__instanceId];t&&(t.paused=!1);var n=this._hashForUpdates[e.__instanceId];n&&(n.entry.paused=!1)},isTargetPaused:function(e){if(!e)throw"cc.Scheduler.isTargetPaused():target should be non-null";var t=this._hashForTimers[e.__instanceId];return t?t.paused:!1}}),cc.RESOURCE_TYPE={IMAGE:["png","jpg","bmp","jpeg","gif"],SOUND:["mp3","ogg","wav","mp4","m4a"],XML:["plist","xml","fnt","tmx","tsx"],BINARY:["ccbi"],FONT:"FONT",TEXT:["txt","vsh","fsh","json","ExportJson"],UNKNOW:[]},cc.ResData=function(e,t,n){this.resList=e||[],this.selector=t,this.target=n,this.curNumber=0,this.loadedNumber=0,this.totalNumber=this.resList.length},cc.Loader=cc.Class.extend({_curData:null,_resQueue:null,_isAsync:!1,_scheduler:null,_running:!1,_regisiterLoader:!1,ctor:function(){this._scheduler=cc.Director.getInstance().getScheduler(),this._resQueue=[]},initWithResources:function(e,t,n){if(!e){cc.log("cocos2d:resources should not null");return}var r=e.concat([]),i=new cc.ResData(r,t,n);this._resQueue.push(i),this._running||(this._running=!0,this._curData=this._resQueue.shift(),this._scheduler.scheduleUpdateForTarget(this))},setAsync:function(e){this._isAsync=e},onResLoaded:function(e){e!=null&&cc.log("cocos2d:Failed loading resource: "+e),this._curData.loadedNumber++},getPercentage:function(){var e=0,t=this._curData;return t.totalNumber==0?e=100:e=0|t.loadedNumber/t.totalNumber*100,e},releaseResources:function(e){if(e&&e.length>0){var t=cc.TextureCache.getInstance(),n=cc.AudioEngine?cc.AudioEngine.getInstance():null,r=cc.SAXParser.getInstance(),i=cc.FileUtils.getInstance(),s,o,u;for(var a=0;a<e.length;a++){s=e[a],o=typeof s=="string"?s:s.src,u=this._getResType(s,o);switch(u){case"IMAGE":t.removeTextureForKey(o);break;case"SOUND":if(!n)throw"Can not find AudioEngine! Install it, please.";n.unloadEffect(o);break;case"XML":r.unloadPlist(o);break;case"BINARY":i.unloadBinaryFileData(o);break;case"TEXT":i.unloadTextFileData(o);break;case"FONT":this._unregisterFaceFont(s);break;default:throw"cocos2d:unknown filename extension: "+u}}}},update:function(){if(this._isAsync){var e=cc.Director.getInstance()._frameRate;if(e!=null&&e<20){cc.log("cocos2d: frame rate less than 20 fps, skip frame.");return}}var t=this._curData;t&&t.curNumber<t.totalNumber&&(this._loadRes(),t.curNumber++);var n=this.getPercentage();n>=100&&(this._complete(),this._resQueue.length>0?(this._running=!0,this._curData=this._resQueue.shift()):(this._running=!1,this._scheduler.unscheduleUpdateForTarget(this)))},_loadRes:function(){var e=cc.TextureCache.getInstance(),t=cc.AudioEngine?cc.AudioEngine.getInstance():null,n=cc.SAXParser.getInstance(),r=cc.FileUtils.getInstance(),i=this._curData.resList.shift(),s=this._getResPath(i),o=this._getResType(i,s);switch(o){case"IMAGE":e.addImageAsync(s,this.onResLoaded,this);break;case"SOUND":if(!t)throw"Can not find AudioEngine! Install it, please.";t.preloadSound(s,this.onResLoaded,this);break;case"XML":n.preloadPlist(s,this.onResLoaded,this);break;case"BINARY":r.preloadBinaryFileData(s,this.onResLoaded,this);break;case"TEXT":r.preloadTextFileData(s,this.onResLoaded,this);break;case"FONT":this._registerFaceFont(i,this.onResLoaded,this);break;default:throw"cocos2d:unknown filename extension: "+o}},_getResPath:function(e){return typeof e=="string"?e:e.src},_getResType:function(e,t){var n=e.fontName;if(n!=null)return cc.RESOURCE_TYPE.FONT;var r=t.substring(t.lastIndexOf(".")+1,t.length),i=r.indexOf("?");i>0&&(r=r.substring(0,i));for(var s in cc.RESOURCE_TYPE)if(cc.RESOURCE_TYPE[s].indexOf(r)!=-1)return s;return r},_complete:function(){cc.doCallback(this._curData.selector,this._curData.target)},_registerFaceFont:function(e,t,n){var r=e.src,i=cc.FileUtils.getInstance();if(r&&r.length>0){var s=document.createElement("style");s.type="text/css",document.body.appendChild(s);var o="@font-face { font-family:"+e.fontName+"; src:";for(var u=0;u<r.length;u++)o+="url('"+i.fullPathForFilename(encodeURI(r[u].src))+"') format('"+r[u].type+"')",o+=u==r.length-1?";":",";s.textContent+=o+"};";var a=document.createElement("div");a.style.fontFamily=e.fontName,a.innerHTML=".",a.style.position="absolute",a.style.left="-100px",a.style.top="-100px",document.body.appendChild(a)}cc.doCallback(t,n)},_unregisterFaceFont:function(e){}}),cc.Loader.preload=function(e,t,n){return this._instance||(this._instance=new cc.Loader),this._instance.initWithResources(e,t,n),this._instance},cc.Loader.preloadAsync=function(e,t,n){return this._instance||(this._instance=new cc.Loader),this._instance.setAsync(!0),this._instance.initWithResources(e,t,n),this._instance},cc.Loader.purgeCachedData=function(e){this._instance&&this._instance.releaseResources(e)},cc.Loader.getInstance=function(){return this._instance||(this._instance=new cc.Loader),this._instance},cc.Loader._instance=null,cc.LoaderScene=cc.Scene.extend({_logo:null,_logoTexture:null,_texture2d:null,_bgLayer:null,_label:null,_winSize:null,ctor:function(){cc.Scene.prototype.ctor.call(this),this._winSize=cc.Director.getInstance().getWinSize()},init:function(){cc.Scene.prototype.init.call(this);var e=160,t=200,n=cc.p(this._winSize.width/2,this._winSize.height/2);this._logoTexture=new Image;var r=this,i;this._logoTexture.addEventListener("load",i=function(){r._initStage(n),this.removeEventListener("load",i,!1)}),this._logoTexture.src="data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAAAlAAD/4QMpaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjAtYzA2MCA2MS4xMzQ3NzcsIDIwMTAvMDIvMTItMTc6MzI6MDAgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjM4MDBEMDY2QTU1MjExRTFBQTAzQjEzMUNFNzMxRkQwIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjM4MDBEMDY1QTU1MjExRTFBQTAzQjEzMUNFNzMxRkQwIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDUzUgV2luZG93cyI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkU2RTk0OEM4OERCNDExRTE5NEUyRkE3M0M3QkE1NTlEIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkU2RTk0OEM5OERCNDExRTE5NEUyRkE3M0M3QkE1NTlEIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+/+4ADkFkb2JlAGTAAAAAAf/bAIQADQkJCQoJDQoKDRMMCwwTFhENDREWGhUVFhUVGhkUFhUVFhQZGR0fIB8dGScnKionJzk4ODg5QEBAQEBAQEBAQAEODAwOEA4RDw8RFA4RDhQVERISERUfFRUXFRUfKB0ZGRkZHSgjJiAgICYjLCwoKCwsNzc1NzdAQEBAQEBAQEBA/8AAEQgAyACgAwEiAAIRAQMRAf/EALAAAAEFAQEAAAAAAAAAAAAAAAQAAgMFBgcBAQEAAwEBAAAAAAAAAAAAAAAAAQMEAgUQAAIBAgIEBwoLBgQGAwAAAAECAwAEEQUhMRIGQVFxsTITFGGBwdEiQlKSMzWRoeFicqKyI1NzFYJjJDQWB9KjVCbxwkNkJWXik3QRAAIBAgMFBQcDBQEAAAAAAAABAhEDIRIEMUFRcTJhwVIUBZGhsSJyEzOB0ULhYpIjUxX/2gAMAwEAAhEDEQA/AMJSpUqAVKlXuFAeUq9wpUB5XuFe4V6ooDzZHDox0CnGMinzwl7Z8NajaHeoO3vmTBZBtp9YUIqTEV5ROxHKnWRnaU8VRMhFBUjpV7hSoSeUq9pUB5Sr2lhQHlKvcK8oBV7hSFSRrtaKAZs07YNPM1pG2xJIAw1jSeandry/8X4m8VCKkWwaWwam7Xl/4v1W8VLtmX/i/VbxUoKkWwakSM407tmX/i/VbxUmzGwjQsjdY41IARie/U0IbZO0kNtCXnOCkEBeFu4KI3Bs7DNb27ya+jDx3kJeEnpJJEcQVbWDsk17u5urd591ucZkWhym2Vnd9RkCDEpFxDRpbw0bunu5mlp2De2FMLYXOD2wB2xbOeraUcYGJ72mlSUiqzzdzMd3Z3mixltA2yzcK/NlHM1DQyRXce1HocdNOEfJXZ88y9ZojOqhiBszIRiHQ8Y4cK5TvHuzLljHNMqxNoDjLFraHHnjPxcNCGVbxEUzYNTx5jZSxhpW6qTzlwJ+DCvO2Zf+L9VvFSgqyHYNLYNTdssPxfibxUu15f8Ai/VPiqCakOwa82DU/a8v/F+JvFTDdWPBL8R8VKCvYRYV5UzoMAy6QdIIqI0B4KJtxiRQwou16QoGUkntH5Tz0RbZbmF2hktraSVBo2lUkY8tDye0flPPXTslVUyiyVRsjqUOA4yMT8dW2ram2m6UVTNq9S7EIyUVJydMTn/6DnP+im9Wl+g5z/opvVrpteEhQWY4AaSTwAVf5WPiZh/9S5/zj7zltzlmYWkfWXNvJDGTgGcYDHirR7i7mSbwXParsFMrgb7w6jKw/wCmnc9I14kF3vpvCljbMyWMOJL4aEiB8qU/ObUK7HYWVrl1pFZWiCOCBQqKOLjPGTrNZZqKbUXVHq2nNwTuJRk1VpbgXN8s7Rk5ym0UQQzhIG2NAjhxHWbI+gCBVjBBFbwxwQqEiiUJGg1BVGAFe7dV28WYLYZFmF2Th1UD7JGjymGyn1iK5OyzIBGB1HgrLZhamzumQAGJwSqnSCh1q3GOCodxt4cxurdcpzuN4cyhiWaF5Bg09udUmnWw1H/jV9nFuJ7Quo+8h8peThFA+047vduyMtk7fYqTl07YFdfUufMPzT5p71UdtlmYXaGS2t3mQHAsgxANdadYJopLe4QS2867EsZ4QfCNYrCFbjdDPmgkYyWFxgVf04ifJf6ScNdRUW1XBb6FU5TjF5EpSSrGu/s5lN+g5z/opvVpfoOc/wCim9WtdHnatvObJXDW7xLGhB8nrPaY9/HCr+tEdPCVaSeDoYLnqF63lzW4/PFSW3ecxbI84VSzWUwUaSdg0DXXK5nvAipnd6qgKvWnQO7pri9ZUEmm3Vl2j1kr8pRlFRyquBNZjGxQ/S56Y1S2fu9OVueon11Szahoou06QoQUXadIVCD2FJJ7R+U89dMydv8Axdn+TH9muZye0flPPXQstlK5Tbka1gUjlC1q0vVLkeb6r+O3Tx9xcY1nt8c0NrZCyiOE1108NYjGv1joo7Js1jzKyScYLIvkzL6LDwHXVJksH9Sb49dKNq0tj1jA6uriOCL+02FWX7iVtZX1/AzaHTyeoauKn2MX9W79zebiZCuR5MjSrhfXuEtwTrUeZH+yNfdrRNcxI6IzhXlJEak6WIGJ2Rw4ChWnChndtlVBLMdQA0k1gbXNMzzDfDLs6mjaPKppJbWwJ1bOwwxw43OnHh71YT3DpfWUJmFlb5jHHDdeXBHIsrRea5TSqvxqG04cNN62vetoCS4tre5mgnkGE9q+3DKOkuI2WX6LDQRRHWDh1UCtwj7QRg2wdl8Djgw1qe7XvW0BQ3kfZ7mSLgU+T9E6RVbnuVrnWVSWqj+Lt8ZbRuHEdKPkYVcZ2MJY5fSGyeVar45+rkWQHAqccalPE5km1htWK5nK4Wnt5FuUBUwOMG4nGkA/BXUrW4S6torlOjMgcd/xVn7rLo7zKs0uEjCNeSvdwoBhgsZxX1l2j36k3Lu+uyprdj5Vs5A+i/lD48a0aaVJOPi7jB6lbzWozpjB48pf1NDXNN4vfl7+Z4BXS65pvF78vfzPAK71XTHmZ/S/yT+jvJ7L3fHytz1E+upbL+Qj5W56jfXWRnsIYKLtekKEFGWvSFQgyjk9o/Keet3YthlMP/5x9msJJ7R+U89biyb/AMXEv7gD6tadL1T+kwepRrC39ZkLDMbiwMvUHRPG0bjlGg8ore/23sxBldxfMPLupNhT8yL/AORNZbdzJ484scytxgLqJY5LZj6Q2sV5G1Vud1mjjyG0ij0NEGSZToKyhjtqw4waztuiXA3qKTbSxltfGhbZlE95ZtZqxVbgiOZhrER9ph3Svk9+pJILZ4Y4DGBFCUMKjRsGPobPFhUfW0NJmljE2xJcIrcI2vFUEln1lRXd6lrazXT9GCNpD+yNqoI7mOVduNw6nzlOIoPOUa6yye1XXcbMR5GdQ3xY0BSbj31/FcTQZirJ+q431q7anbHCTZ72Bw7lbPrKBMcBWNNgbMBBh+bsjBdni0VJ1lARZs6yWiupxCuMDy6KpS2IwOo6DTr3Mre3e5tZZVUM4ZBjqOOJoWO4jkXajcOOMHGgDISvWIrdAkKR80+TzVl908bPPL3LzxOuHdifxVfiTAg92qI/w+/8gGgSyN/mR7XPVlp0lF/3L3mbVKtu5Hjbk/8AHE2Fc03i9+Xv5ngFdKNc13i9+Xv5ngFaNV0x5nn+l/kn9HeEWXu+PlbnqJ9dS2Xu9OVueon11kZ7CGCjLXpCgxRlr0hUIPYUcntH5Tz1s8vb+Bt1/dqPirGSe0flPPWusG/g4Py15q06XqlyMWvVYQ+ruI9xJOqzO9hOto/sP8tbGOFIrmWeM7IuMDMnAXXQJOUjQeOsJk0nY96ip0CYunrjaHx1t+srPJUbXBm2LrFPikwTOb+T+VhbZxGMrDXp83x1QSy2tucJpUjPETp+Cn5/ftaRvKvtp3Kx48HG3erHMzOxZiWZtLMdJNQSbbL71Vk6yynViOkqnEEfOWtPbXi3EQkGg6mXiNckjeSJxJGxR10qw0GtxuxmvbImD4CZMFlA4fRfv0BqesqqzTMZNMEDbIHtHH2QeCiZJSqMQdOGiue53mz3czQwsRbIcNHnkec3c4qAMuriz68gTIToxwOOnlp0MjxMJYW741Gs3RVldtbygE/dMcHX/moDaxTiWNZB53B3arb8/wC+4SOF4sf/AKxU9kcBsfOGHfoUHtG/RbzY5Die5HHhXdvavqiZ9Q8Jdlq4/gbKua7xe/L38zwCuhpf2Uk/Zo50kmwJKIdogDjw1VzzeL35e/meAVp1LTgqY4nn+mRauzqmqwrjzCLL3fHytz1E+upLL+Qj5W56jfXWRnroYKLtekKEFF2vSFQg9hSSe0flPPWosm/hIfoLzVl5PaPynnrRWb/w0X0F5q06XqlyM2sVYx5gmbFre/t71NY2T+0h8VbSO5SWNJUOKSAMp7jDGspmMPaLRlXS6eWve1/FRO7WYdbZm1Y/eW/R7qHxHRXGojlm3ulid6aVbaW+OALvgCLq2Hm9WxHKWqjhj6xsK1e8dm15l4niG1LZkswGsxtrPeOmsvayBJA1VItlWjptLuTdPMo7LtjRDq9naK4+WF9IrUW7BaHOljGqVHB7w2hzVoZt87d8vaNYSLl02CcRsDEbJbj71Uu7UBkvJ7/D7q2QoDxySaAO8MTXdxRVMpRp5XZOWdF/ms7R5XdyKfKWJsO/5PhrG5XlNxmEywW6bTnTxAAcJNbGSMXkM1pjgbiNo1PziPJ+Os7u7m/6ReM00ZOgxSpqYYHT3wRXMKN4ll9zUG4bQfNshu8sZVuEA2hirA4qe/VOwwrVbzbww5mI44UKRRYkbWG0S3JWctbd7u5WFfOOLHiUdJqmaipfLsIsObhWe001lMkMVvJNjhghIALMcBxCs7fxXQmkupx1bXDswGPlaTidVaEyKNXkoo4eBV+Sq7L7Vs9zcBgeyQ4GQ/MB1crmoim2orezqcowTuSeEY48jQ7oZX2PLzdyLhNd6RjrEY6I7+uspvH78vfzPAK6UAAAFGAGgAcArmu8Xvy9/M8ArTfio24RW5nnaG67uou3H/KPuqT2X8hHytz1G+upLL3enK3PUb66ys9RDBRdr0hQgou06QqEGUkntH5Tz1e238vF9BeaqKT2j8p56vbb+Xi+gvNWjTdUuRn1XTHmTh8KrJTJlt8t1CPIY44cGnpJVjTJYkmjaN9Ib4u7V923njTethRauZJV3PaW1rfLIiXEDYg6R4VYc9CXW7thfOZbKdbGZtLW8uPVY/u3GrkNUkM9zlcxUjbhfWOA90cRq4gv4LhdqN+VToNYWmnRm9NNVWNTyHc6VWBv8wt4YeHqm6xyPmroq1Z7WGFLSxTq7WLSuPSdjrkfumq5yHXDUeA92oO2SKpVumNAaoJLMXH3myp0rpJ4uKhc3tbDM5BMri1zAj79j7KTiY8TcdBpcsith0286o+sPCagEX9Pzg4zXUCp6QYse8oouCG3tk6m1BYv05W6T+IdyolxbHDAAa2OgDlNCz3ryN2WxBd5PJMg1t81eId2ukqnLlTBbfcuY+9uJLiRcvtPvHdsHK+cfRHcHDWsyawjyy0WBcDI3lTP6TeIcFV+S5OmXx9bJg1048o8Cj0V8Jq2DVu09nL80up7OxHi+oal3P8AXB/IsZS8T/YOV65zvCcc7vfzPAK3ivWCz445zeH954BXOr6I8yfSfyz+jvCLP3fHytz1G+upLP3fHytz1E+usbPaQ0UXadIUIKLtekKhB7Ckk9o/Keer22/l4/oLzVRSe0flPPV7b/y8X0F5q0abqlyM+q6Y8yQsBTDMor1o8aiaE1pbluMqS3sbLLHIhSRQyngqukhaJ9uBjo+H5aOa3ao2t34qouRlLajTalGP8v0IY8ylXQ+PKPFU/bYXOLPge6CKia0LaxTOxHu1Q7cuBd9yPEJ7TbjXKO8CajbMIF6CNIeNvJHjqIWJ7tSpYkalqVblwIdyG+RGXur0hXYJFxal+Dhq5y3slkv3Y2pD0pTr+QUClpJRUdo9XW4OLrTHtM16cZLLWkeC7y4jvlNEpcRtw1Ux27Ci448NZrTFy3nn3IQWxlgGrDZ3pza7/M8ArZo+ArF5171uvp+CqdV0R5l/psUrs2vB3hdl7vTlbnqJ9dS2Xu+PlbnqJ9dY2eshooq16QoQUXa9IVCD2FLJ7RuU89WNtmUSQqkgYMgw0accKrpPaPynnrZWG4Vi+VWmY5tnMWXG+XrIYnA0rhj0mdcTgdNdwnKDqjmduM1SRR/qlr8/4KX6pa8T/BVzDuLZXudRZblmbxXcPUNPc3KqCIwrbOzgrHEnHjoyD+3eSXkht7DeKG4umDGOJVUklfouThXfmbnZ7Cvy1vt9pmv1W1+d8FL9VteJvgq5yrcOGfLmzHN80iyyETPbptAEFo2ZG8pmUa1OFNn3Ky6W/sbDKM5hv5bx2WTZA+7RF2y52WOPJTzE+z2Dy1vt9pT/AKpacTerS/U7Tib1a04/t7kDXPY03jhN0W6sQ7K7W3q2dnrMccaDy/8At80kuZfqWYxWNtlcvUPPhiGYhWDeUy7IwYU8xPs9g8tb7faUn6pacTerTxm9oOBvVq3v9z927aynuId44LiWKNnjhAXF2UYhRg516qpsryjLr21665zFLSTaK9U2GOA87SwqY37knRU+BzOzags0s1Oyr+BKM6sxwP6tSDPLMen6vy0rvdm3Sxlu7K/S7WDDrFUDUTxgnTU826eXW7KlxmqQuwDBXUKcD+1Xee/wXuKX5XDGWLapSVcOyhEM/seJ/V+WnjeGx4pPV+Wkm6kKZlFay3Jlt7iFpYZY8ASVK6DjtDDA0f8A0Tl340/1f8Ndx8xJVWXB0KbktFFpNzdVXAC/qOwA0CQni2flrO3Vwbm5lnI2TKxbDirX/wBE5d+NcfV/wVR7xZPa5U9utvI8nWhmbbw0YEAYYAVxfhfy5rlKR4Fulu6X7mW1mzT8S4Yis/5CPlbnqJ9dSWfu9OVueon11mZvQ2i7XpChKKtekKhBlNJ7R+U89bDfGTb3a3ZX0Lcj6kdY+T2j8p560288m1kWQr6MJ+ylSAr+2cnV5renjs3H1loX+3j9XvbbtxLN9lqW4UnV5jdnjtXHxihtyZNjeSBu5J9k1BJe7xy7W5CJ/wCzuD/mTVTf2+fq97LJuLrPsNRueS7W6aJ/38x+vLVXuY+xvHaNxbf2GoCezf8A36j/APsSf8w1sLnqczTefJluYoLm5uo5F61sBshItP1cNFYe1f8A3ir/APfE/wCZUe9bB94r5jwuPsrQFhmG4l/Z2M17HdW90tuu3IkTHaCjWdIw0VVZdks9/C06yJFEp2dp+E1bbqybGTZ8vpQD7L1XRv8A7blT96Oda7tpNuuNE37Cq9KSisjyuUoxrStKllHbLlWTXsMs8chuSuwEPDqwoLe5y+YRE/gLzmqRekvKKtd4327yM/ulHxmrHJStySWVRyrjxKI2XC/CTlnlPPKTpTdFbP0L1bgrf5Lp0G3dPhQHwV0S1lzBsns3sESR8Crh9WAJGjSOKuU3E+zdZQ3oJh8IArdZXFDmOTpHa3i2+YrI2KtKy4ricBsBuHHgFXSo440+Wa2qqxjvM9uMoy+WvzWpLCWWWE28HxL6e43ojgkeSCBY1Ri5BGIUDT51cl3vm276BBqSEH4WbxV0tlkyXJcxTMb+OW6uY9mGHrCzDQwwAbTp2uKuTZ9N1uYsfRRR8WPhrm419mSSjRyiqxVK7y23B/ftuTm2oSdJyzNVw3BFn7vTlbnqF9dS2fu9OVueon11lZuQ2iLdsGFD05H2dNQGV0ntG5Tz1dWm9N1b2kVq8EVwsI2UaQaQOKhmitZGLOmk68DhSFvY+gfWNSAg7z3Qvo7yKCKIohiaNR5LKxx8qpxvjcqS0VpbxvwOAcRQPZ7D0G9Y0uz2HoH1jUCpLY7zXlpbm3eKO5QuzjrBqZji3x17PvNcyT288VvDBJbMWUovS2hslW7mFQ9nsPQPrGl2ew9A+saCod/WNxtbYsrfb17WBxx5ddD2281xC88klvDcSXEnWuzrqOGGC9zRUPZ7D0G9Y0uzWHoH1jQVCLreq6ntZbaO3it1mGy7RjTs1X2mYy20ZiCq8ZOODcdEdmsPQb1jS7PYegfWNdJuLqnQiSUlRqpFLmryxtH1Ma7Qw2gNNPOdSt0oI27p007s9h6B9Y0uz2HoH1jXX3Z+I4+1b8IJdX89xLHKQFMXQUahpxoiPN5P+onfU+A0/s9h6DesaXZ7D0D6xpG7OLbUtu0StW5JJx2bBsmbtiSiEk+cxoCWWSaVpZOk2vDVo0VYdnsPQb1jSNvZcCH1jSd2c+p1XAmFqEOmOPEfaH+BQd1ueo211IzrgFUYKNAAqI1WztCpUqVCRUqVKgFSpUqAVKlSoBUqVKgFSpUqAVKlSoBUqVKgFSpUqAVKlSoD/9k=",this._logoTexture.width=e,this._logoTexture.height=t,this._bgLayer=cc.LayerColor.create(cc.c4(32,32,32,255)),this._bgLayer.setPosition(0,0),this.addChild(this._bgLayer,0),this._label=cc.LabelTTF.create("Loading... 0%","Arial",14),this._label.setColor(cc.c3(180,180,180)),this._label.setPosition(cc.pAdd(n,cc.p(0,-t/2-10))),this._bgLayer.addChild(this._label,10)},_initStage:function(e){this._texture2d=new cc.Texture2D,this._texture2d.initWithElement(this._logoTexture),this._texture2d.handleLoadedTexture(),this._logo=cc.Sprite.createWithTexture(this._texture2d),this._logo.setScale(cc.CONTENT_SCALE_FACTOR()),this._logo.setPosition(e),this._bgLayer.addChild(this._logo,10)},onEnter:function(){cc.Node.prototype.onEnter.call(this),this.schedule(this._startLoading,.3)},onExit:function(){cc.Node.prototype.onExit.call(this);var e="Loading... 0%";this._label.setString(e)},initWithResources:function(e,t,n){this.resources=e,this.selector=t,this.target=n},_startLoading:function(){this.unschedule(this._startLoading),cc.Loader.preload(this.resources,this.selector,this.target),this.schedule(this._updatePercent)},_updatePercent:function(){var e=cc.Loader.getInstance().getPercentage(),t="Loading... "+e+"%";this._label.setString(t),e>=100&&this.unschedule(this._updatePercent)}}),cc.LoaderScene.preload=function(e,t,n){this._instance||(this._instance=new cc.LoaderScene,this._instance.init()),this._instance.initWithResources(e,t,n);var r=cc.Director.getInstance();return r.getRunningScene()?r.replaceScene(this._instance):r.runWithScene(this._instance),this._instance},cc.DrawingPrimitive=cc.Class.extend({_renderContext:null,setRenderContext:function(e){this._renderContext=e},getRenderContext:function(){return this._renderContext},ctor:function(e){this._renderContext=e},drawPoint:function(e){cc.log("DrawingPrimitive.drawPoint() not implement!")},drawPoints:function(e,t){cc.log("DrawingPrimitive.drawPoints() not implement!")},drawLine:function(e,t){cc.log("DrawingPrimitive.drawLine() not implement!")},drawRect:function(e,t){cc.log("DrawingPrimitive.drawRect() not implement!")},drawSolidRect:function(e,t,n){cc.log("DrawingPrimitive.drawSolidRect() not implement!")},drawPoly:function(e,t,n,r){cc.log("DrawingPrimitive.drawPoly() not implement!")},drawSolidPoly:function(e,t,n){cc.log("DrawingPrimitive.drawSolidPoly() not implement!")},drawCircle:function(e,t,n,r,i){cc.log("DrawingPrimitive.drawCircle() not implement!")},drawQuadBezier:function(e,t,n,r){cc.log("DrawingPrimitive.drawQuadBezier() not implement!")},drawCubicBezier:function(e,t,n,r,i){cc.log("DrawingPrimitive.drawCubicBezier() not implement!")},drawCatmullRom:function(e,t){cc.log("DrawingPrimitive.drawCardinalSpline() not implement!")},drawCardinalSpline:function(e,t,n){cc.log("DrawingPrimitive.drawCardinalSpline() not implement!")}}),cc.DrawingPrimitiveCanvas=cc.DrawingPrimitive.extend({_cacheArray:[],drawPoint:function(e,t){t||(t=1);var n=cc.EGLView.getInstance().getScaleX(),r=cc.EGLView.getInstance().getScaleY(),i=cc.p(e.x*n,e.y*r);this._renderContext.beginPath(),this._renderContext.arc(i.x,-i.y,t*n,0,Math.PI*2,!1),this._renderContext.closePath(),this._renderContext.fill()},drawPoints:function(e,t,n){if(e==null)return;n||(n=1);var r=this._renderContext,i=cc.EGLView.getInstance().getScaleX(),s=cc.EGLView.getInstance().getScaleY();r.beginPath();for(var o=0,u=e.length;o<u;o++)r.arc(e[o].x*i,-e[o].y*s,n*i,0,Math.PI*2,!1);r.closePath(),r.fill()},drawLine:function(e,t){var n=this._renderContext,r=cc.EGLView.getInstance().getScaleX(),i=cc.EGLView.getInstance().getScaleY();n.beginPath(),n.moveTo(e.x*r,-e.y*i),n.lineTo(t.x*r,-t.y*i),n.closePath(),n.stroke()},drawRect:function(e,t){this.drawLine(cc.p(e.x,e.y),cc.p(t.x,e.y)),this.drawLine(cc.p(t.x,e.y),cc.p(t.x,t.y)),this.drawLine(cc.p(t.x,t.y),cc.p(e.x,t.y)),this.drawLine(cc.p(e.x,t.y),cc.p(e.x,e.y))},drawSolidRect:function(e,t,n){var r=[e,cc.p(t.x,e.y),t,cc.p(e.x,t.y)];this.drawSolidPoly(r,4,n)},drawPoly:function(e,t,n,r){r=r||!1;if(e==null)return;if(e.length<3)throw new Error("Polygon's point must greater than 2");var i=e[0],s=this._renderContext,o=cc.EGLView.getInstance().getScaleX(),u=cc.EGLView.getInstance().getScaleY();s.beginPath(),s.moveTo(i.x*o,-i.y*u);for(var a=1,f=e.length;a<f;a++)s.lineTo(e[a].x*o,-e[a].y*u);n&&s.closePath(),r?s.fill():s.stroke()},drawSolidPoly:function(e,t,n){this.setDrawColor4F(n.r,n.g,n.b,n.a),this.drawPoly(e,t,!0,!0)},drawCircle:function(e,t,n,r,i){i=i||!1;var s=this._renderContext,o=cc.EGLView.getInstance().getScaleX(),u=cc.EGLView.getInstance().getScaleY();s.beginPath();var a=n-Math.PI*2;s.arc(0|e.x*o,0|-(e.y*u),t*o,-n,-a,!1),i&&s.lineTo(0|e.x*o,0|-(e.y*u)),s.stroke()},drawQuadBezier:function(e,t,n,r){var i=this._cacheArray;i.length=0;var s=0;for(var o=0;o<r;o++){var u=Math.pow(1-s,2)*e.x+2*(1-s)*s*t.x+s*s*n.x,a=Math.pow(1-s,2)*e.y+2*(1-s)*s*t.y+s*s*n.y;i.push(cc.p(u,a)),s+=1/r}i.push(cc.p(n.x,n.y)),this.drawPoly(i,r+1,!1,!1)},drawCubicBezier:function(e,t,n,r,i){var s=this._cacheArray;s.length=0;var o=0;for(var u=0;u<i;u++){var a=Math.pow(1-o,3)*e.x+3*Math.pow(1-o,2)*o*t.x+3*(1-o)*o*o*n.x+o*o*o*r.x,f=Math.pow(1-o,3)*e.y+3*Math.pow(1-o,2)*o*t.y+3*(1-o)*o*o*n.y+o*o*o*r.y;s.push(cc.p(a,f)),o+=1/i}s.push(cc.p(r.x,r.y)),this.drawPoly(s,i+1,!1,!1)},drawCatmullRom:function(e,t){this.drawCardinalSpline(e,.5,t)},drawCardinalSpline:function(e,t,n){cc.renderContext.strokeStyle="rgba(255,255,255,1)";var r=this._cacheArray;r.length=0;var i,s,o=1/e.length;for(var u=0;u<n+1;u++){var a=u/n;a==1?(i=e.length-1,s=1):(i=0|a/o,s=(a-o*i)/o);var f=cc.CardinalSplineAt(cc.getControlPointAt(e,i-1),cc.getControlPointAt(e,i-0),cc.getControlPointAt(e,i+1),cc.getControlPointAt(e,i+2),t,s);r.push(f)}this.drawPoly(r,n+1,!1,!1)},drawImage:function(e,t,n,r,i){var s=arguments.length;switch(s){case 2:var o=e.height;this._renderContext.drawImage(e,t.x,-(t.y+o));break;case 3:this._renderContext.drawImage(e,t.x,-(t.y+n.height),n.width,n.height);break;case 5:this._renderContext.drawImage(e,t.x,t.y,n.width,n.height,r.x,-(r.y+i.height),i.width,i.height);break;default:throw new Error("Argument must be non-nil")}},drawStar:function(e,t,n){var r=e||this._renderContext;t*=cc.EGLView.getInstance().getScaleX(),n instanceof cc.Color4F&&(n=new cc.Color3B(0|n.r*255,0|n.g*255,0|n.b*255));var i="rgba("+n.r+","+n.g+","+n.b;r.fillStyle=i+",1)";var s=t/10;r.beginPath(),r.moveTo(-t,t),r.lineTo(0,s),r.lineTo(t,t),r.lineTo(s,0),r.lineTo(t,-t),r.lineTo(0,-s),r.lineTo(-t,-t),r.lineTo(-s,0),r.lineTo(-t,t),r.closePath(),r.fill();var o=r.createRadialGradient(0,0,s,0,0,t);o.addColorStop(0,i+", 1)"),o.addColorStop(.3,i+", 0.8)"),o.addColorStop(1,i+", 0.0)"),r.fillStyle=o,r.beginPath();var u=0,a=cc.PI2;r.arc(0,0,t-s,u,a,!1),r.closePath(),r.fill()},drawColorBall:function(e,t,n){var r=e||this._renderContext;t*=cc.EGLView.getInstance().getScaleX(),n instanceof cc.Color4F&&(n=new cc.Color3B(0|n.r*255,0|n.g*255,0|n.b*255));var i="rgba("+n.r+","+n.g+","+n.b,s=t/10,o=r.createRadialGradient(0,0,s,0,0,t);o.addColorStop(0,i+", 1)"),o.addColorStop(.3,i+", 0.8)"),o.addColorStop(.6,i+", 0.4)"),o.addColorStop(1,i+", 0.0)"),r.fillStyle=o,r.beginPath();var u=0,a=cc.PI2;r.arc(0,0,t,u,a,!1),r.closePath(),r.fill()},fillText:function(e,t,n){this._renderContext.fillText(e,t,-n)},setDrawColor4B:function(e,t,n,r){this._renderContext.fillStyle="rgba("+e+","+t+","+n+","+r/255+")",this._renderContext.strokeStyle="rgba("+e+","+t+","+n+","+r/255+")"},setDrawColor4F:function(e,t,n,r){this._renderContext.fillStyle="rgba("+(0|e*255)+","+(0|t*255)+","+(0|n*255)+","+r+")",this._renderContext.strokeStyle="rgba("+(0|e*255)+","+(0|t*255)+","+(0|n*255)+","+r+")"},setPointSize:function(e){},setLineWidth:function(e){this._renderContext.lineWidth=e*cc.EGLView.getInstance().getScaleX()}}),cc.DrawingPrimitiveWebGL=cc.DrawingPrimitive.extend({_initialized:!1,_shader:null,_colorLocation:-1,_color:null,_pointSizeLocation:-1,_pointSize:-1,ctor:function(e){e==null&&(e=cc.renderContext);if(!e instanceof WebGLRenderingContext)throw"Can't initialise DrawingPrimitiveWebGL. context need is WebGLRenderingContext";cc.DrawingPrimitive.prototype.ctor.call(this,e),this._color=new cc.Color4F(1,1,1,1)},lazy_init:function(){this._initialized||(this._shader=cc.ShaderCache.getInstance().programForKey(cc.SHADER_POSITION_UCOLOR),this._colorLocation=this._renderContext.getUniformLocation(this._shader.getProgram(),"u_color"),this._pointSizeLocation=this._renderContext.getUniformLocation(this._shader.getProgram(),"u_pointSize"),this._initialized=!0)},drawInit:function(){this._initialized=!1},drawPoint:function(e){this.lazy_init(),this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,new Float32Array(this._color._arrayBuffer,0,4),1),this._shader.setUniformLocationWith1f(this._pointSizeLocation,this._pointSize);var t=this._renderContext,n=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,new Float32Array([e.x,e.y]),t.STATIC_DRAW),t.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,t.FLOAT,!1,0,0),t.drawArrays(t.POINTS,0,1),t.deleteBuffer(n),cc.INCREMENT_GL_DRAWS(1)},drawPoints:function(e,t){if(!e||e.length==0)return;this.lazy_init(),this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,new Float32Array(this._color._arrayBuffer,0,4),1),this._shader.setUniformLocationWith1f(this._pointSizeLocation,this._pointSize);var n=this._renderContext,r=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,r),n.bufferData(n.ARRAY_BUFFER,this._pointsToTypeArray(e),n.STATIC_DRAW),n.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,n.FLOAT,!1,0,0),n.drawArrays(n.POINTS,0,e.length),n.deleteBuffer(r),cc.INCREMENT_GL_DRAWS(1)},_pointsToTypeArray:function(e){var t=new Float32Array(e.length*2);for(var n=0;n<e.length;n++)t[n*2]=e[n].x,t[n*2+1]=e[n].y;return t},drawLine:function(e,t){this.lazy_init(),this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,new Float32Array(this._color._arrayBuffer,0,4),1);var n=this._renderContext,r=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,r),n.bufferData(n.ARRAY_BUFFER,this._pointsToTypeArray([e,t]),n.STATIC_DRAW),n.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,n.FLOAT,!1,0,0),n.drawArrays(n.LINES,0,2),n.deleteBuffer(r),cc.INCREMENT_GL_DRAWS(1)},drawRect:function(e,t){this.drawLine(cc.p(e.x,e.y),cc.p(t.x,e.y)),this.drawLine(cc.p(t.x,e.y),cc.p(t.x,t.y)),this.drawLine(cc.p(t.x,t.y),cc.p(e.x,t.y)),this.drawLine(cc.p(e.x,t.y),cc.p(e.x,e.y))},drawSolidRect:function(e,t,n){var r=[e,cc.p(t.x,e.y),t,cc.p(e.x,t.y)];this.drawSolidPoly(r,4,n)},drawPoly:function(e,t,n){this.lazy_init(),this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,new Float32Array(this._color._arrayBuffer,0,4),1);var r=this._renderContext,i=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,i),r.bufferData(r.ARRAY_BUFFER,this._pointsToTypeArray(e),r.STATIC_DRAW),r.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,r.FLOAT,!1,0,0),n?r.drawArrays(r.LINE_LOOP,0,e.length):r.drawArrays(r.LINE_STRIP,0,e.length),r.deleteBuffer(i),cc.INCREMENT_GL_DRAWS(1)},drawSolidPoly:function(e,t,n){this.lazy_init(),n||(n=this._color),this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,new Float32Array(n._arrayBuffer,0,4),1);var r=this._renderContext,i=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,i),r.bufferData(r.ARRAY_BUFFER,this._pointsToTypeArray(e),r.STATIC_DRAW),r.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,r.FLOAT,!1,0,0),r.drawArrays(r.TRIANGLE_FAN,0,e.length),r.deleteBuffer(i),cc.INCREMENT_GL_DRAWS(1)},drawCircle:function(e,t,n,r,i){this.lazy_init();var s=1;i&&s++;var o=2*Math.PI/r,u=new Float32Array((r+2)*2);if(!u)return;for(var a=0;a<=r;a++){var f=a*o,l=t*Math.cos(f+n)+e.x,c=t*Math.sin(f+n)+e.y;u[a*2]=l,u[a*2+1]=c}u[(r+1)*2]=e.x,u[(r+1)*2+1]=e.y,this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,new Float32Array(this._color._arrayBuffer,0,4),1);var h=this._renderContext,p=h.createBuffer();h.bindBuffer(h.ARRAY_BUFFER,p),h.bufferData(h.ARRAY_BUFFER,u,h.STATIC_DRAW),h.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,h.FLOAT,!1,0,0),h.drawArrays(h.LINE_STRIP,0,r+s),h.deleteBuffer(p),cc.INCREMENT_GL_DRAWS(1)},drawQuadBezier:function(e,t,n,r){this.lazy_init();var i=new Float32Array((r+1)*2),s=0;for(var o=0;o<r;o++)i[o*2]=Math.pow(1-s,2)*e.x+2*(1-s)*s*t.x+s*s*n.x,i[o*2+1]=Math.pow(1-s,2)*e.y+2*(1-s)*s*t.y+s*s*n.y,s+=1/r;i[r*2]=n.x,i[r*2+1]=n.y,this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,new Float32Array(this._color._arrayBuffer,0,4),1);var u=this._renderContext,a=u.createBuffer();u.bindBuffer(u.ARRAY_BUFFER,a),u.bufferData(u.ARRAY_BUFFER,i,u.STATIC_DRAW),u.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,u.FLOAT,!1,0,0),u.drawArrays(u.LINE_STRIP,0,r+1),u.deleteBuffer(a),cc.INCREMENT_GL_DRAWS(1)},drawCubicBezier:function(e,t,n,r,i){this.lazy_init();var s=new Float32Array((i+1)*2),o=0;for(var u=0;u<i;u++)s[u*2]=Math.pow(1-o,3)*e.x+3*Math.pow(1-o,2)*o*t.x+3*(1-o)*o*o*n.x+o*o*o*r.x,s[u*2+1]=Math.pow(1-o,3)*e.y+3*Math.pow(1-o,2)*o*t.y+3*(1-o)*o*o*n.y+o*o*o*r.y,o+=1/i;s[i*2]=r.x,s[i*2+1]=r.y,this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,new Float32Array(this._color._arrayBuffer,0,4),1);var a=this._renderContext,f=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,f),a.bufferData(a.ARRAY_BUFFER,s,a.STATIC_DRAW),a.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,a.FLOAT,!1,0,0),a.drawArrays(a.LINE_STRIP,0,i+1),a.deleteBuffer(f),cc.INCREMENT_GL_DRAWS(1)},drawCatmullRom:function(e,t){this.drawCardinalSpline(e,.5,t)},drawCardinalSpline:function(e,t,n){this.lazy_init();var r=new Float32Array((n+1)*2),i,s,o=1/e.length;for(var u=0;u<n+1;u++){var a=u/n;a==1?(i=e.length-1,s=1):(i=0|a/o,s=(a-o*i)/o);var f=cc.CardinalSplineAt(cc.getControlPointAt(e,i-1),cc.getControlPointAt(e,i),cc.getControlPointAt(e,i+1),cc.getControlPointAt(e,i+2),t,s);r[u*2]=f.x,r[u*2+1]=f.y}this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,new Float32Array(this._color._arrayBuffer,0,4),1);var l=this._renderContext,c=l.createBuffer();l.bindBuffer(l.ARRAY_BUFFER,c),l.bufferData(l.ARRAY_BUFFER,r,l.STATIC_DRAW),l.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,l.FLOAT,!1,0,0),l.drawArrays(l.LINE_STRIP,0,n+1),l.deleteBuffer(c),cc.INCREMENT_GL_DRAWS(1)},setDrawColor4B:function(e,t,n,r){this._color.r=e/255,this._color.g=t/255,this._color.b=n/255,this._color.a=r/255},setDrawColor4F:function(e,t,n,r){this._color.r=e,this._color.g=t
,this._color.b=n,this._color.a=r},setPointSize:function(e){this._pointSize=e*cc.CONTENT_SCALE_FACTOR()},setLineWidth:function(e){this._renderContext.lineWidth&&this._renderContext.lineWidth(e)}}),cc.PI2=Math.PI*2,cc.TARGET_PLATFORM={WINDOWS:0,LINUX:1,MACOS:2,ANDROID:3,IPHONE:4,IPAD:5,BLACKBERRY:6,NACL:7,EMSCRIPTEN:8,MOBILE_BROWSER:100,PC_BROWSER:101},cc.ORIENTATION_PORTRAIT=0,cc.ORIENTATION_PORTRAIT_UPSIDE_DOWN=1,cc.ORIENTATION_LANDSCAPE_LEFT=2,cc.ORIENTATION_LANDSCAPE_RIGHT=3,cc.CANVAS=0,cc.WEBGL=1,cc.drawingUtil=null,cc.renderContext=null,cc.canvas=null,cc.gameDiv=null,cc.renderContextType=cc.CANVAS,cc.originalCanvasSize=cc.size(0,0),window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame}(),window.console||(window.console={},window.console.log=function(){},window.console.assert=function(){}),cc.isAddedHiddenEvent=!1,cc.setup=function(e,t,n){function f(){if(!cc.AudioEngine)return;var e=cc.AudioEngine.getInstance();document[u]?e._pausePlaying():(cc.Director.getInstance()._resetLastUpdate(),e._resumePlaying())}var r=cc.$(e)||cc.$("#"+e),i,s,o;r.tagName=="CANVAS"?(t=t||r.width,n=n||r.height,s=cc.container=cc.$new("DIV"),o=s.style,i=cc.canvas=r,i.parentNode.insertBefore(s,i),i.appendTo(s),o.width=(t||480)+"px",o.height=(n||320)+"px",s.setAttribute("id","Cocos2dGameContainer"),o.margin="0 auto",i.setAttribute("width",t||480),i.setAttribute("height",n||320)):(r.tagName!="DIV"&&cc.log("Warning: target element is not a DIV or CANVAS"),t=t||r.clientWidth,n=n||r.clientHeight,i=cc.canvas=cc.$new("CANVAS"),i.addClass("gameCanvas"),i.setAttribute("width",t||480),i.setAttribute("height",n||320),s=cc.container=r,o=s.style,r.appendChild(i),o.width=(t||480)+"px",o.height=(n||320)+"px",o.margin="0 auto"),o.position="relative",o.overflow="hidden",s.top="100%";if(cc.__renderDoesnotSupport)return;cc.Browser.supportWebGL&&(cc.renderContext=cc.webglContext=cc.create3DContext(i,{stencil:!0,preserveDrawingBuffer:!0,antialias:!cc.Browser.isMobile,alpha:!1})),cc.renderContext?(cc.renderContextType=cc.WEBGL,window.gl=cc.renderContext,cc.drawingUtil=new cc.DrawingPrimitiveWebGL(cc.renderContext),cc.TextureCache.getInstance()._initializingRenderer()):(cc.renderContext=i.getContext("2d"),cc.mainRenderContextBackup=cc.renderContext,cc.renderContextType=cc.CANVAS,cc.renderContext.translate(0,i.height),cc.drawingUtil=cc.DrawingPrimitiveCanvas?new cc.DrawingPrimitiveCanvas(cc.renderContext):null),cc.originalCanvasSize=cc.size(i.width,i.height),cc.gameDiv=s,cc.log(cc.ENGINE_VERSION),cc.Configuration.getInstance(),cc.setContextMenuEnable(!1),cc.Browser.isMobile&&cc._addUserSelectStatus();var u,a;typeof document.hidden!="undefined"?(u="hidden",a="visibilitychange"):typeof document.mozHidden!="undefined"?(u="mozHidden",a="mozvisibilitychange"):typeof document.msHidden!="undefined"?(u="msHidden",a="msvisibilitychange"):typeof document.webkitHidden!="undefined"&&(u="webkitHidden",a="webkitvisibilitychange"),typeof document.addEventListener=="undefined"||typeof u=="undefined"?(cc.isAddedHiddenEvent=!1,window.addEventListener("focus",function(){if(!cc.AudioEngine)return;cc.AudioEngine.getInstance()._resumePlaying()},!1),window.addEventListener("blur",function(){if(!cc.AudioEngine)return;cc.AudioEngine.getInstance()._pausePlaying()},!1)):(cc.isAddedHiddenEvent=!0,document.addEventListener(a,f,!1))},cc._addUserSelectStatus=function(){var e=document.createElement("style");e.type="text/css",document.body.appendChild(e),e.textContent="body,canvas,div{ -moz-user-select: none;-webkit-user-select: none;-ms-user-select: none;-khtml-user-select: none;-webkit-tap-highlight-color:rgba(0,0,0,0);}"},cc._isContextMenuEnable=!1,cc.setContextMenuEnable=function(e){cc._isContextMenuEnable=e,cc._isContextMenuEnable?cc.canvas.oncontextmenu=function(){}:cc.canvas.oncontextmenu=function(){return!1}},cc.Application=cc.Class.extend({_animationInterval:null,ctor:function(){this._animationInterval=0;if(cc._sharedApplication)throw"Application has been initialized";cc._sharedApplication=this},setAnimationInterval:function(e){this._animationInterval=e},statusBarFrame:function(e){e&&(e=cc.rect(0,0,0,0))},getTargetPlatform:function(){return cc.Browser.isMobile?cc.TARGET_PLATFORM.MOBILE_BROWSER:cc.TARGET_PLATFORM.PC_BROWSER},run:function(){if(!this.applicationDidFinishLaunching())return 0;var e,t=cc.Director.getInstance(),n=window;return cc.director=t,n.requestAnimFrame&&this._animationInterval==1/60?(e=function(){t.mainLoop(),n.requestAnimFrame(e)},n.requestAnimFrame(e)):(e=function(){t.mainLoop()},setInterval(e,this._animationInterval*1e3)),0}}),cc.Application.getInstance=function(){return cc._sharedApplication},cc.Application.getCurrentLanguage=function(){var e=cc.LANGUAGE_ENGLISH,t=navigator.language;t||(t=navigator.browserLanguage||navigator.userLanguage);if(!t)return e;t=t.toLowerCase();switch(t){case"zh-cn":e=cc.LANGUAGE_CHINESE;break;case"fr":e=cc.LANGUAGE_FRENCH;break;case"it":e=cc.LANGUAGE_ITALIAN;break;case"de":e=cc.LANGUAGE_GERMAN;break;case"es":e=cc.LANGUAGE_SPANISH;break;case"ru":e=cc.LANGUAGE_RUSSIAN;break;case"ko":e=cc.LANGUAGE_KOREAN;break;case"ja":e=cc.LANGUAGE_JAPANESE;break;case"hu":e=cc.LANGUAGE_HUNGARIAN;break;case"pt":e=cc.LANGUAGE_PORTUGUESE;break;case"ar":e=cc.LANGUAGE_ARABIC;break;case"no":e=cc.LANGUAGE_NORWEGIAN;break;case"pl":e=cc.LANGUAGE_POLISH}return e},cc._sharedApplication=null,cc.SAXParser=cc.Class.extend({xmlDoc:null,_parser:null,_xmlDict:null,_isSupportDOMParser:null,ctor:function(){this._xmlDict={},window.DOMParser?(this._isSupportDOMParser=!0,this._parser=new DOMParser):this._isSupportDOMParser=!1},parse:function(e){var t=e;e=this.getList(e);var n=this._parserXML(e,t),r=n.documentElement;if(r.tagName!="plist")throw"cocos2d: "+t+" is not a plist file or you forgot to preload the plist file";var i=null;for(var s=0,o=r.childNodes.length;s<o;s++){i=r.childNodes[s];if(i.nodeType==1)break}return n=null,this._parseNode(i)},tmxParse:function(e,t){if(t==null||t===!1)e=this.getList(e);return this._parserXML(e)},_parserXML:function(e,t){var n;return this._isSupportDOMParser?n=this._parser.parseFromString(e,"text/xml"):(n=new ActiveXObject("Microsoft.XMLDOM"),n.async="false",n.loadXML(e)),n==null&&cc.log("cocos2d:xml "+t+" not found!"),n},_parseNode:function(e){var t=null;switch(e.tagName){case"dict":t=this._parseDict(e);break;case"array":t=this._parseArray(e);break;case"string":if(e.childNodes.length==1)t=e.firstChild.nodeValue;else{t="";for(var n=0;n<e.childNodes.length;n++)t+=e.childNodes[n].nodeValue}break;case"false":t=!1;break;case"true":t=!0;break;case"real":t=parseFloat(e.firstChild.nodeValue);break;case"integer":t=parseInt(e.firstChild.nodeValue,10)}return t},_parseArray:function(e){var t=[];for(var n=0,r=e.childNodes.length;n<r;n++){var i=e.childNodes[n];if(i.nodeType!=1)continue;t.push(this._parseNode(i))}return t},_parseDict:function(e){var t={},n=null;for(var r=0,i=e.childNodes.length;r<i;r++){var s=e.childNodes[r];if(s.nodeType!=1)continue;s.tagName=="key"?n=s.firstChild.nodeValue:t[n]=this._parseNode(s)}return t},preloadPlist:function(e,t,n){var r=cc.FileUtils.getInstance().fullPathForFilename(e);if(window.XMLHttpRequest){var i=new XMLHttpRequest;i.overrideMimeType&&i.overrideMimeType("text/xml")}if(i==null)throw"cocos2d:Your browser does not support XMLHTTP.";var s=this;i.onreadystatechange=function(){i.readyState==4&&(i.responseText?(cc.doCallback(t,n),s._xmlDict[r]=i.responseText,i=null):cc.doCallback(t,n,e))},i.open("GET",r,!0),i.send(null)},unloadPlist:function(e){this._xmlDict[e]&&delete this._xmlDict[e]},getName:function(e){var t=e.lastIndexOf("/",e.length)+1,n=e.lastIndexOf(".",e.length);return e.substring(t,n)},getExt:function(e){var t=e.lastIndexOf(".",e.length)+1;return e.substring(t,e.length)},getList:function(e){return this._xmlDict!=null?this._xmlDict[e]:null}}),cc.SAXParser.getInstance=function(){return this._instance||(this._instance=new cc.SAXParser),this._instance},cc.SAXParser._instance=null,cc.AppController=cc.Class.extend({didFinishLaunchingWithOptions:function(){return cc.Application.getInstance().run(),!0},applicationWillResignActive:function(){cc.Director.getInstance().pause()},applicationDidBecomeActive:function(){cc.Director.getInstance().resume()},applicationDidEnterBackground:function(){cc.Application.getInstance().applicationDidEnterBackground()},applicationWillEnterForeground:function(){cc.Application.getInstance().applicationWillEnterForeground()},applicationWillTerminate:function(){}}),cc.AppController.shareAppController=function(){cc.sharedAppController==null&&(cc.sharedAppController=new cc.AppController);if(!cc.sharedAppController)throw"Application initialize failure";return cc.sharedAppController},cc.sharedAppController=null,cc.LabelTTF=cc.Sprite.extend({_dimensions:null,_hAlignment:cc.TEXT_ALIGNMENT_CENTER,_vAlignment:cc.VERTICAL_TEXT_ALIGNMENT_TOP,_fontName:null,_fontSize:0,_string:"",_originalText:null,_isMultiLine:!1,_fontStyleStr:null,_shadowEnabled:!1,_shadowOffset:null,_shadowOpacity:0,_shadowBlur:0,_shadowColorStr:null,_strokeEnabled:!1,_strokeColor:null,_strokeSize:0,_strokeColorStr:null,_textFillColor:null,_fillColorStr:null,_strokeShadowOffsetX:0,_strokeShadowOffsetY:0,_needUpdateTexture:!1,_labelCanvas:null,_labelContext:null,_lineWidths:null,ctor:function(){cc.Sprite.prototype.ctor.call(this),this._dimensions=cc.SizeZero(),this._hAlignment=cc.TEXT_ALIGNMENT_LEFT,this._vAlignment=cc.VERTICAL_TEXT_ALIGNMENT_TOP,this._opacityModifyRGB=!1,this._fontStyleStr="",this._fontName="Arial",this._isMultiLine=!1,this._shadowEnabled=!1,this._shadowOffset=cc.SizeZero(),this._shadowOpacity=0,this._shadowBlur=0,this._shadowColorStr="rgba(128, 128, 128, 0.5)",this._strokeEnabled=!1,this._strokeColor=cc.white(),this._strokeSize=0,this._strokeColorStr="",this._textFillColor=cc.white(),this._fillColorStr="rgba(255,255,255,1)",this._strokeShadowOffsetX=0,this._strokeShadowOffsetY=0,this._needUpdateTexture=!1,this._lineWidths=[],this._setColorsString()},init:function(){return this.initWithString(" ",this._fontName,this._fontSize)},_measureConfig:function(){this._getLabelContext().font=this._fontStyleStr},_measure:function(e){return this._getLabelContext().measureText(e).width},_checkNextline:function(e,t){var n=this._measure(e),r=Math.floor(e.length*t/n),i=e.indexOf("\n");if(r*.8>=i&&i>0)return i+1;if(n<t)return e.length;var s=!1,o=t+1,u=-1,a=r,f,l=cc.LabelTTF._checkRegEx,c=cc.LabelTTF._reverseCheckRegEx,h=cc.LabelTTF._checkEnRegEx,p=e.substr(r);while(f=l.exec(p)){a+=f[0].length;var d=e.substr(0,a);o=this._measure(d);if(f[2]=="\n"&&o<t){s=!0,u=a;break}if(o>t){u!=-1&&(s=!0);break}u=a,p=e.substr(a)}if(s)return u;p=e.substr(0,r),u=r;while(f=c.exec(p)){u=f[1].length,p=f[1],o=this._measure(p);if(o<t){h.test(f[2])&&u++;break}}return u||1},description:function(){return"<cc.LabelTTF | FontName ="+this._fontName+" FontSize = "+this._fontSize.toFixed(1)+">"},setColor:null,_setColorForCanvas:function(e){cc.NodeRGBA.prototype.setColor.call(this,e),this._setColorsStringForCanvas()},_setColorsString:null,_setColorsStringForCanvas:function(){this._needUpdateTexture=!0;var e=this._displayedColor,t=this._displayedOpacity,n=this._strokeColor,r=this._textFillColor;this._shadowColorStr="rgba("+(0|e.r*.5)+","+(0|e.g*.5)+","+(0|e.b*.5)+","+this._shadowOpacity+")",this._fillColorStr="rgba("+(0|e.r/255*r.r)+","+(0|e.g/255*r.g)+","+(0|e.b/255*r.b)+", "+t/255+")",this._strokeColorStr="rgba("+(0|e.r/255*n.r)+","+(0|e.g/255*n.g)+","+(0|e.b/255*n.b)+", "+t/255+")"},_setColorsStringForWebGL:function(){this._needUpdateTexture=!0;var e=this._strokeColor,t=this._textFillColor;this._shadowColorStr="rgba(128,128,128,"+this._shadowOpacity+")",this._fillColorStr="rgba("+(0|t.r)+","+(0|t.g)+","+(0|t.b)+", 1)",this._strokeColorStr="rgba("+(0|e.r)+","+(0|e.g)+","+(0|e.b)+", 1)"},updateDisplayedColor:null,_updateDisplayedColorForCanvas:function(e){cc.NodeRGBA.prototype.updateDisplayedColor.call(this,e),this._setColorsString()},setOpacity:null,_setOpacityForCanvas:function(e){if(this._opacity===e)return;cc.Sprite.prototype.setOpacity.call(this,e),this._setColorsString(),this._needUpdateTexture=!0},updateDisplayedOpacity:null,updateDisplayedOpacityForCanvas:function(e){cc.NodeRGBA.prototype.updateDisplayedOpacity.call(this,e),this._setColorsString()},getString:function(){return this._string},getHorizontalAlignment:function(){return this._hAlignment},getVerticalAlignment:function(){return this._vAlignment},getDimensions:function(){return cc.size(this._dimensions.width,this._dimensions.height)},getFontSize:function(){return this._fontSize},getFontName:function(){return this._fontName},initWithString:function(e,t,n,r,i,s){var o;return e?o=e+"":o="",n=n||16,r=r||cc.size(0,n),i=i||cc.TEXT_ALIGNMENT_LEFT,s=s||cc.VERTICAL_TEXT_ALIGNMENT_TOP,cc.Sprite.prototype.init.call(this)?(this._opacityModifyRGB=!1,this._dimensions=cc.size(r.width,r.height),this._fontName=t||"Arial",this._hAlignment=i,this._vAlignment=s,this._fontSize=n,this._fontStyleStr=this._fontSize+"px '"+t+"'",this._fontClientHeight=cc.LabelTTF.__getFontHeightByDiv(t,this._fontSize),this.setString(o),this._setColorsString(),this._updateTexture(),this._needUpdateTexture=!1,!0):!1},initWithStringAndTextDefinition:null,_initWithStringAndTextDefinitionForCanvas:function(e,t){return cc.Sprite.prototype.init.call(this)?(this._updateWithTextDefinition(t,!1),this.setString(e),!0):!1},_initWithStringAndTextDefinitionForWebGL:function(e,t){return cc.Sprite.prototype.init.call(this)?(this.setShaderProgram(cc.ShaderCache.getInstance().programForKey(cc.LabelTTF._SHADER_PROGRAM)),this._updateWithTextDefinition(t,!1),this.setString(e),!0):!1},setTextDefinition:function(e){e&&this._updateWithTextDefinition(e,!0)},getTextDefinition:function(){return this._prepareTextDefinition(!1)},enableShadow:function(e,t,n,r){t=t||.5,!1===this._shadowEnabled&&(this._shadowEnabled=!0);var i=this._shadowOffset;if(i&&i.width!=e.width||i.height!=e.height)i.width=e.width,i.height=e.height;this._shadowOpacity!=t&&(this._shadowOpacity=t),this._setColorsString(),this._shadowBlur!=n&&(this._shadowBlur=n),this._needUpdateTexture=!0},disableShadow:function(e){this._shadowEnabled&&(this._shadowEnabled=!1,this._needUpdateTexture=!0)},enableStroke:function(e,t,n){this._strokeEnabled===!1&&(this._strokeEnabled=!0);var r=this._strokeColor;if(r.r!==e.r||r.g!==e.g||r.b!==e.b)r.r=e.r,r.g=e.g,r.b=e.b,this._setColorsString();this._strokeSize!==t&&(this._strokeSize=t||0),this._needUpdateTexture=!0},disableStroke:function(e){this._strokeEnabled&&(this._strokeEnabled=!1,this._needUpdateTexture=!0)},setFontFillColor:null,_setFontFillColorForCanvas:function(e,t){var n=this._textFillColor;if(n.r!=e.r||n.g!=e.g||n.b!=e.b)n.r=e.r,n.g=e.g,n.b=e.b,this._setColorsString(),this._needUpdateTexture=!0},_setFontFillColorForWebGL:function(e,t){var n=this._textFillColor;if(n.r!=e.r||n.g!=e.g||n.b!=e.b)n.r=e.r,n.g=e.g,n.b=e.b,this._setColorsString(),this._needUpdateTexture=!0},_updateWithTextDefinition:function(e,t){e.fontDimensions?(this._dimensions.width=e.fontDimensions.width,this._dimensions.height=e.fontDimensions.height):(this._dimensions.width=0,this._dimensions.height=0),this._hAlignment=e.fontAlignmentH,this._vAlignment=e.fontAlignmentV,this._fontName=e.fontName,this._fontSize=e.fontSize||12,this._fontStyleStr=this._fontSize+"px '"+this._fontName+"'",this._fontClientHeight=cc.LabelTTF.__getFontHeightByDiv(this._fontName,this._fontSize),e.shadowEnabled&&this.enableShadow(e.shadowOffset,e.shadowOpacity,e.shadowBlur,!1),e.strokeEnabled&&this.enableStroke(e.strokeColor,e.strokeSize,!1),this.setFontFillColor(e.fontFillColor,!1),t&&this._updateTexture()},_prepareTextDefinition:function(e){var t=new cc.FontDefinition;e?(t.fontSize=this._fontSize,t.fontDimensions=cc.SIZE_POINTS_TO_PIXELS(this._dimensions)):(t.fontSize=this._fontSize,t.fontDimensions=cc.size(this._dimensions.width,this._dimensions.height)),t.fontName=this._fontName,t.fontAlignmentH=this._hAlignment,t.fontAlignmentV=this._vAlignment;if(this._strokeEnabled){t.strokeEnabled=!0;var n=this._strokeColor;t.strokeColor=new cc.Color3B(n.r,n.g,n.b),t.strokeSize=this._strokeSize}else t.strokeEnabled=!1;this._shadowEnabled?(t.shadowEnabled=!0,t.shadowBlur=this._shadowBlur,t.shadowOpacity=this._shadowOpacity,t.shadowOffset=e?cc.SIZE_POINTS_TO_PIXELS(this._shadowOffset):cc.size(this._shadowOffset.width,this._shadowOffset.height)):t._shadowEnabled=!1;var r=this._textFillColor;return t.fontFillColor=new cc.Color3B(r.r,r.g,r.b),t},_fontClientHeight:18,setString:function(e){e=String(e),this._originalText!=e&&(this._originalText=e+"",this._updateString(),this._needUpdateTexture=!0)},_updateString:function(){this._string=this._originalText},setHorizontalAlignment:function(e){e!==this._hAlignment&&(this._hAlignment=e,this._needUpdateTexture=!0)},setVerticalAlignment:function(e){e!=this._vAlignment&&(this._vAlignment=e,this._needUpdateTexture=!0)},setDimensions:function(e){if(e.width!=this._dimensions.width||e.height!=this._dimensions.height)this._dimensions=e,this._updateString(),this._needUpdateTexture=!0},setFontSize:function(e){this._fontSize!==e&&(this._fontSize=e,this._fontStyleStr=e+"px '"+this._fontName+"'",this._fontClientHeight=cc.LabelTTF.__getFontHeightByDiv(this._fontName,e),this._needUpdateTexture=!0)},setFontName:function(e){this._fontName&&this._fontName!=e&&(this._fontName=e,this._fontStyleStr=this._fontSize+"px '"+e+"'",this._fontClientHeight=cc.LabelTTF.__getFontHeightByDiv(e,this._fontSize),this._needUpdateTexture=!0)},_drawTTFInCanvas:function(e){if(!e)return;var t=this._strokeShadowOffsetX,n=this._strokeShadowOffsetY,r=this._contentSize._height-n,i=this._vAlignment,s=this._hAlignment,o=this._fontClientHeight,u=this._strokeSize;e.setTransform(1,0,0,1,0+t*.5,r+n*.5),e.font!=this._fontStyleStr&&(e.font=this._fontStyleStr),e.fillStyle=this._fillColorStr;var a=0,f=0,l=this._strokeEnabled;l&&(e.lineWidth=u*2,e.strokeStyle=this._strokeColorStr);if(this._shadowEnabled){var c=this._shadowOffset;e.shadowColor=this._shadowColorStr,e.shadowOffsetX=c.width,e.shadowOffsetY=-c.height,e.shadowBlur=this._shadowBlur}e.textBaseline=cc.LabelTTF._textBaseline[i],e.textAlign=cc.LabelTTF._textAlign[s];var h=this._contentSize._width-t;s===cc.TEXT_ALIGNMENT_RIGHT?a+=h:s===cc.TEXT_ALIGNMENT_CENTER?a+=h/2:a+=0;if(this._isMultiLine){var p=this._strings.length;i===cc.VERTICAL_TEXT_ALIGNMENT_BOTTOM?f=o+r-o*p:i===cc.VERTICAL_TEXT_ALIGNMENT_CENTER&&(f=o/2+(r-o*p)/2);for(var d=0;d<p;d++){var v=this._strings[d],m=-r+o*d+f;l&&e.strokeText(v,a,m),e.fillText(v,a,m)}}else i===cc.VERTICAL_TEXT_ALIGNMENT_BOTTOM?(l&&e.strokeText(this._string,a,f),e.fillText(this._string,a,f)):i===cc.VERTICAL_TEXT_ALIGNMENT_TOP?(f-=r,l&&e.strokeText(this._string,a,f),e.fillText(this._string,a,f)):(f-=r*.5,l&&e.strokeText(this._string,a,f),e.fillText(this._string,a,f))},_getLabelContext:function(){if(this._labelContext)return this._labelContext;if(!this._labelCanvas){var e=document.createElement("canvas"),t=new cc.Texture2D;t.initWithElement(e),this.setTexture(t),this._labelCanvas=e}return this._labelContext=this._labelCanvas.getContext("2d"),this._labelContext},_updateTTF:function(){var e=this._dimensions.width,t,n,r=this._lineWidths;r.length=0,this._isMultiLine=!1,this._measureConfig();if(e!==0){var i=this._string;this._strings=[];for(t=0,n=this._string.length;t<n;){var s=this._checkNextline(i.substr(t),e),o=i.substr(t,s);this._strings.push(o),t+=s}}else{this._strings=this._string.split("\n");for(t=0,n=this._strings.length;t<n;t++)r.push(this._measure(this._strings[t]))}this._strings.length>0&&(this._isMultiLine=!0);var u,a=0,f=0;this._strokeEnabled&&(a=f=this._strokeSize*2);if(this._shadowEnabled){var l=this._shadowOffset;a+=Math.abs(l.width)*2,f+=Math.abs(l.height)*2}e===0?this._isMultiLine?u=cc.size(0|Math.max.apply(Math,r)+a,0|this._fontClientHeight*this._strings.length+f):u=cc.size(0|this._measure(this._string)+a,0|this._fontClientHeight+f):this._dimensions.height===0?this._isMultiLine?u=cc.size(0|e+a,0|this._fontClientHeight*this._strings.length+f):u=cc.size(0|e+a,0|this._fontClientHeight+f):u=cc.size(0|e+a,0|this._dimensions.height+f),this.setContentSize(u),this._strokeShadowOffsetX=a,this._strokeShadowOffsetY=f;var c=this._anchorPoint;this._anchorPointInPoints._x=a*.5+(u.width-a)*c._x,this._anchorPointInPoints._y=f*.5+(u.height-f)*c._y},getContentSize:function(){return this._needUpdateTexture&&this._updateTTF(),cc.Sprite.prototype.getContentSize.call(this)},_updateTexture:function(){var e=this._getLabelContext(),t=this._labelCanvas,n=this._contentSize;if(this._string.length===0)return t.width=1,t.height=n._height,this.setTextureRect(cc.rect(0,0,1,n._height)),!0;e.font=this._fontStyleStr,this._updateTTF();var r=n._width,i=n._height,s=t.width==r&&t.height==i;return t.width=r,t.height=i,s&&e.clearRect(0,0,r,i),this._drawTTFInCanvas(e),this._texture.handleLoadedTexture(),this.setTextureRect(cc.rect(0,0,r,i)),!0},visit:function(e){if(!this._string||this._string=="")return;this._needUpdateTexture&&(this._needUpdateTexture=!1,this._updateTexture());var t=e||cc.renderContext;cc.Sprite.prototype.visit.call(this,t)},draw:null,_drawForWebGL:function(e){if(!this._string||this._string=="")return;var t=e||cc.renderContext,n=this._texture;n&&n._isLoaded&&(this._shaderProgram.use(),this._shaderProgram.setUniformForModelViewAndProjectionMatrixWithMat4(),cc.glBlendFunc(this._blendFunc.src,this._blendFunc.dst),cc.glBindTexture2D(n),cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POS_COLOR_TEX),t.bindBuffer(t.ARRAY_BUFFER,this._quadWebBuffer),this._quadDirty&&(t.bufferData(t.ARRAY_BUFFER,this._quad.arrayBuffer,t.STATIC_DRAW),this._quadDirty=!1),t.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,3,t.FLOAT,!1,24,0),t.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,t.FLOAT,!1,24,16),t.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,t.UNSIGNED_BYTE,!0,24,12),t.drawArrays(t.TRIANGLE_STRIP,0,4));if(cc.SPRITE_DEBUG_DRAW===1){var r=this._quad,i=[cc.p(r.tl.vertices.x,r.tl.vertices.y),cc.p(r.bl.vertices.x,r.bl.vertices.y),cc.p(r.br.vertices.x,r.br.vertices.y),cc.p(r.tr.vertices.x,r.tr.vertices.y)];cc.drawingUtil.drawPoly(i,4,!0)}else if(cc.SPRITE_DEBUG_DRAW===2){var s=this.getTextureRect()._size,o=this.getOffsetPosition(),u=[cc.p(o.x,o.y),cc.p(o.x+s.width,o.y),cc.p(o.x+s.width,o.y+s.height),cc.p(o.x,o.y+s.height)];cc.drawingUtil.drawPoly(u,4,!0)}cc.g_NumberOfDraws++},_setTextureRectForCanvas:function(e,t,n){this._rectRotated=t||!1,n=n||e._size,this.setContentSize(n),this.setVertexRect(e);var r=this._textureRect_Canvas;r.x=e.x,r.y=e.y,r.width=e.width,r.height=e.height,r.validRect=!(r.width===0||r.height===0||r.x<0||r.y<0);var i=this._unflippedOffsetPositionFromCenter;this._flippedX&&(i._x=-i._x),this._flippedY&&(i._y=-i._y),this._offsetPosition._x=i.x+(this._contentSize._width-this._rect.width)/2,this._offsetPosition._y=i.y+(this._contentSize._height-this._rect.height)/2,this._batchNode&&(this._dirty=!0)},_setTextureCoords:function(e){var t=this._batchNode?this._textureAtlas.getTexture():this._texture;if(!t)return;var n=t.getPixelsWide(),r=t.getPixelsHigh(),i,s,o,u,a,f=this._quad;this._rectRotated?(cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL?(i=(2*e.x+1)/(2*n),s=i+(e.height*2-2)/(2*n),o=(2*e.y+1)/(2*r),u=o+(e.width*2-2)/(2*r)):(i=e.x/n,s=(e.x+e.height)/n,o=e.y/r,u=(e.y+e.width)/r),this._flippedX&&(a=o,o=u,u=a),this._flippedY&&(a=i,i=s,s=a),f.bl.texCoords.u=i,f.bl.texCoords.v=o,f.br.texCoords.u=i,f.br.texCoords.v=u,f.tl.texCoords.u=s,f.tl.texCoords.v=o,f.tr.texCoords.u=s,f.tr.texCoords.v=u):(cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL?(i=(2*e.x+1)/(2*n),s=i+(e.width*2-2)/(2*n),o=(2*e.y+1)/(2*r),u=o+(e.height*2-2)/(2*r)):(i=e.x/n,s=(e.x+e.width)/n,o=e.y/r,u=(e.y+e.height)/r),this._flippedX&&(a=i,i=s,s=a),this._flippedY&&(a=o,o=u,u=a),f.bl.texCoords.u=i,f.bl.texCoords.v=u,f.br.texCoords.u=s,f.br.texCoords.v=u,f.tl.texCoords.u=i,f.tl.texCoords.v=o,f.tr.texCoords.u=s,f.tr.texCoords.v=o),this._quadDirty=!0}}),cc.Browser.supportWebGL?(cc.LabelTTF.prototype.setColor=cc.Sprite.prototype.setColor,cc.LabelTTF.prototype._setColorsString=cc.LabelTTF.prototype._setColorsStringForWebGL,cc.LabelTTF.prototype.updateDisplayedColor=cc.Sprite.prototype.updateDisplayedColor,cc.LabelTTF.prototype.setOpacity=cc.Sprite.prototype.setOpacity,cc.LabelTTF.prototype.updateDisplayedOpacity=cc.Sprite.prototype.updateDisplayedOpacity,cc.LabelTTF.prototype.initWithStringAndTextDefinition=cc.LabelTTF.prototype._initWithStringAndTextDefinitionForWebGL,cc.LabelTTF.prototype.setFontFillColor=cc.LabelTTF.prototype._setFontFillColorForWebGL,cc.LabelTTF.prototype.draw=cc.LabelTTF.prototype._drawForWebGL,cc.LabelTTF.prototype.setTextureRect=cc.Sprite.prototype._setTextureRectForWebGL):(cc.LabelTTF.prototype.setColor=cc.LabelTTF.prototype._setColorForCanvas,cc.LabelTTF.prototype._setColorsString=cc.LabelTTF.prototype._setColorsStringForCanvas,cc.LabelTTF.prototype.updateDisplayedColor=cc.LabelTTF.prototype._updateDisplayedColorForCanvas,cc.LabelTTF.prototype.setOpacity=cc.LabelTTF.prototype._setOpacityForCanvas,cc.LabelTTF.prototype.updateDisplayedOpacity=cc.LabelTTF.prototype._updateDisplayedOpacityForCanvas,cc.LabelTTF.prototype.initWithStringAndTextDefinition=cc.LabelTTF.prototype._initWithStringAndTextDefinitionForCanvas,cc.LabelTTF.prototype.setFontFillColor=cc.LabelTTF.prototype._setFontFillColorForCanvas,cc.LabelTTF.prototype.draw=cc.Sprite.prototype.draw,cc.LabelTTF.prototype.setTextureRect=cc.LabelTTF.prototype._setTextureRectForCanvas),cc.LabelTTF._textAlign=["left","center","right"],cc.LabelTTF._textBaseline=["top","middle","bottom"],cc.LabelTTF._checkRegEx=/(.+?)([\s\n\r\-\/\\\:]|[\u4E00-\u9FA5]|[\uFE30-\uFFA0])/,cc.LabelTTF._reverseCheckRegEx=/(.*)([\s\n\r\-\/\\\:]|[\u4E00-\u9FA5]|[\uFE30-\uFFA0])/,cc.LabelTTF._checkEnRegEx=/[\s\-\/\\\:]/,cc.LabelTTF.create=function(e,t,n,r,i,s){var o=new cc.LabelTTF;return o.initWithString(e,t,n,r,i,s)?o:null},cc.LabelTTF.createWithFontDefinition=function(e,t){var n=new cc.LabelTTF;return n&&n.initWithStringAndTextDefinition(e,t)?n:null},cc.USE_LA88_LABELS?cc.LabelTTF._SHADER_PROGRAM=cc.SHADER_POSITION_TEXTURECOLOR:cc.LabelTTF._SHADER_PROGRAM=cc.SHADER_POSITION_TEXTUREA8COLOR,cc.LabelTTF.__labelHeightDiv=document.createElement("div"),cc.LabelTTF.__labelHeightDiv.style.fontFamily="Arial",cc.LabelTTF.__labelHeightDiv.style.position="absolute",cc.LabelTTF.__labelHeightDiv.style.left="-100px",cc.LabelTTF.__labelHeightDiv.style.top="-100px",cc.LabelTTF.__labelHeightDiv.style.lineHeight="normal",document.body.appendChild(cc.LabelTTF.__labelHeightDiv),cc.LabelTTF.__getFontHeightByDiv=function(e,t){var n=cc.LabelTTF.__fontHeightCache[e+"."+t];if(n>0)return n;var r=cc.LabelTTF.__labelHeightDiv;return r.innerHTML="ajghl~!",r.style.fontFamily=e,r.style.fontSize=t+"px",n=r.clientHeight,cc.LabelTTF.__fontHeightCache[e+"."+t]=n,r.innerHTML="",n},cc.LabelTTF.__fontHeightCache={},cc.HashElement=cc.Class.extend({actions:null,target:null,actionIndex:0,currentAction:null,currentActionSalvaged:!1,paused:!1,hh:null,ctor:function(){this.actions=[],this._target=null,this.actionIndex=0,this.currentAction=null,this.currentActionSalvaged=!1,this.paused=!1,this.hh=null}}),cc.ActionManager=cc.Class.extend({_hashTargets:null,_arrayTargets:null,_currentTarget:null,_currentTargetSalvaged:!1,_searchElementByTarget:function(e,t){for(var n=0;n<e.length;n++)if(t==e[n].target)return e[n];return null},ctor:function(){this._hashTargets={},this._arrayTargets=[],this._currentTarget=null,this._currentTargetSalvaged=!1},addAction:function(e,t,n){if(!e)throw"cc.ActionManager.addAction(): action must be non-null";if(!t)throw"cc.ActionManager.addAction(): action must be non-null";var r=this._hashTargets[t.__instanceId];r||(r=new cc.HashElement,r.paused=n,r.target=t,this._hashTargets[t.__instanceId]=r,this._arrayTargets.push(r)),this._actionAllocWithHashElement(r),r.actions.push(e),e.startWithTarget(t)},removeAllActions:function(){var e=this._arrayTargets;for(var t=0;t<e.length;t++){var n=e[t];n&&this.removeAllActionsFromTarget(n.target,!0)}},removeAllActionsFromTarget:function(e,t){if(e==null)return;var n=this._hashTargets[e.__instanceId];n&&(n.actions.indexOf(n.currentAction)!==-1&&!n.currentActionSalvaged&&(n.currentActionSalvaged=!0),n.actions.length=0,this._currentTarget==n&&!t?this._currentTargetSalvaged=!0:this._deleteHashElement(n))},removeAction:function(e){if(e==null)return;var t=e.getOriginalTarget(),n=this._hashTargets[t.__instanceId];if(n){for(var r=0;r<n.actions.length;r++)if(n.actions[r]==e){n.actions.splice(r,1);break}}else cc.log("cocos2d: removeAction: Target not found")},removeActionByTag:function(e,t){e==cc.ACTION_TAG_INVALID&&cc.log("cc.ActionManager.removeActionByTag(): an invalid tag");if(!t)throw"cc.ActionManager.removeActionByTag(): target must be non-null";var n=this._hashTargets[t.__instanceId];if(n){var r=n.actions.length;for(var i=0;i<r;++i){var s=n.actions[i];if(s&&s.getTag()===e&&s.getOriginalTarget()==t){this._removeActionAtIndex(i,n);break}}}},getActionByTag:function(e,t){e==cc.ACTION_TAG_INVALID&&cc.log("cc.ActionManager.getActionByTag(): an invalid tag");var n=this._hashTargets[t.__instanceId];if(n){if(n.actions!=null)for(var r=0;r<n.actions.length;++r){var i=n.actions[r];if(i&&i.getTag()===e)return i}cc.log("cocos2d : getActionByTag(tag ="+e+"): Action not found")}return null},numberOfRunningActionsInTarget:function(e){var t=this._hashTargets[e.__instanceId];return t?t.actions?t.actions.length:0:0},pauseTarget:function(e){var t=this._hashTargets[e.__instanceId];t&&(t.paused=!0)},resumeTarget:function(e){var t=this._hashTargets[e.__instanceId];t&&(t.paused=!1)},pauseAllRunningActions:function(){var e=[],t=this._arrayTargets;for(var n=0;n<t.length;n++){var r=t[n];r&&!r.paused&&(r.paused=!0,e.push(r.target))}return e},resumeTargets:function(e){if(!e)return;for(var t=0;t<e.length;t++)e[t]&&this.resumeTarget(e[t])},purgeSharedManager:function(){cc.Director.getInstance().getScheduler().unscheduleUpdateForTarget(this)},_removeActionAtIndex:function(e,t){var n=t.actions[e];n==t.currentAction&&!t.currentActionSalvaged&&(t.currentActionSalvaged=!0),cc.ArrayRemoveObjectAtIndex(t.actions,e),t.actionIndex>=e&&t.actionIndex--,t.actions.length==0&&(this._currentTarget==t?this._currentTargetSalvaged=!0:this._deleteHashElement(t))},_deleteHashElement:function(e){e&&(delete this._hashTargets[e.target.__instanceId],cc.ArrayRemoveObject(this._arrayTargets,e),e.actions=null,e.target=null)},_actionAllocWithHashElement:function(e){e.actions==null&&(e.actions=[])},update:function(e){var t=this._arrayTargets,n;for(var r=0;r<t.length;r++){this._currentTarget=t[r],n=this._currentTarget;if(!n.paused)for(n.actionIndex=0;n.actionIndex<n.actions.length;n.actionIndex++){n.currentAction=n.actions[n.actionIndex];if(!n.currentAction)continue;n.currentActionSalvaged=!1,n.currentAction.step(e);if(n.currentActionSalvaged)n.currentAction=null;else if(n.currentAction.isDone()){n.currentAction.stop();var i=n.currentAction;n.currentAction=null,this.removeAction(i)}n.currentAction=null}this._currentTargetSalvaged&&n.actions.length===0&&this._deleteHashElement(n)}}}),cc.kmScalar=Number,cc.kmBool=Number,cc.kmEnum=Number,cc.KM_FALSE=0,cc.KM_TRUE=1,cc.kmPI=3.141592,cc.kmPIOver180=.017453,cc.kmPIUnder180=57.295779,cc.kmEpsilon=1/64,cc.kmSQR=function(e){return e*e},cc.kmDegreesToRadians=function(e){return e*cc.kmPIOver180},cc.kmRadiansToDegrees=function(e){return e*cc.kmPIUnder180},cc.kmMin=function(e,t){return e<t?e:t},cc.kmMax=function(e,t){return e>t?e:t},cc.kmAlmostEqual=function(e,t){return e+cc.kmEpsilon>t&&e-cc.kmEpsilon<t},cc.kmVec2=function(e,t){this.x=e||0,this.y=t||0},cc.kmVec2Fill=function(e,t,n){return e.x=t,e.y=n,e},cc.kmVec2Length=function(e){return Math.sqrt(cc.kmSQR(e.x)+cc.kmSQR(e.y))},cc.kmVec2LengthSq=function(e){return cc.kmSQR(e.x)+cc.kmSQR(e.y)},cc.kmVec2Normalize=function(e,t){var n=1/cc.kmVec2Length(t),r=new cc.kmVec2;return r.x=t.x*n,r.y=t.y*n,e.x=r.x,e.y=r.y,e},cc.kmVec2Add=function(e,t,n){return e.x=t.x+n.x,e.y=t.y+n.y,e},cc.kmVec2Dot=function(e,t){return e.x*t.x+e.y*t.y},cc.kmVec2Subtract=function(e,t,n){return e.x=t.x-n.x,e.y=t.y-n.y,e},cc.kmVec2Transform=function(e,t,n){var r=new cc.kmVec2;return r.x=t.x*n.mat[0]+t.y*n.mat[3]+n.mat[6],r.y=t.x*n.mat[1]+t.y*n.mat[4]+n.mat[7],e.x=r.x,e.y=r.y,e},cc.kmVec2TransformCoord=function(e,t,n){return null},cc.kmVec2Scale=function(e,t,n){return e.x=t.x*n,e.y=t.y*n,e},cc.kmVec2AreEqual=function(e,t){return e.x<t.x+cc.kmEpsilon&&e.x>t.x-cc.kmEpsilon&&e.y<t.y+cc.kmEpsilon&&e.y>t.y-cc.kmEpsilon},cc.kmVec3=function(e,t,n){this.x=e||0,this.y=t||0,this.z=n||0},cc.kmVec3Fill=function(e,t,n,r){return e?(e.x=t,e.y=n,e.z=r,e):new cc.kmVec3(t,n,r)},cc.kmVec3Length=function(e){return Math
.sqrt(cc.kmSQR(e.x)+cc.kmSQR(e.y)+cc.kmSQR(e.z))},cc.kmVec3LengthSq=function(e){return cc.kmSQR(e.x)+cc.kmSQR(e.y)+cc.kmSQR(e.z)},cc.kmVec3Normalize=function(e,t){var n=1/cc.kmVec3Length(t);return e.x=t.x*n,e.y=t.y*n,e.z=t.z*n,e},cc.kmVec3Cross=function(e,t,n){return e.x=t.y*n.z-t.z*n.y,e.y=t.z*n.x-t.x*n.z,e.z=t.x*n.y-t.y*n.x,e},cc.kmVec3Dot=function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z},cc.kmVec3Add=function(e,t,n){return e.x=t.x+n.x,e.y=t.y+n.y,e.z=t.z+n.z,e},cc.kmVec3Subtract=function(e,t,n){return e.x=t.x-n.x,e.y=t.y-n.y,e.z=t.z-n.z,e},cc.kmVec3Transform=function(e,t,n){return e.x=t.x*n.mat[0]+t.y*n.mat[4]+t.z*n.mat[8]+n.mat[12],e.y=t.x*n.mat[1]+t.y*n.mat[5]+t.z*n.mat[9]+n.mat[13],e.z=t.x*n.mat[2]+t.y*n.mat[6]+t.z*n.mat[10]+n.mat[14],e},cc.kmVec3TransformNormal=function(e,t,n){return e.x=t.x*n.mat[0]+t.y*n.mat[4]+t.z*n.mat[8],e.y=t.x*n.mat[1]+t.y*n.mat[5]+t.z*n.mat[9],e.z=t.x*n.mat[2]+t.y*n.mat[6]+t.z*n.mat[10],e},cc.kmVec3TransformCoord=function(e,t,n){var r=new cc.kmVec4,i=new cc.kmVec4;return cc.kmVec4Fill(i,t.x,t.y,t.z,1),cc.kmVec4Transform(r,i,n),e.x=r.x/r.w,e.y=r.y/r.w,e.z=r.z/r.w,e},cc.kmVec3Scale=function(e,t,n){return e.x=t.x*n,e.y=t.y*n,e.z=t.z*n,e},cc.kmVec3AreEqual=function(e,t){return e.x<t.x+cc.kmEpsilon&&e.x>t.x-cc.kmEpsilon&&e.y<t.y+cc.kmEpsilon&&e.y>t.y-cc.kmEpsilon&&e.z<t.z+cc.kmEpsilon&&e.z>t.z-cc.kmEpsilon?1:0},cc.kmVec3InverseTransform=function(e,t,n){var r=new cc.kmVec3(t.x-n.mat[12],t.y-n.mat[13],t.z-n.mat[14]);return e.x=r.x*n.mat[0]+r.y*n.mat[1]+r.z*n.mat[2],e.y=r.x*n.mat[4]+r.y*n.mat[5]+r.z*n.mat[6],e.z=r.x*n.mat[8]+r.y*n.mat[9]+r.z*n.mat[10],e},cc.kmVec3InverseTransformNormal=function(e,t,n){return e.x=t.x*n.mat[0]+t.y*n.mat[1]+t.z*n.mat[2],e.y=t.x*n.mat[4]+t.y*n.mat[5]+t.z*n.mat[6],e.z=t.x*n.mat[8]+t.y*n.mat[9]+t.z*n.mat[10],e},cc.kmVec3Assign=function(e,t){return e==t?e:(e.x=t.x,e.y=t.y,e.z=t.z,e)},cc.kmVec3Zero=function(e){return e.x=0,e.y=0,e.z=0,e},cc.kmVec3ToTypeArray=function(e){if(!e)return null;var t=new Float32Array(3);return t[0]=e.x,t[1]=e.y,t[2]=e.z,t},cc.kmVec4=function(e,t,n,r){this.x=e||0,this.y=t||0,this.z=n||0,this.w=r||0},cc.kmVec4Fill=function(e,t,n,r,i){return e.x=t,e.y=n,e.z=r,e.w=i,e},cc.kmVec4Add=function(e,t,n){return e.x=t.x+n.x,e.y=t.y+n.y,e.z=t.z+n.z,e.w=t.w+n.w,e},cc.kmVec4Dot=function(e,t){return e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w},cc.kmVec4Length=function(e){return Math.sqrt(cc.kmSQR(e.x)+cc.kmSQR(e.y)+cc.kmSQR(e.z)+cc.kmSQR(e.w))},cc.kmVec4LengthSq=function(e){return cc.kmSQR(e.x)+cc.kmSQR(e.y)+cc.kmSQR(e.z)+cc.kmSQR(e.w)},cc.kmVec4Lerp=function(e,t,n,r){return e},cc.kmVec4Normalize=function(e,t){var n=1/cc.kmVec4Length(t);return e.x*=n,e.y*=n,e.z*=n,e.w*=n,e},cc.kmVec4Scale=function(e,t,n){return cc.kmVec4Normalize(e,t),e.x*=n,e.y*=n,e.z*=n,e.w*=n,e},cc.kmVec4Subtract=function(e,t,n){return e.x=t.x-n.x,e.y=t.y-n.y,e.z=t.z-n.z,e.w=t.w-n.w,e},cc.kmVec4Transform=function(e,t,n){return e.x=t.x*n.mat[0]+t.y*n.mat[4]+t.z*n.mat[8]+t.w*n.mat[12],e.y=t.x*n.mat[1]+t.y*n.mat[5]+t.z*n.mat[9]+t.w*n.mat[13],e.z=t.x*n.mat[2]+t.y*n.mat[6]+t.z*n.mat[10]+t.w*n.mat[14],e.w=t.x*n.mat[3]+t.y*n.mat[7]+t.z*n.mat[11]+t.w*n.mat[15],e},cc.kmVec4TransformArray=function(e,t,n,r,i,s){var o=0;while(o<s){var u=n+o*r,a=e+o*t;cc.kmVec4Transform(a,u,i),++o}return e},cc.kmVec4AreEqual=function(e,t){return e.x<t.x+cc.kmEpsilon&&e.x>t.x-cc.kmEpsilon&&e.y<t.y+cc.kmEpsilon&&e.y>t.y-cc.kmEpsilon&&e.z<t.z+cc.kmEpsilon&&e.z>t.z-cc.kmEpsilon&&e.w<t.w+cc.kmEpsilon&&e.w>t.w-cc.kmEpsilon},cc.kmVec4Assign=function(e,t){return e==t?(cc.log("destVec and srcVec are same object"),e):(e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e)},cc.kmVec4ToTypeArray=function(e){if(!e)return null;var t=new Float32Array(4);return t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w,t},cc.kmRay2=function(e,t){this.start=e||new cc.kmVec2,this.start=e||new cc.kmVec2},cc.kmRay2Fill=function(e,t,n,r,i){e.start.x=t,e.start.y=n,e.dir.x=r,e.dir.y=i},cc.kmRay2IntersectLineSegment=function(e,t,n,r){var i=e.start.x,s=e.start.y,o=e.start.x+e.dir.x,u=e.start.y+e.dir.y,a=t.x,f=t.y,l=n.x,c=n.y,h=(c-f)*(o-i)-(l-a)*(u-s),p,d,v;return h>-cc.kmEpsilon&&h<cc.kmEpsilon?cc.KM_FALSE:(p=((l-a)*(s-f)-(c-f)*(i-a))/h,d=i+p*(o-i),v=s+p*(u-s),d<cc.kmMin(t.x,n.x)-cc.kmEpsilon||d>cc.kmMax(t.x,n.x)+cc.kmEpsilon||v<cc.kmMin(t.y,n.y)-cc.kmEpsilon||v>cc.kmMax(t.y,n.y)+cc.kmEpsilon?cc.KM_FALSE:d<cc.kmMin(i,o)-cc.kmEpsilon||d>cc.kmMax(i,o)+cc.kmEpsilon||v<cc.kmMin(s,u)-cc.kmEpsilon||v>cc.kmMax(s,u)+cc.kmEpsilon?cc.KM_FALSE:(r.x=d,r.y=v,cc.KM_TRUE))},cc.calculate_line_normal=function(e,t,n){var r=new cc.kmVec2;cc.kmVec2Subtract(r,t,e),n.x=-r.y,n.y=r.x,cc.kmVec2Normalize(n,n)},cc.kmRay2IntersectTriangle=function(e,t,n,r,i,s){var o=new cc.kmVec2,u=new cc.kmVec2,a=new cc.kmVec2,f=1e4,l=cc.KM_FALSE,c,h;return cc.kmRay2IntersectLineSegment(e,t,n,o)&&(c=new cc.kmVec2,l=cc.KM_TRUE,h=cc.kmVec2Length(cc.kmVec2Subtract(c,o,e.start)),h<f&&(u.x=o.x,u.y=o.y,f=h,cc.calculate_line_normal(t,n,a))),cc.kmRay2IntersectLineSegment(e,n,r,o)&&(c=new cc.kmVec2,l=cc.KM_TRUE,h=cc.kmVec2Length(cc.kmVec2Subtract(c,o,e.start)),h<f&&(u.x=o.x,u.y=o.y,f=h,cc.calculate_line_normal(n,r,a))),cc.kmRay2IntersectLineSegment(e,r,t,o)&&(c=new cc.kmVec2,l=cc.KM_TRUE,h=cc.kmVec2Length(cc.kmVec2Subtract(c,o,e.start)),h<f&&(u.x=o.x,u.y=o.y,f=h,cc.calculate_line_normal(r,t,a))),l&&(i.x=u.x,i.y=u.y,s&&(s.x=a.x,s.y=a.y)),l},cc.kmRay2IntersectCircle=function(e,t,n,r){cc.log("cc.kmRay2IntersectCircle() has not been implemented.")};var Float32Array=Float32Array||Array;cc.kmMat3=function(){this.mat=new Float32Array([0,0,0,0,0,0,0,0,0])},cc.kmMat3Fill=function(e,t){for(var n=0;n<9;n++)e.mat[n]=t;return e},cc.kmMat3Adjugate=function(e,t){return e.mat[0]=t.mat[4]*t.mat[8]-t.mat[5]*t.mat[7],e.mat[1]=t.mat[2]*t.mat[7]-t.mat[1]*t.mat[8],e.mat[2]=t.mat[1]*t.mat[5]-t.mat[2]*t.mat[4],e.mat[3]=t.mat[5]*t.mat[6]-t.mat[3]*t.mat[8],e.mat[4]=t.mat[0]*t.mat[8]-t.mat[2]*t.mat[6],e.mat[5]=t.mat[2]*t.mat[3]-t.mat[0]*t.mat[5],e.mat[6]=t.mat[3]*t.mat[7]-t.mat[4]*t.mat[6],e.mat[8]=t.mat[0]*t.mat[4]-t.mat[1]*t.mat[3],e},cc.kmMat3Identity=function(e){return e.mat[1]=e.mat[2]=e.mat[3]=e.mat[5]=e.mat[6]=e.mat[7]=0,e.mat[0]=e.mat[4]=e.mat[8]=1,e},cc.kmMat3Inverse=function(e,t,n){var r,i=new cc.kmMat3;return t===0?null:(r=1/t,cc.kmMat3Adjugate(i,n),cc.kmMat3ScalarMultiply(e,i,r),e)},cc.kmMat3._identity=new Float32Array([1,0,0,0,1,0,0,0,1]),cc.kmMat3IsIdentity=function(e){for(var t=0;t<9;t++)if(cc.kmMat3._identity[t]!==e.mat[t])return!1;return!0},cc.kmMat3Transpose=function(e,t){var n,r;for(n=0;n<3;++n)for(r=0;r<3;++r)e.mat[n*3+r]=t.mat[r*3+n];return e},cc.kmMat3Determinant=function(e){var t;return t=e.mat[0]*e.mat[4]*e.mat[8]+e.mat[1]*e.mat[5]*e.mat[6]+e.mat[2]*e.mat[3]*e.mat[7],t-=e.mat[2]*e.mat[4]*e.mat[6]+e.mat[0]*e.mat[5]*e.mat[7]+e.mat[1]*e.mat[3]*e.mat[8],t},cc.kmMat3Multiply=function(e,t,n){var r=t.mat,i=n.mat;return e.mat[0]=r[0]*i[0]+r[3]*i[1]+r[6]*i[2],e.mat[1]=r[1]*i[0]+r[4]*i[1]+r[7]*i[2],e.mat[2]=r[2]*i[0]+r[5]*i[1]+r[8]*i[2],e.mat[3]=r[0]*i[3]+r[3]*i[4]+r[6]*i[5],e.mat[4]=r[1]*i[3]+r[4]*i[4]+r[7]*i[5],e.mat[5]=r[2]*i[3]+r[5]*i[4]+r[8]*i[5],e.mat[6]=r[0]*i[6]+r[3]*i[7]+r[6]*i[8],e.mat[7]=r[1]*i[6]+r[4]*i[7]+r[7]*i[8],e.mat[8]=r[2]*i[6]+r[5]*i[7]+r[8]*i[8],e},cc.kmMat3ScalarMultiply=function(e,t,n){for(var r=0;r<9;r++)e.mat[r]=t.mat[r]*n;return e},cc.kmMat3RotationAxisAngle=function(e,t,n){var r=Math.cos(n),i=Math.sin(n);return e.mat[0]=r+t.x*t.x*(1-r),e.mat[1]=t.z*i+t.y*t.x*(1-r),e.mat[2]=-t.y*i+t.z*t.x*(1-r),e.mat[3]=-t.z*i+t.x*t.y*(1-r),e.mat[4]=r+t.y*t.y*(1-r),e.mat[5]=t.x*i+t.z*t.y*(1-r),e.mat[6]=t.y*i+t.x*t.z*(1-r),e.mat[7]=-t.x*i+t.y*t.z*(1-r),e.mat[8]=r+t.z*t.z*(1-r),e},cc.kmMat3Assign=function(e,t){if(e==t)return cc.log("cc.kmMat3Assign(): pOut equals pIn"),e;for(var n=0;n<9;n++)e.mat[n]=t.mat[n];return e},cc.kmMat3AreEqual=function(e,t){if(e==t)return!0;for(var n=0;n<9;++n)if(!(e.mat[n]+cc.kmEpsilon>t.mat[n]&&e.mat[n]-cc.kmEpsilon<t.mat[n]))return!1;return!0},cc.kmMat3RotationX=function(e,t){return e.mat[0]=1,e.mat[1]=0,e.mat[2]=0,e.mat[3]=0,e.mat[4]=Math.cos(t),e.mat[5]=Math.sin(t),e.mat[6]=0,e.mat[7]=-Math.sin(t),e.mat[8]=Math.cos(t),e},cc.kmMat3RotationY=function(e,t){return e.mat[0]=Math.cos(t),e.mat[1]=0,e.mat[2]=-Math.sin(t),e.mat[3]=0,e.mat[4]=1,e.mat[5]=0,e.mat[6]=Math.sin(t),e.mat[7]=0,e.mat[8]=Math.cos(t),e},cc.kmMat3RotationZ=function(e,t){return e.mat[0]=Math.cos(t),e.mat[1]=-Math.sin(t),e.mat[2]=0,e.mat[3]=Math.sin(t),e.mat[4]=Math.cos(t),e.mat[5]=0,e.mat[6]=0,e.mat[7]=0,e.mat[8]=1,e},cc.kmMat3Rotation=function(e,t){return e.mat[0]=Math.cos(t),e.mat[1]=Math.sin(t),e.mat[2]=0,e.mat[3]=-Math.sin(t),e.mat[4]=Math.cos(t),e.mat[5]=0,e.mat[6]=0,e.mat[7]=0,e.mat[8]=1,e},cc.kmMat3Scaling=function(e,t,n){return cc.kmMat3Identity(e),e.mat[0]=t,e.mat[4]=n,e},cc.kmMat3Translation=function(e,t,n){return cc.kmMat3Identity(e),e.mat[6]=t,e.mat[7]=n,e},cc.kmMat3RotationQuaternion=function(e,t){return!t||!e?null:(e.mat[0]=1-2*(t.y*t.y+t.z*t.z),e.mat[1]=2*(t.x*t.y-t.w*t.z),e.mat[2]=2*(t.x*t.z+t.w*t.y),e.mat[3]=2*(t.x*t.y+t.w*t.z),e.mat[4]=1-2*(t.x*t.x+t.z*t.z),e.mat[5]=2*(t.y*t.z-t.w*t.x),e.mat[6]=2*(t.x*t.z-t.w*t.y),e.mat[7]=2*(t.y*t.z+t.w*t.x),e.mat[8]=1-2*(t.x*t.x+t.y*t.y),e)},cc.kmMat3RotationToAxisAngle=function(e,t,n){var r;return cc.kmQuaternionRotationMatrix(r,n),cc.kmQuaternionToAxisAngle(r,e,t),e},cc.kmMat4=function(){this.mat=new Float32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0])},cc.kmMat4Fill=function(e,t){e.mat[0]=e.mat[1]=e.mat[2]=e.mat[3]=e.mat[4]=e.mat[5]=e.mat[6]=e.mat[7]=e.mat[8]=e.mat[9]=e.mat[10]=e.mat[11]=e.mat[12]=e.mat[13]=e.mat[14]=e.mat[15]=t},cc.kmMat4Identity=function(e){return e.mat[1]=e.mat[2]=e.mat[3]=e.mat[4]=e.mat[6]=e.mat[7]=e.mat[8]=e.mat[9]=e.mat[11]=e.mat[12]=e.mat[13]=e.mat[14]=0,e.mat[0]=e.mat[5]=e.mat[10]=e.mat[15]=1,e},cc.kmMat4._get=function(e,t,n){return e.mat[t+4*n]},cc.kmMat4._set=function(e,t,n,r){e.mat[t+4*n]=r},cc.kmMat4._swap=function(e,t,n,r,i){var s=cc.kmMat4._get(e,t,n);cc.kmMat4._set(e,t,n,cc.kmMat4._get(e,r,i)),cc.kmMat4._set(e,r,i,s)},cc.kmMat4._gaussj=function(e,t){var n,r=0,i=0,s,o,u,a,f=4,l=4,c,h,p,d=[0,0,0,0],v=[0,0,0,0],m=[0,0,0,0];for(n=0;n<f;n++){c=0;for(s=0;s<f;s++)if(m[s]!=1)for(o=0;o<f;o++)m[o]==0&&Math.abs(cc.kmMat4._get(e,s,o))>=c&&(c=Math.abs(cc.kmMat4._get(e,s,o)),i=s,r=o);++m[r];if(i!=r){for(u=0;u<f;u++)cc.kmMat4._swap(e,i,u,r,u);for(u=0;u<l;u++)cc.kmMat4._swap(t,i,u,r,u)}v[n]=i,d[n]=r;if(cc.kmMat4._get(e,r,r)==0)return cc.KM_FALSE;p=1/cc.kmMat4._get(e,r,r),cc.kmMat4._set(e,r,r,1);for(u=0;u<f;u++)cc.kmMat4._set(e,r,u,cc.kmMat4._get(e,r,u)*p);for(u=0;u<l;u++)cc.kmMat4._set(t,r,u,cc.kmMat4._get(t,r,u)*p);for(a=0;a<f;a++)if(a!=r){h=cc.kmMat4._get(e,a,r),cc.kmMat4._set(e,a,r,0);for(u=0;u<f;u++)cc.kmMat4._set(e,a,u,cc.kmMat4._get(e,a,u)-cc.kmMat4._get(e,r,u)*h);for(u=0;u<l;u++)cc.kmMat4._set(t,a,u,cc.kmMat4._get(e,a,u)-cc.kmMat4._get(t,r,u)*h)}}for(u=f-1;u>=0;u--)if(v[u]!=d[u])for(o=0;o<f;o++)cc.kmMat4._swap(e,o,v[u],o,d[u]);return cc.KM_TRUE},cc.kmMat4._identity=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),cc.kmMat4Inverse=function(e,t){var n=new cc.kmMat4,r=new cc.kmMat4;return cc.kmMat4Assign(n,t),cc.kmMat4Identity(r),cc.kmMat4._gaussj(n,r)==cc.KM_FALSE?null:(cc.kmMat4Assign(e,n),e)},cc.kmMat4IsIdentity=function(e){for(var t=0;t<16;t++)if(cc.kmMat4._identity[t]!=e.mat[t])return!1;return!0},cc.kmMat4Transpose=function(e,t){var n,r,i=e.mat,s=t.mat;for(r=0;r<4;++r)for(n=0;n<4;++n)i[r*4+n]=s[n*4+r];return e},cc.kmMat4Multiply=function(e,t,n){var r=e.mat,i=t.mat[0],s=t.mat[1],o=t.mat[2],u=t.mat[3],a=t.mat[4],f=t.mat[5],l=t.mat[6],c=t.mat[7],h=t.mat[8],p=t.mat[9],d=t.mat[10],v=t.mat[11],m=t.mat[12],g=t.mat[13],y=t.mat[14],b=t.mat[15],w=n.mat[0],E=n.mat[1],S=n.mat[2],x=n.mat[3],T=n.mat[4],N=n.mat[5],C=n.mat[6],k=n.mat[7],L=n.mat[8],A=n.mat[9],O=n.mat[10],M=n.mat[11],_=n.mat[12],D=n.mat[13],P=n.mat[14],H=n.mat[15];return r[0]=w*i+E*a+S*h+x*m,r[1]=w*s+E*f+S*p+x*g,r[2]=w*o+E*l+S*d+x*y,r[3]=w*u+E*c+S*v+x*b,r[4]=T*i+N*a+C*h+k*m,r[5]=T*s+N*f+C*p+k*g,r[6]=T*o+N*l+C*d+k*y,r[7]=T*u+N*c+C*v+k*b,r[8]=L*i+A*a+O*h+M*m,r[9]=L*s+A*f+O*p+M*g,r[10]=L*o+A*l+O*d+M*y,r[11]=L*u+A*c+O*v+M*b,r[12]=_*i+D*a+P*h+H*m,r[13]=_*s+D*f+P*p+H*g,r[14]=_*o+D*l+P*d+H*y,r[15]=_*u+D*c+P*v+H*b,e},cc.getMat4MultiplyValue=function(e,t){var n=e.mat,r=t.mat,i=new Float32Array(16);return i[0]=n[0]*r[0]+n[4]*r[1]+n[8]*r[2]+n[12]*r[3],i[1]=n[1]*r[0]+n[5]*r[1]+n[9]*r[2]+n[13]*r[3],i[2]=n[2]*r[0]+n[6]*r[1]+n[10]*r[2]+n[14]*r[3],i[3]=n[3]*r[0]+n[7]*r[1]+n[11]*r[2]+n[15]*r[3],i[4]=n[0]*r[4]+n[4]*r[5]+n[8]*r[6]+n[12]*r[7],i[5]=n[1]*r[4]+n[5]*r[5]+n[9]*r[6]+n[13]*r[7],i[6]=n[2]*r[4]+n[6]*r[5]+n[10]*r[6]+n[14]*r[7],i[7]=n[3]*r[4]+n[7]*r[5]+n[11]*r[6]+n[15]*r[7],i[8]=n[0]*r[8]+n[4]*r[9]+n[8]*r[10]+n[12]*r[11],i[9]=n[1]*r[8]+n[5]*r[9]+n[9]*r[10]+n[13]*r[11],i[10]=n[2]*r[8]+n[6]*r[9]+n[10]*r[10]+n[14]*r[11],i[11]=n[3]*r[8]+n[7]*r[9]+n[11]*r[10]+n[15]*r[11],i[12]=n[0]*r[12]+n[4]*r[13]+n[8]*r[14]+n[12]*r[15],i[13]=n[1]*r[12]+n[5]*r[13]+n[9]*r[14]+n[13]*r[15],i[14]=n[2]*r[12]+n[6]*r[13]+n[10]*r[14]+n[14]*r[15],i[15]=n[3]*r[12]+n[7]*r[13]+n[11]*r[14]+n[15]*r[15],i},cc.getMat4MultiplyWithMat4=function(e,t,n){var r=e.mat,i=t.mat,s=n.mat;return s[0]=r[0]*i[0]+r[4]*i[1]+r[8]*i[2]+r[12]*i[3],s[1]=r[1]*i[0]+r[5]*i[1]+r[9]*i[2]+r[13]*i[3],s[2]=r[2]*i[0]+r[6]*i[1]+r[10]*i[2]+r[14]*i[3],s[3]=r[3]*i[0]+r[7]*i[1]+r[11]*i[2]+r[15]*i[3],s[4]=r[0]*i[4]+r[4]*i[5]+r[8]*i[6]+r[12]*i[7],s[5]=r[1]*i[4]+r[5]*i[5]+r[9]*i[6]+r[13]*i[7],s[6]=r[2]*i[4]+r[6]*i[5]+r[10]*i[6]+r[14]*i[7],s[7]=r[3]*i[4]+r[7]*i[5]+r[11]*i[6]+r[15]*i[7],s[8]=r[0]*i[8]+r[4]*i[9]+r[8]*i[10]+r[12]*i[11],s[9]=r[1]*i[8]+r[5]*i[9]+r[9]*i[10]+r[13]*i[11],s[10]=r[2]*i[8]+r[6]*i[9]+r[10]*i[10]+r[14]*i[11],s[11]=r[3]*i[8]+r[7]*i[9]+r[11]*i[10]+r[15]*i[11],s[12]=r[0]*i[12]+r[4]*i[13]+r[8]*i[14]+r[12]*i[15],s[13]=r[1]*i[12]+r[5]*i[13]+r[9]*i[14]+r[13]*i[15],s[14]=r[2]*i[12]+r[6]*i[13]+r[10]*i[14]+r[14]*i[15],s[15]=r[3]*i[12]+r[7]*i[13]+r[11]*i[14]+r[15]*i[15],n.mat},cc.kmMat4Assign=function(e,t){if(e==t)return cc.log("cc.kmMat4Assign(): pOut equals pIn"),e;var n=e.mat,r=t.mat;return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],n[9]=r[9],n[10]=r[10],n[11]=r[11],n[12]=r[12],n[13]=r[13],n[14]=r[14],n[15]=r[15],e},cc.kmMat4AreEqual=function(e,t){if(e==t)return cc.log("cc.kmMat4AreEqual(): pMat1 and pMat2 are same object."),!0;for(var n=0;n<16;n++)if(!(e.mat[n]+cc.kmEpsilon>t.mat[n]&&e.mat[n]-cc.kmEpsilon<t.mat[n]))return!1;return!0},cc.kmMat4RotationX=function(e,t){return e.mat[0]=1,e.mat[1]=0,e.mat[2]=0,e.mat[3]=0,e.mat[4]=0,e.mat[5]=Math.cos(t),e.mat[6]=Math.sin(t),e.mat[7]=0,e.mat[8]=0,e.mat[9]=-Math.sin(t),e.mat[10]=Math.cos(t),e.mat[11]=0,e.mat[12]=0,e.mat[13]=0,e.mat[14]=0,e.mat[15]=1,e},cc.kmMat4RotationY=function(e,t){return e.mat[0]=Math.cos(t),e.mat[1]=0,e.mat[2]=-Math.sin(t),e.mat[3]=0,e.mat[4]=0,e.mat[5]=1,e.mat[6]=0,e.mat[7]=0,e.mat[8]=Math.sin(t),e.mat[9]=0,e.mat[10]=Math.cos(t),e.mat[11]=0,e.mat[12]=0,e.mat[13]=0,e.mat[14]=0,e.mat[15]=1,e},cc.kmMat4RotationZ=function(e,t){return e.mat[0]=Math.cos(t),e.mat[1]=Math.sin(t),e.mat[2]=0,e.mat[3]=0,e.mat[4]=-Math.sin(t),e.mat[5]=Math.cos(t),e.mat[6]=0,e.mat[7]=0,e.mat[8]=0,e.mat[9]=0,e.mat[10]=1,e.mat[11]=0,e.mat[12]=0,e.mat[13]=0,e.mat[14]=0,e.mat[15]=1,e},cc.kmMat4RotationPitchYawRoll=function(e,t,n,r){var i=Math.cos(t),s=Math.sin(t),o=Math.cos(n),u=Math.sin(n),a=Math.cos(r),f=Math.sin(r),l=s*u,c=i*u;return e.mat[0]=o*a,e.mat[4]=o*f,e.mat[8]=-u,e.mat[1]=l*a-i*f,e.mat[5]=l*f+i*a,e.mat[9]=s*o,e.mat[2]=c*a+s*f,e.mat[6]=c*f-s*a,e.mat[10]=i*o,e.mat[3]=e.mat[7]=e.mat[11]=0,e.mat[15]=1,e},cc.kmMat4RotationQuaternion=function(e,t){return e.mat[0]=1-2*(t.y*t.y+t.z*t.z),e.mat[1]=2*(t.x*t.y+t.z*t.w),e.mat[2]=2*(t.x*t.z-t.y*t.w),e.mat[3]=0,e.mat[4]=2*(t.x*t.y-t.z*t.w),e.mat[5]=1-2*(t.x*t.x+t.z*t.z),e.mat[6]=2*(t.z*t.y+t.x*t.w),e.mat[7]=0,e.mat[8]=2*(t.x*t.z+t.y*t.w),e.mat[9]=2*(t.y*t.z-t.x*t.w),e.mat[10]=1-2*(t.x*t.x+t.y*t.y),e.mat[11]=0,e.mat[12]=0,e.mat[13]=0,e.mat[14]=0,e.mat[15]=1,e},cc.kmMat4RotationTranslation=function(e,t,n){return e.mat[0]=t.mat[0],e.mat[1]=t.mat[1],e.mat[2]=t.mat[2],e.mat[3]=0,e.mat[4]=t.mat[3],e.mat[5]=t.mat[4],e.mat[6]=t.mat[5],e.mat[7]=0,e.mat[8]=t.mat[6],e.mat[9]=t.mat[7],e.mat[10]=t.mat[8],e.mat[11]=0,e.mat[12]=n.x,e.mat[13]=n.y,e.mat[14]=n.z,e.mat[15]=1,e},cc.kmMat4Scaling=function(e,t,n,r){return e.mat[0]=t,e.mat[5]=n,e.mat[10]=r,e.mat[15]=1,e.mat[1]=e.mat[2]=e.mat[3]=e.mat[4]=e.mat[6]=e.mat[7]=e.mat[8]=e.mat[9]=e.mat[11]=e.mat[12]=e.mat[13]=e.mat[14]=0,e},cc.kmMat4Translation=function(e,t,n,r){return e.mat[0]=e.mat[5]=e.mat[10]=e.mat[15]=1,e.mat[1]=e.mat[2]=e.mat[3]=e.mat[4]=e.mat[6]=e.mat[7]=e.mat[8]=e.mat[9]=e.mat[11]=0,e.mat[12]=t,e.mat[13]=n,e.mat[14]=r,e},cc.kmMat4GetUpVec3=function(e,t){return e.x=t.mat[4],e.y=t.mat[5],e.z=t.mat[6],cc.kmVec3Normalize(e,e),e},cc.kmMat4GetRightVec3=function(e,t){return e.x=t.mat[0],e.y=t.mat[1],e.z=t.mat[2],cc.kmVec3Normalize(e,e),e},cc.kmMat4GetForwardVec3=function(e,t){return e.x=t.mat[8],e.y=t.mat[9],e.z=t.mat[10],cc.kmVec3Normalize(e,e),e},cc.kmMat4PerspectiveProjection=function(e,t,n,r,i){var s=cc.kmDegreesToRadians(t/2),o=i-r,u=Math.sin(s);if(o==0||u==0||n==0)return null;var a=Math.cos(s)/u;return cc.kmMat4Identity(e),e.mat[0]=a/n,e.mat[5]=a,e.mat[10]=-(i+r)/o,e.mat[11]=-1,e.mat[14]=-2*r*i/o,e.mat[15]=0,e},cc.kmMat4OrthographicProjection=function(e,t,n,r,i,s,o){return cc.kmMat4Identity(e),e.mat[0]=2/(n-t),e.mat[5]=2/(i-r),e.mat[10]=-2/(o-s),e.mat[12]=-((n+t)/(n-t)),e.mat[13]=-((i+r)/(i-r)),e.mat[14]=-((o+s)/(o-s)),e},cc.kmMat4LookAt=function(e,t,n,r){var i=new cc.kmVec3,s=new cc.kmVec3,o=new cc.kmVec3,u=new cc.kmVec3,a=new cc.kmMat4;return cc.kmVec3Subtract(i,n,t),cc.kmVec3Normalize(i,i),cc.kmVec3Assign(s,r),cc.kmVec3Normalize(s,s),cc.kmVec3Cross(o,i,s),cc.kmVec3Normalize(o,o),cc.kmVec3Cross(u,o,i),cc.kmVec3Normalize(o,o),cc.kmMat4Identity(e),e.mat[0]=o.x,e.mat[4]=o.y,e.mat[8]=o.z,e.mat[1]=u.x,e.mat[5]=u.y,e.mat[9]=u.z,e.mat[2]=-i.x,e.mat[6]=-i.y,e.mat[10]=-i.z,cc.kmMat4Translation(a,-t.x,-t.y,-t.z),cc.kmMat4Multiply(e,e,a),e},cc.kmMat4RotationAxisAngle=function(e,t,n){var r=Math.cos(n),i=Math.sin(n),s=new cc.kmVec3;return cc.kmVec3Normalize(s,t),e.mat[0]=r+s.x*s.x*(1-r),e.mat[1]=s.z*i+s.y*s.x*(1-r),e.mat[2]=-s.y*i+s.z*s.x*(1-r),e.mat[3]=0,e.mat[4]=-s.z*i+s.x*s.y*(1-r),e.mat[5]=r+s.y*s.y*(1-r),e.mat[6]=s.x*i+s.z*s.y*(1-r),e.mat[7]=0,e.mat[8]=s.y*i+s.x*s.z*(1-r),e.mat[9]=-s.x*i+s.y*s.z*(1-r),e.mat[10]=r+s.z*s.z*(1-r),e.mat[11]=0,e.mat[12]=0,e.mat[13]=0,e.mat[14]=0,e.mat[15]=1,e},cc.kmMat4ExtractRotation=function(e,t){return e.mat[0]=t.mat[0],e.mat[1]=t.mat[1],e.mat[2]=t.mat[2],e.mat[3]=t.mat[4],e.mat[4]=t.mat[5],e.mat[5]=t.mat[6],e.mat[6]=t.mat[8],e.mat[7]=t.mat[9],e.mat[8]=t.mat[10],e},cc.kmMat4ExtractPlane=function(e,t,n){switch(n){case cc.KM_PLANE_RIGHT:e.a=t.mat[3]-t.mat[0],e.b=t.mat[7]-t.mat[4],e.c=t.mat[11]-t.mat[8],e.d=t.mat[15]-t.mat[12];break;case cc.KM_PLANE_LEFT:e.a=t.mat[3]+t.mat[0],e.b=t.mat[7]+t.mat[4],e.c=t.mat[11]+t.mat[8],e.d=t.mat[15]+t.mat[12];break;case cc.KM_PLANE_BOTTOM:e.a=t.mat[3]+t.mat[1],e.b=t.mat[7]+t.mat[5],e.c=t.mat[11]+t.mat[9],e.d=t.mat[15]+t.mat[13];break;case cc.KM_PLANE_TOP:e.a=t.mat[3]-t.mat[1],e.b=t.mat[7]-t.mat[5],e.c=t.mat[11]-t.mat[9],e.d=t.mat[15]-t.mat[13];break;case cc.KM_PLANE_FAR:e.a=t.mat[3]-t.mat[2],e.b=t.mat[7]-t.mat[6],e.c=t.mat[11]-t.mat[10],e.d=t.mat[15]-t.mat[14];break;case cc.KM_PLANE_NEAR:e.a=t.mat[3]+t.mat[2],e.b=t.mat[7]+t.mat[6],e.c=t.mat[11]+t.mat[10],e.d=t.mat[15]+t.mat[14];break;default:cc.log("cc.kmMat4ExtractPlane(): Invalid plane index")}var r=Math.sqrt(e.a*e.a+e.b*e.b+e.c*e.c);return e.a/=r,e.b/=r,e.c/=r,e.d/=r,e},cc.kmMat4RotationToAxisAngle=function(e,t,n){var r=new cc.kmQuaternion,i=new cc.kmMat3;return cc.kmMat4ExtractRotation(i,n),cc.kmQuaternionRotationMatrix(r,i),cc.kmQuaternionToAxisAngle(r,e,t),e},cc.KM_PLANE_LEFT=0,cc.KM_PLANE_RIGHT=1,cc.KM_PLANE_BOTTOM=2,cc.KM_PLANE_TOP=3,cc.KM_PLANE_NEAR=4,cc.KM_PLANE_FAR=5,cc.kmPlane=function(e,t,n,r){this.a=e||0,this.b=t||0,this.c=n||0,this.d=r||0},cc.POINT_INFRONT_OF_PLANE=0,cc.POINT_BEHIND_PLANE=1,cc.POINT_ON_PLANE=2,cc.kmPlaneDot=function(e,t){return e.a*t.x+e.b*t.y+e.c*t.z+e.d*t.w},cc.kmPlaneDotCoord=function(e,t){return e.a*t.x+e.b*t.y+e.c*t.z+e.d},cc.kmPlaneDotNormal=function(e,t){return e.a*t.x+e.b*t.y+e.c*t.z},cc.kmPlaneFromPointNormal=function(e,t,n){return e.a=n.x,e.b=n.y,e.c=n.z,e.d=-cc.kmVec3Dot(n,t),e},cc.kmPlaneFromPoints=function(e,t,n,r){var i=new cc.kmVec3,s=new cc.kmVec3,o=new cc.kmVec3;return cc.kmVec3Subtract(s,n,t),cc.kmVec3Subtract(o,r,t),cc.kmVec3Cross(i,s,o),cc.kmVec3Normalize(i,i),e.a=i.x,e.b=i.y,e.c=i.z,e.d=cc.kmVec3Dot(cc.kmVec3Scale(i,i,-1),t),e},cc.kmPlaneIntersectLine=function(e,t,n,r){throw"cc.kmPlaneIntersectLine() hasn't been implemented."},cc.kmPlaneNormalize=function(e,t){var n=new cc.kmVec3;n.x=t.a,n.y=t.b,n.z=t.c;var r=1/cc.kmVec3Length(n);return cc.kmVec3Normalize(n,n),e.a=n.x,e.b=n.y,e.c=n.z,e.d=t.d*r,e},cc.kmPlaneScale=function(e,t,n){cc.log("cc.kmPlaneScale() has not been implemented.")},cc.kmPlaneClassifyPoint=function(e,t){var n=e.a*t.x+e.b*t.y+e.c*t.z+e.d;return n>.001?cc.POINT_INFRONT_OF_PLANE:n<-0.001?cc.POINT_BEHIND_PLANE:cc.POINT_ON_PLANE},cc.kmQuaternion=function(e,t,n,r){this.x=e||0,this.y=t||0,this.z=n||0,this.w=r||0},cc.kmQuaternionConjugate=function(e,t){return e.x=-t.x,e.y=-t.y,e.z=-t.z,e.w=t.w,e},cc.kmQuaternionDot=function(e,t){return e.w*t.w+e.x*t.x+e.y*t.y+e.z*t.z},cc.kmQuaternionExp=function(e,t){return e},cc.kmQuaternionIdentity=function(e){return e.x=0,e.y=0,e.z=0,e.w=1,e},cc.kmQuaternionInverse=function(e,t){var n=cc.kmQuaternionLength(t),r=new cc.kmQuaternion;return Math.abs(n)>cc.kmEpsilon?(e.x=0,e.y=0,e.z=0,e.w=0,e):(cc.kmQuaternionScale(e,cc.kmQuaternionConjugate(r,t),1/n),e)},cc.kmQuaternionIsIdentity=function(e){return e.x==0&&e.y==0&&e.z==0&&e.w==1},cc.kmQuaternionLength=function(e){return Math.sqrt(cc.kmQuaternionLengthSq(e))},cc.kmQuaternionLengthSq=function(e){return e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w},cc.kmQuaternionLn=function(e,t){return e},cc.kmQuaternionMultiply=function(e,t,n){return e.w=t.w*n.w-t.x*n.x-t.y*n.y-t.z*n.z,e.x=t.w*n.x+t.x*n.w+t.y*n.z-t.z*n.y,e.y=t.w*n.y+t.y*n.w+t.z*n.x-t.x*n.z,e.z=t.w*n.z+t.z*n.w+t.x*n.y-t.y*n.x,e},cc.kmQuaternionNormalize=function(e,t){var n=cc.kmQuaternionLength(t);if(Math.abs(n)<=cc.kmEpsilon)throw"cc.kmQuaternionNormalize(): pIn is an invalid value";return cc.kmQuaternionScale(e,t,1/n),e},cc.kmQuaternionRotationAxis=function(e,t,n){var r=n*.5,i=Math.sin(r);return e.w=Math.cos(r),e.x=t.x*i,e.y=t.y*i,e.z=t.z*i,e},cc.kmQuaternionRotationMatrix=function(e,t){var n,r,i,s,o=[],u=0,a=0;if(!t)return null;o[0]=t.mat[0],o[1]=t.mat[3],o[2]=t.mat[6],o[4]=t.mat[1],o[5]=t.mat[4],o[6]=t.mat[7],o[8]=t.mat[2],o[9]=t.mat[5],o[10]=t.mat[8],o[15]=1;var f=o[0];return a=f[0]+f[5]+f[10]+1,a>cc.kmEpsilon?(u=Math.sqrt(a)*2,n=(f[9]-f[6])/u,r=(f[2]-f[8])/u,i=(f[4]-f[1])/u,s=.25*u):f[0]>f[5]&&f[0]>f[10]?(u=Math.sqrt(1+f[0]-f[5]-f[10])*2,n=.25*u,r=(f[4]+f[1])/u,i=(f[2]+f[8])/u,s=(f[9]-f[6])/u):f[5]>f[10]?(u=Math.sqrt(1+f[5]-f[0]-f[10])*2,n=(f[4]+f[1])/u,r=.25*u,i=(f[9]+f[6])/u,s=(f[2]-f[8])/u):(u=Math.sqrt(1+f[10]-f[0]-f[5])*2,n=(f[2]+f[8])/u,r=(f[9]+f[6])/u,i=.25*u,s=(f[4]-f[1])/u),e.x=n,e.y=r,e.z=i,e.w=s,e},cc.kmQuaternionRotationYawPitchRoll=function(e,t,n,r){var i,s,o,u,a,f,l,c,h,p,d;return i=cc.kmDegreesToRadians(n)/2,s=cc.kmDegreesToRadians(t)/2,o=cc.kmDegreesToRadians(r)/2,u=Math.cos(i),a=Math.cos(s),f=Math.cos(o),l=Math.sin(i),c=Math.sin(s),h=Math.sin(o),p=a*f,d=c*h,e.w=u*p+l*d,e.x=l*p-u*d,e.y=u*c*f+l*a*h,e.z=u*a*h-l*c*f,cc.kmQuaternionNormalize(e,e),e},cc.kmQuaternionSlerp=function(e,t,n,r){if(t.x==n.x&&t.y==n.y&&t.z==n.z&&t.w==n.w)return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e;var i=cc.kmQuaternionDot(t,n),s=Math.acos(i),o=Math.sqrt(1-cc.kmSQR(i)),u=Math.sin(r*s)/o,a=Math.sin((1-r)*s)/o,f=new cc.kmQuaternion,l=new cc.kmQuaternion;return cc.kmQuaternionScale(f,t,a),cc.kmQuaternionScale(l,n,u),cc.kmQuaternionAdd(e,f,l),e},cc.kmQuaternionToAxisAngle=function(e,t,n){var r,i;r=Math.acos(e.w),i=Math.sqrt(cc.kmSQR(e.x)+cc.kmSQR(e.y)+cc.kmSQR(e.z)),i>-cc.kmEpsilon&&i<cc.kmEpsilon||i<2*cc.kmPI+cc.kmEpsilon&&i>2*cc.kmPI-cc.kmEpsilon?(n=0,t.x=0,t.y=0,t.z=1):(n=r*2,t.x=e.x/i,t.y=e.y/i,t.z=e.z/i,cc.kmVec3Normalize(t,t))},cc.kmQuaternionScale=function(e,t,n){return e.x=t.x*n,e.y=t.y*n,e.z=t.z*n,e.w=t.w*n,e},cc.kmQuaternionAssign=function(e,t){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e},cc.kmQuaternionAdd=function(e,t,n){return e.x=t.x+n.x,e.y=t.y+n.y,e.z=t.z+n.z,e.w=t.w+n.w,e},cc.kmQuaternionRotationBetweenVec3=function(e,t,n,r){var i=new cc.kmVec3,s=new cc.kmVec3,o;cc.kmVec3Assign(i,t),cc.kmVec3Assign(s,n),cc.kmVec3Normalize(i,i),cc.kmVec3Normalize(s,s),o=cc.kmVec3Dot(i,s);if(o>=1)return cc.kmQuaternionIdentity(e),e;if(o<1e-6-1)if(Math.abs(cc.kmVec3LengthSq(r))<cc.kmEpsilon)cc.kmQuaternionRotationAxis(e,r,cc.kmPI);else{var u=new cc.kmVec3,a=new cc.kmVec3;a.x=1,a.y=0,a.z=0,cc.kmVec3Cross(u,a,t);if(Math.abs(cc.kmVec3LengthSq(u))<cc.kmEpsilon){var f=new cc.kmVec3;f.x=0,f.y=1,f.z=0,cc.kmVec3Cross(u,f,t)}cc.kmVec3Normalize(u,u),cc.kmQuaternionRotationAxis(e,u,cc.kmPI)}else{var l=Math.sqrt((1+o)*2),c=1/l,h=new cc.kmVec3;cc.kmVec3Cross(h,i,s),e.x=h.x*c,e.y=h.y*c,e.z=h.z*c,e.w=l*.5,cc.kmQuaternionNormalize(e,e)}return e},cc.kmQuaternionMultiplyVec3=function(e,t,n){var r=new cc.kmVec3,i=new cc.kmVec3,s=new cc.kmVec3;return s.x=t.x,s.y=t.y,s.z=t.z,cc.kmVec3Cross(r,s,n),cc.kmVec3Cross(i,s,r),cc.kmVec3Scale(r,r,2*t.w),cc.kmVec3Scale(i,i,2),cc.kmVec3Add(e,n,r),cc.kmVec3Add(e,e,i),e},cc.kmAABB=function(e,t){this.min=e||new cc.kmVec3,this.max=t||new cc.kmVec3},cc.kmAABBContainsPoint=function(e,t){return e.x>=t.min.x&&e.x<=t.max.x&&e.y>=t.min.y&&e.y<=t.max.y&&e.z>=t.min.z&&e.z<=t.max.z?cc.KM_TRUE:cc.KM_FALSE},cc.kmAABBAssign=function(e,t){return cc.kmVec3Assign(e.min,t.min),cc.kmVec3Assign(e.max,t.max),e},cc.kmAABBScale=function(e,t,n){cc.log("cc.kmAABBScale hasn't been supported.")},cc.km_mat4_stack=function(e,t,n,r){this.top=n,this.stack=r},cc.km_mat4_stack.INITIAL_SIZE=30,cc.km_mat4_stack_initialize=function(e){e.stack=[],e.top=null},cc.km_mat4_stack_push=function(e,t){e.stack.push(e.top),e.top=new cc.kmMat4,cc.kmMat4Assign(e.top,t)},cc.km_mat4_stack_pop=function(e,t){e.top=e.stack.pop()},cc.km_mat4_stack_release=function(e){e.stack=null,e.top=null,e=null},cc.KM_GL_MODELVIEW=5888,cc.KM_GL_PROJECTION=5889,cc.KM_GL_TEXTURE=5890,cc.modelview_matrix_stack=new cc.km_mat4_stack,cc.projection_matrix_stack=new cc.km_mat4_stack,cc.texture_matrix_stack=new cc.km_mat4_stack,cc.current_stack=null,cc.initialized=!1,cc.lazyInitialize=function(){if(!cc.initialized){var e=new cc.kmMat4;cc.km_mat4_stack_initialize(cc.modelview_matrix_stack),cc.km_mat4_stack_initialize(cc.projection_matrix_stack),cc.km_mat4_stack_initialize(cc.texture_matrix_stack),cc.current_stack=cc.modelview_matrix_stack,cc.initialized=!0,cc.kmMat4Identity(e),cc.km_mat4_stack_push(cc.modelview_matrix_stack,e),cc.km_mat4_stack_push(cc.projection_matrix_stack,e),cc.km_mat4_stack_push(cc.texture_matrix_stack,e)}},cc.lazyInitialize(),cc.kmGLFreeAll=function(){cc.km_mat4_stack_release(cc.modelview_matrix_stack),cc.km_mat4_stack_release(cc.projection_matrix_stack),cc.km_mat4_stack_release(cc.texture_matrix_stack),cc.initialized=!1,cc.current_stack=null},cc.kmGLPushMatrix=function(){cc.km_mat4_stack_push(cc.current_stack,cc.current_stack.top)},cc.kmGLPushMatrixWitMat4=function(e){cc.current_stack.stack.push(cc.current_stack.top),cc.kmMat4Assign(e,cc.current_stack.top),cc.current_stack.top=e},cc.kmGLPopMatrix=function(){cc.current_stack.top=cc.current_stack.stack.pop()},cc.kmGLMatrixMode=function(e){switch(e){case cc.KM_GL_MODELVIEW:cc.current_stack=cc.modelview_matrix_stack;break;case cc.KM_GL_PROJECTION:cc.current_stack=cc.projection_matrix_stack;break;case cc.KM_GL_TEXTURE:cc.current_stack=cc.texture_matrix_stack;break;default:throw"Invalid matrix mode specified"}},cc.kmGLLoadIdentity=function(){cc.kmMat4Identity(cc.current_stack.top)},cc.kmGLLoadMatrix=function(e){cc.kmMat4Assign(cc.current_stack.top,e)},cc.kmGLMultMatrix=function(e){cc.kmMat4Multiply(cc.current_stack.top,cc.current_stack.top,e)},cc.kmGLTranslatef=function(e,t,n){var r=new cc.kmMat4;cc.kmMat4Translation(r,e,t,n),cc.kmMat4Multiply(cc.current_stack.top,cc.current_stack.top,r)},cc.kmGLRotatef=function(e,t,n,r){var i=new cc.kmVec3(t,n,r),s=new cc.kmMat4;cc.kmMat4RotationAxisAngle(s,i,cc.kmDegreesToRadians(e)),cc.kmMat4Multiply(cc.current_stack.top,cc.current_stack.top,s)},cc.kmGLScalef=function(e,t,n){var r=new cc.kmMat4;cc.kmMat4Scaling(r,e,t,n),cc.kmMat4Multiply(cc.current_stack.top,cc.current_stack.top,r)},cc.kmGLGetMatrix=function(e,t){switch(e){case cc.KM_GL_MODELVIEW:cc.kmMat4Assign(t,cc.modelview_matrix_stack.top);break;case cc.KM_GL_PROJECTION:cc.kmMat4Assign(t,cc.projection_matrix_stack.top);break;case cc.KM_GL_TEXTURE:cc.kmMat4Assign(t,cc.texture_matrix_stack.top);break;default:throw"Invalid matrix mode specified"}},cc.SHADER_POSITION_UCOLOR_FRAG="                                           \nprecision lowp float;                    \n                                         \nvarying vec4 v_fragmentColor;            \n                                         \nvoid main()                              \n{                                        \n    gl_FragColor = v_fragmentColor;      \n}                                        \n",cc.SHADER_POSITION_UCOLOR_VERT="                                               \nattribute vec4 a_position;               \nuniform    vec4 u_color;                 \nuniform float u_pointSize;               \n                                         \nvarying lowp vec4 v_fragmentColor;       \n                                         \nvoid main(void)                          \n{                                        \n    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  \n    gl_PointSize = u_pointSize;          \n    v_fragmentColor = u_color;           \n}",cc.SHADER_POSITION_COLOR_FRAG="                                        \nprecision lowp float;                 \nvarying vec4 v_fragmentColor;         \n                                      \nvoid main()                           \n{                                     \n     gl_FragColor = v_fragmentColor;       \n} ",cc.SHADER_POSITION_COLOR_VERT="                                                \nattribute vec4 a_position;                \nattribute vec4 a_color;                   \n                                          \nvarying lowp vec4 v_fragmentColor;        \n                                          \nvoid main()                               \n{                                         \n    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  \n    v_fragmentColor = a_color;             \n}",cc.SHADER_POSITION_COLOR_LENGTH_TEXTURE_FRAG="                                               \n// #extension GL_OES_standard_derivatives : enable																			\n\nvarying mediump vec4 v_color;																								\nvarying mediump vec2 v_texcoord;																							    \n\nvoid main()																													\n{																															\n// #if defined GL_OES_standard_derivatives																					\n// gl_FragColor = v_color*smoothstep(0.0, length(fwidth(v_texcoord)), 1.0 - length(v_texcoord));							    \n// #else																														\ngl_FragColor = v_color * step(0.0, 1.0 - length(v_texcoord));														        \n// #endif																													\n}",cc.SHADER_POSITION_COLOR_LENGTH_TEXTURE_VERT="																	        \nattribute mediump vec4 a_position;									\nattribute mediump vec2 a_texcoord;									\nattribute mediump vec4 a_color;										\n\nvarying mediump vec4 v_color;										\nvarying mediump vec2 v_texcoord;									    \n\nvoid main()															\n{																	\n     v_color = a_color;//vec4(a_color.rgb * a_color.a, a_color.a);				\n     v_texcoord = a_texcoord;										\n																        \n    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  \n}",cc.SHADER_POSITION_TEXTURE_FRAG="                                             \nprecision lowp float;                      \n                                           \nvarying vec2 v_texCoord;                   \nuniform sampler2D CC_Texture0;             \n                                           \nvoid main()                                \n{                                          \n    gl_FragColor =  texture2D(CC_Texture0, v_texCoord);   \n}",cc.SHADER_POSITION_TEXTURE_VERT="                                                   \nattribute vec4 a_position;                   \nattribute vec2 a_texCoord;                  \n                                            \nvarying mediump vec2 v_texCoord;           \n                                           \nvoid main()                                \n{                                          \n    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  \n    v_texCoord = a_texCoord;               \n}"
,cc.SHADER_POSITION_TEXTURE_UCOLOR_FRAG="                                                \nprecision lowp float;                        \n                                             \nuniform vec4 u_color;                        \nvarying vec2 v_texCoord;                     \n                                             \nuniform sampler2D CC_Texture0;               \n                                             \nvoid main()                                  \n{                                            \n    gl_FragColor =  texture2D(CC_Texture0, v_texCoord) * u_color;    \n}",cc.SHADER_POSITION_TEXTURE_UCOLOR_VERT="                                               \nattribute vec4 a_position;                   \nattribute vec2 a_texCoord;                   \n                                             \nvarying mediump vec2 v_texCoord;             \n                                             \nvoid main()                                  \n{                                            \n    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  \n    v_texCoord = a_texCoord;                 \n}",cc.SHADER_POSITION_TEXTURE_A8COLOR_FRAG="                                               \nprecision lowp float;                        \n                                             \nvarying vec4 v_fragmentColor;                \nvarying vec2 v_texCoord;                     \nuniform sampler2D CC_Texture0;                 \n                                             \nvoid main()                                  \n{                                            \n    gl_FragColor = vec4( v_fragmentColor.rgb,         \n        v_fragmentColor.a * texture2D(CC_Texture0, v_texCoord).a   \n    );                                       \n}",cc.SHADER_POSITION_TEXTURE_A8COLOR_VERT="                                               \nattribute vec4 a_position;                   \nattribute vec2 a_texCoord;                   \nattribute vec4 a_color;                      \n                                             \nvarying lowp vec4 v_fragmentColor;           \nvarying mediump vec2 v_texCoord;             \n                                             \nvoid main()                                  \n{                                            \n    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  \n    v_fragmentColor = a_color;               \n    v_texCoord = a_texCoord;                 \n}",cc.SHADER_POSITION_TEXTURE_COLOR_FRAG="                                               \nprecision lowp float;                        \n                                             \nvarying vec4 v_fragmentColor;                \nvarying vec2 v_texCoord;                     \nuniform sampler2D CC_Texture0;               \n                                             \nvoid main()                                  \n{                                            \n    gl_FragColor = v_fragmentColor * texture2D(CC_Texture0, v_texCoord);         \n}",cc.SHADER_POSITION_TEXTURE_COLOR_VERT="                                               \nattribute vec4 a_position;                   \nattribute vec2 a_texCoord;                   \nattribute vec4 a_color;                      \n                                             \nvarying lowp vec4 v_fragmentColor;           \nvarying mediump vec2 v_texCoord;             \n                                             \nvoid main()                                  \n{                                            \n    gl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;  \n    v_fragmentColor = a_color;               \n    v_texCoord = a_texCoord;                 \n}",cc.SHADER_POSITION_TEXTURE_COLOR_ALPHATEST_FRAG="                                                  \nprecision lowp float;                           \n                                                \nvarying vec4 v_fragmentColor;                   \nvarying vec2 v_texCoord;                        \nuniform sampler2D CC_Texture0;                  \nuniform float CC_alpha_value;                   \n                                                \nvoid main()                                     \n{                                               \n    vec4 texColor = texture2D(CC_Texture0, v_texCoord);          \n                                                \n    // mimic: glAlphaFunc(GL_GREATER)           \n    //pass if ( incoming_pixel >= CC_alpha_value ) => fail if incoming_pixel < CC_alpha_value         \n                                                \n    if ( texColor.a <= CC_alpha_value )          \n        discard;                                \n                                                \n    gl_FragColor = texColor * v_fragmentColor;  \n}",cc.SHADEREX_SWITCHMASK_FRAG="                                                   \nprecision lowp float;                            \n                                                 \nvarying vec4 v_fragmentColor;                    \nvarying vec2 v_texCoord;                         \nuniform sampler2D u_texture;                     \nuniform sampler2D   u_mask;                      \n                                                 \nvoid main()                                      \n{                                                \n    vec4 texColor   = texture2D(u_texture, v_texCoord);          \n    vec4 maskColor  = texture2D(u_mask, v_texCoord);             \n    vec4 finalColor = vec4(texColor.r, texColor.g, texColor.b, maskColor.a * texColor.a);        \n    gl_FragColor    = v_fragmentColor * finalColor;              \n}",cc.SHADERTYPE_POSITION_TEXTURECOLOR=0,cc.SHADERTYPE_POSITION_TEXTURECOLOR_ALPHATEST=1,cc.SHADERTYPE_POSITION_COLOR=2,cc.SHADERTYPE_POSITION_TEXTURE=3,cc.SHADERTYPE_POSITION_TEXTURE_UCOLOR=4,cc.SHADERTYPE_POSITION_TEXTURE_A8COLOR=5,cc.SHADERTYPE_POSITION_UCOLOR=6,cc.SHADERTYPE_POSITION_LENGTH_TEXTURECOLOR=7,cc.SHADERTYPE_MAX=8,cc._sharedShaderCache=null,cc.ShaderCache=cc.Class.extend({_programs:null,_init:function(){return this.loadDefaultShaders(),!0},_loadDefaultShader:function(e,t){switch(t){case cc.SHADERTYPE_POSITION_TEXTURECOLOR:e.initWithVertexShaderByteArray(cc.SHADER_POSITION_TEXTURE_COLOR_VERT,cc.SHADER_POSITION_TEXTURE_COLOR_FRAG),e.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION),e.addAttribute(cc.ATTRIBUTE_NAME_COLOR,cc.VERTEX_ATTRIB_COLOR),e.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS);break;case cc.SHADERTYPE_POSITION_TEXTURECOLOR_ALPHATEST:e.initWithVertexShaderByteArray(cc.SHADER_POSITION_TEXTURE_COLOR_VERT,cc.SHADER_POSITION_TEXTURE_COLOR_ALPHATEST_FRAG),e.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION),e.addAttribute(cc.ATTRIBUTE_NAME_COLOR,cc.VERTEX_ATTRIB_COLOR),e.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS);break;case cc.SHADERTYPE_POSITION_COLOR:e.initWithVertexShaderByteArray(cc.SHADER_POSITION_COLOR_VERT,cc.SHADER_POSITION_COLOR_FRAG),e.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION),e.addAttribute(cc.ATTRIBUTE_NAME_COLOR,cc.VERTEX_ATTRIB_COLOR);break;case cc.SHADERTYPE_POSITION_TEXTURE:e.initWithVertexShaderByteArray(cc.SHADER_POSITION_TEXTURE_VERT,cc.SHADER_POSITION_TEXTURE_FRAG),e.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION),e.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS);break;case cc.SHADERTYPE_POSITION_TEXTURE_UCOLOR:e.initWithVertexShaderByteArray(cc.SHADER_POSITION_TEXTURE_UCOLOR_VERT,cc.SHADER_POSITION_TEXTURE_UCOLOR_FRAG),e.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION),e.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS);break;case cc.SHADERTYPE_POSITION_TEXTURE_A8COLOR:e.initWithVertexShaderByteArray(cc.SHADER_POSITION_TEXTURE_A8COLOR_VERT,cc.SHADER_POSITION_TEXTURE_A8COLOR_FRAG),e.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION),e.addAttribute(cc.ATTRIBUTE_NAME_COLOR,cc.VERTEX_ATTRIB_COLOR),e.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS);break;case cc.SHADERTYPE_POSITION_UCOLOR:e.initWithVertexShaderByteArray(cc.SHADER_POSITION_UCOLOR_VERT,cc.SHADER_POSITION_UCOLOR_FRAG),e.addAttribute("aVertex",cc.VERTEX_ATTRIB_POSITION);break;case cc.SHADERTYPE_POSITION_LENGTH_TEXTURECOLOR:e.initWithVertexShaderByteArray(cc.SHADER_POSITION_COLOR_LENGTH_TEXTURE_VERT,cc.SHADER_POSITION_COLOR_LENGTH_TEXTURE_FRAG),e.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION),e.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS),e.addAttribute(cc.ATTRIBUTE_NAME_COLOR,cc.VERTEX_ATTRIB_COLOR);break;default:cc.log("cocos2d: cc.ShaderCache._loadDefaultShader, error shader type");return}e.link(),e.updateUniforms()},ctor:function(){this._programs={}},loadDefaultShaders:function(){var e=new cc.GLProgram;this._loadDefaultShader(e,cc.SHADERTYPE_POSITION_TEXTURECOLOR),this._programs[cc.SHADER_POSITION_TEXTURECOLOR]=e,this._programs.ShaderPositionTextureColor=e,e=new cc.GLProgram,this._loadDefaultShader(e,cc.SHADERTYPE_POSITION_TEXTURECOLOR_ALPHATEST),this._programs[cc.SHADER_POSITION_TEXTURECOLORALPHATEST]=e,this._programs.ShaderPositionTextureColorAlphaTest=e,e=new cc.GLProgram,this._loadDefaultShader(e,cc.SHADERTYPE_POSITION_COLOR),this._programs[cc.SHADER_POSITION_COLOR]=e,this._programs.ShaderPositionColor=e,e=new cc.GLProgram,this._loadDefaultShader(e,cc.SHADERTYPE_POSITION_TEXTURE),this._programs[cc.SHADER_POSITION_TEXTURE]=e,this._programs.ShaderPositionTexture=e,e=new cc.GLProgram,this._loadDefaultShader(e,cc.SHADERTYPE_POSITION_TEXTURE_UCOLOR),this._programs[cc.SHADER_POSITION_TEXTURE_UCOLOR]=e,this._programs.ShaderPositionTextureUColor=e,e=new cc.GLProgram,this._loadDefaultShader(e,cc.SHADERTYPE_POSITION_TEXTURE_A8COLOR),this._programs[cc.SHADER_POSITION_TEXTUREA8COLOR]=e,this._programs.ShaderPositionTextureA8Color=e,e=new cc.GLProgram,this._loadDefaultShader(e,cc.SHADERTYPE_POSITION_UCOLOR),this._programs[cc.SHADER_POSITION_UCOLOR]=e,this._programs.ShaderPositionUColor=e,e=new cc.GLProgram,this._loadDefaultShader(e,cc.SHADERTYPE_POSITION_LENGTH_TEXTURECOLOR),this._programs[cc.SHADER_POSITION_LENGTHTEXTURECOLOR]=e,this._programs.ShaderPositionLengthTextureColor=e},reloadDefaultShaders:function(){var e=this.programForKey(cc.SHADER_POSITION_TEXTURECOLOR);e.reset(),this._loadDefaultShader(e,cc.SHADERTYPE_POSITION_TEXTURECOLOR),e=this.programForKey(cc.SHADER_POSITION_TEXTURECOLORALPHATEST),e.reset(),this._loadDefaultShader(e,cc.SHADERTYPE_POSITION_TEXTURECOLOR_ALPHATEST),e=this.programForKey(cc.SHADER_POSITION_COLOR),e.reset(),this._loadDefaultShader(e,cc.SHADERTYPE_POSITION_COLOR),e=this.programForKey(cc.SHADER_POSITION_TEXTURE),e.reset(),this._loadDefaultShader(e,cc.SHADERTYPE_POSITION_TEXTURE),e=this.programForKey(cc.SHADER_POSITION_TEXTURE_UCOLOR),e.reset(),this._loadDefaultShader(e,cc.SHADERTYPE_POSITION_TEXTURE_UCOLOR),e=this.programForKey(cc.SHADER_POSITION_TEXTUREA8COLOR),e.reset(),this._loadDefaultShader(e,cc.SHADERTYPE_POSITION_TEXTURE_A8COLOR),e=this.programForKey(cc.SHADER_POSITION_UCOLOR),e.reset(),this._loadDefaultShader(e,cc.SHADERTYPE_POSITION_UCOLOR)},programForKey:function(e){return this._programs[e]},getProgram:function(e){return this._programs[e]},addProgram:function(e,t){this._programs[t]=e}}),cc.ShaderCache.getInstance=function(){return cc._sharedShaderCache||(cc._sharedShaderCache=new cc.ShaderCache,cc._sharedShaderCache._init()),cc._sharedShaderCache},cc.ShaderCache.purgeSharedShaderCache=function(){cc._sharedShaderCache=null},cc.VERTEX_ATTRIB_POSITION=0,cc.VERTEX_ATTRIB_COLOR=1,cc.VERTEX_ATTRIB_TEX_COORDS=2,cc.VERTEX_ATTRIB_MAX=3,cc.UNIFORM_PMATRIX=0,cc.UNIFORM_MVMATRIX=1,cc.UNIFORM_MVPMATRIX=2,cc.UNIFORM_TIME=3,cc.UNIFORM_SINTIME=4,cc.UNIFORM_COSTIME=5,cc.UNIFORM_RANDOM01=6,cc.UNIFORM_SAMPLER=7,cc.UNIFORM_MAX=8,cc.SHADER_POSITION_TEXTURECOLOR="ShaderPositionTextureColor",cc.SHADER_POSITION_TEXTURECOLORALPHATEST="ShaderPositionTextureColorAlphaTest",cc.SHADER_POSITION_COLOR="ShaderPositionColor",cc.SHADER_POSITION_TEXTURE="ShaderPositionTexture",cc.SHADER_POSITION_TEXTURE_UCOLOR="ShaderPositionTexture_uColor",cc.SHADER_POSITION_TEXTUREA8COLOR="ShaderPositionTextureA8Color",cc.SHADER_POSITION_UCOLOR="ShaderPosition_uColor",cc.SHADER_POSITION_LENGTHTEXTURECOLOR="ShaderPositionLengthTextureColor",cc.UNIFORM_PMATRIX_S="CC_PMatrix",cc.UNIFORM_MVMATRIX_S="CC_MVMatrix",cc.UNIFORM_MVPMATRIX_S="CC_MVPMatrix",cc.UNIFORM_TIME_S="CC_Time",cc.UNIFORM_SINTIME_S="CC_SinTime",cc.UNIFORM_COSTIME_S="CC_CosTime",cc.UNIFORM_RANDOM01_S="CC_Random01",cc.UNIFORM_SAMPLER_S="CC_Texture0",cc.UNIFORM_ALPHA_TEST_VALUE_S="CC_alpha_value",cc.ATTRIBUTE_NAME_COLOR="a_color",cc.ATTRIBUTE_NAME_POSITION="a_position",cc.ATTRIBUTE_NAME_TEX_COORD="a_texCoord",cc.HashUniformEntry=function(e,t,n){this.value=e,this.location=t,this.hh=n||{}},cc.GLProgram=cc.Class.extend({_glContext:null,_programObj:null,_vertShader:null,_fragShader:null,_uniforms:null,_hashForUniforms:null,_usesTime:!1,_updateUniformLocation:function(e,t,n){if(e==null)return!1;var r=!0,i=null;for(var s=0;s<this._hashForUniforms.length;s++)this._hashForUniforms[s].location==e&&(i=this._hashForUniforms[s]);return i?i.value==t?r=!1:i.value=t:(i=new cc.HashUniformEntry,i.location=e,i.value=t,this._hashForUniforms.push(i)),r},_description:function(){return"<CCGLProgram = "+this.toString()+" | Program = "+this._programObj.toString()+", VertexShader = "+this._vertShader.toString()+", FragmentShader = "+this._fragShader.toString()+">"},_compileShader:function(e,t,n){if(!n||!e)return!1;n="precision highp float;        \nuniform mat4 CC_PMatrix;         \nuniform mat4 CC_MVMatrix;        \nuniform mat4 CC_MVPMatrix;       \nuniform vec4 CC_Time;            \nuniform vec4 CC_SinTime;         \nuniform vec4 CC_CosTime;         \nuniform vec4 CC_Random01;        \n//CC INCLUDES END                \n  \n"+n,this._glContext.shaderSource(e,n),this._glContext.compileShader(e);var r=this._glContext.getShaderParameter(e,this._glContext.COMPILE_STATUS);return r||(cc.log("cocos2d: ERROR: Failed to compile shader:\n"+this._glContext.getShaderSource(e)),t==this._glContext.VERTEX_SHADER?cc.log("cocos2d: \n"+this.vertexShaderLog()):cc.log("cocos2d: \n"+this.fragmentShaderLog())),r==1},ctor:function(e){this._programObj=null,this._vertShader=null,this._fragShader=null,this._uniforms=[],this._hashForUniforms=[],this._glContext=e||cc.renderContext},destroyProgram:function(){this._vertShader=null,this._fragShader=null,this._uniforms=null,this._hashForUniforms=null,this._glContext.deleteProgram(this._programObj)},initWithVertexShaderByteArray:function(e,t){var n=this._glContext;return this._programObj=n.createProgram(),this._vertShader=null,this._fragShader=null,e&&(this._vertShader=n.createShader(n.VERTEX_SHADER),this._compileShader(this._vertShader,n.VERTEX_SHADER,e)||cc.log("cocos2d: ERROR: Failed to compile vertex shader")),t&&(this._fragShader=n.createShader(n.FRAGMENT_SHADER),this._compileShader(this._fragShader,n.FRAGMENT_SHADER,t)||cc.log("cocos2d: ERROR: Failed to compile fragment shader")),this._vertShader&&n.attachShader(this._programObj,this._vertShader),cc.CHECK_GL_ERROR_DEBUG(),this._fragShader&&n.attachShader(this._programObj,this._fragShader),this._hashForUniforms.length=0,cc.CHECK_GL_ERROR_DEBUG(),!0},initWithString:function(e,t){return this.initWithVertexShaderByteArray(e,t)},initWithVertexShaderFilename:function(e,t){var n=cc.FileUtils.getInstance(),r=n.getTextFileData(e),i=n.getTextFileData(t);return this.initWithVertexShaderByteArray(r,i)},init:function(e,t){return this.initWithVertexShaderFilename(e,t)},addAttribute:function(e,t){this._glContext.bindAttribLocation(this._programObj,t,e)},link:function(){if(!this._programObj)return cc.log("cc.GLProgram.link(): Cannot link invalid program"),!1;this._glContext.linkProgram(this._programObj),this._vertShader&&this._glContext.deleteShader(this._vertShader),this._fragShader&&this._glContext.deleteShader(this._fragShader),this._vertShader=null,this._fragShader=null;if(cc.COCOS2D_DEBUG){var e=this._glContext.getProgramParameter(this._programObj,this._glContext.LINK_STATUS);if(!e)return cc.log("cocos2d: ERROR: Failed to link program: "+this._glContext.getProgramInfoLog(this._programObj)),cc.glDeleteProgram(this._programObj),this._programObj=null,!1}return!0},use:function(){cc.glUseProgram(this._programObj)},updateUniforms:function(){this._uniforms[cc.UNIFORM_PMATRIX]=this._glContext.getUniformLocation(this._programObj,cc.UNIFORM_PMATRIX_S),this._uniforms[cc.UNIFORM_MVMATRIX]=this._glContext.getUniformLocation(this._programObj,cc.UNIFORM_MVMATRIX_S),this._uniforms[cc.UNIFORM_MVPMATRIX]=this._glContext.getUniformLocation(this._programObj,cc.UNIFORM_MVPMATRIX_S),this._uniforms[cc.UNIFORM_TIME]=this._glContext.getUniformLocation(this._programObj,cc.UNIFORM_TIME_S),this._uniforms[cc.UNIFORM_SINTIME]=this._glContext.getUniformLocation(this._programObj,cc.UNIFORM_SINTIME_S),this._uniforms[cc.UNIFORM_COSTIME]=this._glContext.getUniformLocation(this._programObj,cc.UNIFORM_COSTIME_S),this._usesTime=this._uniforms[cc.UNIFORM_TIME]!=null||this._uniforms[cc.UNIFORM_SINTIME]!=null||this._uniforms[cc.UNIFORM_COSTIME]!=null,this._uniforms[cc.UNIFORM_RANDOM01]=this._glContext.getUniformLocation(this._programObj,cc.UNIFORM_RANDOM01_S),this._uniforms[cc.UNIFORM_SAMPLER]=this._glContext.getUniformLocation(this._programObj,cc.UNIFORM_SAMPLER_S),this.use(),this.setUniformLocationWith1i(this._uniforms[cc.UNIFORM_SAMPLER],0)},getUniformLocationForName:function(e){if(!e)throw"cc.GLProgram.getUniformLocationForName(): uniform name should be non-null";if(!this._programObj)throw"cc.GLProgram.getUniformLocationForName(): Invalid operation. Cannot get uniform location when program is not initialized";return this._glContext.getUniformLocation(this._programObj,e)},getUniformMVPMatrix:function(){return this._uniforms[cc.UNIFORM_MVPMATRIX]},getUniformSampler:function(){return this._uniforms[cc.UNIFORM_SAMPLER]},setUniformLocationWith1i:function(e,t){var n=this._updateUniformLocation(e,t);n&&this._glContext.uniform1i(e,t)},setUniformLocationWith2i:function(e,t,n){var r=[t,n],i=this._updateUniformLocation(e,r);i&&this._glContext.uniform2i(e,t,n)},setUniformLocationWith3i:function(e,t,n,r){var i=[t,n,r],s=this._updateUniformLocation(e,i);s&&this._glContext.uniform3i(e,t,n,r)},setUniformLocationWith4i:function(e,t,n,r,i){var s=[t,n,r,i],o=this._updateUniformLocation(e,s);o&&this._glContext.uniform4i(e,t,n,r,i)},setUniformLocationWith2iv:function(e,t,n){var r=this._updateUniformLocation(e,t);r&&this._glContext.uniform2iv(e,t)},setUniformLocationWith3iv:function(e,t,n){var r=this._updateUniformLocation(e,t);r&&this._glContext.uniform3iv(e,t)},setUniformLocationWith4iv:function(e,t,n){var r=this._updateUniformLocation(e,t);r&&this._glContext.uniform4iv(e,t)},setUniformLocationI32:function(e,t){this.setUniformLocationWith1i(arguments[0],arguments[1])},setUniformLocationWith1f:function(e,t){var n=this._updateUniformLocation(e,t);n&&this._glContext.uniform1f(e,t)},setUniformLocationWith2f:function(e,t,n){var r=[t,n],i=this._updateUniformLocation(e,r);i&&this._glContext.uniform2f(e,t,n)},setUniformLocationWith3f:function(e,t,n,r){var i=[t,n,r],s=this._updateUniformLocation(e,i);s&&this._glContext.uniform3f(e,t,n,r)},setUniformLocationWith4f:function(e,t,n,r,i){var s=[t,n,r,i],o=this._updateUniformLocation(e,s);o&&this._glContext.uniform4f(e,t,n,r,i)},setUniformLocationWith2fv:function(e,t,n){var r=this._updateUniformLocation(e,t);r&&this._glContext.uniform2fv(e,t)},setUniformLocationWith3fv:function(e,t,n){var r=this._updateUniformLocation(e,t);r&&this._glContext.uniform3fv(e,t)},setUniformLocationWith4fv:function(e,t,n){var r=this._updateUniformLocation(e,t);r&&this._glContext.uniform4fv(e,t)},setUniformLocationWithMatrix4fv:function(e,t,n){var r=this._updateUniformLocation(e,t);r&&this._glContext.uniformMatrix4fv(e,!1,t)},setUniformLocationF32:function(){if(arguments.length<2)return;switch(arguments.length){case 2:this.setUniformLocationWith1f(arguments[0],arguments[1]);break;case 3:this.setUniformLocationWith2f(arguments[0],arguments[1],arguments[2]);break;case 4:this.setUniformLocationWith3f(arguments[0],arguments[1],arguments[2],arguments[3]);break;case 5:this.setUniformLocationWith4f(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4])}},setUniformsForBuiltins:function(){var e=new cc.kmMat4,t=new cc.kmMat4,n=new cc.kmMat4;cc.kmGLGetMatrix(cc.KM_GL_PROJECTION,e),cc.kmGLGetMatrix(cc.KM_GL_MODELVIEW,t),cc.kmMat4Multiply(n,e,t),this.setUniformLocationWithMatrix4fv(this._uniforms[cc.UNIFORM_PMATRIX],e.mat,1),this.setUniformLocationWithMatrix4fv(this._uniforms[cc.UNIFORM_MVMATRIX],t.mat,1),this.setUniformLocationWithMatrix4fv(this._uniforms[cc.UNIFORM_MVPMATRIX],n.mat,1);if(this._usesTime){var r=cc.Director.getInstance(),i=r.getTotalFrames()*r.getAnimationInterval();this.setUniformLocationWith4f(this._uniforms[cc.UNIFORM_TIME],i/10,i,i*2,i*4),this.setUniformLocationWith4f(this._uniforms[cc.UNIFORM_SINTIME],i/8,i/4,i/2,Math.sin(i)),this.setUniformLocationWith4f(this._uniforms[cc.UNIFORM_COSTIME],i/8,i/4,i/2,Math.cos(i))}this._uniforms[cc.UNIFORM_RANDOM01]!=-1&&this.setUniformLocationWith4f(this._uniforms[cc.UNIFORM_RANDOM01],Math.random(),Math.random(),Math.random(),Math.random())},setUniformForModelViewProjectionMatrix:function(){this._glContext.uniformMatrix4fv(this._uniforms[cc.UNIFORM_MVPMATRIX],!1,cc.getMat4MultiplyValue(cc.projection_matrix_stack.top,cc.modelview_matrix_stack.top))},setUniformForModelViewProjectionMatrixWithMat4:function(e){cc.kmMat4Multiply(e,cc.projection_matrix_stack.top,cc.modelview_matrix_stack.top),this._glContext.uniformMatrix4fv(this._uniforms[cc.UNIFORM_MVPMATRIX],!1,e.mat)},setUniformForModelViewAndProjectionMatrixWithMat4:function(){this._glContext.uniformMatrix4fv(this._uniforms[cc.UNIFORM_MVMATRIX],!1,cc.modelview_matrix_stack.top.mat),this._glContext.uniformMatrix4fv(this._uniforms[cc.UNIFORM_PMATRIX],!1,cc.projection_matrix_stack.top.mat)},vertexShaderLog:function(){return this._glContext.getShaderInfoLog(this._vertShader)},getVertexShaderLog:function(){return this._glContext.getShaderInfoLog(this._vertShader)},getFragmentShaderLog:function(){return this._glContext.getShaderInfoLog(this._vertShader)},fragmentShaderLog:function(){return this._glContext.getShaderInfoLog(this._fragShader)},programLog:function(){return this._glContext.getProgramInfoLog(this._programObj)},getProgramLog:function(){return this._glContext.getProgramInfoLog(this._programObj)},reset:function(){this._vertShader=null,this._fragShader=null,this._uniforms.length=0,this._glContext.deleteProgram(this._programObj),this._programObj=null;for(var e=0;e<this._hashForUniforms.length;e++)this._hashForUniforms[e].value=null,this._hashForUniforms[e]=null;this._hashForUniforms.length=0},getProgram:function(){return this._programObj},retain:function(){},release:function(){}}),cc.GLProgram.create=function(e,t){var n=new cc.GLProgram;return n.init(e,t)?n:null},cc.VERTEX_ATTRIB_FLAG_NONE=0,cc.VERTEX_ATTRIB_FLAG_POSITION=1,cc.VERTEX_ATTRIB_FLAG_COLOR=2,cc.VERTEX_ATTRIB_FLAG_TEX_COORDS=4,cc.VERTEX_ATTRIB_FLAG_POS_COLOR_TEX=cc.VERTEX_ATTRIB_FLAG_POSITION|cc.VERTEX_ATTRIB_FLAG_COLOR|cc.VERTEX_ATTRIB_FLAG_TEX_COORDS,cc.GL_ALL=0,cc._currentProjectionMatrix=-1,cc._vertexAttribPosition=!1,cc._vertexAttribColor=!1,cc._vertexAttribTexCoords=!1,cc.ENABLE_GL_STATE_CACHE&&(cc.MAX_ACTIVETEXTURE=16,cc._currentShaderProgram=-1,cc._currentBoundTexture=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],cc._blendingSource=-1,cc._blendingDest=-1,cc._GLServerState=0,cc.TEXTURE_ATLAS_USE_VAO&&(cc._uVAO=0)),cc.glInvalidateStateCache=function(){cc.kmGLFreeAll(),cc._currentProjectionMatrix=-1,cc._vertexAttribPosition=!1,cc._vertexAttribColor=!1,cc._vertexAttribTexCoords=!1;if(cc.ENABLE_GL_STATE_CACHE){cc._currentShaderProgram=-1;for(var e=0;e<cc.MAX_ACTIVETEXTURE;e++)cc._currentBoundTexture[e]=-1;cc._blendingSource=-1,cc._blendingDest=-1,cc._GLServerState=0}},cc.glUseProgram=function(e){e!==cc._currentShaderProgram&&(cc._currentShaderProgram=e,cc.renderContext.useProgram(e))},cc.ENABLE_GL_STATE_CACHE||(cc.glUseProgram=function(e){cc.renderContext.useProgram(e)}),cc.glDeleteProgram=function(e){cc.ENABLE_GL_STATE_CACHE&&e===cc._currentShaderProgram&&(cc._currentShaderProgram=-1),gl.deleteProgram(e)},cc.glBlendFunc=function(e,t){if(e!==cc._blendingSource||t!==cc._blendingDest)cc._blendingSource=e,cc._blendingDest=t,cc.setBlending(e,t)},cc.setBlending=function(e,t){var n=cc.renderContext;e===n.ONE&&t===n.ZERO?n.disable(n.BLEND):(n.enable(n.BLEND),cc.renderContext.blendFunc(e,t))},cc.glBlendFuncForParticle=function(e,t){if(e!==cc._blendingSource||t!==cc._blendingDest){cc._blendingSource=e,cc._blendingDest=t;var n=cc.renderContext;e===n.ONE&&t===n.ZERO?n.disable(n.BLEND):(n.enable(n.BLEND),n.blendFuncSeparate(n.SRC_ALPHA,t,e,t))}},cc.ENABLE_GL_STATE_CACHE||(cc.glBlendFunc=cc.setBlending),cc.glBlendResetToCache=function(){var e=cc.renderContext;e.blendEquation(e.FUNC_ADD),cc.ENABLE_GL_STATE_CACHE?cc.setBlending(cc._blendingSource,cc._blendingDest):cc.setBlending(e.BLEND_SRC,e.BLEND_DST)},cc.setProjectionMatrixDirty=function(){cc._currentProjectionMatrix=-1},cc.glEnableVertexAttribs=function(e){var t=cc.renderContext,n=e&cc.VERTEX_ATTRIB_FLAG_POSITION;n!==cc._vertexAttribPosition&&(n?t.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION):t.disableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),cc._vertexAttribPosition=n);var r=e&cc.VERTEX_ATTRIB_FLAG_COLOR;r!==cc._vertexAttribColor&&(r?t.enableVertexAttribArray(cc.VERTEX_ATTRIB_COLOR):t.disableVertexAttribArray(cc.VERTEX_ATTRIB_COLOR),cc._vertexAttribColor=r);var i=e&cc.VERTEX_ATTRIB_FLAG_TEX_COORDS;i!==cc._vertexAttribTexCoords&&(i?t.enableVertexAttribArray(cc.VERTEX_ATTRIB_TEX_COORDS):t.disableVertexAttribArray(cc.VERTEX_ATTRIB_TEX_COORDS),cc._vertexAttribTexCoords=i)},cc.glBindTexture2D=function(e){cc.glBindTexture2DN(0,e)},cc.glBindTexture2DN=function(e,t){if(cc._currentBoundTexture[e]==t)return;cc._currentBoundTexture[e]=t;var n=cc.renderContext;n.activeTexture(n.TEXTURE0+e),t?n.bindTexture(n.TEXTURE_2D,t._webTextureObj):n.bindTexture(n.TEXTURE_2D,null)},cc.ENABLE_GL_STATE_CACHE||(cc.glBindTexture2DN=function(e,t){var n=cc.renderContext;n.activeTexture(n.TEXTURE0+e),t?n.bindTexture(n.TEXTURE_2D,t._webTextureObj):n.bindTexture(n.TEXTURE_2D,null)}),cc.glDeleteTexture=function(e){cc.glDeleteTextureN(0,e)},cc.glDeleteTextureN=function(e,t){cc.ENABLE_GL_STATE_CACHE&&t==cc._currentBoundTexture[e]&&(cc._currentBoundTexture[e]=-1),cc.renderContext.deleteTexture(t)},cc.glBindVAO=function(e){if(!cc.TEXTURE_ATLAS_USE_VAO)return;cc.ENABLE_GL_STATE_CACHE&&cc._uVAO!=e&&(cc._uVAO=e)},cc.glEnable=function(e){cc.ENABLE_GL_STATE_CACHE},cc.IMAGE_FORMAT_JPEG=0,cc.IMAGE_FORMAT_PNG=1,cc.IMAGE_FORMAT_RAWDATA=2,cc.NextPOT=function(e){return e-=1,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,e+1},cc.RenderTexture=cc.Node.extend({_cacheCanvas:null,_cacheContext:null,_fBO:0,_depthRenderBuffer:0,_oldFBO:0,_texture:null,_textureCopy:null,_uITextureImage:null,_pixelFormat:cc.TEXTURE_2D_PIXEL_FORMAT_RGBA8888,_sprite:null,_clearFlags:0,_clearColor:null,_clearDepth:0,_clearStencil:0,_autoDraw:!1,_clearColorStr:null,ctor:null,_ctorForCanvas:function(){cc.Node.prototype.ctor.call(this),this._clearColor=cc.c4f(1,1,1,1),this._clearColorStr="rgba(255,255,255,1)",this._cacheCanvas=document.createElement("canvas"),this._cacheContext=this._cacheCanvas.getContext("2d"),this.setAnchorPoint(0,0)},_ctorForWebGL:function(){cc.Node.prototype.ctor.call(this),this._clearColor=cc.c4f(0,0,0,0)},cleanup:null,_cleanupForCanvas:function(){cc.Node.prototype.onExit.call(this),this._cacheContext=null,this._cacheCanvas=null},_cleanupForWebGL:function(){cc.Node.prototype.onExit.call(this),this._textureCopy=null;var e=cc.renderContext;e.deleteFramebuffer(this._fBO),this._depthRenderBuffer&&e.deleteRenderbuffer(this._depthRenderBuffer),this._uITextureImage=null},getSprite:function(){return this._sprite},setSprite:function(e){this._sprite=e},initWithWidthAndHeight:null,_initWithWidthAndHeightForCanvas:function(e,t,n,r){var i=this._cacheCanvas,s=cc.CONTENT_SCALE_FACTOR();i.width=0|e*s,i.height=0|t*s,this._cacheContext.translate(0,i.height);var o=new cc.Texture2D;return o.initWithElement(i),o.handleLoadedTexture(),this._sprite=cc.Sprite.createWithTexture(o),!0},_initWithWidthAndHeightForWebGL:function(e,t,n,r){n==cc.TEXTURE_2D_PIXEL_FORMAT_A8&&cc.log("cc.RenderTexture._initWithWidthAndHeightForWebGL() : only RGB and RGBA formats are valid for a render texture;");var i=cc.renderContext,s=cc.CONTENT_SCALE_FACTOR();e=0|e*s,t=0|t*s,this._oldFBO=i.getParameter(i.FRAMEBUFFER_BINDING);var o,u;cc.Configuration.getInstance().supportsNPOT()?(o=e,u=t):(o=cc.NextPOT(e),u=cc.NextPOT(t));var a=o*u*4,f=new Uint8Array(a);for(var l=0;l<o*u*4;l++)f[l]=0;this._pixelFormat=n,this._texture=new cc.Texture2D;if(!this._texture)return!1;var c=this._texture;c.initWithData(f,this._pixelFormat,o,u,cc.size(e,t));var h=i.getParameter(i.RENDERBUFFER_BINDING);if(cc.Configuration.getInstance().checkForGLExtension("GL_QCOM")){this._textureCopy=new cc.Texture2D;if(!this._textureCopy)return!1;this._textureCopy.initWithData(f,this._pixelFormat,o,u,cc.size(e,t))}this._fBO=i.createFramebuffer(),i.bindFramebuffer(i.FRAMEBUFFER,this._fBO),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,c._webTextureObj,0),r!=0&&(this._depthRenderBuffer=i.createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,this._depthRenderBuffer),i.renderbufferStorage(i.RENDERBUFFER,r,o,u),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,this._depthRenderBuffer)),i.checkFramebufferStatus(i.FRAMEBUFFER)!==i.FRAMEBUFFER_COMPLETE&&cc.log("Could not attach texture to the framebuffer"),c.setAliasTexParameters(),this._sprite=cc.Sprite.createWithTexture(c);var p=this._sprite;return p.setScaleY(-1),p.setBlendFunc(i.ONE,i.ONE_MINUS_SRC_ALPHA),i.bindRenderbuffer(i.RENDERBUFFER,h),i.bindFramebuffer(i.FRAMEBUFFER,this._oldFBO),this._autoDraw=!1,this.addChild(p),!0},begin:null,_beginForCanvas:function(){cc.renderContext=this._cacheContext,cc.EGLView.getInstance()._setScaleXYForRenderTexture()},_beginForWebGL:function(){cc.kmGLMatrixMode(cc.KM_GL_PROJECTION),cc.kmGLPushMatrix(),cc.kmGLMatrixMode(cc.KM_GL_MODELVIEW),cc.kmGLPushMatrix();var e=cc.Director.getInstance();e.setProjection(e.getProjection());var t=this._texture.getContentSizeInPixels(),n=cc.Director.getInstance().getWinSizeInPixels(),r=n.width/t.width,i=n.height/t.height,s=cc.renderContext;s.viewport(0,0,t.width,t.height);var o=new cc.kmMat4;cc.kmMat4OrthographicProjection(o,-1/r,1/r,-1/i,1/i,-1,1),cc.kmGLMultMatrix(o),this._oldFBO=s.getParameter(s.FRAMEBUFFER_BINDING),s.bindFramebuffer(s.FRAMEBUFFER,this._fBO),cc.Configuration.getInstance().checkForGLExtension("GL_QCOM")&&(s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,this._textureCopy._webTextureObj,0),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT),s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,this._texture._webTextureObj,0))},beginWithClear:function(e,t,n,r,i,s){var o=cc.renderContext;i=i||o.COLOR_BUFFER_BIT,s=s||o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT,this._beginWithClear(e,t,n,r,i,s,o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT|o.STENCIL_BUFFER_BIT)},_beginWithClear:null,_beginWithClearForCanvas:function(e,t,n,r,i,s,o){this.begin(),e=e||0,t=t||0,n=n||0,r=isNaN(r)?1:r;var u=this._cacheContext,a=this._cacheCanvas;u.save(),u.fillStyle="rgba("+(0|e*255)+","+(0|t*255)+","+(0|n*255)+","+r+")",u.clearRect(0,0,a.width,-a.height),u.fillRect(0,0,a.width,-a.height),u.restore()},_beginWithClearForWebGL:function(e,t,n,r,i,s,o){this.begin();var u=cc.renderContext,a=[0,0,0,0],f=0,l=0;o&u.COLOR_BUFFER_BIT&&(a=u.getParameter(u.COLOR_CLEAR_VALUE),u.clearColor(e,t,n,r)),o&u.DEPTH_BUFFER_BIT&&(f=u.getParameter(u.DEPTH_CLEAR_VALUE),u.clearDepth(i)),o&u.STENCIL_BUFFER_BIT&&(l=u.getParameter(u.STENCIL_CLEAR_VALUE),u.clearStencil(s)),u.clear(o),o&u.COLOR_BUFFER_BIT&&u.clearColor(a[0],a[1],a[2],a[3]),o&u.DEPTH_BUFFER_BIT&&u.clearDepth(f),o&u.STENCIL_BUFFER_BIT&&u.clearStencil(l)},end:null,_endForCanvas:function(){cc.renderContext=cc.mainRenderContextBackup,cc.EGLView.getInstance()._resetScale()},_endForWebGL:function(){var e=cc.renderContext,t=cc.Director.getInstance();e.bindFramebuffer(e.FRAMEBUFFER,this._oldFBO),t.setViewport(),cc.kmGLMatrixMode(cc.KM_GL_PROJECTION),cc.kmGLPopMatrix(),cc.kmGLMatrixMode(cc.KM_GL_MODELVIEW),cc.kmGLPopMatrix()},clear:function(e,t,n,r){this.beginWithClear(e,t,n,r),this.end()},clearRect:null,_clearRectForCanvas:function(e,t,n,r){this._cacheContext.clearRect(e,t,n,-r)},_clearRectForWebGL:function(e,t,n,r){},clearDepth:null,_clearDepthForCanvas:function(e){cc.log("clearDepth isn't supported on Cocos2d-Html5"
)},_clearDepthForWebGL:function(e){this.begin();var t=cc.renderContext,n=t.getParameter(t.DEPTH_CLEAR_VALUE);t.clearDepth(e),t.clear(t.DEPTH_BUFFER_BIT),t.clearDepth(n),this.end()},clearStencil:null,_clearStencilForCanvas:function(e){cc.log("clearDepth isn't supported on Cocos2d-Html5")},_clearStencilForWebGL:function(e){var t=cc.renderContext,n=t.getParameter(t.STENCIL_CLEAR_VALUE);t.clearStencil(e),t.clear(t.STENCIL_BUFFER_BIT),t.clearStencil(n)},visit:null,_visitForCanvas:function(e){if(!this._visible)return;e=e||cc.renderContext,e.save(),this.draw(e),this.transform(e),this._sprite.visit(),e.restore(),this._orderOfArrival=0},_visitForWebGL:function(e){if(!this._visible)return;cc.kmGLPushMatrix();var t=this._grid;t&&t.isActive()&&(t.beforeDraw(),this.transformAncestors()),this.transform(e),this._sprite.visit(),this.draw(e),t&&t.isActive()&&t.afterDraw(this),cc.kmGLPopMatrix(),this._orderOfArrival=0},draw:null,_drawForCanvas:function(e){e=e||cc.renderContext;if(this._autoDraw){this.begin();if(this._clearFlags){var t=this._cacheCanvas;e.save(),e.fillStyle=this._clearColorStr,e.clearRect(0,0,t.width,-t.height),e.fillRect(0,0,t.width,-t.height),e.restore()}this.sortAllChildren();var n=this._children,r=n.length,i=this._sprite;for(var s=0;s<r;s++){var o=n[s];o!=i&&o.visit()}this.end()}},_drawForWebGL:function(e){var t=cc.renderContext;if(this._autoDraw){this.begin();var n=this._clearFlags;if(n){var r=[0,0,0,0],i=0,s=0;n&t.COLOR_BUFFER_BIT&&(r=t.getParameter(t.COLOR_CLEAR_VALUE),t.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearColor.a)),n&t.DEPTH_BUFFER_BIT&&(i=t.getParameter(t.DEPTH_CLEAR_VALUE),t.clearDepth(this._clearDepth)),n&t.STENCIL_BUFFER_BIT&&(s=t.getParameter(t.STENCIL_CLEAR_VALUE),t.clearStencil(this._clearStencil)),t.clear(n),n&t.COLOR_BUFFER_BIT&&t.clearColor(r[0],r[1],r[2],r[3]),n&t.DEPTH_BUFFER_BIT&&t.clearDepth(i),n&t.STENCIL_BUFFER_BIT&&t.clearStencil(s)}this.sortAllChildren();var o=this._children;for(var u=0;u<o.length;u++){var a=o[u];a!=this._sprite&&a.visit()}this.end()}},newCCImage:null,_newCCImageForCanvas:function(e){return cc.log("saveToFile isn't supported on Cocos2d-Html5"),null},_newCCImageForWebGL:function(e){cc.log("saveToFile isn't supported on Cocos2d-Html5"),e===null&&(e=!0),cc.Assert(this._pixelFormat==cc.TEXTURE_2D_PIXEL_FORMAT_RGBA8888,"only RGBA8888 can be saved as image");if(!this._texture)return null;var t=this._texture.getContentSizeInPixels(),n=t.width,r=t.height,i=new cc.Image,s=cc.renderContext,o=new Uint8Array(n*r*4);if(!o)return i;var u=new Uint8Array(n*r*4);if(!u)return null;this.begin(),s.pixelStorei(s.PACK_ALIGNMENT,1),s.readPixels(0,0,n,r,s.RGBA,s.UNSIGNED_BYTE,u),this.end();for(var a=0;a<r;++a)this._memcpy(o,a*n*4,u,(r-a-1)*n*4,n*4);return i.initWithImageData(o,n*r*4,cc.FMT_RAWDATA,n,r,8),o=null,u=null,i},_memcpy:function(e,t,n,r,i){for(var s=0;s<i;s++)e[t+s]=n[r+s]},saveToFile:function(e,t){cc.log("saveToFile isn't supported on Cocos2d-Html5")},listenToBackground:function(e){cc.log("listenToBackground isn't supported on Cocos2d-Html5")},listenToForeground:function(e){cc.log("listenToForeground isn't supported on Cocos2d-Html5")},getClearFlags:function(){return this._clearFlags},setClearFlags:function(e){this._clearFlags=e},getClearColor:function(){return this._clearColor},setClearColor:null,_setClearColorForCanvas:function(e){var t=this._clearColor;t.r=e.r,t.g=e.g,t.b=e.b,t.a=e.a,this._clearColorStr="rgba("+(0|e.r*255)+","+(0|e.g*255)+","+(0|e.b*255)+","+e.a+")"},_setClearColorForWebGL:function(e){var t=this._clearColor;t.r=e.r,t.g=e.g,t.b=e.b,t.a=e.a},getClearDepth:function(){return this._clearDepth},setClearDepth:function(e){this._clearDepth=e},getClearStencil:function(){return this._clearStencil},setClearStencil:function(e){this._clearStencil=e},isAutoDraw:function(){return this._autoDraw},setAutoDraw:function(e){this._autoDraw=e}}),cc.Browser.supportWebGL?(cc.RenderTexture.prototype.ctor=cc.RenderTexture.prototype._ctorForWebGL,cc.RenderTexture.prototype.cleanup=cc.RenderTexture.prototype._cleanupForWebGL,cc.RenderTexture.prototype.initWithWidthAndHeight=cc.RenderTexture.prototype._initWithWidthAndHeightForWebGL,cc.RenderTexture.prototype.begin=cc.RenderTexture.prototype._beginForWebGL,cc.RenderTexture.prototype._beginWithClear=cc.RenderTexture.prototype._beginWithClearForWebGL,cc.RenderTexture.prototype.end=cc.RenderTexture.prototype._endForWebGL,cc.RenderTexture.prototype.clearRect=cc.RenderTexture.prototype._clearRectForWebGL,cc.RenderTexture.prototype.clearDepth=cc.RenderTexture.prototype._clearDepthForWebGL,cc.RenderTexture.prototype.clearStencil=cc.RenderTexture.prototype._clearStencilForWebGL,cc.RenderTexture.prototype.visit=cc.RenderTexture.prototype._visitForWebGL,cc.RenderTexture.prototype.draw=cc.RenderTexture.prototype._drawForWebGL,cc.RenderTexture.prototype.newCCImage=cc.RenderTexture.prototype._newCCImageForWebGL,cc.RenderTexture.prototype.setClearColor=cc.RenderTexture.prototype._setClearColorForWebGL):(cc.RenderTexture.prototype.ctor=cc.RenderTexture.prototype._ctorForCanvas,cc.RenderTexture.prototype.cleanup=cc.RenderTexture.prototype._cleanupForCanvas,cc.RenderTexture.prototype.initWithWidthAndHeight=cc.RenderTexture.prototype._initWithWidthAndHeightForCanvas,cc.RenderTexture.prototype.begin=cc.RenderTexture.prototype._beginForCanvas,cc.RenderTexture.prototype._beginWithClear=cc.RenderTexture.prototype._beginWithClearForCanvas,cc.RenderTexture.prototype.end=cc.RenderTexture.prototype._endForCanvas,cc.RenderTexture.prototype.clearRect=cc.RenderTexture.prototype._clearRectForCanvas,cc.RenderTexture.prototype.clearDepth=cc.RenderTexture.prototype._clearDepthForCanvas,cc.RenderTexture.prototype.clearStencil=cc.RenderTexture.prototype._clearStencilForCanvas,cc.RenderTexture.prototype.visit=cc.RenderTexture.prototype._visitForCanvas,cc.RenderTexture.prototype.draw=cc.RenderTexture.prototype._drawForCanvas,cc.RenderTexture.prototype.newCCImage=cc.RenderTexture.prototype._newCCImageForCanvas,cc.RenderTexture.prototype.setClearColor=cc.RenderTexture.prototype._setClearColorForCanvas),cc.RenderTexture.create=function(e,t,n,r){n=n||cc.TEXTURE_2D_PIXEL_FORMAT_RGBA8888,r=r||0;var i=new cc.RenderTexture;return i&&i.initWithWidthAndHeight(e,t,n,r)?i:null},cc.MotionStreak=cc.NodeRGBA.extend({_fastMode:!1,_startingPositionInitialized:!1,_texture:null,_blendFunc:null,_positionR:null,_stroke:0,_fadeDelta:0,_minSeg:0,_maxPoints:0,_nuPoints:0,_previousNuPoints:0,_pointVertexes:null,_pointState:null,_vertices:null,_colorPointer:null,_texCoords:null,_verticesBuffer:null,_colorPointerBuffer:null,_texCoordsBuffer:null,ctor:function(){cc.NodeRGBA.prototype.ctor.call(this),this._positionR=cc._pConst(0,0),this._blendFunc=new cc.BlendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA),this._vertexWebGLBuffer=cc.renderContext.createBuffer(),this._fastMode=!1,this._startingPositionInitialized=!1,this._texture=null,this._stroke=0,this._fadeDelta=0,this._minSeg=0,this._maxPoints=0,this._nuPoints=0,this._previousNuPoints=0,this._pointVertexes=null,this._pointState=null,this._vertices=null,this._colorPointer=null,this._texCoords=null,this._verticesBuffer=null,this._colorPointerBuffer=null,this._texCoordsBuffer=null},getTexture:function(){return this._texture},setTexture:function(e){this._texture!=e&&(this._texture=e)},getBlendFunc:function(){return this._blendFunc},setBlendFunc:function(e,t){t===undefined?this._blendFunc=e:(this._blendFunc.src=e,this._blendFunc.dst=t)},getOpacity:function(){return cc.log("cc.MotionStreak.getOpacity has not been supported."),0},setOpacity:function(e){cc.log("cc.MotionStreak.setOpacity has not been supported.")},setOpacityModifyRGB:function(e){},isOpacityModifyRGB:function(){return!1},onExit:function(){cc.Node.prototype.onExit.call(this),this._verticesBuffer&&cc.renderContext.deleteBuffer(this._verticesBuffer),this._texCoordsBuffer&&cc.renderContext.deleteBuffer(this._texCoordsBuffer),this._colorPointerBuffer&&cc.renderContext.deleteBuffer(this._colorPointerBuffer)},isFastMode:function(){return this._fastMode},setFastMode:function(e){this._fastMode=e},isStartingPositionInitialized:function(){return this._startingPositionInitialized},setStartingPositionInitialized:function(e){this._startingPositionInitialized=e},initWithFade:function(e,t,n,r,i){if(!i)throw"cc.MotionStreak.initWithFade(): Invalid filename or texture";typeof i=="string"&&(i=cc.TextureCache.getInstance().addImage(i)),cc.Node.prototype.setPosition.call(this,cc.PointZero()),this.setAnchorPoint(0,0),this.ignoreAnchorPointForPosition(!0),this._startingPositionInitialized=!1,this._fastMode=!0,this._minSeg=t==-1?n/5:t,this._minSeg*=this._minSeg,this._stroke=n,this._fadeDelta=1/e;var s=(0|e*60)+2;this._nuPoints=0,this._pointState=new Float32Array(s),this._pointVertexes=new Float32Array(s*2),this._vertices=new Float32Array(s*4),this._texCoords=new Float32Array(s*4),this._colorPointer=new Uint8Array(s*8),this._maxPoints=s;var o=cc.renderContext;return this._verticesBuffer=o.createBuffer(),this._texCoordsBuffer=o.createBuffer(),this._colorPointerBuffer=o.createBuffer(),this._blendFunc.src=o.SRC_ALPHA,this._blendFunc.dst=o.ONE_MINUS_SRC_ALPHA,this.setShaderProgram(cc.ShaderCache.getInstance().programForKey(cc.SHADER_POSITION_TEXTURECOLOR)),this.setTexture(i),this.setColor(r),this.scheduleUpdate(),o.bindBuffer(o.ARRAY_BUFFER,this._verticesBuffer),o.bufferData(o.ARRAY_BUFFER,this._vertices,o.DYNAMIC_DRAW),o.bindBuffer(o.ARRAY_BUFFER,this._texCoordsBuffer),o.bufferData(o.ARRAY_BUFFER,this._texCoords,o.DYNAMIC_DRAW),o.bindBuffer(o.ARRAY_BUFFER,this._colorPointerBuffer),o.bufferData(o.ARRAY_BUFFER,this._colorPointer,o.DYNAMIC_DRAW),!0},tintWithColor:function(e){this.setColor(e);var t=this._colorPointer;for(var n=0,r=this._nuPoints*2;n<r;n++)t[n*4]=e.r,t[n*4+1]=e.g,t[n*4+2]=e.b},reset:function(){this._nuPoints=0},setPosition:function(e,t){this._startingPositionInitialized=!0,t===undefined?(this._positionR._x=e.x,this._positionR._y=e.y):(this._positionR._x=e,this._positionR._y=t)},draw:function(e){if(this._nuPoints<=1)return;this._texture&&this._texture.isLoaded()&&(e=e||cc.renderContext,cc.NODE_DRAW_SETUP(this),cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POS_COLOR_TEX),cc.glBlendFunc(this._blendFunc.src,this._blendFunc.dst),cc.glBindTexture2D(this._texture),e.bindBuffer(e.ARRAY_BUFFER,this._verticesBuffer),e.bufferData(e.ARRAY_BUFFER,this._vertices,e.DYNAMIC_DRAW),e.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,this._texCoordsBuffer),e.bufferData(e.ARRAY_BUFFER,this._texCoords,e.DYNAMIC_DRAW),e.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,this._colorPointerBuffer),e.bufferData(e.ARRAY_BUFFER,this._colorPointer,e.DYNAMIC_DRAW),e.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,e.UNSIGNED_BYTE,!0,0,0),e.drawArrays(e.TRIANGLE_STRIP,0,this._nuPoints*2),cc.g_NumberOfDraws++)},update:function(e){if(!this._startingPositionInitialized)return;e*=this._fadeDelta;var t,n,r,i,s=0,o=this._nuPoints,u=this._pointState,a=this._pointVertexes,f=this._vertices,l=this._colorPointer;for(r=0;r<o;r++){u[r]-=e;if(u[r]<=0)s++;else{t=r-s,s>0?(u[t]=u[r],a[t*2]=a[r*2],a[t*2+1]=a[r*2+1],i=r*2,n=t*2,f[n*2]=f[i*2],f[n*2+1]=f[i*2+1],f[(n+1)*2]=f[(i+1)*2],f[(n+1)*2+1]=f[(i+1)*2+1],i*=4,n*=4,l[n+0]=l[i+0],l[n+1]=l[i+1],l[n+2]=l[i+2],l[n+4]=l[i+4],l[n+5]=l[i+5],l[n+6]=l[i+6]):n=t*8;var c=u[t]*255;l[n+3]=c,l[n+7]=c}}o-=s;var h=!0;if(o>=this._maxPoints)h=!1;else if(o>0){var p=cc.pDistanceSQ(cc.p(a[(o-1)*2],a[(o-1)*2+1]),this._positionR)<this._minSeg,d=o==1?!1:cc.pDistanceSQ(cc.p(a[(o-2)*2],a[(o-2)*2+1]),this._positionR)<this._minSeg*2;if(p||d)h=!1}if(h){a[o*2]=this._positionR._x,a[o*2+1]=this._positionR._y,u[o]=1;var v=o*8,m=this._displayedColor;l[v]=m.r,l[v+1]=m.g,l[v+2]=m.b,l[v+4]=m.r,l[v+5]=m.g,l[v+6]=m.b,l[v+3]=255,l[v+7]=255,o>0&&this._fastMode&&(o>1?cc.vertexLineToPolygon(a,this._stroke,this._vertices,o,1):cc.vertexLineToPolygon(a,this._stroke,this._vertices,0,2)),o++}this._fastMode||cc.vertexLineToPolygon(a,this._stroke,this._vertices,0,o);if(o&&this._previousNuPoints!=o){var g=1/o,y=this._texCoords;for(r=0;r<o;r++)y[r*4]=0,y[r*4+1]=g*r,y[(r*2+1)*2]=1,y[(r*2+1)*2+1]=g*r;this._previousNuPoints=o}this._nuPoints=o}}),cc.MotionStreak.create=function(e,t,n,r,i){var s=new cc.MotionStreak;return s&&s.initWithFade(e,t,n,r,i)?s:null},cc.stencilBits=-1,cc.setProgram=function(e,t){e.setShaderProgram(t);var n=e.getChildren();if(!n)return;for(var r=0;r<n.length;r++)cc.setProgram(n[r],t)},cc.ClippingNode=cc.Node.extend({_stencil:null,_alphaThreshold:0,_inverted:!1,_godhelpme:!1,ctor:function(){cc.Node.prototype.ctor.call(this),this._stencil=null,this._alphaThreshold=0,this._inverted=!1},init:null,_initForWebGL:function(e){return this._stencil=e,this._alphaThreshold=1,this._inverted=!1,cc.ClippingNode._init_once=!0,cc.ClippingNode._init_once&&(cc.stencilBits=cc.renderContext.getParameter(cc.renderContext.STENCIL_BITS),cc.stencilBits<=0&&cc.log("Stencil buffer is not enabled."),cc.ClippingNode._init_once=!1),!0},_initForCanvas:function(e){this._stencil=e,this._alphaThreshold=1,this._inverted=!1},onEnter:function(){cc.Node.prototype.onEnter.call(this),this._stencil.onEnter()},onEnterTransitionDidFinish:function(){cc.Node.prototype.onEnterTransitionDidFinish.call(this),this._stencil.onEnterTransitionDidFinish()},onExitTransitionDidStart:function(){this._stencil.onExitTransitionDidStart(),cc.Node.prototype.onExitTransitionDidStart.call(this)},onExit:function(){this._stencil.onExit(),cc.Node.prototype.onExit.call(this)},visit:null,_visitForWebGL:function(e){var t=e||cc.renderContext;if(cc.stencilBits<1){cc.Node.prototype.visit.call(this,e);return}if(!this._stencil||!this._stencil.isVisible()){this._inverted&&cc.Node.prototype.visit.call(this,e);return}cc.ClippingNode._layer=-1;if(cc.ClippingNode._layer+1==cc.stencilBits){cc.ClippingNode._visit_once=!0,cc.ClippingNode._visit_once&&(cc.log("Nesting more than "+cc.stencilBits+"stencils is not supported. Everything will be drawn without stencil for this node and its childs."),cc.ClippingNode._visit_once=!1),cc.Node.prototype.visit.call(this,e);return}cc.ClippingNode._layer++;var n=1<<cc.ClippingNode._layer,r=n-1,i=n|r,s=t.isEnabled(t.STENCIL_TEST),o=t.getParameter(t.STENCIL_WRITEMASK),u=t.getParameter(t.STENCIL_FUNC),a=t.getParameter(t.STENCIL_REF),f=t.getParameter(t.STENCIL_VALUE_MASK),l=t.getParameter(t.STENCIL_FAIL),c=t.getParameter(t.STENCIL_PASS_DEPTH_FAIL),h=t.getParameter(t.STENCIL_PASS_DEPTH_PASS);t.enable(t.STENCIL_TEST),t.stencilMask(n);var p=t.getParameter(t.DEPTH_WRITEMASK);t.depthMask(!1),t.stencilFunc(t.NEVER,n,n),t.stencilOp(this._inverted?t.REPLACE:t.ZERO,t.KEEP,t.KEEP),cc.drawingUtil.drawSolidRect(cc.PointZero(),cc.pFromSize(cc.Director.getInstance().getWinSize()),cc.c4f(1,1,1,1)),t.stencilFunc(t.NEVER,n,n),t.stencilOp(this._inverted?t.ZERO:t.REPLACE,t.KEEP,t.KEEP);if(this._alphaThreshold<1){var d=cc.ShaderCache.getInstance().programForKey(cc.SHADER_POSITION_TEXTURECOLORALPHATEST),v=t.getUniformLocation(d.getProgram(),cc.UNIFORM_ALPHA_TEST_VALUE_S);cc.glUseProgram(d.getProgram()),d.setUniformLocationWith1f(v,this._alphaThreshold),cc.setProgram(this._stencil,d)}cc.kmGLPushMatrix(),this.transform(),this._stencil.visit(),cc.kmGLPopMatrix(),t.depthMask(p),t.stencilFunc(t.EQUAL,i,i),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),cc.Node.prototype.visit.call(this,e),t.stencilFunc(u,a,f),t.stencilOp(l,c,h),t.stencilMask(o),s||t.disable(t.STENCIL_TEST),cc.ClippingNode._layer--},_visitForCanvas:function(e){if(!this._stencil||!this._stencil.isVisible()){this._inverted&&cc.Node.prototype.visit.call(this,e);return}if(this._cangodhelpme()||this._stencil instanceof cc.Sprite){var t=e||cc.renderContext,n=t.canvas,r=cc.ClippingNode._getSharedCache();r.width=n.width,r.height=n.height;var i=r.getContext("2d");i.drawImage(n,0,0),t.save(),this._super(t),t.globalCompositeOperation=this._inverted?"destination-out":"destination-in",this.transform(t),this._stencil.visit(),t.restore(),t.save(),t.setTransform(1,0,0,1,0,0),t.globalCompositeOperation="destination-over",t.drawImage(r,0,0),t.restore()}else{var t=e||cc.renderContext,s,o=this._children,u;t.save(),this.transform(t),this._stencil.visit(t),t.clip(),this._cangodhelpme(!0);var a=o.length;if(a>0){this.sortAllChildren();for(s=0;s<a;s++){u=o[s];if(!(u._zOrder<0))break;u.visit(t)}this.draw(t);for(;s<a;s++)o[s].visit(t)}else this.draw(t);this._cangodhelpme(!1),t.restore()}},getStencil:function(){return this._stencil},setStencil:null,_setStencilForWebGL:function(e){this._stencil=e},_setStencilForCanvas:function(e){this._stencil=e;var t=cc.EGLView.getInstance().getScaleX(),n=cc.EGLView.getInstance().getScaleY(),r=cc.renderContext;if(e instanceof cc.Sprite)return;e instanceof cc.DrawNode&&(e.draw=function(){for(var i=0;i<e._buffer.length;i++){var s=e._buffer[i],o=s.verts,u=o[0];r.beginPath(),r.moveTo(u.x*t,-u.y*n);for(var a=1,f=o.length;a<f;a++)r.lineTo(o[a].x*t,-o[a].y*n)}})},getAlphaThreshold:function(){return this._alphaThreshold},setAlphaThreshold:function(e){this._alphaThreshold=e},isInverted:function(){return this._inverted},setInverted:function(e){this._inverted=e},_cangodhelpme:function(e){if(e===!0||e===!1)cc.ClippingNode.prototype._godhelpme=e;return cc.ClippingNode.prototype._godhelpme}}),cc.Browser.supportWebGL?(cc.ClippingNode.prototype.init=cc.ClippingNode.prototype._initForWebGL,cc.ClippingNode.prototype.visit=cc.ClippingNode.prototype._visitForWebGL,cc.ClippingNode.prototype.setStencil=cc.ClippingNode.prototype._setStencilForWebGL):(cc.ClippingNode.prototype.init=cc.ClippingNode.prototype._initForCanvas,cc.ClippingNode.prototype.visit=cc.ClippingNode.prototype._visitForCanvas,cc.ClippingNode.prototype.setStencil=cc.ClippingNode.prototype._setStencilForCanvas),cc.ClippingNode._init_once=null,cc.ClippingNode._visit_once=null,cc.ClippingNode._layer=null,cc.ClippingNode._sharedCache=null,cc.ClippingNode._getSharedCache=function(){return cc.ClippingNode._sharedCache||(cc.ClippingNode._sharedCache=document.createElement("canvas"))},cc.ClippingNode.create=function(e){var t=new cc.ClippingNode;return t.init(e),t},cc.GridBase=cc.Class.extend({_active:!1,_reuseGrid:0,_gridSize:null,_texture:null,_step:null,_grabber:null,_isTextureFlipped:!1,_shaderProgram:null,_directorProjection:0,_dirty:!1,ctor:function(){this._active=!1,this._reuseGrid=0,this._gridSize=null,this._texture=null,this._step=cc.p(0,0),this._grabber=null,this._isTextureFlipped=!1,this._shaderProgram=null,this._directorProjection=0,this._dirty=!1},isActive:function(){return this._active},setActive:function(e){this._active=e;if(!e){var t=cc.Director.getInstance(),n=t.getProjection();t.setProjection(n)}},getReuseGrid:function(){return this._reuseGrid},setReuseGrid:function(e){this._reuseGrid=e},getGridSize:function(){return cc.size(this._gridSize.width,this._gridSize.height)},setGridSize:function(e){this._gridSize.width=parseInt(e.width),this._gridSize.height=parseInt(e.height)},getStep:function(){return cc.p(this._step.x,this._step.y)},setStep:function(e){this._step.x=e.x,this._step.y=e.y},isTextureFlipped:function(){return this._isTextureFlipped},setTextureFlipped:function(e){this._isTextureFlipped!=e&&(this._isTextureFlipped=e,this.calculateVertexPoints())},initWithSize:function(e,t,n){if(!t){var r=cc.Director.getInstance(),i=r.getWinSizeInPixels(),s=cc.NextPOT(i.width),o=cc.NextPOT(i.height),u=new Uint8Array(s*o*4);if(!u)return cc.log("cocos2d: CCGrid: not enough memory."),!1;t=new cc.Texture2D,t.initWithData(u,cc.TEXTURE_2D_PIXEL_FORMAT_RGBA8888,s,o,i);if(!t)return cc.log("cocos2d: CCGrid: error creating texture"),!1}n=n||!1,this._active=!1,this._reuseGrid=0,this._gridSize=e,this._texture=t,this._isTextureFlipped=n;var a=this._texture.getContentSize();return this._step.x=a.width/e.width,this._step.y=a.height/e.height,this._grabber=new cc.Grabber,this._grabber?(this._grabber.grab(this._texture),this._shaderProgram=cc.ShaderCache.getInstance().programForKey(cc.SHADER_POSITION_TEXTURE),this.calculateVertexPoints(),!0):!1},beforeDraw:function(){this._directorProjection=cc.Director.getInstance().getProjection(),this.set2DProjection(),this._grabber.beforeRender(this._texture)},afterDraw:function(e){this._grabber.afterRender(this._texture),cc.Director.getInstance().setProjection(this._directorProjection);if(e.getCamera().isDirty()){var t=e.getAnchorPointInPoints();cc.kmGLTranslatef(t.x,t.y,0),e.getCamera().locate(),cc.kmGLTranslatef(-t.x,-t.y,0)}cc.glBindTexture2D(this._texture),this.blit()},blit:function(){cc.log("cc.GridBase.blit(): Shall be overridden in subclass.")},reuse:function(){cc.log("cc.GridBase.reuse(): Shall be overridden in subclass.")},calculateVertexPoints:function(){cc.log("cc.GridBase.calculateVertexPoints(): Shall be overridden in subclass.")},set2DProjection:function(){var e=cc.Director.getInstance().getWinSizeInPixels(),t=cc.renderContext;t.viewport(0,0,e.width,e.height),cc.kmGLMatrixMode(cc.KM_GL_PROJECTION),cc.kmGLLoadIdentity();var n=new cc.kmMat4;cc.kmMat4OrthographicProjection(n,0,e.width,0,e.height,-1,1),cc.kmGLMultMatrix(n),cc.kmGLMatrixMode(cc.KM_GL_MODELVIEW),cc.kmGLLoadIdentity(),cc.setProjectionMatrixDirty()}}),cc.GridBase.create=function(e,t,n){var r=new cc.GridBase;return r&&r.initWithSize(e,t,n)?r:null},cc.Grid3D=cc.GridBase.extend({_texCoordinates:null,_vertices:null,_originalVertices:null,_indices:null,_texCoordinateBuffer:null,_verticesBuffer:null,_indicesBuffer:null,ctor:function(){cc.GridBase.prototype.ctor.call(this),this._texCoordinates=null,this._vertices=null,this._originalVertices=null,this._indices=null,this._texCoordinateBuffer=null,this._verticesBuffer=null,this._indicesBuffer=null},vertex:function(e){(e.x!==(0|e.x)||e.y!==(0|e.y))&&cc.log("cc.Grid3D.vertex() : Numbers must be integers");var t=0|(e.x*(this._gridSize.height+1)+e.y)*3,n=this._vertices;return new cc.Vertex3F(n[t],n[t+1],n[t+2])},originalVertex:function(e){(e.x!==(0|e.x)||e.y!==(0|e.y))&&cc.log("cc.Grid3D.originalVertex() : Numbers must be integers");var t=0|(e.x*(this._gridSize.height+1)+e.y)*3,n=this._originalVertices;return new cc.Vertex3F(n[t],n[t+1],n[t+2])},setVertex:function(e,t){(e.x!==(0|e.x)||e.y!==(0|e.y))&&cc.log("cc.Grid3D.setVertex() : Numbers must be integers");var n=0|(e.x*(this._gridSize.height+1)+e.y)*3,r=this._vertices;r[n]=t.x,r[n+1]=t.y,r[n+2]=t.z,this._dirty=!0},blit:function(){var e=this._gridSize.width*this._gridSize.height;cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION|cc.VERTEX_ATTRIB_FLAG_TEX_COORDS),this._shaderProgram.use(),this._shaderProgram.setUniformsForBuiltins();var t=cc.renderContext,n=this._dirty;t.bindBuffer(t.ARRAY_BUFFER,this._verticesBuffer),n&&t.bufferData(t.ARRAY_BUFFER,this._vertices,t.DYNAMIC_DRAW),t.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,3,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,this._texCoordinateBuffer),n&&t.bufferData(t.ARRAY_BUFFER,this._texCoordinates,t.DYNAMIC_DRAW),t.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,t.FLOAT,!1,0,0),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._indicesBuffer),n&&t.bufferData(t.ELEMENT_ARRAY_BUFFER,this._indices,t.STATIC_DRAW),t.drawElements(t.TRIANGLES,e*6,t.UNSIGNED_SHORT,0),n&&(this._dirty=!1),cc.INCREMENT_GL_DRAWS(1)},reuse:function(){if(this._reuseGrid>0){var e=this._originalVertices,t=this._vertices;for(var n=0,r=this._vertices.length;n<r;n++)e[n]=t[n];--this._reuseGrid}},calculateVertexPoints:function(){var e=cc.renderContext,t=this._texture.getPixelsWide(),n=this._texture.getPixelsHigh(),r=this._texture.getContentSizeInPixels().height,i=this._gridSize,s=(i.width+1)*(i.height+1);this._vertices=new Float32Array(s*3),this._texCoordinates=new Float32Array(s*2),this._indices=new Uint16Array(i.width*i.height*6),this._verticesBuffer&&e.deleteBuffer(this._verticesBuffer),this._verticesBuffer=e.createBuffer(),this._texCoordinateBuffer&&e.deleteBuffer(this._texCoordinateBuffer),this._texCoordinateBuffer=e.createBuffer(),this._indicesBuffer&&e.deleteBuffer(this._indicesBuffer),this._indicesBuffer=e.createBuffer();var o,u,a,f=this._indices,l=this._texCoordinates,c=this._isTextureFlipped,h=this._vertices;for(o=0;o<i.width;++o)for(u=0;u<i.height;++u){var p=u*i.width+o,d=o*this._step.x,v=d+this._step.x,m=u*this._step.y,g=m+this._step.y,y=o*(i.height+1)+u,b=(o+1)*(i.height+1)+u,w=(o+1)*(i.height+1)+(u+1),E=o*(i.height+1)+(u+1);f[p*6]=y,f[p*6+1]=b,f[p*6+2]=E,f[p*6+3]=b,f[p*6+4]=w,f[p*6+5]=E;var S=[y*3,b*3,w*3,E*3],x={x:d,y:m,z:0},T={x:v,y:m,z:0},N={x:v,y:g,z:0},C={x:d,y:g,z:0},k=[x,T,N,C],L=[y*2,b*2,w*2,E*2],A=[cc.p(d,m),cc.p(v,m),cc.p(v,g),cc.p(d,g)];for(a=0;a<4;++a)h[S[a]]=k[a].x,h[S[a]+1]=k[a].y,h[S[a]+2]=k[a].z,l[L[a]]=A[a].x/t,c?l[L[a]+1]=(r-A[a].y)/n:l[L[a]+1]=A[a].y/n}this._originalVertices=new Float32Array(this._vertices),e.bindBuffer(e.ARRAY_BUFFER,this._verticesBuffer),e.bufferData(e.ARRAY_BUFFER,this._vertices,e.DYNAMIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,this._texCoordinateBuffer),e.bufferData(e.ARRAY_BUFFER,this._texCoordinates,e.DYNAMIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._indicesBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this._indices,e.STATIC_DRAW),this._dirty=!0}}),cc.Grid3D.create=function(e,t,n){var r=new cc.Grid3D;return r&&r.initWithSize(e,t,n)?r:null},cc.TiledGrid3D=cc.GridBase.extend({_texCoordinates:null,_vertices:null,_originalVertices:null,_indices:null,_texCoordinateBuffer:null,_verticesBuffer:null,_indicesBuffer:null,ctor:function(){cc.GridBase.prototype.ctor.call(this),this._texCoordinates=null,this._vertices=null,this._originalVertices=null,this._indices=null,this._texCoordinateBuffer=null,this._verticesBuffer=null,this._indicesBuffer=null},tile:function(e){(e.x!==(0|e.x)||e.y!==(0|e.y))&&cc.log("cc.TiledGrid3D.tile() : Numbers must be integers");var t=(this._gridSize.height*e.x+e.y)*4*3,n=this._vertices;return new cc.Quad3(new cc.Vertex3F(n[t],n[t+1],n[t+2]),new cc.Vertex3F(n[t+3],n[t+4],n[t+5]),new cc.Vertex3F(n[t+6],n[t+7],n[t+8]),new cc.Vertex3F(n[t+9],n[t+10],n[t+11]))},originalTile:function(e){(e.x!==(0|e.x)||e.y!==(0|e.y))&&cc.log("cc.TiledGrid3D.originalTile() : Numbers must be integers");var t=(this._gridSize.height*e.x+e.y)*4*3,n=this._originalVertices;return new cc.Quad3(new cc.Vertex3F(n[t],n[t+1],n[t+2]),new cc.Vertex3F(n[t+3],n[t+4],n[t+5]),new cc.Vertex3F(n[t+6],n[t+7],n[t+8]),new cc.Vertex3F(n[t+9],n[t+10],n[t+11]))},setTile:function(e,t){(e.x!==(0|e.x)||e.y!==(0|e.y))&&cc.log("cc.TiledGrid3D.setTile() : Numbers must be integers");var n=(this._gridSize.height*e.x+e.y)*12,r=this._vertices;r[n]=t.bl.x,r[n+1]=t.bl.y,r[n+2]=t.bl.z,r[n+3]=t.br.x,r[n+4]=t.br.y,r[n+5]=t.br.z,r[n+6]=t.tl.x,r[n+7]=t.tl.y,r[n+8]=t.tl.z,r[n+9]=t.tr.x,r[n+10]=t.tr.y,r[n+11]=t.tr.z,this._dirty=!0},blit:function(){var e=this._gridSize.width*this._gridSize.height;this._shaderProgram.use(),this._shaderProgram.setUniformsForBuiltins();var t=cc.renderContext,n=this._dirty;cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POSITION|cc.VERTEX_ATTRIB_FLAG_TEX_COORDS),t.bindBuffer(t.ARRAY_BUFFER,this._verticesBuffer),n&&t.bufferData(t.ARRAY_BUFFER,this._vertices,t.DYNAMIC_DRAW),t.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,3,t.FLOAT,!1,0,this._vertices),t.bindBuffer(t.ARRAY_BUFFER,this._texCoordinateBuffer),n&&t.bufferData(t.ARRAY_BUFFER,this._texCoordinates,t.DYNAMIC_DRAW),t.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,t.FLOAT,!1,0,this._texCoordinates),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._indicesBuffer),n&&t.bufferData(t.ELEMENT_ARRAY_BUFFER,this._indices,t.STATIC_DRAW),t.drawElements(t.TRIANGLES,e*6,t.UNSIGNED_SHORT,0),n&&(this._dirty=!1),cc.INCREMENT_GL_DRAWS(1)},reuse:function(){if(this._reuseGrid>0){var e=this._vertices,t=this._originalVertices;for(var n=0;n<e.length;n++)t[n]=e[n];--this._reuseGrid}},calculateVertexPoints:function(){var e=this._texture.getPixelsWide(),t=this._texture.getPixelsHigh(),n=this._texture.getContentSizeInPixels().height,r=this._gridSize,i=r.width*r.height;this._vertices=new Float32Array(i*12),this._texCoordinates=new Float32Array(i*8),this._indices=new Uint16Array(i*6);var s=cc.renderContext;this._verticesBuffer&&s.deleteBuffer(this._verticesBuffer),this._verticesBuffer=s.createBuffer(),this._texCoordinateBuffer&&s.deleteBuffer(this._texCoordinateBuffer),this._texCoordinateBuffer=s.createBuffer(),this._indicesBuffer&&s.deleteBuffer(this._indicesBuffer),this._indicesBuffer=s.createBuffer();var o,u,a=0,f=this._step,l=this._vertices,c=this._texCoordinates,h=this._isTextureFlipped;for(o=0;o<r.width;o++)for(u=0;u<r.height;u++){var p=o*f.x,d=p+f.x,v=u*f.y,m=v+f.y;l[a*12]=p,l[a*12+1]=v,l[a*12+2]=0,l[a*12+3]=d,l[a*12+4]=v,l[a*12+5]=0,l[a*12+6]=p,l[a*12+7]=m,l[a*12+8]=0,l[a*12+9]=d,l[a*12+10]=m,l[a*12+11]=0;var g=v,y=m;h&&(g=n-v,y=n-m),c[a*8]=p/e,c[a*8+1]=g/t,c[a*8+2]=d/e,c[a*8+3]=g/t,c[a*8+4]=p/e,c[a*8+5]=y/t,c[a*8+6]=d/e,c[a*8+7]=y/t,a++}var b=this._indices;for(o=0;o<i;o++)b[o*6+0]=o*4+0,b[o*6+1]=o*4+1,b[o*6+2]=o*4+2,b[o*6+3]=o*4+1,b[o*6+4]=o*4+2,b[o*6+5]=o*4+3;this._originalVertices=new Float32Array(this._vertices),s.bindBuffer(s.ARRAY_BUFFER,this._verticesBuffer),s.bufferData(s.ARRAY_BUFFER,this._vertices,s.DYNAMIC_DRAW),s.bindBuffer(s.ARRAY_BUFFER,this._texCoordinateBuffer),s.bufferData(s.ARRAY_BUFFER,this._texCoordinates,s.DYNAMIC_DRAW),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,this._indicesBuffer),s.bufferData(s.ELEMENT_ARRAY_BUFFER,this._indices,s.DYNAMIC_DRAW),this._dirty=!0}}),cc.TiledGrid3D.create=function(e,t,n){var r=new cc.TiledGrid3D;return r.initWithSize(e,t,n),r},cc.Grabber=cc.Class.extend({_FBO:null,_oldFBO:null,_oldClearColor:null,_gl:null,ctor:function(){this._gl=cc.renderContext,this._oldClearColor=[0,0,0,0],this._oldFBO=null,this._FBO=this._gl.createFramebuffer()},grab:function(e){var t=this._gl;this._oldFBO=t.getParameter(t.FRAMEBUFFER_BINDING),t.bindFramebuffer(t.FRAMEBUFFER,this._FBO),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e._webTextureObj,0);var n=t.checkFramebufferStatus(t.FRAMEBUFFER);n!=t.FRAMEBUFFER_COMPLETE&&cc.log("Frame Grabber: could not attach texture to frmaebuffer"),t.bindFramebuffer(t.FRAMEBUFFER,this._oldFBO)},beforeRender:function(e){var t=this._gl;this._oldFBO=t.getParameter(t.FRAMEBUFFER_BINDING),t.bindFramebuffer(t.FRAMEBUFFER,this._FBO),this._oldClearColor=t.getParameter(t.COLOR_CLEAR_VALUE),t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)},afterRender:function(e){var t=this._gl;t.bindFramebuffer(t.FRAMEBUFFER,this._oldFBO),t.colorMask(!0,!0,!0,!0)},destroy:function(){this._gl.deleteFramebuffer(this._FBO)}}),cc.v2fzero=function(){return{x:0,y:0}},cc.v2f=function(e,t){return{x:e,y:t}},cc.v2fadd=function(e,t){return cc.v2f(e.x+t.x,e.y+t.y)},cc.v2fsub=function(e,t){return cc.v2f(e.x-t.x,e.y-t.y)},cc.v2fmult=function(e,t){return cc.v2f(e.x*t,e.y*t)},cc.v2fperp=function(e){return cc.v2f(-e.y,e.x)},cc.v2fneg=function(e){return cc.v2f(-e.x,-e.y)},cc.v2fdot=function(e,t){return e.x*t.x+e.y*t.y},cc.v2fforangle=function(e){return cc.v2f(Math.cos(e),Math.sin(e))},cc.v2fnormalize=function(e){var t=cc.pNormalize(cc.p(e.x,e.y));return cc.v2f(t.x,t.y)},cc.__v2f=function(e){return cc.v2f(e.x,e.y)},cc.__t=function(e){return{u:e.x,v:e.y}},cc.DrawNodeCanvas=cc.Node.extend({_buffer:null,_blendFunc:null,_lineWidth:0,_drawColor:null,ctor:function(){cc.Node.prototype.ctor.call(this),this._buffer=[],this._lineWidth=1,this._drawColor=new cc.Color4F(255,255,255,255),this._blendFunc=new cc.BlendFunc(cc.BLEND_SRC,cc.BLEND_DST)},getBlendFunc:function(){return this._blendFunc},setBlendFunc:function(e){this._blendFunc=e},setLineWidth:function(e){this._lineWidth=e},getLineWidth:function(){return this._lineWidth},setDrawColor:function(e){this._drawColor.r=e.r,this._drawColor.g=e.g,this._drawColor.b=e.b,this._drawColor.a=e.a},getDrawColor:function(){return new cc.Color4F(this._drawColor.r,this._drawColor.g,this._drawColor.b,this._drawColor.a)},drawRect:function(e,t,n,r,i){r=r||this._lineWidth,i=i||this.getDrawColor();var s=[e,cc.p(t.x,e.y),t,cc.p(e.x,t.y)],o=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);o.verts=s,o.lineWidth=r,o.lineColor=i,o.isClosePolygon=!0,o.isStroke=!0,o.lineCap="butt",o.fillColor=n,n&&(o.isFill=!0),this._buffer.push(o)},drawCircle:function(e,t,n,r,i,s,o){s=s||this._lineWidth,o=o||this.getDrawColor();var u=2*Math.PI/r,a=[];for(var f=0;f<=r;f++){var l=f*u,c=t*Math.cos(l+n)+e.x,h=t*Math.sin(l+n)+e.y;a.push(cc.p(c,h))}i&&a.push(cc.p(e.x,e.y));var p=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);p.verts=a,p.lineWidth=s,p.lineColor=o,p.isClosePolygon=!0,p.isStroke=!0,this._buffer.push(p)},drawQuadBezier:function(e,t,n,r,i,s){i=i||this._lineWidth,s=s||this.getDrawColor();var o=[],u=0;for(var a=0;a<r;a++){var f=Math.pow(1-u,2)*e.x+2*(1-u)*u*t.x+u*u*n.x,l=Math.pow(1-u,2)*e.y+2*(1-u)*u*t.y+u*u*n.y;o.push(cc.p(f,l)),u+=1/r}o.push(cc.p(n.x,n.y));var c=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);c.verts=
o,c.lineWidth=i,c.lineColor=s,c.isStroke=!0,c.lineCap="round",this._buffer.push(c)},drawCubicBezier:function(e,t,n,r,i,s,o){s=s||this._lineWidth,o=o||this.getDrawColor();var u=[],a=0;for(var f=0;f<i;f++){var l=Math.pow(1-a,3)*e.x+3*Math.pow(1-a,2)*a*t.x+3*(1-a)*a*a*n.x+a*a*a*r.x,c=Math.pow(1-a,3)*e.y+3*Math.pow(1-a,2)*a*t.y+3*(1-a)*a*a*n.y+a*a*a*r.y;u.push(cc.p(l,c)),a+=1/i}u.push(cc.p(r.x,r.y));var h=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);h.verts=u,h.lineWidth=s,h.lineColor=o,h.isStroke=!0,h.lineCap="round",this._buffer.push(h)},drawCatmullRom:function(e,t,n,r){this.drawCardinalSpline(e,.5,t,n,r)},drawCardinalSpline:function(e,t,n,r,i){r=r||this._lineWidth,i=i||this.getDrawColor();var s=[],o,u,a=1/e.length;for(var f=0;f<n+1;f++){var l=f/n;l==1?(o=e.length-1,u=1):(o=0|l/a,u=(l-a*o)/a);var c=cc.CardinalSplineAt(cc.getControlPointAt(e,o-1),cc.getControlPointAt(e,o-0),cc.getControlPointAt(e,o+1),cc.getControlPointAt(e,o+2),t,u);s.push(c)}var h=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);h.verts=s,h.lineWidth=r,h.lineColor=i,h.isStroke=!0,h.lineCap="round",this._buffer.push(h)},drawDot:function(e,t,n){n=n||this.getDrawColor();var r=new cc._DrawNodeElement(cc.DrawNode.TYPE_DOT);r.verts=[e],r.lineWidth=t,r.fillColor=n,this._buffer.push(r)},drawSegment:function(e,t,n,r){n=n||this._lineWidth,r=r||this.getDrawColor();var i=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);i.verts=[e,t],i.lineWidth=n,i.lineColor=r,i.isStroke=!0,i.lineCap="round",this._buffer.push(i)},drawPoly_:function(e,t,n,r){n=n||this._lineWidth,r=r||this.getDrawColor();var i=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);i.verts=e,i.fillColor=t,i.lineWidth=n,i.lineColor=r,i.isClosePolygon=!0,i.isStroke=!0,i.lineCap="round",t&&(i.isFill=!0),this._buffer.push(i)},drawPoly:function(e,t,n,r){var i=[];for(var s=0;s<e.length;s++)i.push(cc.p(e[s].x,e[s].y));return this.drawPoly_(i,t,n,r)},draw:function(e){var t=e||cc.renderContext;this._blendFunc&&this._blendFunc.src==gl.SRC_ALPHA&&this._blendFunc.dst==gl.ONE&&(t.globalCompositeOperation="lighter");for(var n=0;n<this._buffer.length;n++){var r=this._buffer[n];switch(r.type){case cc.DrawNode.TYPE_DOT:this._drawDot(t,r);break;case cc.DrawNode.TYPE_SEGMENT:this._drawSegment(t,r);break;case cc.DrawNode.TYPE_POLY:this._drawPoly(t,r)}}},_drawDot:function(e,t){var n=t.fillColor,r=t.verts[0],i=t.lineWidth,s=cc.EGLView.getInstance().getScaleX(),o=cc.EGLView.getInstance().getScaleY();e.fillStyle="rgba("+(0|n.r*255)+","+(0|n.g*255)+","+(0|n.b*255)+","+n.a+")",e.beginPath(),e.arc(r.x*s,-r.y*o,i*s,0,Math.PI*2,!1),e.closePath(),e.fill()},_drawSegment:function(e,t){var n=t.lineColor,r=t.verts[0],i=t.verts[1],s=t.lineWidth,o=t.lineCap,u=cc.EGLView.getInstance().getScaleX(),a=cc.EGLView.getInstance().getScaleY();e.strokeStyle="rgba("+(0|n.r*255)+","+(0|n.g*255)+","+(0|n.b*255)+","+n.a+")",e.lineWidth=s*u,e.beginPath(),e.lineCap=o,e.moveTo(r.x*u,-r.y*a),e.lineTo(i.x*u,-i.y*a),e.stroke()},_drawPoly:function(e,t){var n=t.verts,r=t.lineCap,i=t.fillColor,s=t.lineWidth,o=t.lineColor,u=t.isClosePolygon,a=t.isFill,f=t.isStroke;if(n==null)return;var l=n[0],c=cc.EGLView.getInstance().getScaleX(),h=cc.EGLView.getInstance().getScaleY();e.lineCap=r,i&&(e.fillStyle="rgba("+(0|i.r*255)+","+(0|i.g*255)+","+(0|i.b*255)+","+i.a+")"),s&&(e.lineWidth=s*c),o&&(e.strokeStyle="rgba("+(0|o.r*255)+","+(0|o.g*255)+","+(0|o.b*255)+","+o.a+")"),e.beginPath(),e.moveTo(l.x*c,-l.y*h);for(var p=1,d=n.length;p<d;p++)e.lineTo(n[p].x*c,-n[p].y*h);u&&e.closePath(),a&&e.fill(),f&&e.stroke()},clear:function(){this._buffer.length=0}}),cc.DrawNodeWebGL=cc.Node.extend({_bufferCapacity:0,_buffer:null,_trianglesArrayBuffer:null,_trianglesWebBuffer:null,_trianglesReader:null,_blendFunc:null,_dirty:!1,getBlendFunc:function(){return this._blendFunc},setBlendFunc:function(e){this._blendFunc=e},ctor:function(){cc.Node.prototype.ctor.call(this),this._buffer=[],this._blendFunc=new cc.BlendFunc(cc.BLEND_SRC,cc.BLEND_DST)},init:function(){return cc.Node.prototype.init.call(this)?(this.setShaderProgram(cc.ShaderCache.getInstance().programForKey(cc.SHADER_POSITION_LENGTHTEXTURECOLOR)),this._ensureCapacity(512),this._trianglesWebBuffer=cc.renderContext.createBuffer(),this._dirty=!0,!0):!1},_render:function(){var e=cc.renderContext;cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POS_COLOR_TEX),e.bindBuffer(e.ARRAY_BUFFER,this._trianglesWebBuffer),this._dirty&&(e.bufferData(e.ARRAY_BUFFER,this._trianglesArrayBuffer,e.STREAM_DRAW),this._dirty=!1);var t=cc.V2F_C4B_T2F.BYTES_PER_ELEMENT;e.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,e.FLOAT,!1,t,0),e.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,e.UNSIGNED_BYTE,!0,t,8),e.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,e.FLOAT,!1,t,12),e.drawArrays(e.TRIANGLES,0,this._buffer.length*3),cc.INCREMENT_GL_DRAWS(1)},_ensureCapacity:function(e){if(this._buffer.length+e>this._bufferCapacity){var t=cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT;this._bufferCapacity+=Math.max(this._bufferCapacity,e);if(this._buffer==null||this._buffer.length===0)this._buffer=[],this._trianglesArrayBuffer=new ArrayBuffer(t*this._bufferCapacity),this._trianglesReader=new Uint8Array(this._trianglesArrayBuffer);else{var n=this._buffer;n.length=0;var r=new ArrayBuffer(t*this._bufferCapacity);for(var i=0;i<this._buffer.length;i++)n[i]=new cc.V2F_C4B_T2F_Triangle(this._buffer[i].a,this._buffer[i].b,this._buffer[i].c,r,i*t);this._trianglesReader=new Uint8Array(r),this._trianglesArrayBuffer=r}}},draw:function(){cc.glBlendFunc(this._blendFunc.src,this._blendFunc.dst),this._shaderProgram.use(),this._shaderProgram.setUniformsForBuiltins(),this._render()},drawDot:function(e,t,n){var r={r:0|n.r*255,g:0|n.g*255,b:0|n.b*255,a:0|n.a*255},i={vertices:{x:e.x-t,y:e.y-t},colors:r,texCoords:{u:-1,v:-1}},s={vertices:{x:e.x-t,y:e.y+t},colors:r,texCoords:{u:-1,v:1}},o={vertices:{x:e.x+t,y:e.y+t},colors:r,texCoords:{u:1,v:1}},u={vertices:{x:e.x+t,y:e.y-t},colors:r,texCoords:{u:1,v:-1}};this._buffer.push(new cc.V2F_C4B_T2F_Triangle(i,s,o,this._trianglesArrayBuffer,this._buffer.length*cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT)),this._buffer.push(new cc.V2F_C4B_T2F_Triangle(i,o,u,this._trianglesArrayBuffer,this._buffer.length*cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT)),this._dirty=!0},drawSegment:function(e,t,n,r){var i=18;this._ensureCapacity(i);var s={r:0|r.r*255,g:0|r.g*255,b:0|r.b*255,a:0|r.a*255},o=cc.__v2f(e),u=cc.__v2f(t),a=cc.v2fnormalize(cc.v2fperp(cc.v2fsub(u,o))),f=cc.v2fperp(a),l=cc.v2fmult(a,n),c=cc.v2fmult(f,n),h=cc.v2fsub(u,cc.v2fadd(l,c)),p=cc.v2fadd(u,cc.v2fsub(l,c)),d=cc.v2fsub(u,l),v=cc.v2fadd(u,l),m=cc.v2fsub(o,l),g=cc.v2fadd(o,l),y=cc.v2fsub(o,cc.v2fsub(l,c)),b=cc.v2fadd(o,cc.v2fadd(l,c)),w=cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT,E=this._trianglesArrayBuffer;this._buffer.push(new cc.V2F_C4B_T2F_Triangle({vertices:h,colors:s,texCoords:cc.__t(cc.v2fneg(cc.v2fadd(a,f)))},{vertices:p,colors:s,texCoords:cc.__t(cc.v2fsub(a,f))},{vertices:d,colors:s,texCoords:cc.__t(cc.v2fneg(a))},E,this._buffer.length*w)),this._buffer.push(new cc.V2F_C4B_T2F_Triangle({vertices:v,colors:s,texCoords:cc.__t(a)},{vertices:p,colors:s,texCoords:cc.__t(cc.v2fsub(a,f))},{vertices:d,colors:s,texCoords:cc.__t(cc.v2fneg(a))},E,this._buffer.length*w)),this._buffer.push(new cc.V2F_C4B_T2F_Triangle({vertices:v,colors:s,texCoords:cc.__t(a)},{vertices:m,colors:s,texCoords:cc.__t(cc.v2fneg(a))},{vertices:d,colors:s,texCoords:cc.__t(cc.v2fneg(a))},E,this._buffer.length*w)),this._buffer.push(new cc.V2F_C4B_T2F_Triangle({vertices:v,colors:s,texCoords:cc.__t(a)},{vertices:m,colors:s,texCoords:cc.__t(cc.v2fneg(a))},{vertices:g,colors:s,texCoords:cc.__t(a)},E,this._buffer.length*w)),this._buffer.push(new cc.V2F_C4B_T2F_Triangle({vertices:y,colors:s,texCoords:cc.__t(cc.v2fsub(f,a))},{vertices:m,colors:s,texCoords:cc.__t(cc.v2fneg(a))},{vertices:g,colors:s,texCoords:cc.__t(a)},E,this._buffer.length*w)),this._buffer.push(new cc.V2F_C4B_T2F_Triangle({vertices:y,colors:s,texCoords:cc.__t(cc.v2fsub(f,a))},{vertices:b,colors:s,texCoords:cc.__t(cc.v2fadd(a,f))},{vertices:g,colors:s,texCoords:cc.__t(a)},E,this._buffer.length*w)),this._dirty=!0},drawPoly:function(e,t,n,r){var i={r:0|t.r*255,g:0|t.g*255,b:0|t.b*255,a:0|t.a*255},s={r:0|r.r*255,g:0|r.g*255,b:0|r.b*255,a:0|r.a*255},o=[],u,a,f,l,c=e.length;for(u=0;u<c;u++){a=cc.__v2f(e[(u-1+c)%c]),f=cc.__v2f(e[u]),l=cc.__v2f(e[(u+1)%c]);var h=cc.v2fnormalize(cc.v2fperp(cc.v2fsub(f,a))),p=cc.v2fnormalize(cc.v2fperp(cc.v2fsub(l,f))),d=cc.v2fmult(cc.v2fadd(h,p),1/(cc.v2fdot(h,p)+1));o[u]={offset:d,n:p}}var v=n>0,m=3*c-2,g=3*m;this._ensureCapacity(g);var y=cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT,b=this._trianglesArrayBuffer,w=this._buffer,E=v==0?.5:0;for(u=0;u<c-2;u++)a=cc.v2fsub(cc.__v2f(e[0]),cc.v2fmult(o[0].offset,E)),f=cc.v2fsub(cc.__v2f(e[u+1]),cc.v2fmult(o[u+1].offset,E)),l=cc.v2fsub(cc.__v2f(e[u+2]),cc.v2fmult(o[u+2].offset,E)),w.push(new cc.V2F_C4B_T2F_Triangle({vertices:a,colors:i,texCoords:cc.__t(cc.v2fzero())},{vertices:f,colors:i,texCoords:cc.__t(cc.v2fzero())},{vertices:l,colors:i,texCoords:cc.__t(cc.v2fzero())},b,w.length*y));for(u=0;u<c;u++){var S=(u+1)%c;a=cc.__v2f(e[u]),f=cc.__v2f(e[S]);var x=o[u].n,T=o[u].offset,N=o[S].offset,C=v?cc.v2fsub(a,cc.v2fmult(T,n)):cc.v2fsub(a,cc.v2fmult(T,.5)),k=v?cc.v2fsub(f,cc.v2fmult(N,n)):cc.v2fsub(f,cc.v2fmult(N,.5)),L=v?cc.v2fadd(a,cc.v2fmult(T,n)):cc.v2fadd(a,cc.v2fmult(T,.5)),A=v?cc.v2fadd(f,cc.v2fmult(N,n)):cc.v2fadd(f,cc.v2fmult(N,.5));v?(w.push(new cc.V2F_C4B_T2F_Triangle({vertices:C,colors:s,texCoords:cc.__t(cc.v2fneg(x))},{vertices:k,colors:s,texCoords:cc.__t(cc.v2fneg(x))},{vertices:A,colors:s,texCoords:cc.__t(x)},b,w.length*y)),w.push(new cc.V2F_C4B_T2F_Triangle({vertices:C,colors:s,texCoords:cc.__t(cc.v2fneg(x))},{vertices:L,colors:s,texCoords:cc.__t(x)},{vertices:A,colors:s,texCoords:cc.__t(x)},b,w.length*y))):(w.push(new cc.V2F_C4B_T2F_Triangle({vertices:C,colors:i,texCoords:cc.__t(cc.v2fzero())},{vertices:k,colors:i,texCoords:cc.__t(cc.v2fzero())},{vertices:A,colors:i,texCoords:cc.__t(x)},b,w.length*y)),w.push(new cc.V2F_C4B_T2F_Triangle({vertices:C,colors:i,texCoords:cc.__t(cc.v2fzero())},{vertices:L,colors:i,texCoords:cc.__t(x)},{vertices:A,colors:i,texCoords:cc.__t(x)},b,w.length*y)))}o=null,this._dirty=!0},clear:function(){this._buffer.length=0,this._dirty=!0}}),cc.DrawNode=cc.Browser.supportWebGL?cc.DrawNodeWebGL:cc.DrawNodeCanvas,cc.DrawNode.create=function(){var e=new cc.DrawNode;return e&&e.init()?e:null},cc._DrawNodeElement=function(e,t,n,r,i,s,o,u,a){this.type=e,this.verts=t||null,this.fillColor=n||null,this.lineWidth=r||0,this.lineColor=i||null,this.lineCap=s||"butt",this.isClosePolygon=o||!1,this.isFill=u||!1,this.isStroke=a||!1},cc.DrawNode.TYPE_DOT=0,cc.DrawNode.TYPE_SEGMENT=1,cc.DrawNode.TYPE_POLY=2,cc.ACTION_TAG_INVALID=-1,cc.Action=cc.Class.extend({_originalTarget:null,_target:null,_tag:cc.ACTION_TAG_INVALID,ctor:function(){this._originalTarget=null,this._target=null,this._tag=cc.ACTION_TAG_INVALID},description:function(){return"<cc.Action | Tag = "+this._tag+">"},copy:function(){return this.clone()},clone:function(){var e=new cc.Action;return e._originalTarget=null,e._target=null,e._tag=this._tag,e},isDone:function(){return!0},startWithTarget:function(e){this._originalTarget=e,this._target=e},stop:function(){this._target=null},step:function(e){cc.log("[Action step]. override me")},update:function(e){cc.log("[Action update]. override me")},getTarget:function(){return this._target},setTarget:function(e){this._target=e},getOriginalTarget:function(){return this._originalTarget},setOriginalTarget:function(e){this._originalTarget=e},getTag:function(){return this._tag},setTag:function(e){this._tag=e},retain:function(){},release:function(){}}),cc.Action.create=function(){return new cc.Action},cc.FiniteTimeAction=cc.Action.extend({_duration:0,ctor:function(){cc.Action.prototype.ctor.call(this),this._duration=0},getDuration:function(){return this._duration},setDuration:function(e){this._duration=e},reverse:function(){return cc.log("cocos2d: FiniteTimeAction#reverse: Implement me"),null},clone:function(){return new cc.FiniteTimeAction}}),cc.Speed=cc.Action.extend({_speed:0,_innerAction:null,ctor:function(){cc.Action.prototype.ctor.call(this),this._speed=0,this._innerAction=null},getSpeed:function(){return this._speed},setSpeed:function(e){this._speed=e},initWithAction:function(e,t){if(!e)throw"cc.Speed.initWithAction(): action must be non nil";return this._innerAction=e,this._speed=t,!0},clone:function(){var e=new cc.Speed;return e.initWithAction(this._innerAction.clone(),this._speed),e},startWithTarget:function(e){cc.Action.prototype.startWithTarget.call(this,e),this._innerAction.startWithTarget(e)},stop:function(){this._innerAction.stop(),cc.Action.prototype.stop.call(this)},step:function(e){this._innerAction.step(e*this._speed)},isDone:function(){return this._innerAction.isDone()},reverse:function(){return cc.Speed.create(this._innerAction.reverse(),this._speed)},setInnerAction:function(e){this._innerAction!=e&&(this._innerAction=e)},getInnerAction:function(){return this._innerAction}}),cc.Speed.create=function(e,t){var n=new cc.Speed;return n&&n.initWithAction(e,t)?n:null},cc.Follow=cc.Action.extend({_followedNode:null,_boundarySet:!1,_boundaryFullyCovered:!1,_halfScreenSize:null,_fullScreenSize:null,leftBoundary:0,rightBoundary:0,topBoundary:0,bottomBoundary:0,_worldRect:null,ctor:function(){cc.Action.prototype.ctor.call(this),this._followedNode=null,this._boundarySet=!1,this._boundaryFullyCovered=!1,this._halfScreenSize=null,this._fullScreenSize=null,this.leftBoundary=0,this.rightBoundary=0,this.topBoundary=0,this.bottomBoundary=0,this._worldRect=cc.RectZero()},clone:function(){var e=new cc.Follow,t=this._worldRect,n=new cc.Rect(t.x,t.y,t.width,t.height);return e.initWithTarget(this._followedNode,n),e},isBoundarySet:function(){return this._boundarySet},setBoudarySet:function(e){this._boundarySet=e},initWithTarget:function(e,t){if(!e)throw"cc.Follow.initWithAction(): followedNode must be non nil";t=t||cc.RectZero(),this._followedNode=e,this._worldRect=t,this._boundarySet=!cc._rectEqualToZero(t),this._boundaryFullyCovered=!1;var n=cc.Director.getInstance().getWinSize();return this._fullScreenSize=cc.p(n.width,n.height),this._halfScreenSize=cc.pMult(this._fullScreenSize,.5),this._boundarySet&&(this.leftBoundary=-(t.x+t.width-this._fullScreenSize.x),this.rightBoundary=-t.x,this.topBoundary=-t.y,this.bottomBoundary=-(t.y+t.height-this._fullScreenSize.y),this.rightBoundary<this.leftBoundary&&(this.rightBoundary=this.leftBoundary=(this.leftBoundary+this.rightBoundary)/2),this.topBoundary<this.bottomBoundary&&(this.topBoundary=this.bottomBoundary=(this.topBoundary+this.bottomBoundary)/2),this.topBoundary==this.bottomBoundary&&this.leftBoundary==this.rightBoundary&&(this._boundaryFullyCovered=!0)),!0},step:function(e){var t=this._followedNode.getPositionX(),n=this._followedNode.getPositionY();t=this._halfScreenSize.x-t,n=this._halfScreenSize.y-n;if(this._boundarySet){if(this._boundaryFullyCovered)return;this._target.setPosition(cc.clampf(t,this.leftBoundary,this.rightBoundary),cc.clampf(n,this.bottomBoundary,this.topBoundary))}else this._target.setPosition(t,n)},isDone:function(){return!this._followedNode.isRunning()},stop:function(){this._target=null,cc.Action.prototype.stop.call(this)}}),cc.Follow.create=function(e,t){t=t||new cc.RectZero;var n=new cc.Follow;return t!=null&&n&&n.initWithTarget(e,t)?n:n&&n.initWithTarget(e)?n:null},cc.ActionInterval=cc.FiniteTimeAction.extend({_elapsed:0,_firstTick:!1,ctor:function(){cc.FiniteTimeAction.prototype.ctor.call(this),this._elapsed=0,this._firstTick=!1},getElapsed:function(){return this._elapsed},initWithDuration:function(e){return this._duration=e===0?cc.FLT_EPSILON:e,this._elapsed=0,this._firstTick=!0,!0},isDone:function(){return this._elapsed>=this._duration},clone:function(){var e=new cc.ActionInterval;return e.initWithDuration(this._duration),e},step:function(e){this._firstTick?(this._firstTick=!1,this._elapsed=0):this._elapsed+=e;var t=this._elapsed/(this._duration>1.192092896e-7?this._duration:1.192092896e-7);t=1>t?t:1,this.update(t>0?t:0)},startWithTarget:function(e){cc.Action.prototype.startWithTarget.call(this,e),this._elapsed=0,this._firstTick=!0},reverse:function(){return cc.log("cc.IntervalAction: reverse not implemented."),null},setAmplitudeRate:function(e){cc.log("cc.ActionInterval.setAmplitudeRate(): it should be overridden in subclass.")},getAmplitudeRate:function(){cc.log("cc.ActionInterval.getAmplitudeRate(): it should be overridden in subclass.")}}),cc.ActionInterval.create=function(e){var t=new cc.ActionInterval;return t.initWithDuration(e),t},cc.Sequence=cc.ActionInterval.extend({_actions:null,_split:null,_last:0,ctor:function(){cc.ActionInterval.prototype.ctor.call(this),this._actions=[],this._split=null,this._last=0},initWithTwoActions:function(e,t){if(!e||!t)throw"cc.Sequence.initWithTwoActions(): arguments must all be non nil";var n=e.getDuration()+t.getDuration();return this.initWithDuration(n),this._actions[0]=e,this._actions[1]=t,!0},clone:function(){var e=new cc.Sequence;return e.initWithTwoActions(this._actions[0].clone(),this._actions[1].clone()),e},startWithTarget:function(e){cc.ActionInterval.prototype.startWithTarget.call(this,e),this._split=this._actions[0].getDuration()/this._duration,this._last=-1},stop:function(){this._last!==-1&&this._actions[this._last].stop(),cc.Action.prototype.stop.call(this)},update:function(e){var t,n=0,r=this._split,i=this._actions,s=this._last;e<r?(t=r!==0?e/r:1,n===0&&s===1&&(i[1].update(0),i[1].stop())):(n=1,t=r===1?1:(e-r)/(1-r),s===-1&&(i[0].startWithTarget(this._target),i[0].update(1),i[0].stop()),s||(i[0].update(1),i[0].stop()));if(s===n&&i[n].isDone())return;s!==n&&i[n].startWithTarget(this._target),i[n].update(t),this._last=n},reverse:function(){return cc.Sequence._actionOneTwo(this._actions[1].reverse(),this._actions[0].reverse())},copy:function(){return this.clone()}}),cc.Sequence.create=function(e){var t=e instanceof Array?e:arguments;t.length>0&&t[t.length-1]==null&&cc.log("parameters should not be ending with null in Javascript");var n=t[0];for(var r=1;r<t.length;r++)t[r]&&(n=cc.Sequence._actionOneTwo(n,t[r]));return n},cc.Sequence._actionOneTwo=function(e,t){var n=new cc.Sequence;return n.initWithTwoActions(e,t),n},cc.Repeat=cc.ActionInterval.extend({_times:0,_total:0,_nextDt:0,_actionInstant:!1,_innerAction:null,ctor:function(){cc.ActionInterval.prototype.ctor.call(this),this._times=0,this._total=0,this._nextDt=0,this._actionInstant=!1,this._innerAction=null},initWithAction:function(e,t){var n=e.getDuration()*t;return this.initWithDuration(n)?(this._times=t,this._innerAction=e,e instanceof cc.ActionInstant&&(this._times-=1),this._total=0,!0):!1},clone:function(){var e=new cc.Repeat;return e.initWithAction(this._innerAction.clone(),this._times),e},startWithTarget:function(e){this._total=0,this._nextDt=this._innerAction.getDuration()/this._duration,cc.ActionInterval.prototype.startWithTarget.call(this,e),this._innerAction.startWithTarget(e)},stop:function(){this._innerAction.stop(),cc.Action.prototype.stop.call(this)},update:function(e){var t=this._innerAction,n=this._duration,r=this._times,i=this._nextDt;if(e>=i){while(e>i&&this._total<r)t.update(1),this._total++,t.stop(),t.startWithTarget(this._target),i+=t.getDuration()/n,this._nextDt=i;e>=1&&this._total<r&&this._total++,this._actionInstant&&(this._total==r?(t.update(1),t.stop()):t.update(e-(i-t.getDuration()/n)))}else t.update(e*r%1)},isDone:function(){return this._total==this._times},reverse:function(){return cc.Repeat.create(this._innerAction.reverse(),this._times)},setInnerAction:function(e){this._innerAction!=e&&(this._innerAction=e)},getInnerAction:function(){return this._innerAction}}),cc.Repeat.create=function(e,t){var n=new cc.Repeat;return n.initWithAction(e,t),n},cc.RepeatForever=cc.ActionInterval.extend({_innerAction:null,ctor:function(){cc.ActionInterval.prototype.ctor.call(this),this._innerAction=null},initWithAction:function(e){if(!e)throw"cc.RepeatForever.initWithAction(): action must be non null";return this._innerAction=e,!0},clone:function(){var e=new cc.RepeatForever;return e.initWithAction(this._innerAction.clone()),e},startWithTarget:function(e){cc.ActionInterval.prototype.startWithTarget.call(this,e),this._innerAction.startWithTarget(e)},step:function(e){var t=this._innerAction;t.step(e),t.isDone()&&(t.startWithTarget(this._target),t.step(t.getElapsed()-t.getDuration()))},isDone:function(){return!1},reverse:function(){return cc.RepeatForever.create(this._innerAction.reverse())},setInnerAction:function(e){this._innerAction!=e&&(this._innerAction=e)},getInnerAction:function(){return this._innerAction}}),cc.RepeatForever.create=function(e){var t=new cc.RepeatForever;return t&&t.initWithAction(e)?t:null},cc.Spawn=cc.ActionInterval.extend({_one:null,_two:null,ctor:function(){cc.ActionInterval.prototype.ctor.call(this),this._one=null,this._two=null},initWithTwoActions:function(e,t){if(!e||!t)throw"cc.Spawn.initWithTwoActions(): arguments must all be non null";var n=!1,r=e.getDuration(),i=t.getDuration();return this.initWithDuration(Math.max(r,i))&&(this._one=e,this._two=t,r>i?this._two=cc.Sequence._actionOneTwo(t,cc.DelayTime.create(r-i)):r<i&&(this._one=cc.Sequence._actionOneTwo(e,cc.DelayTime.create(i-r))),n=!0),n},clone:function(){var e=new cc.Spawn;return e.initWithTwoActions(this._one.clone(),this._two.clone()),e},startWithTarget:function(e){cc.ActionInterval.prototype.startWithTarget.call(this,e),this._one.startWithTarget(e),this._two.startWithTarget(e)},stop:function(){this._one.stop(),this._two.stop(),cc.Action.prototype.stop.call(this)},update:function(e){this._one&&this._one.update(e),this._two&&this._two.update(e)},reverse:function(){return cc.Spawn._actionOneTwo(this._one.reverse(),this._two.reverse())}}),cc.Spawn.create=function(e){var t=e instanceof Array?e:arguments;t.length>0&&t[t.length-1]==null&&cc.log("parameters should not be ending with null in Javascript");var n=t[0];for(var r=1;r<t.length;r++)t[r]!=null&&(n=this._actionOneTwo(n,t[r]));return n},cc.Spawn._actionOneTwo=function(e,t){var n=new cc.Spawn;return n.initWithTwoActions(e,t),n},cc.RotateTo=cc.ActionInterval.extend({_dstAngleX:0,_startAngleX:0,_diffAngleX:0,_dstAngleY:0,_startAngleY:0,_diffAngleY:0,ctor:function(){cc.ActionInterval.prototype.ctor.call(this),this._dstAngleX=0,this._startAngleX=0,this._diffAngleX=0,this._dstAngleY=0,this._startAngleY=0,this._diffAngleY=0},initWithDuration:function(e,t,n){return cc.ActionInterval.prototype.initWithDuration.call(this,e)?(this._dstAngleX=t||0,this._dstAngleY=n||this._dstAngleX,!0):!1},clone:function(){var e=new cc.RotateTo;return e.initWithDuration(this._duration,this._dstAngleX,this._dstAngleY),e},startWithTarget:function(e){cc.ActionInterval.prototype.startWithTarget.call(this,e);var t=e.getRotationX()%360,n=this._dstAngleX-t;n>180&&(n-=360),n<-180&&(n+=360),this._startAngleX=t,this._diffAngleX=n,this._startAngleY=e.getRotationY()%360;var r=this._dstAngleY-this._startAngleY;r>180&&(r-=360),r<-180&&(r+=360),this._diffAngleY=r},reverse:function(){cc.log("cc.RotateTo.reverse(): it should be overridden in subclass.")},update:function(e){this._target&&(this._target.setRotationX(this._startAngleX+this._diffAngleX*e),this._target.setRotationY(this._startAngleY+this._diffAngleY*e))}}),cc.RotateTo.create=function(e,t,n){var r=new cc.RotateTo;return r.initWithDuration(e,t,n),r},cc.RotateBy=cc.ActionInterval.extend({_angleX:0,_startAngleX:0,_angleY:0,_startAngleY:0,ctor:function(){cc.ActionInterval.prototype.ctor.call(this),this._angleX=0,this._startAngleX=0,this._angleY=0,this._startAngleY=0},initWithDuration:function(e,t,n){return cc.ActionInterval.prototype.initWithDuration.call(this,e)?(this._angleX=t||0,this._angleY=n||this._angleX,!0):!1},clone:function(){var e=new cc.RotateBy;return e.initWithDuration(this._duration,this._angleX,this._angleY),e},startWithTarget:function(e){cc.ActionInterval.prototype.startWithTarget.call(this,e),this._startAngleX=e.getRotationX(),this._startAngleY=e.getRotationY()},update:function(e){this._target&&(this._target.setRotationX(this._startAngleX+this._angleX*e),this._target.setRotationY(this._startAngleY+this._angleY*e))},reverse:function(){return cc.RotateBy.create(this._duration,-this._angleX,-this._angleY)}}),cc.RotateBy.create=function(e,t,n){var r=new cc.RotateBy;return r.initWithDuration(e,t,n),r},cc.MoveBy=cc.ActionInterval.extend({_positionDelta:null,_startPosition:null,_previousPosition:null,ctor:function(){cc.ActionInterval.prototype.ctor.call(this),this._positionDelta=cc.p(0,0),this._startPosition=cc.p(0,0),this._previousPosition=cc.p(0,0)},initWithDuration:function(e,t){return cc.ActionInterval.prototype.initWithDuration.call(this,e)?(this._positionDelta.x=t.x,this._positionDelta.y=t.y,!0):!1},clone:function(){var e=new cc.MoveBy;return e.initWithDuration(this._duration,this._positionDelta),e},startWithTarget:function(e){cc.ActionInterval.prototype.startWithTarget.call(this,e);var t=e.getPositionX(),n=e.getPositionY();this._previousPosition.x=t,this._previousPosition.y=n,this._startPosition.x=t,this._startPosition.y=n},update:function(e){if(this._target){var t=this._positionDelta.x*e,n=this._positionDelta.y*e,r=this._startPosition;if(cc.ENABLE_STACKABLE_ACTIONS){var i=this._target.getPositionX(),s=this._target.getPositionY(),o=this._previousPosition;r.x=r.x+i-o.x,r.y=r.y+s-o.y,t+=r.x,n+=r.y,this._target.setPosition(t,n),o.x=t,o.y=n}else this._target.setPosition(r.x+t,r.y+n)}},reverse:function(){return cc.MoveBy.create(this._duration,cc.p(-this._positionDelta.x,-this._positionDelta.y))}}),cc.MoveBy.create=function(e,t){var n=new cc.MoveBy;return n.initWithDuration(e,t),n},cc.MoveTo=cc.MoveBy.extend({_endPosition:null,ctor:function(){cc.MoveBy.prototype.ctor.call(this),this._endPosition=cc.p(0,0)},initWithDuration:function(e,t){return cc.MoveBy.prototype.initWithDuration.call(this,e,t)?(this._endPosition.x=t.x,this._endPosition.y=t.y,!0):!1},clone:function(){var e=new cc.MoveTo;return e.initWithDuration(this._duration,this._endPosition),e},startWithTarget:function(e){cc.MoveBy.prototype.startWithTarget.call(this,e),this._positionDelta.x=this._endPosition.x-e.getPositionX(),this._positionDelta.y=this._endPosition.y-e.getPositionY()}}),cc.MoveTo.create=function(e,t){var n=new cc.MoveTo;return n.initWithDuration(e,t),n},cc.SkewTo=cc.ActionInterval.extend({_skewX:0,_skewY:0,_startSkewX:0,_startSkewY:0,_endSkewX:0,_endSkewY:0,_deltaX:0,_deltaY:0,ctor:function(){cc.ActionInterval.prototype.ctor.call(this),this._skewX=0,this._skewY=0,this._startSkewX=0,this._startSkewY=0,this._endSkewX=0,this._endSkewY=0,this._deltaX=0,this._deltaY=0},initWithDuration:function(e,t,n){var r=!1;return cc.ActionInterval.prototype.initWithDuration.call(this,e)&&(this._endSkewX=t,this._endSkewY=n,r=!0),r},clone:function(){var e=new cc.SkewTo;return e.initWithDuration(this._duration,this._endSkewX,this._endSkewY),e},startWithTarget:function(e){cc.ActionInterval.prototype.startWithTarget.call(this,e),this._startSkewX=e.getSkewX()%180,this._deltaX=this._endSkewX-this._startSkewX,this._deltaX>180&&(this._deltaX-=360),this._deltaX<-180&&(this._deltaX+=360),this._startSkewY=e.getSkewY()%360,this._deltaY=this._endSkewY-this._startSkewY,this._deltaY>180&&(this._deltaY-=360),this._deltaY<-180&&(this._deltaY+=360)},update:function(e){this._target.setSkewX(this._startSkewX+this._deltaX*e),this._target.setSkewY(this._startSkewY+this._deltaY*e)}}),cc.SkewTo.create=function(e,t,n){var r=new cc.SkewTo;return r&&r.initWithDuration(e,t,n),r},cc.SkewBy=cc.SkewTo.extend({initWithDuration:function(e,t,n){var r=!1;return cc.SkewTo.prototype.initWithDuration.call(this,e,t,n)&&(this._skewX=t,this._skewY=n,r=!0),r},clone:function(){var e=new cc.SkewBy;return e.initWithDuration(this._duration,this._skewX,this._skewY),e},startWithTarget:function(e){cc.SkewTo.prototype.startWithTarget.call(this,e),this._deltaX=this._skewX,this._deltaY=this._skewY,this._endSkewX=this._startSkewX+this._deltaX,this._endSkewY=this._startSkewY+this._deltaY},reverse:function(){return cc.SkewBy.create(this._duration,-this._skewX,-this._skewY)}}),cc.SkewBy.create=function(e,t,n){var r=new cc.SkewBy;return r&&r.initWithDuration(e,t,n),r},cc.JumpBy=cc.ActionInterval.extend({_startPosition:null,_delta:null,_height:0,_jumps:0,_previousPosition:null,ctor:function(){cc.ActionInterval.prototype.ctor.call(this),this._startPosition=cc.p(0,0),this._previousPosition=cc.p(0,0),this._delta=cc.p(0,0),this._height=0,this._jumps=0},initWithDuration:function(e,t,n,r){return cc.ActionInterval.prototype.initWithDuration.call(this,e)?(this._delta.x=t.x,this._delta.y=t.y,this._height=n,this._jumps=r,!0):!1},clone:function(){var e=new cc.JumpBy;return e.initWithDuration(this._duration,this._delta,this._height,this._jumps),e},startWithTarget:function(e){cc.ActionInterval.prototype.startWithTarget.call(this,e);var t=e.getPositionX(),n=e.getPositionY();this._previousPosition.x=t,this._previousPosition.y=n,this._startPosition.x=t,this._startPosition.y=n},update:function(e){if(this._target){var t=e*this._jumps%1,n=this._height*4*t*(1-t);n+=this._delta.y*e;var r=this._delta.x*e,i=this._startPosition;if(cc.ENABLE_STACKABLE_ACTIONS){var s=this._target.getPositionX(),o=this._target.getPositionY(),u=this._previousPosition;i.x=i.x+s-u.x,i.y=i.y+o-u.y,r+=i.x,n+=i.y,this._target.setPosition(r,n),u.x=r,u.y=n}else this._target.setPosition(i.x+r,i.y+n)}},reverse:function(){return cc.JumpBy.create(this._duration,cc.p(-this._delta.x,-this._delta.y),this._height,this._jumps)}}),cc.JumpBy.create=function(e,t,n,r){var i=new cc.JumpBy;return i.initWithDuration(e,t,n,r),i},cc.JumpTo=cc.JumpBy.extend({startWithTarget:function(e){cc.JumpBy.prototype.startWithTarget.call(this,e),this._delta.x=this._delta.x-this._startPosition.x,this._delta.y=this._delta.y-this._startPosition.y},clone:function(){var e=new cc.JumpTo;return e.initWithDuration(this._duration,this._delta,this._height,this._jumps),e}}),cc.JumpTo.create=function(e,t,n,r){var i=new cc.JumpTo;return i.initWithDuration(e,t,n,r),i},cc.bezierAt=function(e,t,n,r,i){return Math.pow(1-i,3)*e+3*i*Math.pow(1-i,2)*t+3*Math.pow(i,2)*(1-i)*n+Math.pow(i,3)*r},cc.BezierBy=cc.ActionInterval.extend({_config:null,_startPosition:null,_previousPosition:null,ctor:function(){cc.ActionInterval.prototype.ctor.call(this),this._config=[],this._startPosition=cc.p(0,0),this._previousPosition=cc.p(0,0)},initWithDuration:function(e,t){return cc.ActionInterval.prototype.initWithDuration.call(this,e)?(this._config=t,!0):!1},clone:function(){var e=new cc.BezierBy,t=[];for(var n=0;n<this._config.length;n++){var r=this._config[n];t.push(cc.p(r.x,r.y))}return e.initWithDuration(this._duration,t),e},startWithTarget:function(e){cc.ActionInterval.prototype.startWithTarget.call(this,e);var t=e.getPositionX(),n=e.getPositionY();this._previousPosition.x=t,this._previousPosition.y=n,this._startPosition.x=t,this._startPosition.y=n},update:function(e){if(this._target){var t=this._config,n=0,r=t[0].x,i=t[1].x,s=t[2].x,o=0,u=t[0].y,a=t[1].y,f=t[2].y,l=cc.bezierAt(n,r,i,s,e),c=cc.bezierAt(o,u,a,f,e),h=this._startPosition;if(cc.ENABLE_STACKABLE_ACTIONS){var p=this._target.getPositionX(),d=this._target.getPositionY(),v=this._previousPosition;h.x=h.x+p-v.x,h.y=h.y+d-v.y,l+=h.x,c+=h.y,this._target.setPosition(l,c),v.x=l,v.y=c}else this._target.setPosition(h.x+l,h.y+c)}},reverse:function(){var e=this._config,t=[cc.pAdd(e[1],cc.pNeg(e[2])),cc.pAdd(e[0],cc.pNeg(e[2])),cc.pNeg(e[2])];return cc.BezierBy.create(this._duration,t)}}),cc.BezierBy.create=function(e,t){var n=new cc.BezierBy;return n.initWithDuration(e,t),n},cc.BezierTo=cc.BezierBy.extend({_toConfig:null,ctor:function(){cc.BezierBy.prototype.ctor.call(this),this._toConfig=[]},initWithDuration:function(e,t){return cc.ActionInterval.prototype.initWithDuration.call(this,e)?(this._toConfig=t,!0):!1},clone:function(){var e=new cc.BezierTo;return e.initWithDuration(this._duration,this._toConfig),e},startWithTarget:function(e){cc.BezierBy.prototype.startWithTarget.call(this,e);var t=this._startPosition,n=this._toConfig,r=this._config;r[0]=cc.pSub(n[0],t),r[1]=cc.pSub(n[1],t),r[2]=cc.pSub(n[2],t)}}),cc.BezierTo.create=function(e,t){var n=new cc.BezierTo;return n.initWithDuration(e,t),n},cc.ScaleTo=cc.ActionInterval.extend({_scaleX:1,_scaleY:1,_startScaleX:1,_startScaleY:1,_endScaleX:0,_endScaleY:0,_deltaX:0,_deltaY:0,ctor:function(){cc.ActionInterval.prototype.ctor.call(this),this._scaleX=1,this._scaleY=1,this._startScaleX=1,this._startScaleY=1,this._endScaleX=0,this._endScaleY=0,this._deltaX=0,this._deltaY=0},initWithDuration:function(e,t,n){return cc.ActionInterval.prototype.initWithDuration.call(this,e)?(this._endScaleX=t,this._endScaleY=n!=
null?n:t,!0):!1},clone:function(){var e=new cc.ScaleTo;return e.initWithDuration(this._duration,this._endScaleX,this._endScaleY),e},startWithTarget:function(e){cc.ActionInterval.prototype.startWithTarget.call(this,e),this._startScaleX=e.getScaleX(),this._startScaleY=e.getScaleY(),this._deltaX=this._endScaleX-this._startScaleX,this._deltaY=this._endScaleY-this._startScaleY},update:function(e){this._target&&this._target.setScale(this._startScaleX+this._deltaX*e,this._startScaleY+this._deltaY*e)}}),cc.ScaleTo.create=function(e,t,n){var r=new cc.ScaleTo;return r.initWithDuration(e,t,n),r},cc.ScaleBy=cc.ScaleTo.extend({startWithTarget:function(e){cc.ScaleTo.prototype.startWithTarget.call(this,e),this._deltaX=this._startScaleX*this._endScaleX-this._startScaleX,this._deltaY=this._startScaleY*this._endScaleY-this._startScaleY},reverse:function(){return cc.ScaleBy.create(this._duration,1/this._endScaleX,1/this._endScaleY)},clone:function(){var e=new cc.ScaleBy;return e.initWithDuration(this._duration,this._endScaleX,this._endScaleY),e}}),cc.ScaleBy.create=function(e,t,n){var r=new cc.ScaleBy;return r.initWithDuration(e,t,n),r},cc.Blink=cc.ActionInterval.extend({_times:0,_originalState:!1,ctor:function(){cc.ActionInterval.prototype.ctor.call(this),this._times=0,this._originalState=!1},initWithDuration:function(e,t){return cc.ActionInterval.prototype.initWithDuration.call(this,e)?(this._times=t,!0):!1},clone:function(){var e=new cc.Blink;return e.initWithDuration(this._duration,this._times),e},update:function(e){if(this._target&&!this.isDone()){var t=1/this._times,n=e%t;this._target.setVisible(n>t/2)}},startWithTarget:function(e){cc.ActionInterval.prototype.startWithTarget.call(this,e),this._originalState=e.isVisible()},stop:function(){this._target.setVisible(this._originalState),cc.ActionInterval.prototype.stop.call(this)},reverse:function(){return cc.Blink.create(this._duration,this._times)}}),cc.Blink.create=function(e,t){var n=new cc.Blink;return n.initWithDuration(e,t),n},cc.FadeTo=cc.ActionInterval.extend({_toOpacity:null,_fromOpacity:null,ctor:function(){cc.ActionInterval.prototype.ctor.call(this),this._toOpacity=0,this._fromOpacity=0},initWithDuration:function(e,t){return cc.ActionInterval.prototype.initWithDuration.call(this,e)?(this._toOpacity=t,!0):!1},clone:function(){var e=new cc.FadeTo;return e.initWithDuration(this._duration,this._toOpacity),e},update:function(e){if(this._target.RGBAProtocol){var t=this._fromOpacity;this._target.setOpacity(t+(this._toOpacity-t)*e)}},startWithTarget:function(e){cc.ActionInterval.prototype.startWithTarget.call(this,e),this._target.RGBAProtocol&&(this._fromOpacity=e.getOpacity())}}),cc.FadeTo.create=function(e,t){var n=new cc.FadeTo;return n.initWithDuration(e,t),n},cc.FadeIn=cc.FadeTo.extend({_reverseAction:null,reverse:function(){var e=new cc.FadeOut;return e.initWithDuration(this._duration,0),e},clone:function(){var e=new cc.FadeIn;return e.initWithDuration(this._duration,this._toOpacity),e},startWithTarget:function(e){this._reverseAction&&(this._toOpacity=this._reverseAction._fromOpacity),cc.FadeTo.prototype.startWithTarget.call(this,e)}}),cc.FadeIn.create=function(e,t){t==null&&(t=255);var n=new cc.FadeIn;return n.initWithDuration(e,t),n},cc.FadeOut=cc.FadeTo.extend({reverse:function(){var e=new cc.FadeIn;return e._reverseAction=this,e.initWithDuration(this._duration,255),e},clone:function(){var e=new cc.FadeOut;return e.initWithDuration(this._duration,this._toOpacity),e}}),cc.FadeOut.create=function(e){var t=new cc.FadeOut;return t.initWithDuration(e,0),t},cc.TintTo=cc.ActionInterval.extend({_to:null,_from:null,ctor:function(){cc.ActionInterval.prototype.ctor.call(this),this._to=cc.c3b(0,0,0),this._from=cc.c3b(0,0,0)},initWithDuration:function(e,t,n,r){return cc.ActionInterval.prototype.initWithDuration.call(this,e)?(this._to=cc.c3b(t,n,r),!0):!1},clone:function(){var e=new cc.TintTo,t=this._to;return e.initWithDuration(this._duration,t.r,t.g,t.b),e},startWithTarget:function(e){cc.ActionInterval.prototype.startWithTarget.call(this,e),this._target.RGBAProtocol&&(this._from=this._target.getColor())},update:function(e){var t=this._from,n=this._to;this._target.RGBAProtocol&&this._target.setColor(cc.c3b(t.r+(n.r-t.r)*e,t.g+(n.g-t.g)*e,t.b+(n.b-t.b)*e))}}),cc.TintTo.create=function(e,t,n,r){var i=new cc.TintTo;return i.initWithDuration(e,t,n,r),i},cc.TintBy=cc.ActionInterval.extend({_deltaR:0,_deltaG:0,_deltaB:0,_fromR:0,_fromG:0,_fromB:0,ctor:function(){cc.ActionInterval.prototype.ctor.call(this),this._deltaR=0,this._deltaG=0,this._deltaB=0,this._fromR=0,this._fromG=0,this._fromB=0},initWithDuration:function(e,t,n,r){return cc.ActionInterval.prototype.initWithDuration.call(this,e)?(this._deltaR=t,this._deltaG=n,this._deltaB=r,!0):!1},clone:function(){var e=new cc.TintBy;return e.initWithDuration(this._duration,this._deltaR,this._deltaG,this._deltaB),e},startWithTarget:function(e){cc.ActionInterval.prototype.startWithTarget.call(this,e);if(e.RGBAProtocol){var t=e.getColor();this._fromR=t.r,this._fromG=t.g,this._fromB=t.b}},update:function(e){this._target.RGBAProtocol&&this._target.setColor(cc.c3b(this._fromR+this._deltaR*e,this._fromG+this._deltaG*e,this._fromB+this._deltaB*e))},reverse:function(){return cc.TintBy.create(this._duration,-this._deltaR,-this._deltaG,-this._deltaB)}}),cc.TintBy.create=function(e,t,n,r){var i=new cc.TintBy;return i.initWithDuration(e,t,n,r),i},cc.DelayTime=cc.ActionInterval.extend({update:function(e){},reverse:function(){return cc.DelayTime.create(this._duration)},clone:function(){var e=new cc.DelayTime;return e.initWithDuration(this._duration),e}}),cc.DelayTime.create=function(e){var t=new cc.DelayTime;return t.initWithDuration(e),t},cc.ReverseTime=cc.ActionInterval.extend({_other:null,ctor:function(){cc.ActionInterval.prototype.ctor.call(this),this._other=null},initWithAction:function(e){if(!e)throw"cc.ReverseTime.initWithAction(): action must be non null";if(e==this._other)throw"cc.ReverseTime.initWithAction(): the action was already passed in.";return cc.ActionInterval.prototype.initWithDuration.call(this,e.getDuration())?(this._other=e,!0):!1},clone:function(){var e=new cc.ReverseTime;return e.initWithAction(this._other.clone()),e},startWithTarget:function(e){cc.ActionInterval.prototype.startWithTarget.call(this,e),this._other.startWithTarget(e)},update:function(e){this._other&&this._other.update(1-e)},reverse:function(){return this._other.clone()},stop:function(){this._other.stop(),cc.Action.prototype.stop.call(this)}}),cc.ReverseTime.create=function(e){var t=new cc.ReverseTime;return t.initWithAction(e),t},cc.Animate=cc.ActionInterval.extend({_animation:null,_nextFrame:0,_origFrame:null,_executedLoops:0,_splitTimes:null,ctor:function(){cc.ActionInterval.prototype.ctor.call(this),this._animation=null,this._nextFrame=0,this._origFrame=null,this._executedLoops=0,this._splitTimes=[]},getAnimation:function(){return this._animation},setAnimation:function(e){this._animation=e},initWithAnimation:function(e){if(!e)throw"cc.Animate.initWithAnimation(): animation must be non-NULL";var t=e.getDuration();if(this.initWithDuration(t*e.getLoops())){this._nextFrame=0,this.setAnimation(e),this._origFrame=null,this._executedLoops=0;var n=this._splitTimes;n.length=0;var r=0,i=t/e.getTotalDelayUnits(),s=e.getFrames();cc.ArrayVerifyType(s,cc.AnimationFrame);for(var o=0;o<s.length;o++){var u=s[o],a=r*i/t;r+=u.getDelayUnits(),n.push(a)}return!0}return!1},clone:function(){var e=new cc.Animate;return e.initWithAnimation(this._animation.clone()),e},startWithTarget:function(e){cc.ActionInterval.prototype.startWithTarget.call(this,e),this._animation.getRestoreOriginalFrame()&&(this._origFrame=e.displayFrame()),this._nextFrame=0,this._executedLoops=0},update:function(e){if(e<1){e*=this._animation.getLoops();var t=0|e;t>this._executedLoops&&(this._nextFrame=0,this._executedLoops++),e%=1}var n=this._animation.getFrames(),r=n.length,i=this._splitTimes;for(var s=this._nextFrame;s<r;s++){if(!(i[s]<=e))break;this._target.setDisplayFrame(n[s].getSpriteFrame()),this._nextFrame=s+1}},reverse:function(){var e=this._animation,t=e.getFrames(),n=[];cc.ArrayVerifyType(t,cc.AnimationFrame);if(t.length>0)for(var r=t.length-1;r>=0;r--){var i=t[r];if(!i)break;n.push(i.clone())}var s=cc.Animation.createWithAnimationFrames(n,e.getDelayPerUnit(),e.getLoops());return s.setRestoreOriginalFrame(e.getRestoreOriginalFrame()),cc.Animate.create(s)},stop:function(){this._animation.getRestoreOriginalFrame()&&this._target&&this._target.setDisplayFrame(this._origFrame),cc.Action.prototype.stop.call(this)}}),cc.Animate.create=function(e){var t=new cc.Animate;return t.initWithAnimation(e),t},cc.TargetedAction=cc.ActionInterval.extend({_action:null,_forcedTarget:null,ctor:function(){cc.ActionInterval.prototype.ctor.call(this),this._action=null,this._forcedTarget=null},initWithTarget:function(e,t){return this.initWithDuration(t.getDuration())?(this._forcedTarget=e,this._action=t,!0):!1},clone:function(){var e=new cc.TargetedAction;return e.initWithTarget(this._forcedTarget,this._action.clone()),e},startWithTarget:function(e){cc.ActionInterval.prototype.startWithTarget.call(this,e),this._action.startWithTarget(this._forcedTarget)},stop:function(){this._action.stop()},update:function(e){this._action.update(e)},getForcedTarget:function(){return this._forcedTarget},setForcedTarget:function(e){this._forcedTarget!=e&&(this._forcedTarget=e)}}),cc.TargetedAction.create=function(e,t){var n=new cc.TargetedAction;return n.initWithTarget(e,t),n},cc.ActionInstant=cc.FiniteTimeAction.extend({isDone:function(){return!0},step:function(e){this.update(1)},update:function(e){},reverse:function(){return this.clone()},clone:function(){return new cc.ActionInstant}}),cc.Show=cc.ActionInstant.extend({update:function(e){this._target.setVisible(!0)},reverse:function(){return cc.Hide.create()},clone:function(){return new cc.Show}}),cc.Show.create=function(){return new cc.Show},cc.Hide=cc.ActionInstant.extend({update:function(e){this._target.setVisible(!1)},reverse:function(){return cc.Show.create()},clone:function(){return new cc.Hide}}),cc.Hide.create=function(){return new cc.Hide},cc.ToggleVisibility=cc.ActionInstant.extend({update:function(e){this._target.setVisible(!this._target.isVisible())},reverse:function(){return new cc.ToggleVisibility},clone:function(){return new cc.ToggleVisibility}}),cc.ToggleVisibility.create=function(){return new cc.ToggleVisibility},cc.RemoveSelf=cc.ActionInstant.extend({_isNeedCleanUp:!0,ctor:function(){cc.FiniteTimeAction.prototype.ctor.call(this),this._isNeedCleanUp=!0},update:function(e){this._target.removeFromParent(this._isNeedCleanUp)},init:function(e){return this._isNeedCleanUp=e,!0},reverse:function(){return new cc.RemoveSelf(this._isNeedCleanUp)},clone:function(){return new cc.RemoveSelf(this._isNeedCleanUp)}}),cc.RemoveSelf.create=function(e){e==null&&(e=!0);var t=new cc.RemoveSelf;return t&&t.init(e),t},cc.FlipX=cc.ActionInstant.extend({_flippedX:!1,ctor:function(){cc.FiniteTimeAction.prototype.ctor.call(this),this._flippedX=!1},initWithFlipX:function(e){return this._flippedX=e,!0},update:function(e){this._target.setFlippedX(this._flippedX)},reverse:function(){return cc.FlipX.create(!this._flippedX)},clone:function(){var e=new cc.FlipX;return e.initWithFlipX(this._flippedX),e}}),cc.FlipX.create=function(e){var t=new cc.FlipX;return t.initWithFlipX(e)?t:null},cc.FlipY=cc.ActionInstant.extend({_flippedY:!1,ctor:function(){cc.FiniteTimeAction.prototype.ctor.call(this),this._flippedY=!1},initWithFlipY:function(e){return this._flippedY=e,!0},update:function(e){this._target.setFlippedY(this._flippedY)},reverse:function(){return cc.FlipY.create(!this._flippedY)},clone:function(){var e=new cc.FlipY;return e.initWithFlipY(this._flippedY),e}}),cc.FlipY.create=function(e){var t=new cc.FlipY;return t.initWithFlipY(e)?t:null},cc.Place=cc.ActionInstant.extend({_position:null,ctor:function(){cc.FiniteTimeAction.prototype.ctor.call(this),this._position=cc.p(0,0)},initWithPosition:function(e){return this._position.x=e.x,this._position.y=e.y,!0},update:function(e){this._target.setPosition(this._position)},clone:function(){var e=new cc.Place;return e.initWithPosition(this._position),e}}),cc.Place.create=function(e){var t=new cc.Place;return t.initWithPosition(e),t},cc.CallFunc=cc.ActionInstant.extend({_selectorTarget:null,_callFunc:null,_function:null,_data:null,ctor:function(){cc.FiniteTimeAction.prototype.ctor.call(this),this._selectorTarget=null,this._callFunc=null,this._function=null,this._data=null},initWithTarget:function(e,t,n){return this._data=n,this._callFunc=e,this._selectorTarget=t,!0},initWithFunction:function(e){return this._function=e,!0},execute:function(){cc.doCallback(this._callFunc,this._selectorTarget,this._data)},update:function(e){this.execute()},getTargetCallback:function(){return this._selectorTarget},setTargetCallback:function(e){e!=this._selectorTarget&&(this._selectorTarget&&(this._selectorTarget=null),this._selectorTarget=e)},copy:function(){var e=new cc.CallFunc;return this._selectorTarget?e.initWithTarget(this._callFunc,this._selectorTarget,this._data):this._function&&e.initWithFunction(this._function),e},clone:function(){var e=new cc.CallFunc;return this._selectorTarget?e.initWithTarget(this._callFunc,this._selectorTarget,this._data):this._function&&e.initWithFunction(this._function),e}}),cc.CallFunc.create=function(e,t,n){var r=new cc.CallFunc;if(t===undefined){if(r&&r.initWithFunction(e))return r}else if(r&&r.initWithTarget(e,t,n))return r._callFunc=e,r;return null},cc.ActionCamera=cc.ActionInterval.extend({_centerXOrig:0,_centerYOrig:0,_centerZOrig:0,_eyeXOrig:0,_eyeYOrig:0,_eyeZOrig:0,_upXOrig:0,_upYOrig:0,_upZOrig:0,ctor:function(){cc.ActionInterval.prototype.ctor.call(this),this._centerXOrig=0,this._centerYOrig=0,this._centerZOrig=0,this._eyeXOrig=0,this._eyeYOrig=0,this._eyeZOrig=0,this._upXOrig=0,this._upYOrig=0,this._upZOrig=0},startWithTarget:function(e){cc.ActionInterval.prototype.startWithTarget.call(this,e);var t=e.getCamera(),n=t.getCenter();this._centerXOrig=n.x,this._centerYOrig=n.y,this._centerZOrig=n.z;var r=t.getEye();this._eyeXOrig=r.x,this._eyeYOrig=r.y,this._eyeZOrig=r.z;var i=t.getUp();this._upXOrig=i.x,this._upYOrig=i.y,this._upZOrig=i.z},clone:function(){return new cc.ActionCamera},reverse:function(){return cc.ReverseTime.create(this)}}),cc.OrbitCamera=cc.ActionCamera.extend({_radius:0,_deltaRadius:0,_angleZ:0,_deltaAngleZ:0,_angleX:0,_deltaAngleX:0,_radZ:0,_radDeltaZ:0,_radX:0,_radDeltaX:0,ctor:function(){cc.ActionCamera.prototype.ctor.call(this),this._radius=0,this._deltaRadius=0,this._angleZ=0,this._deltaAngleZ=0,this._angleX=0,this._deltaAngleX=0,this._radZ=0,this._radDeltaZ=0,this._radX=0,this._radDeltaX=0},initWithDuration:function(e,t,n,r,i,s,o){return cc.ActionInterval.prototype.initWithDuration.call(this,e)?(this._radius=t,this._deltaRadius=n,this._angleZ=r,this._deltaAngleZ=i,this._angleX=s,this._deltaAngleX=o,this._radDeltaZ=cc.DEGREES_TO_RADIANS(i),this._radDeltaX=cc.DEGREES_TO_RADIANS(o),!0):!1},sphericalRadius:function(){var e,t,n,r=this._target.getCamera(),i=r.getEye(),s=r.getCenter(),o=i.x-s.x,u=i.y-s.y,a=i.z-s.z,f=Math.sqrt(Math.pow(o,2)+Math.pow(u,2)+Math.pow(a,2)),l=Math.sqrt(Math.pow(o,2)+Math.pow(u,2));return l===0&&(l=cc.FLT_EPSILON),f===0&&(f=cc.FLT_EPSILON),t=Math.acos(a/f),o<0?n=Math.PI-Math.asin(u/l):n=Math.asin(u/l),e=f/cc.Camera.getZEye(),{newRadius:e,zenith:t,azimuth:n}},startWithTarget:function(e){cc.ActionInterval.prototype.startWithTarget.call(this,e);var t=this.sphericalRadius();isNaN(this._radius)&&(this._radius=t.newRadius),isNaN(this._angleZ)&&(this._angleZ=cc.RADIANS_TO_DEGREES(t.zenith)),isNaN(this._angleX)&&(this._angleX=cc.RADIANS_TO_DEGREES(t.azimuth)),this._radZ=cc.DEGREES_TO_RADIANS(this._angleZ),this._radX=cc.DEGREES_TO_RADIANS(this._angleX)},clone:function(){var e=new cc.OrbitCamera;return e.initWithDuration(this._duration,this._radius,this._deltaRadius,this._angleZ,this._deltaAngleZ,this._angleX,this._deltaAngleX),e},update:function(e){var t=(this._radius+this._deltaRadius*e)*cc.Camera.getZEye(),n=this._radZ+this._radDeltaZ*e,r=this._radX+this._radDeltaX*e,i=Math.sin(n)*Math.cos(r)*t+this._centerXOrig,s=Math.sin(n)*Math.sin(r)*t+this._centerYOrig,o=Math.cos(n)*t+this._centerZOrig;this._target.getCamera().setEye(i,s,o)}}),cc.OrbitCamera.create=function(e,t,n,r,i,s,o){var u=new cc.OrbitCamera;return u.initWithDuration(e,t,n,r,i,s,o)?u:null},cc.ActionEase=cc.ActionInterval.extend({_inner:null,ctor:function(){cc.ActionInterval.prototype.ctor.call(this),this._inner=null},initWithAction:function(e){if(!e)throw"cc.ActionEase.initWithAction(): action must be non nil";return this.initWithDuration(e.getDuration())?(this._inner=e,!0):!1},clone:function(){var e=new cc.ActionEase;return e.initWithAction(this._inner.clone()),e},startWithTarget:function(e){cc.ActionInterval.prototype.startWithTarget.call(this,e),this._inner.startWithTarget(this._target)},stop:function(){this._inner.stop(),cc.ActionInterval.prototype.stop.call(this)},update:function(e){this._inner.update(e)},reverse:function(){return cc.ActionEase.create(this._inner.reverse())},getInnerAction:function(){return this._inner}}),cc.ActionEase.create=function(e){var t=new cc.ActionEase;return t&&t.initWithAction(e),t},cc.EaseRateAction=cc.ActionEase.extend({_rate:0,ctor:function(){cc.ActionEase.prototype.ctor.call(this),this._rate=0},setRate:function(e){this._rate=e},getRate:function(){return this._rate},initWithAction:function(e,t){return cc.ActionEase.prototype.initWithAction.call(this,e)?(this._rate=t,!0):!1},clone:function(){var e=new cc.EaseRateAction;return e.initWithAction(this._inner.clone(),this._rate),e},reverse:function(){return cc.EaseRateAction.create(this._inner.reverse(),1/this._rate)}}),cc.EaseRateAction.create=function(e,t){var n=new cc.EaseRateAction;return n&&n.initWithAction(e,t),n},cc.EaseIn=cc.EaseRateAction.extend({update:function(e){this._inner.update(Math.pow(e,this._rate))},reverse:function(){return cc.EaseIn.create(this._inner.reverse(),1/this._rate)},clone:function(){var e=new cc.EaseIn;return e.initWithAction(this._inner.clone(),this._rate),e}}),cc.EaseIn.create=function(e,t){var n=new cc.EaseIn;return n&&n.initWithAction(e,t),n},cc.EaseOut=cc.EaseRateAction.extend({update:function(e){this._inner.update(Math.pow(e,1/this._rate))},reverse:function(){return cc.EaseOut.create(this._inner.reverse(),1/this._rate)},clone:function(){var e=new cc.EaseOut;return e.initWithAction(this._inner.clone(),this._rate),e}}),cc.EaseOut.create=function(e,t){var n=new cc.EaseOut;return n&&n.initWithAction(e,t),n},cc.EaseInOut=cc.EaseRateAction.extend({update:function(e){e*=2,e<1?this._inner.update(.5*Math.pow(e,this._rate)):this._inner.update(1-.5*Math.pow(2-e,this._rate))},clone:function(){var e=new cc.EaseInOut;return e.initWithAction(this._inner.clone(),this._rate),e},reverse:function(){return cc.EaseInOut.create(this._inner.reverse(),this._rate)}}),cc.EaseInOut.create=function(e,t){var n=new cc.EaseInOut;return n&&n.initWithAction(e,t),n},cc.EaseExponentialIn=cc.ActionEase.extend({update:function(e){this._inner.update(e===0?0:Math.pow(2,10*(e-1)))},reverse:function(){return cc.EaseExponentialOut.create(this._inner.reverse())},clone:function(){var e=new cc.EaseExponentialIn;return e.initWithAction(this._inner.clone()),e}}),cc.EaseExponentialIn.create=function(e){var t=new cc.EaseExponentialIn;return t&&t.initWithAction(e),t},cc.EaseExponentialOut=cc.ActionEase.extend({update:function(e){this._inner.update(e==1?1:-Math.pow(2,-10*e)+1)},reverse:function(){return cc.EaseExponentialIn.create(this._inner.reverse())},clone:function(){var e=new cc.EaseExponentialOut;return e.initWithAction(this._inner.clone()),e}}),cc.EaseExponentialOut.create=function(e){var t=new cc.EaseExponentialOut;return t&&t.initWithAction(e),t},cc.EaseExponentialInOut=cc.ActionEase.extend({update:function(e){e!=1&&e!==0&&(e*=2,e<1?e=.5*Math.pow(2,10*(e-1)):e=.5*(-Math.pow(2,-10*(e-1))+2)),this._inner.update(e)},reverse:function(){return cc.EaseExponentialInOut.create(this._inner.reverse())},clone:function(){var e=new cc.EaseExponentialInOut;return e.initWithAction(this._inner.clone()),e}}),cc.EaseExponentialInOut.create=function(e){var t=new cc.EaseExponentialInOut;return t&&t.initWithAction(e),t},cc.EaseSineIn=cc.ActionEase.extend({update:function(e){e=e===0||e==1?e:-1*Math.cos(e*Math.PI/2)+1,this._inner.update(e)},reverse:function(){return cc.EaseSineOut.create(this._inner.reverse())},clone:function(){var e=new cc.EaseSineIn;return e.initWithAction(this._inner.clone()),e}}),cc.EaseSineIn.create=function(e){var t=new cc.EaseSineIn;return t&&t.initWithAction(e),t},cc.EaseSineOut=cc.ActionEase.extend({update:function(e){e=e===0||e==1?e:Math.sin(e*Math.PI/2),this._inner.update(e)},reverse:function(){return cc.EaseSineIn.create(this._inner.reverse())},clone:function(){var e=new cc.EaseSineOut;return e.initWithAction(this._inner.clone()),e}}),cc.EaseSineOut.create=function(e){var t=new cc.EaseSineOut;return t&&t.initWithAction(e),t},cc.EaseSineInOut=cc.ActionEase.extend({update:function(e){e=e===0||e==1?e:-0.5*(Math.cos(Math.PI*e)-1),this._inner.update(e)},clone:function(){var e=new cc.EaseSineInOut;return e.initWithAction(this._inner.clone()),e},reverse:function(){return cc.EaseSineInOut.create(this._inner.reverse())}}),cc.EaseSineInOut.create=function(e){var t=new cc.EaseSineInOut;return t&&t.initWithAction(e),t},cc.EaseElastic=cc.ActionEase.extend({_period:null,ctor:function(){cc.ActionEase.prototype.ctor.call(this),this._period=.3},getPeriod:function(){return this._period},setPeriod:function(e){this._period=e},initWithAction:function(e,t){return cc.ActionEase.prototype.initWithAction.call(this,e),this._period=t==null?.3:t,!0},reverse:function(){cc.log("cc.EaseElastic.reverse(): it should be overridden in subclass.")},clone:function(){var e=new cc.EaseElastic;return e.initWithAction(this._inner.clone(),this._period),e}}),cc.EaseElastic.create=function(e,t){var n=new cc.EaseElastic;return n&&n.initWithAction(e,t)?n:null},cc.EaseElasticIn=cc.EaseElastic.extend({update:function(e){var t=0;if(e===0||e===1)t=e;else{var n=this._period/4;e-=1,t=-Math.pow(2,10*e)*Math.sin((e-n)*Math.PI*2/this._period)}this._inner.update(t)},reverse:function(){return cc.EaseElasticOut.create(this._inner.reverse(),this._period)},clone:function(){var e=new cc.EaseElasticIn;return e.initWithAction(this._inner.clone(),this._period),e}}),cc.EaseElasticIn.create=function(e,t){var n=new cc.EaseElasticIn;return n&&n.initWithAction(e,t)?n:null},cc.EaseElasticOut=cc.EaseElastic.extend({update:function(e){var t=0;if(e===0||e==1)t=e;else{var n=this._period/4;t=Math.pow(2,-10*e)*Math.sin((e-n)*Math.PI*2/this._period)+1}this._inner.update(t)},reverse:function(){return cc.EaseElasticIn.create(this._inner.reverse(),this._period)},clone:function(){var e=new cc.EaseElasticOut;return e.initWithAction(this._inner.clone(),this._period),e}}),cc.EaseElasticOut.create=function(e,t){var n=new cc.EaseElasticOut;return n&&n.initWithAction(e,t),n},cc.EaseElasticInOut=cc.EaseElastic.extend({update:function(e){var t=0,n=this._period;if(e===0||e==1)t=e;else{e*=2,n||(n=this._period=.3*1.5);var r=n/4;e-=1,e<0?t=-0.5*Math.pow(2,10*e)*Math.sin((e-r)*Math.PI*2/n):t=Math.pow(2,-10*e)*Math.sin((e-r)*Math.PI*2/n)*.5+1}this._inner.update(t)},reverse:function(){return cc.EaseElasticInOut.create(this._inner.reverse(),this._period)},clone:function(){var e=new cc.EaseElasticInOut;return e.initWithAction(this._inner.clone(),this._period),e}}),cc.EaseElasticInOut.create=function(e,t){var n=new cc.EaseElasticInOut;return n&&n.initWithAction(e,t),n},cc.EaseBounce=cc.ActionEase.extend({bounceTime:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?(e-=1.5/2.75,7.5625*e*e+.75):e<2.5/2.75?(e-=2.25/2.75,7.5625*e*e+.9375):(e-=2.625/2.75,7.5625*e*e+.984375)},clone:function(){var e=new cc.EaseBounce;return e.initWithAction(this._inner.clone()),e},reverse:function(){return cc.EaseBounce.create(this._inner.reverse())}}),cc.EaseBounce.create=function(e){var t=new cc.EaseBounce;return t&&t.initWithAction(e),t},cc.EaseBounceIn=cc.EaseBounce.extend({update:function(e){var t=1-this.bounceTime(1-e);this._inner.update(t)},reverse:function(){return cc.EaseBounceOut.create(this._inner.reverse())},clone:function(){var e=new cc.EaseBounceIn;return e.initWithAction(this._inner.clone()),e}}),cc.EaseBounceIn.create=function(e){var t=new cc.EaseBounceIn;return t&&t.initWithAction(e),t},cc.EaseBounceOut=cc.EaseBounce.extend({update:function(e){var t=this.bounceTime(e);this._inner.update(t)},reverse:function(){return cc.EaseBounceIn.create(this._inner.reverse())},clone:function(){var e=new cc.EaseBounceOut;return e.initWithAction(this._inner.clone()),e}}),cc.EaseBounceOut.create=function(e){var t=new cc.EaseBounceOut;return t&&t.initWithAction(e),t},cc.EaseBounceInOut=cc.EaseBounce.extend({update:function(e){var t=0;e<.5?(e*=2,t=(1-this.bounceTime(1-e))*.5):t=this.bounceTime(e*2-1)*.5+.5,this._inner.update(t)},clone:function(){var e=new cc.EaseBounceInOut;return e.initWithAction(this._inner.clone()),e},reverse:function(){return cc.EaseBounceInOut.create(this._inner.reverse())}}),cc.EaseBounceInOut.create=function(e){var t=new cc.EaseBounceInOut;return t&&t.initWithAction(e),t},cc.EaseBackIn=cc.ActionEase.extend({update:function(e){var t=1.70158;e=e===0||e==1?e:e*e*((t+1)*e-t),this._inner.update(e)},reverse:function(){return cc.EaseBackOut.create(this._inner.reverse())},clone:function(){var e=new cc.EaseBackIn;return e.initWithAction(this._inner.clone()),e}}),cc.EaseBackIn.create=function(e){var t=new cc.EaseBackIn;return t&&t.initWithAction(e),t},cc.EaseBackOut=cc.ActionEase.extend({update:function(e){var t=1.70158;e-=1,this._inner.update(e*e*((t+1)*e+t)+1)},reverse:function(){return cc.EaseBackIn.create(this._inner.reverse())},clone:function(){var e=new cc.EaseBackOut;return e.initWithAction(this._inner.clone()),e}}),cc.EaseBackOut.create=function(e){var t=new cc.EaseBackOut;return t&&t.initWithAction(e),t},cc.EaseBackInOut=cc.ActionEase.extend({update:function(e){var t=2.5949095;e*=2,e<1?this._inner.update(e*e*((t+1)*e-t)/2):(e-=2,this._inner.update(e*e*((t+1)*e+t)/2+1))},clone:function(){var e=new cc.EaseBackInOut;return e.initWithAction(this._inner.clone()),e},reverse:function(){return cc.EaseBackInOut.create(this._inner.reverse())}}),cc.EaseBackInOut.create=function(e){var t=new cc.EaseBackInOut;return t&&t.initWithAction(e),t},cc.CardinalSplineAt=function(e,t,n,r,i,s){var o=s*s,u=o*s,a=(1-i)/2,f=a*(-u+2*o-s),l=a*(-u+o)+(2*u-3*o+1),c=a*(u-2*o+s)+(-2*u+3*o),h=a*(u-o),p=e.x*f+t.x*l+n.x*c+r.x*h,d=e.y*f+t.y*l+n.y*c+r.y*h;return cc.p(p,d)},cc.reverseControlPoints=function(e){var t=[];for(var n=e.length-1;n>=0;n--)t.push(cc.p(e[n].x,e[n].y));return t},cc.copyControlPoints=function(e){var t=[];for(var n=0;n<e.length;n++)t.push(cc.p(e[n].x,e[n].y));return t},cc.getControlPointAt=function(e,t){var n=Math.min(e.length-1,Math.max(t,0));return e[n]},cc.reverseControlPointsInline=function(e){var t=e.length,n=0|t/2;for(var r=0;r<n;++r){var i=e[r];e[r]=e[t-r-1],e[t-r-1]=i}},cc.CardinalSplineTo=cc.ActionInterval.extend({_points:null,_deltaT:0,_tension:0,_previousPosition:null,_accumulatedDiff:null,ctor:function(){cc.ActionInterval.prototype.ctor.call(this),this._points=[],this._deltaT=0,this._tension=0,this._previousPosition=null,this._accumulatedDiff=null},initWithDuration:function(e,t,n){if(!t||t.length==0)throw"Invalid configuration. It must at least have one control point";return cc.ActionInterval.prototype.initWithDuration.call(this,e)?(this.setPoints(t),this._tension=n,!0):!1},clone:function(){var e=new cc.CardinalSplineTo;return e.initWithDuration(this._duration,cc.copyControlPoints(this._points),this._tension),e},startWithTarget:function(e){cc.ActionInterval.prototype.startWithTarget.call(this,e),this._deltaT=1/(this._points.length-1);var t=this._target.getPosition();this._previousPosition=cc.p(t.x,t.y),this._accumulatedDiff=cc.p(0,0)},update:function(e){var t,n,r=this._points;if(e==1)t=r.length-1,n=1;else{var i=this._deltaT;t=0|e/i,n=(e-i*t)/i}var s=cc.CardinalSplineAt(cc.getControlPointAt(r,t-1),cc.getControlPointAt(r,t-0),cc.getControlPointAt(r,t+1),cc.getControlPointAt(r,t+2),this._tension,n);if(cc.ENABLE_STACKABLE_ACTIONS){var o,u;o=this._target.getPositionX()-this._previousPosition.x,u=this._target.getPositionY()-this._previousPosition.y;if(o!=0||u!=0){var a=this._accumulatedDiff;o=a.x+o,u=a.y+u,a.x=o,a.y=u,s.x+=o,s.y+=u}}this.updatePosition(s)},reverse:function(){var e=cc.reverseControlPoints(this._points);return cc.CardinalSplineTo.create(this._duration,e,this._tension)},updatePosition:function(e){this._target.setPosition(e),this._previousPosition=e},getPoints:function(){return this._points},setPoints:function(e){this._points=e}}),cc.CardinalSplineTo.create=function(e,t,n){var r=new cc.CardinalSplineTo;return r.initWithDuration(e,t,n)?r:null},cc.CardinalSplineBy=cc.CardinalSplineTo.extend({_startPosition:null,ctor:function(){cc.CardinalSplineTo.prototype.ctor.call(this),this._startPosition=cc.p(0,0)},startWithTarget:function(e){cc.CardinalSplineTo.prototype.startWithTarget.call(this,e);var t=e.getPosition();this._startPosition.x=t.x,this._startPosition.y=t.y},reverse:function(){var e=this._points.slice(),t,n=e[0];for(var r=1;r<e.length;++r)t=e[r],e[r]=cc.pSub(t,n),n=t;var i=cc.reverseControlPoints(e);n=i[i.length-1],i.pop(),n.x=-n.x,n.y=-n.y,i.unshift(n);for(var r=1;r<i.length;++r)t=i[r],t.x=-t.x,t.y=-t.y,t.x+=n.x,t.y+=n.y,i[r]=t,n=t;return cc.CardinalSplineBy.create(this._duration,i,this._tension)},updatePosition:function(e){var t=this._startPosition,n=e.x+t.x,r=e.y+t.y;this._target.setPosition(n,r),this._previousPosition.x=n,this._previousPosition.y=r},clone:function(){var e=new cc.CardinalSplineBy;return e.initWithDuration(this._duration,cc.copyControlPoints(this._points),this._tension),e}}),cc.CardinalSplineBy.create=function(e,t,n){var r=new cc.CardinalSplineBy;return r.initWithDuration(e,t,n)?r:null},cc.CatmullRomTo=cc.CardinalSplineTo.extend({initWithDuration:function(e,t){return cc.CardinalSplineTo.prototype.initWithDuration.call(this,e,t,.5)},clone:function(){var e=new cc.CatmullRomTo;return e.initWithDuration(this._duration,cc.copyControlPoints(this._points)),e}}),cc.CatmullRomTo.create=function(e,t){var n=new cc.CatmullRomTo;return n.initWithDuration(e,t)?n:null},cc.CatmullRomBy=cc.CardinalSplineBy.extend({initWithDuration:function(e,t){return cc.CardinalSplineTo.prototype.initWithDuration.call(this,e,t,.5)},clone:function(){var e=new cc.CatmullRomBy;return e.initWithDuration(this._duration,cc.copyControlPoints(this._points)),e}}),cc.CatmullRomBy.create=function(e,t){var n=new cc.CatmullRomBy;return n.initWithDuration(e,t)?n:null},cc.ActionTweenDelegate=cc.Class.extend({updateTweenAction:function(e,t){}}),cc.ActionTween=cc.ActionInterval.extend({key:"",from:0,to:0,delta:0,ctor:function(){cc.ActionInterval.prototype.ctor.call(this),this.key="",this.from=0,this.to=0,this.delta=0},initWithDuration:function(e,t,n,r){return cc.ActionInterval.prototype.initWithDuration.call(this,e)?(this.key=t,this.to=r,this.from=n,!0):!1},startWithTarget:function(e){if(!e||!e.updateTweenAction)throw"cc.ActionTween.startWithTarget(): target must be non-null, and target must implement updateTweenAction function";cc.ActionInterval.prototype.startWithTarget.call(this,e),this.delta=this.to-this.from},update:function(e){this._target.updateTweenAction(this.to-this.delta*(1-e),this.key)},reverse:function(){return cc.ActionTween.create(this.duration,this.key,this.to,this.from)},clone:function(){var e=new cc.ActionTween;return e.initWithDuration(this._duration,this.key,this.from,this.to),e}}),cc.ActionTween.create=function(e,t,n,r){var i=new cc.ActionTween;return i.initWithDuration(e,t,n,r)?i:null},cc.GridAction=cc.ActionInterval.extend({_gridSize:null,ctor:function(){cc.ActionInterval.prototype.ctor.call(this),this._gridSize=cc.size(0,0)},clone:function(){var e=new cc.GridAction,t=this._gridSize;return e.initWithDuration(this._duration,cc.size(t.width,t.height)),e},startWithTarget:function(e){cc.ActionInterval.prototype.startWithTarget.call(this,e);var t=this.getGrid(),n=this._target,r=n.getGrid();if(r&&r.getReuseGrid()>0){var i=r.getGridSize();r.isActive()&&i.width==this._gridSize.width&&i.height==this._gridSize.height&&r.reuse()}else r&&r.isActive()&&r.setActive(!1),n.setGrid(t),n.getGrid().setActive(!0)},reverse:function(){return cc.ReverseTime.create(this)},initWithDuration:function(e,t){return cc.ActionInterval.prototype.initWithDuration.call(this,e)?(this._gridSize.width=t.width,this._gridSize.height=t.height,!0):!1},getGrid:function(){cc.log("cc.GridAction.getGrid(): it should be overridden in subclass.")}}),cc.GridAction
.create=function(e,t){var n=new cc.GridAction;return n.initWithDuration(e,t),n},cc.Grid3DAction=cc.GridAction.extend({getGrid:function(){return cc.Grid3D.create(this._gridSize)},vertex:function(e){return this._target.getGrid().vertex(e)},originalVertex:function(e){return this._target.getGrid().originalVertex(e)},setVertex:function(e,t){this._target.getGrid().setVertex(e,t)}}),cc.Grid3DAction.create=function(e,t){var n=new cc.Grid3DAction;return n.initWithDuration(e,t),n},cc.TiledGrid3DAction=cc.GridAction.extend({tile:function(e){return this._target.getGrid().tile(e)},originalTile:function(e){return this._target.getGrid().originalTile(e)},setTile:function(e,t){this._target.getGrid().setTile(e,t)},getGrid:function(){return cc.TiledGrid3D.create(this._gridSize)}}),cc.TiledGrid3DAction.create=function(e,t){var n=new cc.TiledGrid3DAction;return n.initWithDuration(e,t),n},cc.StopGrid=cc.ActionInstant.extend({startWithTarget:function(e){cc.ActionInstant.prototype.startWithTarget.call(this,e);var t=this._target.getGrid();t&&t.isActive()&&t.setActive(!1)}}),cc.StopGrid.create=function(){return new cc.StopGrid},cc.ReuseGrid=cc.ActionInstant.extend({_times:null,initWithTimes:function(e){return this._times=e,!0},startWithTarget:function(e){cc.ActionInstant.prototype.startWithTarget.call(this,e),this._target.getGrid()&&this._target.getGrid().isActive()&&this._target.getGrid().setReuseGrid(this._target.getGrid().getReuseGrid()+this._times)}}),cc.ReuseGrid.create=function(e){return new cc.ReuseGrid},cc.RAND_MAX=16777215,cc.rand=function(){return Math.random()*cc.RAND_MAX},cc.Waves3D=cc.Grid3DAction.extend({_waves:null,_amplitude:null,_amplitudeRate:null,ctor:function(){cc.GridAction.prototype.ctor.call(this),this._waves=0,this._amplitude=0,this._amplitudeRate=0},getAmplitude:function(){return this._amplitude},setAmplitude:function(e){this._amplitude=e},getAmplitudeRate:function(){return this._amplitudeRate},setAmplitudeRate:function(e){this._amplitudeRate=e},initWithDuration:function(e,t,n,r){return cc.Grid3DAction.prototype.initWithDuration.call(this,e,t)?(this._waves=n,this._amplitude=r,this._amplitudeRate=1,!0):!1},update:function(e){var t=this._gridSize,n=this._amplitude,r=cc.p(0,0),i=this._amplitudeRate,s=this._waves;for(var o=0;o<t.width+1;++o)for(var u=0;u<t.height+1;++u){r.x=o,r.y=u;var a=this.originalVertex(r);a.z+=Math.sin(Math.PI*e*s*2+(a.y+a.x)*.01)*n*i,this.setVertex(r,a)}}}),cc.Waves3D.create=function(e,t,n,r){var i=new cc.Waves3D;return i.initWithDuration(e,t,n,r),i},cc.FlipX3D=cc.Grid3DAction.extend({initWithDuration:function(e){return cc.Grid3DAction.prototype.initWithDuration.call(this,e,cc.size(1,1))},initWithSize:function(e,t){return e.width!=1||e.height!=1?(cc.log("Grid size must be (1,1)"),!1):cc.Grid3DAction.prototype.initWithDuration.call(this,t,e)},update:function(e){var t=Math.PI*e,n=Math.sin(t);t/=2;var r=Math.cos(t),i=new cc.Vertex3F,s=cc.p(0,0);s.x=s.y=1;var o=this.originalVertex(s);s.x=s.y=0;var u=this.originalVertex(s),a=o.x,f=u.x,l,c,h,p,d;a>f?(c=cc.p(0,0),h=cc.p(0,1),p=cc.p(1,0),d=cc.p(1,1),l=a):(p=cc.p(0,0),d=cc.p(0,1),c=cc.p(1,0),h=cc.p(1,1),l=f),i.x=l-l*r,i.z=Math.abs(parseFloat(l*n/4));var v=this.originalVertex(c);v.x=i.x,v.z+=i.z,this.setVertex(c,v),v=this.originalVertex(h),v.x=i.x,v.z+=i.z,this.setVertex(h,v),v=this.originalVertex(p),v.x-=i.x,v.z-=i.z,this.setVertex(p,v),v=this.originalVertex(d),v.x-=i.x,v.z-=i.z,this.setVertex(d,v)}}),cc.FlipX3D.create=function(e){var t=new cc.FlipX3D;return t.initWithDuration(e),t},cc.FlipY3D=cc.FlipX3D.extend({update:function(e){var t=Math.PI*e,n=Math.sin(t);t/=2;var r=Math.cos(t),i=new cc.Vertex3F,s=cc.p(0,0);s.x=s.y=1;var o=this.originalVertex(s);s.x=s.y=0;var u=this.originalVertex(s),a=o.y,f=u.y,l,c,h,p,d;a>f?(c=cc.p(0,0),h=cc.p(0,1),p=cc.p(1,0),d=cc.p(1,1),l=a):(h=cc.p(0,0),c=cc.p(0,1),d=cc.p(1,0),p=cc.p(1,1),l=f),i.y=l-l*r,i.z=Math.abs(parseFloat(l*n)/4);var v=this.originalVertex(c);v.y=i.y,v.z+=i.z,this.setVertex(c,v),v=this.originalVertex(h),v.y-=i.y,v.z-=i.z,this.setVertex(h,v),v=this.originalVertex(p),v.y=i.y,v.z+=i.z,this.setVertex(p,v),v=this.originalVertex(d),v.y-=i.y,v.z-=i.z,this.setVertex(d,v)}}),cc.FlipY3D.create=function(e){var t=new cc.FlipY3D;return t.initWithDuration(e),t},cc.Lens3D=cc.Grid3DAction.extend({_position:null,_radius:0,_lensEffect:0,_concave:!1,_dirty:!1,ctor:function(){cc.GridAction.prototype.ctor.call(this),this._position=cc._pConst(0,0),this._radius=0,this._lensEffect=0,this._concave=!1,this._dirty=!1},getLensEffect:function(){return this._lensEffect},setLensEffect:function(e){this._lensEffect=e},setConcave:function(e){this._concave=e},getPosition:function(){return this._position},setPosition:function(e){cc.pointEqualToPoint(e,this._position)||(this._position._x=e.x,this._position._y=e.y,this._dirty=!0)},initWithDuration:function(e,t,n,r){return cc.Grid3DAction.prototype.initWithDuration.call(this,e,t)?(this.setPosition(n),this._radius=r,this._lensEffect=.7,this._dirty=!0,!0):!1},update:function(e){if(this._dirty){var t=this._gridSize.width,n=this._gridSize.height,r=this._radius,i=this._lensEffect,s=cc.p(0,0),o=cc.p(0,0),u,a,f,l,c;for(var h=0;h<t+1;++h)for(var p=0;p<n+1;++p)s.x=h,s.y=p,u=this.originalVertex(s),o.x=this._position.x-u.x,o.y=this._position.y-u.y,a=cc.pLength(o),a<r&&(a=r-a,c=a/r,c==0&&(c=.001),f=Math.log(c)*i,l=Math.exp(f)*r,a=cc.pLength(o),a>0&&(o.x=o.x/a,o.y=o.y/a,o.x=o.x*l,o.y=o.y*l,u.z+=cc.pLength(o)*i)),this.setVertex(s,u);this._dirty=!1}}}),cc.Lens3D.create=function(e,t,n,r){var i=new cc.Lens3D;return i.initWithDuration(e,t,n,r),i},cc.Ripple3D=cc.Grid3DAction.extend({_position:null,_radius:null,_waves:null,_amplitude:null,_amplitudeRate:null,ctor:function(){cc.GridAction.prototype.ctor.call(this),this._position=cc._pConst(0,0),this._radius=0,this._waves=0,this._amplitude=0,this._amplitudeRate=0},getPosition:function(){return this._position},setPosition:function(e){this._position._x=e.x,this._position._y=e.y},getAmplitude:function(){return this._amplitude},setAmplitude:function(e){this._amplitude=e},getAmplitudeRate:function(){return this._amplitudeRate},setAmplitudeRate:function(e){this._amplitudeRate=e},initWithDuration:function(e,t,n,r,i,s){return cc.Grid3DAction.prototype.initWithDuration.call(this,e,t)?(this.setPosition(n),this._radius=r,this._waves=i,this._amplitude=s,this._amplitudeRate=1,!0):!1},update:function(e){var t=this._gridSize.width,n=this._gridSize.height,r=cc.p(0,0),i=this._radius,s=this._waves,o=this._amplitude,u=this._amplitudeRate,a,f,l=cc.p(0,0);for(var c=0;c<t+1;++c)for(var h=0;h<n+1;++h){r.x=c,r.y=h,a=this.originalVertex(r),l.x=this._position.x-a.x,l.y=this._position.y-a.y,f=cc.pLength(l);if(f<i){f=i-f;var p=Math.pow(f/i,2);a.z+=Math.sin(e*Math.PI*s*2+f*.1)*o*u*p}this.setVertex(r,a)}}}),cc.Ripple3D.create=function(e,t,n,r,i,s){var o=new cc.Ripple3D;return o.initWithDuration(e,t,n,r,i,s),o},cc.Shaky3D=cc.Grid3DAction.extend({_randRange:null,_shakeZ:null,ctor:function(){cc.GridAction.prototype.ctor.call(this),this._randRange=0,this._shakeZ=!1},initWithDuration:function(e,t,n,r){return cc.Grid3DAction.prototype.initWithDuration.call(this,e,t)?(this._randRange=n,this._shakeZ=r,!0):!1},update:function(e){var t=this._gridSize.width,n=this._gridSize.height,r=this._randRange,i=this._shakeZ,s=cc.p(0,0),o;for(var u=0;u<t+1;++u)for(var a=0;a<n+1;++a)s.x=u,s.y=a,o=this.originalVertex(s),o.x+=cc.rand()%(r*2)-r,o.y+=cc.rand()%(r*2)-r,i&&(o.z+=cc.rand()%(r*2)-r),this.setVertex(s,o)}}),cc.Shaky3D.create=function(e,t,n,r){var i=new cc.Shaky3D;return i.initWithDuration(e,t,n,r),i},cc.Liquid=cc.Grid3DAction.extend({_waves:null,_amplitude:null,_amplitudeRate:null,ctor:function(){cc.GridAction.prototype.ctor.call(this),this._waves=0,this._amplitude=0,this._amplitudeRate=0},getAmplitude:function(){return this._amplitude},setAmplitude:function(e){this._amplitude=e},getAmplitudeRate:function(){return this._amplitudeRate},setAmplitudeRate:function(e){this._amplitudeRate=e},initWithDuration:function(e,t,n,r){return cc.Grid3DAction.prototype.initWithDuration.call(this,e,t)?(this._waves=n,this._amplitude=r,this._amplitudeRate=1,!0):!1},update:function(e){var t=this._gridSize.width,n=this._gridSize.height,r=cc.p(0,0),i=this._waves,s=this._amplitude,o=this._amplitudeRate,u;for(var a=1;a<t;++a)for(var f=1;f<n;++f)r.x=a,r.y=f,u=this.originalVertex(r),u.x=u.x+Math.sin(e*Math.PI*i*2+u.x*.01)*s*o,u.y=u.y+Math.sin(e*Math.PI*i*2+u.y*.01)*s*o,this.setVertex(r,u)}}),cc.Liquid.create=function(e,t,n,r){var i=new cc.Liquid;return i.initWithDuration(e,t,n,r),i},cc.Waves=cc.Grid3DAction.extend({_waves:null,_amplitude:null,_amplitudeRate:null,_vertical:null,_horizontal:null,ctor:function(){cc.GridAction.prototype.ctor.call(this),this._waves=0,this._amplitude=0,this._amplitudeRate=0,this._vertical=!1,this._horizontal=!1},getAmplitude:function(){return this._amplitude},setAmplitude:function(e){this._amplitude=e},getAmplitudeRate:function(){return this._amplitudeRate},setAmplitudeRate:function(e){this._amplitudeRate=e},initWithDuration:function(e,t,n,r,i,s){return cc.Grid3DAction.prototype.initWithDuration.call(this,e,t)?(this._waves=n,this._amplitude=r,this._amplitudeRate=1,this._horizontal=i,this._vertical=s,!0):!1},update:function(e){var t=this._gridSize.width,n=this._gridSize.height,r=cc.p(0,0),i=this._vertical,s=this._horizontal,o=this._waves,u=this._amplitude,a=this._amplitudeRate,f;for(var l=0;l<t+1;++l)for(var c=0;c<n+1;++c)r.x=l,r.y=c,f=this.originalVertex(r),i&&(f.x=f.x+Math.sin(e*Math.PI*o*2+f.y*.01)*u*a),s&&(f.y=f.y+Math.sin(e*Math.PI*o*2+f.x*.01)*u*a),this.setVertex(r,f)}}),cc.Waves.create=function(e,t,n,r,i,s){var o=new cc.Waves;return o.initWithDuration(e,t,n,r,i,s),o},cc.Twirl=cc.Grid3DAction.extend({_position:null,_twirls:null,_amplitude:null,_amplitudeRate:null,ctor:function(){cc.GridAction.prototype.ctor.call(this),this._position=cc._pConst(0,0),this._twirls=0,this._amplitude=0,this._amplitudeRate=0},getPosition:function(){return this._position},setPosition:function(e){this._position._x=e.x,this._position._y=e.y},getAmplitude:function(){return this._amplitude},setAmplitude:function(e){this._amplitude=e},getAmplitudeRate:function(){return this._amplitudeRate},setAmplitudeRate:function(e){this._amplitudeRate=e},initWithDuration:function(e,t,n,r,i){return cc.Grid3DAction.prototype.initWithDuration.call(this,e,t)?(this.setPosition(n),this._twirls=r,this._amplitude=i,this._amplitudeRate=1,!0):!1},update:function(e){var t=this._position,n=this._gridSize.width,r=this._gridSize.height,i=cc.p(0,0),s=.1*this._amplitude*this._amplitudeRate,o=this._twirls,u,a,f,l,c=cc.p(0,0);for(var h=0;h<n+1;++h)for(var p=0;p<r+1;++p)i.x=h,i.y=p,u=this.originalVertex(i),c.x=h-n/2,c.y=p-r/2,a=cc.pLength(c)*Math.cos(Math.PI/2+e*Math.PI*o*2)*s,f=Math.sin(a)*(u.y-t.y)+Math.cos(a)*(u.x-t.x),l=Math.cos(a)*(u.y-t.y)-Math.sin(a)*(u.x-t.x),u.x=t.x+f,u.y=t.y+l,this.setVertex(i,u)}}),cc.Twirl.create=function(e,t,n,r,i){var s=new cc.Twirl;return s.initWithDuration(e,t,n,r,i),s},cc.ShakyTiles3D=cc.TiledGrid3DAction.extend({_randRange:0,_shakeZ:!1,ctor:function(){cc.GridAction.prototype.ctor.call(this),this._randRange=0,this._shakeZ=!1},initWithDuration:function(e,t,n,r){return cc.TiledGrid3DAction.prototype.initWithDuration.call(this,e,t)?(this._randRange=n,this._shakeZ=r,!0):!1},update:function(e){var t=this._gridSize,n=this._randRange,r=cc.p(0,0);for(var i=0;i<t.width;++i)for(var s=0;s<t.height;++s){r.x=i,r.y=s;var o=this.originalTile(r);o.bl.x+=cc.rand()%(n*2)-n,o.br.x+=cc.rand()%(n*2)-n,o.tl.x+=cc.rand()%(n*2)-n,o.tr.x+=cc.rand()%(n*2)-n,o.bl.y+=cc.rand()%(n*2)-n,o.br.y+=cc.rand()%(n*2)-n,o.tl.y+=cc.rand()%(n*2)-n,o.tr.y+=cc.rand()%(n*2)-n,this._shakeZ&&(o.bl.z+=cc.rand()%(n*2)-n,o.br.z+=cc.rand()%(n*2)-n,o.tl.z+=cc.rand()%(n*2)-n,o.tr.z+=cc.rand()%(n*2)-n),this.setTile(r,o)}}}),cc.ShakyTiles3D.create=function(e,t,n,r){var i=new cc.ShakyTiles3D;return i.initWithDuration(e,t,n,r),i},cc.ShatteredTiles3D=cc.TiledGrid3DAction.extend({_randRange:0,_once:!1,_shatterZ:!1,ctor:function(){cc.GridAction.prototype.ctor.call(this),this._randRange=0,this._shakeZ=!1,this._once=!1},initWithDuration:function(e,t,n,r){return cc.TiledGrid3DAction.prototype.initWithDuration.call(this,e,t)?(this._once=!1,this._randRange=n,this._shatterZ=r,!0):!1},update:function(e){if(this._once===!1){var t=this._gridSize,n=this._randRange,r,i=cc.p(0,0);for(var s=0;s<t.width;++s)for(var o=0;o<t.height;++o)i.x=s,i.y=o,r=this.originalTile(i),r.bl.x+=cc.rand()%(n*2)-n,r.br.x+=cc.rand()%(n*2)-n,r.tl.x+=cc.rand()%(n*2)-n,r.tr.x+=cc.rand()%(n*2)-n,r.bl.y+=cc.rand()%(n*2)-n,r.br.y+=cc.rand()%(n*2)-n,r.tl.y+=cc.rand()%(n*2)-n,r.tr.y+=cc.rand()%(n*2)-n,this._shatterZ&&(r.bl.z+=cc.rand()%(n*2)-n,r.br.z+=cc.rand()%(n*2)-n,r.tl.z+=cc.rand()%(n*2)-n,r.tr.z+=cc.rand()%(n*2)-n),this.setTile(i,r);this._once=!0}}}),cc.ShatteredTiles3D.create=function(e,t,n,r){var i=new cc.ShatteredTiles3D;return i.initWithDuration(e,t,n,r),i},cc.Tile=function(e,t,n){this.position=e||cc.POINT_ZERO,this.startPosition=t||cc.POINT_ZERO,this.delta=n||cc.POINT_ZERO},cc.ShuffleTiles=cc.TiledGrid3DAction.extend({_seed:0,_tilesCount:0,_tilesOrder:null,_tiles:null,ctor:function(){cc.GridAction.prototype.ctor.call(this),this._tilesOrder=[],this._tiles=[],this._seed=0,this._tilesCount=0},initWithDuration:function(e,t,n){return cc.TiledGrid3DAction.prototype.initWithDuration.call(this,e,t)?(this._seed=n,this._tilesOrder.length=0,this._tiles.length=0,!0):!1},shuffle:function(e,t){for(var n=t-1;n>=0;n--){var r=0|cc.rand()%(n+1),i=e[n];e[n]=e[r],e[r]=i}},getDelta:function(e){var t=this._gridSize,n=e.width*t.height+e.height;return cc.size(this._tilesOrder[n]/t.height-e.width,this._tilesOrder[n]%t.height-e.height)},placeTile:function(e,t){var n=this.originalTile(e),r=this._target.getGrid().getStep(),i=t.position;n.bl.x+=i.x*r.x,n.bl.y+=i.y*r.y,n.br.x+=i.x*r.x,n.br.y+=i.y*r.y,n.tl.x+=i.x*r.x,n.tl.y+=i.y*r.y,n.tr.x+=i.x*r.x,n.tr.y+=i.y*r.y,this.setTile(e,n)},startWithTarget:function(e){cc.TiledGrid3DAction.prototype.startWithTarget.call(this,e);var t=this._gridSize;this._tilesCount=t.width*t.height;var n=this._tilesOrder;n.length=0;for(var r=0;r<this._tilesCount;++r)n[r]=r;this.shuffle(n,this._tilesCount);var i=this._tiles;i.length=0;var s=0,o=cc.size(0,0);for(var u=0;u<t.width;++u)for(var a=0;a<t.height;++a)i[s]=new cc.Tile,i[s].position=cc.p(u,a),i[s].startPosition=cc.p(u,a),o.width=u,o.height=a,i[s].delta=this.getDelta(o),++s},update:function(e){var t=0,n=this._gridSize,r=this._tiles,i,s=cc.p(0,0);for(var o=0;o<n.width;++o)for(var u=0;u<n.height;++u)s.x=o,s.y=u,i=r[t],i.position.x=i.delta.width*e,i.position.y=i.delta.height*e,this.placeTile(s,i),++t}}),cc.ShuffleTiles.create=function(e,t,n){var r=new cc.ShuffleTiles;return r.initWithDuration(e,t,n),r},cc.FadeOutTRTiles=cc.TiledGrid3DAction.extend({testFunc:function(e,t){var n=this._gridSize.width*t,r=this._gridSize.height*t;return n+r==0?1:Math.pow((e.width+e.height)/(n+r),6)},turnOnTile:function(e){this.setTile(e,this.originalTile(e))},turnOffTile:function(e){this.setTile(e,new cc.Quad3)},transformTile:function(e,t){var n=this.originalTile(e),r=this._target.getGrid().getStep();n.bl.x+=r.x/2*(1-t),n.bl.y+=r.y/2*(1-t),n.br.x-=r.x/2*(1-t),n.br.y+=r.y/2*(1-t),n.tl.x+=r.x/2*(1-t),n.tl.y-=r.y/2*(1-t),n.tr.x-=r.x/2*(1-t),n.tr.y-=r.y/2*(1-t),this.setTile(e,n)},update:function(e){var t=this._gridSize,n=cc.p(0,0),r=cc.size(0,0),i;for(var s=0;s<t.width;++s)for(var o=0;o<t.height;++o)n.x=s,n.y=o,r.width=s,r.height=o,i=this.testFunc(r,e),i==0?this.turnOffTile(n):i<1?this.transformTile(n,i):this.turnOnTile(n)}}),cc.FadeOutTRTiles.create=function(e,t){var n=new cc.FadeOutTRTiles;return n.initWithDuration(e,t),n},cc.FadeOutBLTiles=cc.FadeOutTRTiles.extend({testFunc:function(e,t){var n=this._gridSize.width*(1-t),r=this._gridSize.height*(1-t);return e.width+e.height==0?1:Math.pow((n+r)/(e.width+e.height),6)}}),cc.FadeOutBLTiles.create=function(e,t){var n=new cc.FadeOutBLTiles;return n.initWithDuration(e,t),n},cc.FadeOutUpTiles=cc.FadeOutTRTiles.extend({testFunc:function(e,t){var n=this._gridSize.height*t;return n==0?1:Math.pow(e.height/n,6)},transformTile:function(e,t){var n=this.originalTile(e),r=this._target.getGrid().getStep();n.bl.y+=r.y/2*(1-t),n.br.y+=r.y/2*(1-t),n.tl.y-=r.y/2*(1-t),n.tr.y-=r.y/2*(1-t),this.setTile(e,n)}}),cc.FadeOutUpTiles.create=function(e,t){var n=new cc.FadeOutUpTiles;return n.initWithDuration(e,t),n},cc.FadeOutDownTiles=cc.FadeOutUpTiles.extend({testFunc:function(e,t){var n=this._gridSize.height*(1-t);return e.height==0?1:Math.pow(n/e.height,6)}}),cc.FadeOutDownTiles.create=function(e,t){var n=new cc.FadeOutDownTiles;return n.initWithDuration(e,t),n},cc.TurnOffTiles=cc.TiledGrid3DAction.extend({_seed:null,_tilesCount:0,_tilesOrder:null,ctor:function(){cc.GridAction.prototype.ctor.call(this),this._tilesOrder=[],this._seed=null,this._tilesCount=0},initWithDuration:function(e,t,n){return cc.TiledGrid3DAction.prototype.initWithDuration.call(this,e,t)?(this._seed=n,this._tilesOrder.length=0,!0):!1},shuffle:function(e,t){for(var n=t-1;n>=0;n--){var r=0|cc.rand()%(n+1),i=e[n];e[n]=e[r],e[r]=i}},turnOnTile:function(e){this.setTile(e,this.originalTile(e))},turnOffTile:function(e){this.setTile(e,new cc.Quad3)},startWithTarget:function(e){cc.TiledGrid3DAction.prototype.startWithTarget.call(this,e),this._tilesCount=this._gridSize.width*this._gridSize.height;var t=this._tilesOrder;t.length=0;for(var n=0;n<this._tilesCount;++n)t[n]=n;this.shuffle(t,this._tilesCount)},update:function(e){var t=0|e*this._tilesCount,n=this._gridSize,r,i=cc.p(0,0),s=this._tilesOrder;for(var o=0;o<this._tilesCount;o++)r=s[o],i.x=0|r/n.height,i.y=r%(0|n.height),o<t?this.turnOffTile(i):this.turnOnTile(i)}}),cc.TurnOffTiles.create=function(e,t,n){n=n||0;var r=new cc.TurnOffTiles;return r.initWithDuration(e,t,n),r},cc.WavesTiles3D=cc.TiledGrid3DAction.extend({_waves:0,_amplitude:0,_amplitudeRate:0,ctor:function(){cc.GridAction.prototype.ctor.call(this),this._waves=0,this._amplitude=0,this._amplitudeRate=0},getAmplitude:function(){return this._amplitude},setAmplitude:function(e){this._amplitude=e},getAmplitudeRate:function(){return this._amplitudeRate},setAmplitudeRate:function(e){this._amplitudeRate=e},initWithDuration:function(e,t,n,r){return cc.TiledGrid3DAction.prototype.initWithDuration.call(this,e,t)?(this._waves=n,this._amplitude=r,this._amplitudeRate=1,!0):!1},update:function(e){var t=this._gridSize,n=this._waves,r=this._amplitude,i=this._amplitudeRate,s=cc.p(0,0),o;for(var u=0;u<t.width;u++)for(var a=0;a<t.height;a++)s.x=u,s.y=a,o=this.originalTile(s),o.bl.z=Math.sin(e*Math.PI*n*2+(o.bl.y+o.bl.x)*.01)*r*i,o.br.z=o.bl.z,o.tl.z=o.bl.z,o.tr.z=o.bl.z,this.setTile(s,o)}}),cc.WavesTiles3D.create=function(e,t,n,r){var i=new cc.WavesTiles3D;return i.initWithDuration(e,t,n,r),i},cc.JumpTiles3D=cc.TiledGrid3DAction.extend({_jumps:0,_amplitude:0,_amplitudeRate:0,ctor:function(){cc.GridAction.prototype.ctor.call(this),this._jumps=0,this._amplitude=0,this._amplitudeRate=0},getAmplitude:function(){return this._amplitude},setAmplitude:function(e){this._amplitude=e},getAmplitudeRate:function(){return this._amplitudeRate},setAmplitudeRate:function(e){this._amplitudeRate=e},initWithDuration:function(e,t,n,r){return cc.TiledGrid3DAction.prototype.initWithDuration.call(this,e,t)?(this._jumps=n,this._amplitude=r,this._amplitudeRate=1,!0):!1},update:function(e){var t=Math.sin(Math.PI*e*this._jumps*2)*this._amplitude*this._amplitudeRate,n=Math.sin(Math.PI*(e*this._jumps*2+1))*this._amplitude*this._amplitudeRate,r=this._gridSize,i=this._target.getGrid(),s,o=cc.p(0,0);for(var u=0;u<r.width;u++)for(var a=0;a<r.height;a++)o.x=u,o.y=a,s=i.originalTile(o),(u+a)%2==0?(s.bl.z+=t,s.br.z+=t,s.tl.z+=t,s.tr.z+=t):(s.bl.z+=n,s.br.z+=n,s.tl.z+=n,s.tr.z+=n),i.setTile(o,s)}}),cc.JumpTiles3D.create=function(e,t,n,r){var i=new cc.JumpTiles3D;return i.initWithDuration(e,t,n,r),i},cc.SplitRows=cc.TiledGrid3DAction.extend({_rows:0,_winSize:null,ctor:function(){cc.GridAction.prototype.ctor.call(this),this._rows=0,this._winSize=null},initWithDuration:function(e,t){return this._rows=t,cc.TiledGrid3DAction.prototype.initWithDuration.call(this,e,cc.size(1,t))},update:function(e){var t=this._gridSize,n=this._winSize.width,r,i,s=cc.p(0,0);for(var o=0;o<t.height;++o)s.y=o,r=this.originalTile(s),i=1,o%2==0&&(i=-1),r.bl.x+=i*n*e,r.br.x+=i*n*e,r.tl.x+=i*n*e,r.tr.x+=i*n*e,this.setTile(s,r)},startWithTarget:function(e){cc.TiledGrid3DAction.prototype.startWithTarget.call(this,e),this._winSize=cc.Director.getInstance().getWinSizeInPixels()}}),cc.SplitRows.create=function(e,t){var n=new cc.SplitRows;return n.initWithDuration(e,t),n},cc.SplitCols=cc.TiledGrid3DAction.extend({_cols:0,_winSize:null,ctor:function(){cc.GridAction.prototype.ctor.call(this),this._cols=0,this._winSize=null},initWithDuration:function(e,t){return this._cols=t,cc.TiledGrid3DAction.prototype.initWithDuration.call(this,e,cc.size(t,1))},update:function(e){var t=this._gridSize.width,n=this._winSize.height,r,i,s=cc.p(0,0);for(var o=0;o<t;++o)s.x=o,r=this.originalTile(s),i=1,o%2==0&&(i=-1),r.bl.y+=i*n*e,r.br.y+=i*n*e,r.tl.y+=i*n*e,r.tr.y+=i*n*e,this.setTile(s,r)},startWithTarget:function(e){cc.TiledGrid3DAction.prototype.startWithTarget.call(this,e),this._winSize=cc.Director.getInstance().getWinSizeInPixels()}}),cc.SplitCols.create=function(e,t){var n=new cc.SplitCols;return n.initWithDuration(e,t),n},cc.PageTurn3D=cc.Grid3DAction.extend({update:function(e){var t=Math.max(0,e-.25),n=t*t*500,r=-100-n,i=-Math.PI/2*Math.sqrt(e),s=+Math.PI/2+i,o=Math.sin(s),u=Math.cos(s),a=this._gridSize,f=cc.p(0,0);for(var l=0;l<=a.width;++l)for(var c=0;c<=a.height;++c){f.x=l,f.y=c;var h=this.originalVertex(f),p=Math.sqrt(h.x*h.x+(h.y-r)*(h.y-r)),d=p*o,v=Math.asin(h.x/p),m=v/o,g=Math.cos(m);m<=Math.PI?h.x=d*Math.sin(m):h.x=0,h.y=p+r-d*(1-g)*o,h.z=d*(1-g)*u/7,h.z<.5&&(h.z=.5),this.setVertex(f,h)}}}),cc.PageTurn3D.create=function(e,t){var n=new cc.PageTurn3D;return n.initWithDuration(e,t),n},cc.PROGRESS_TIMER_TYPE_RADIAL=0,cc.PROGRESS_TIMER_TYPE_BAR=1,cc.PROGRESS_TEXTURE_COORDS_COUNT=4,cc.PROGRESS_TEXTURE_COORDS=75,cc.ProgressTimer=cc.NodeRGBA.extend({_type:null,_percentage:0,_sprite:null,_midPoint:null,_barChangeRate:null,_reverseDirection:!1,getMidpoint:function(){return cc.p(this._midPoint.x,this._midPoint)},setMidpoint:function(e){this._midPoint=cc.pClamp(e,cc.p(0,0),cc.p(1,1))},getBarChangeRate:function(){return cc.p(this._barChangeRate.x,this._barChangeRate.y)},setBarChangeRate:function(e){this._barChangeRate=cc.pClamp(e,cc.p(0,0),cc.p(1,1))},getType:function(){return this._type},getPercentage:function(){return this._percentage},getSprite:function(){return this._sprite},setPercentage:function(e){this._percentage!=e&&(this._percentage=cc.clampf(e,0,100),this._updateProgress())},setOpacityModifyRGB:function(e){},isOpacityModifyRGB:function(){return!1},isReverseDirection:function(){return this._reverseDirection},_boundaryTexCoord:function(e){if(e<cc.PROGRESS_TEXTURE_COORDS_COUNT){var t=cc.PROGRESS_TEXTURE_COORDS;return this._reverseDirection?cc.p(t>>7-(e<<1)&1,t>>7-((e<<1)+1)&1):cc.p(t>>(e<<1)+1&1,t>>(e<<1)&1)}return cc.PointZero()},_origin:null,_startAngle:270,_endAngle:270,_radius:0,_counterClockWise:!1,_barRect:null,_vertexDataCount:0,_vertexData:null,_vertexArrayBuffer:null,_vertexWebGLBuffer:null,_vertexDataDirty:!1,ctor:null,_ctorForCanvas:function(){cc.NodeRGBA.prototype.ctor.call(this),this._type=cc.PROGRESS_TIMER_TYPE_RADIAL,this._percentage=0,this._midPoint=cc.p(0,0),this._barChangeRate=cc.p(0,0),this._reverseDirection=!1,this._sprite=null,this._origin=cc.PointZero(),this._startAngle=270,this._endAngle=270,this._radius=0,this._counterClockWise=!1,this._barRect=cc.RectZero()},_ctorForWebGL:function(){cc.NodeRGBA.prototype.ctor.call(this),this._type=cc.PROGRESS_TIMER_TYPE_RADIAL,this._percentage=0,this._midPoint=cc.p(0,0),this._barChangeRate=cc.p(0,0),this._reverseDirection=!1,this._sprite=null,this._vertexWebGLBuffer=cc.renderContext.createBuffer(),this._vertexDataCount=0,this._vertexData=null,this._vertexArrayBuffer=null,this._vertexDataDirty=!1},setColor:function(e){this._sprite.setColor(e),this._updateColor()},setOpacity:function(e){this._sprite.setOpacity(e),this._updateColor()},getColor:function(){return this._sprite.getColor()},getOpacity:function(){return this._sprite.getOpacity()},setReverseProgress:null,_setReverseProgressForCanvas:function(e){this._reverseDirection!==e&&(this._reverseDirection=e)},_setReverseProgressForWebGL:function(e){this._reverseDirection!==e&&(this._reverseDirection=e,this._vertexData=null,this._vertexArrayBuffer=null,this._vertexDataCount=0)},setSprite:null,_setSpriteForCanvas:function(e){this._sprite!=e&&(this._sprite=e,this.setContentSize(this._sprite.getContentSize()))},_setSpriteForWebGL:function(e){e&&this._sprite!=e&&(this._sprite=e,this.setContentSize(e.getContentSize()),this._vertexData&&(this._vertexData=null,this._vertexArrayBuffer=null,this._vertexDataCount=0))},setType:null,_setTypeForCanvas:function(e){e!==this._type&&(this._type=e)},_setTypeForWebGL:function(e){e!==this._type&&(this._vertexData&&(this._vertexData=null,this._vertexArrayBuffer=null,this._vertexDataCount=0),this._type=e)},setReverseDirection:null,_setReverseDirectionForCanvas:function(e){this._reverseDirection!==e&&(this._reverseDirection=e)},_setReverseDirectionForWebGL:function(e){this._reverseDirection!==e&&(this._reverseDirection=e,this._vertexData=null,this._vertexArrayBuffer=null,this._vertexDataCount=0)},_textureCoordFromAlphaPoint:function(e){var t=this._sprite;if(!t)return{u:0,v:0};var n=t.getQuad(),r=cc.p(n.bl.texCoords.u,n.bl.texCoords.v),i=cc.p(n.tr.texCoords.u,n.tr.texCoords.v);if(t.isTextureRectRotated()){var s=e.x;e.x=e.y,e.y=s}return{u:r.x*(1-e.x)+i.x*e.x,v:r.y*(1-e.y)+i.y*e.y}},_vertexFromAlphaPoint:function(e){if(!this._sprite)return{x:0,y:0};var t=this._sprite.getQuad(),n=cc.p(t.bl.vertices.x,t.bl.vertices.y),r=cc.p(t.tr.vertices.x,t.tr.vertices.y);return{x:n.x*(1-e.x)+r.x*e.x,y:n.y*(1-e.y)+r.y*e.y}},initWithSprite:null,_initWithSpriteForCanvas:function(e){return this.setPercentage(0),this.setAnchorPoint(.5,.5),this._type=cc.PROGRESS_TIMER_TYPE_RADIAL,this._reverseDirection=!1,this.setMidpoint(cc.p(.5,.5)),this.setBarChangeRate(cc.p(1,1)),this.setSprite(e),!0},_initWithSpriteForWebGL:function(e){return this.setPercentage(0),this._vertexData=null,this._vertexArrayBuffer=null,this._vertexDataCount=0,this.setAnchorPoint(.5,.5),this._type=cc.PROGRESS_TIMER_TYPE_RADIAL,this._reverseDirection=!1,this.setMidpoint(cc.p(.5,.5)),this.setBarChangeRate(cc.p(1,1)),this.setSprite(e),this.setShaderProgram(cc.ShaderCache.getInstance().programForKey(cc.SHADER_POSITION_TEXTURECOLOR)),!0},draw:null,_drawForCanvas:function(e){var t=e||cc.renderContext,n=this._sprite;n._isLighterMode&&(t.globalCompositeOperation="lighter");var r=cc.EGLView.getInstance().getScaleX(),i=cc.EGLView.getInstance().getScaleY();t.globalAlpha=n._displayedOpacity/255;var s=n._rect,o=n._contentSize,u=n._offsetPosition,a=n._drawSize_Canvas,f=0|u.x,l=-u.y-s.height,c=n._textureRect_Canvas;a.width=s.width*r,a.height=s.height*i,t.save(),n._flippedX&&(f=-u.x-s.width,t.scale(-1,1)),n._flippedY&&(l=u.y,t.scale(1,-1)),f*=r,l*=i;if(this._type==cc.PROGRESS_TIMER_TYPE_BAR){var h=this._barRect;t.beginPath(),t.rect(h.x*r,h.y*i,h.width*r,h.height*i),t.clip(),t.closePath()}else if(this._type==cc.PROGRESS_TIMER_TYPE_RADIAL){var p=this._origin.x*r,d=this._origin.y*i;t.beginPath(),t.arc(p,d,this._radius*i,Math.PI/180*this._startAngle,Math.PI/180*this._endAngle,this._counterClockWise),t.lineTo(p,d),t.clip(),t.closePath()}if(n._texture&&c.validRect){var v=n._texture.getHtmlElementObj();this._colorized?t.drawImage(v,0,0,c.width,c.height,f,l,a.width,a.height):t.drawImage(v,c.x,c.y,c.width,c.height,f,l,a.width,a.height)}else if(o.width!==0){var m=this.getColor();t.fillStyle="rgba("+m.r+","+m.g+","+m.b+",1)",t.fillRect(f,l,o.width*r,o.height*i)}t.restore(),cc.INCREMENT_GL_DRAWS(1)},_drawForWebGL:function(e){var t=e||cc.renderContext;if(!this._vertexData||!this._sprite)return;cc.NODE_DRAW_SETUP(this);var n=this._sprite.getBlendFunc();cc.glBlendFunc(n.src,n.dst),cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POS_COLOR_TEX),this._sprite.getTexture()?cc.glBindTexture2D(this._sprite.getTexture()):cc.glBindTexture2D(null),t.bindBuffer(t.ARRAY_BUFFER,this._vertexWebGLBuffer),this._vertexDataDirty&&(t.bufferData(t.ARRAY_BUFFER,this._vertexArrayBuffer,t.DYNAMIC_DRAW),this._vertexDataDirty=!1);var r=cc.V2F_C4B_T2F.BYTES_PER_ELEMENT;t.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,t.FLOAT,!1,r,0),t.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,t.UNSIGNED_BYTE,!0,r,8),t.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,t.FLOAT,!1,r,12),this._type===cc.PROGRESS_TIMER_TYPE_RADIAL?t.drawArrays(t.TRIANGLE_FAN,0,this._vertexDataCount):this._type==cc.PROGRESS_TIMER_TYPE_BAR&&(this._reverseDirection?(t.drawArrays(t.TRIANGLE_STRIP,0,this._vertexDataCount/2),t.drawArrays(t.TRIANGLE_STRIP,4,this._vertexDataCount/2),cc.g_NumberOfDraws++):t.drawArrays(t.TRIANGLE_STRIP,0,this._vertexDataCount)),cc.g_NumberOfDraws++},_updateRadial:function(){if(!this._sprite)return;var e,t=this._midPoint,n=this._percentage/100,r=2*cc.PI*(this._reverseDirection?n:1-n),i=cc.p(t.x,1),s=cc.pRotateByAngle(i,t,r),o=0,u;if(n==0)u=i,o=0;else if(n==1)u=i,o=4;else{var a=cc.FLT_MAX,f=cc.PROGRESS_TEXTURE_COORDS_COUNT;for(e=0;e<=f;++e){var l=(e+(f-1))%f,c=this._boundaryTexCoord(e%f),h=this._boundaryTexCoord(l);e==0?h=cc.pLerp(c,h,1-t.x):e==4&&(c=cc.pLerp(c,h,1-t.x));var p=cc.p(0,0);if(cc.pLineIntersect(c,h,t,s,p)){if(e==0||e==4)if(!(0<=p.x&&p.x<=1))continue;p.y>=0&&p.y<a&&(a=p.y,o=e)}}u=cc.pAdd(t,cc.pMult(cc.pSub(s,t),a))}var d=!0;this._vertexDataCount!=o+3&&(d=!1,this._vertexData=null,this._vertexArrayBuffer=null,this._vertexDataCount=0);if(!this._vertexData){this._vertexDataCount=o+3;var v=this._vertexDataCount,m=cc.V2F_C4B_T2F.BYTES_PER_ELEMENT;this._vertexArrayBuffer=new ArrayBuffer(v*m);var g=[];for(e=0;e<v;e++)g[e]=new cc.V2F_C4B_T2F(null,null,null,this._vertexArrayBuffer,e*m);this._vertexData=g;if(!this._vertexData){cc.log("cc.ProgressTimer._updateRadial() : Not enough memory");return}}this._updateColor();var y=this._vertexData;if(!d){y[0].texCoords=this._textureCoordFromAlphaPoint(t),y[0].vertices=this._vertexFromAlphaPoint(t),y[1].texCoords=this._textureCoordFromAlphaPoint(i),y[1].vertices=this._vertexFromAlphaPoint(i);for(e=0;e<o;e++){var b=this._boundaryTexCoord(e);y[e+2].texCoords=this._textureCoordFromAlphaPoint(b),y[e+2].vertices=this._vertexFromAlphaPoint(b)}}y[this._vertexDataCount-1].texCoords=this._textureCoordFromAlphaPoint(u),y[this._vertexDataCount-1].vertices=this._vertexFromAlphaPoint(u)},_updateBar:function(){if(!this._sprite)return;var e,t=this._percentage/100,n=this._barChangeRate,r=cc.pMult(cc.p(1-n.x+t*n.x,1-n.y+t*n.y),.5),i=cc.pSub(this._midPoint,r),s=cc.pAdd(this._midPoint,r);i.x<0&&(s.x+=-i.x,i.x=0),s.x>1&&(i.x-=s.x-1,s.x=1),i.y<0&&(s.y+=-i.y,i.y=0),s.y>1&&(i.y-=s.y-1,s.y=1);var o;if(!this._reverseDirection){if(!this._vertexData){this._vertexDataCount=4;var u=cc.V2F_C4B_T2F.BYTES_PER_ELEMENT,a=4;this._vertexArrayBuffer=new ArrayBuffer(a*u),this._vertexData=[];for(e=0;e<a;e++)this._vertexData[e]=new cc.V2F_C4B_T2F(null,null,null,this._vertexArrayBuffer,e*u)}o=this._vertexData,o[0].texCoords=this._textureCoordFromAlphaPoint(cc.p(i.x,s.y)),o[0].vertices=this._vertexFromAlphaPoint(cc.p(i.x,s.y)),o[1].texCoords=this._textureCoordFromAlphaPoint(cc.p(i.x,i.y)),o[1].vertices=this._vertexFromAlphaPoint(cc.p(i.x,i.y)),o[2].texCoords=this._textureCoordFromAlphaPoint(cc.p(s.x,s.y)),o[2].vertices=this._vertexFromAlphaPoint(cc.p(s.x,s.y)),o[3].texCoords=this._textureCoordFromAlphaPoint(cc.p(s.x,i.y)),o[3].vertices=this._vertexFromAlphaPoint(cc.p(s.x,i.y))}else{if(!this._vertexData){this._vertexDataCount=8;var f=cc.V2F_C4B_T2F.BYTES_PER_ELEMENT,l=8;this._vertexArrayBuffer=new ArrayBuffer(l*f);var c=[];for(e=0;e<l;e++)c[e]=new cc.V2F_C4B_T2F(null,null,null,this._vertexArrayBuffer,e*f);c[0].texCoords=this._textureCoordFromAlphaPoint(cc.p(0,1)),c[0].vertices=this._vertexFromAlphaPoint(cc.p(0,1)),c[1].texCoords=this._textureCoordFromAlphaPoint(cc.p(0,0)),c[1].vertices=this._vertexFromAlphaPoint(cc.p(0,0)),c[6].texCoords=this._textureCoordFromAlphaPoint(cc.p(1,1)),c[6].vertices=this._vertexFromAlphaPoint(cc.p(1,1)),c[7].texCoords=this._textureCoordFromAlphaPoint(cc.p(1,0)),c[7].vertices=this._vertexFromAlphaPoint(cc.p(1,0)),this._vertexData=c}o=this._vertexData,o[2].texCoords=this._textureCoordFromAlphaPoint(cc.p(i.x,s.y)),o[2].vertices=this._vertexFromAlphaPoint(cc.p(i.x,s.y)),o[3].texCoords=this._textureCoordFromAlphaPoint(cc.p(i.x,i.y)),o[3].vertices=this._vertexFromAlphaPoint(cc.p(i.x,i.y)),o[4].texCoords=this._textureCoordFromAlphaPoint(cc.p(s.x,s.y)),o[4].vertices=this._vertexFromAlphaPoint(cc.p(s.x,s
.y)),o[5].texCoords=this._textureCoordFromAlphaPoint(cc.p(s.x,i.y)),o[5].vertices=this._vertexFromAlphaPoint(cc.p(s.x,i.y))}this._updateColor()},_updateColor:function(){if(!this._sprite||!this._vertexData)return;var e=this._sprite.getQuad().tl.colors,t=this._vertexData;for(var n=0,r=this._vertexDataCount;n<r;++n)t[n].colors=e;this._vertexDataDirty=!0},_updateProgress:null,_updateProgressForCanvas:function(){var e=this._sprite,t=e.getContentSize(),n=this._midPoint;if(this._type==cc.PROGRESS_TIMER_TYPE_RADIAL){this._radius=Math.round(Math.sqrt(t.width*t.width+t.height*t.height));var r,i,s=!1,o=this._origin;o.x=t.width*n.x,o.y=-t.height*n.y,this._reverseDirection?(i=270,r=270-3.6*this._percentage):(r=-90,i=-90+3.6*this._percentage),e._flippedX&&(o.x-=t.width*this._midPoint.x*2,r=-r,i=-i,r-=180,i-=180,s=!s),e._flippedY&&(o.y+=t.height*this._midPoint.y*2,s=!s,r=-r,i=-i),this._startAngle=r,this._endAngle=i,this._counterClockWise=s}else{var u=this._barChangeRate,a=this._percentage/100,f=this._barRect,l=cc.size(t.width*(1-u.x),t.height*(1-u.y)),c=cc.size((t.width-l.width)*a,(t.height-l.height)*a),h=cc.size(l.width+c.width,l.height+c.height),p=cc.p(t.width*n.x,t.height*n.y),d=p.x-h.width/2;n.x>.5&&h.width/2>=t.width-p.x&&(d=t.width-h.width);var v=p.y-h.height/2;n.y>.5&&h.height/2>=t.height-p.y&&(v=t.height-h.height),f.x=0;var m=1;e._flippedX&&(f.x-=h.width,m=-1),d>0&&(f.x+=d*m),f.y=0;var g=1;e._flippedY&&(f.y+=h.height,g=-1),v>0&&(f.y-=v*g),f.width=h.width,f.height=-h.height}},_updateProgressForWebGL:function(){var e=this._type;e===cc.PROGRESS_TIMER_TYPE_RADIAL?this._updateRadial():e===cc.PROGRESS_TIMER_TYPE_BAR&&this._updateBar(),this._vertexDataDirty=!0}}),cc.Browser.supportWebGL?(cc.ProgressTimer.prototype.ctor=cc.ProgressTimer.prototype._ctorForWebGL,cc.ProgressTimer.prototype.setReverseProgress=cc.ProgressTimer.prototype._setReverseProgressForWebGL,cc.ProgressTimer.prototype.setSprite=cc.ProgressTimer.prototype._setSpriteForWebGL,cc.ProgressTimer.prototype.setType=cc.ProgressTimer.prototype._setTypeForWebGL,cc.ProgressTimer.prototype.setReverseDirection=cc.ProgressTimer.prototype._setReverseDirectionForWebGL,cc.ProgressTimer.prototype.initWithSprite=cc.ProgressTimer.prototype._initWithSpriteForWebGL,cc.ProgressTimer.prototype.draw=cc.ProgressTimer.prototype._drawForWebGL,cc.ProgressTimer.prototype._updateProgress=cc.ProgressTimer.prototype._updateProgressForWebGL):(cc.ProgressTimer.prototype.ctor=cc.ProgressTimer.prototype._ctorForCanvas,cc.ProgressTimer.prototype.setReverseProgress=cc.ProgressTimer.prototype._setReverseProgressForCanvas,cc.ProgressTimer.prototype.setSprite=cc.ProgressTimer.prototype._setSpriteForCanvas,cc.ProgressTimer.prototype.setType=cc.ProgressTimer.prototype._setTypeForCanvas,cc.ProgressTimer.prototype.setReverseDirection=cc.ProgressTimer.prototype._setReverseDirectionForCanvas,cc.ProgressTimer.prototype.initWithSprite=cc.ProgressTimer.prototype._initWithSpriteForCanvas,cc.ProgressTimer.prototype.draw=cc.ProgressTimer.prototype._drawForCanvas,cc.ProgressTimer.prototype._updateProgress=cc.ProgressTimer.prototype._updateProgressForCanvas),cc.ProgressTimer.create=function(e){var t=new cc.ProgressTimer;return t.initWithSprite(e)?t:null},cc.ProgressTo=cc.ActionInterval.extend({_to:0,_from:0,ctor:function(){cc.ActionInterval.prototype.ctor.call(this),this._to=0,this._from=0},initWithDuration:function(e,t){return cc.ActionInterval.prototype.initWithDuration.call(this,e)?(this._to=t,!0):!1},clone:function(){var e=new cc.ProgressTo;return e.initWithDuration(this._duration,this._to),e},reverse:function(){return cc.log("cc.ProgressTo.reverse(): reverse hasn't been supported."),null},startWithTarget:function(e){cc.ActionInterval.prototype.startWithTarget.call(this,e),this._from=e.getPercentage(),this._from==100&&(this._from=0)},update:function(e){this._target instanceof cc.ProgressTimer&&this._target.setPercentage(this._from+(this._to-this._from)*e)}}),cc.ProgressTo.create=function(e,t){var n=new cc.ProgressTo;return n.initWithDuration(e,t),n},cc.ProgressFromTo=cc.ActionInterval.extend({_to:0,_from:0,ctor:function(){cc.ActionInterval.prototype.ctor.call(this),this._to=0,this._from=0},initWithDuration:function(e,t,n){return cc.ActionInterval.prototype.initWithDuration.call(this,e)?(this._to=n,this._from=t,!0):!1},clone:function(){var e=new cc.ProgressFromTo;return e.initWithDuration(this._duration,this._from,this._to),e},reverse:function(){return cc.ProgressFromTo.create(this._duration,this._to,this._from)},startWithTarget:function(e){cc.ActionInterval.prototype.startWithTarget.call(this,e)},update:function(e){this._target instanceof cc.ProgressTimer&&this._target.setPercentage(this._from+(this._to-this._from)*e)}}),cc.ProgressFromTo.create=function(e,t,n){var r=new cc.ProgressFromTo;return r.initWithDuration(e,t,n),r},cc.SCENE_FADE=4208917214,cc.TransitionEaseScene=cc.Class.extend({easeActionWithAction:function(){}}),cc.TRANSITION_ORIENTATION_LEFT_OVER=0,cc.TRANSITION_ORIENTATION_RIGHT_OVER=1,cc.TRANSITION_ORIENTATION_UP_OVER=0,cc.TRANSITION_ORIENTATION_DOWN_OVER=1,cc.TransitionScene=cc.Scene.extend({_inScene:null,_outScene:null,_duration:null,_isInSceneOnTop:!1,_isSendCleanupToScene:!1,_setNewScene:function(e){this.unschedule(this._setNewScene);var t=cc.Director.getInstance();this._isSendCleanupToScene=t.isSendCleanupToScene(),t.replaceScene(this._inScene),cc.TouchDispatcher&&t.getTouchDispatcher().setDispatchEvents(!0),this._outScene.setVisible(!0)},_sceneOrder:function(){this._isInSceneOnTop=!0},draw:function(){this._isInSceneOnTop?(this._outScene.visit(),this._inScene.visit()):(this._inScene.visit(),this._outScene.visit())},onEnter:function(){cc.Node.prototype.onEnter.call(this),cc.TouchDispatcher&&cc.Director.getInstance().getTouchDispatcher().setDispatchEvents(!1),this._outScene.onExitTransitionDidStart(),this._inScene.onEnter()},onExit:function(){cc.Node.prototype.onExit.call(this),cc.TouchDispatcher&&cc.Director.getInstance().getTouchDispatcher().setDispatchEvents(!0),this._outScene.onExit(),this._inScene.onEnterTransitionDidFinish()},cleanup:function(){cc.Node.prototype.cleanup.call(this),this._isSendCleanupToScene&&this._outScene.cleanup()},initWithDuration:function(e,t){if(!t)throw"cc.TransitionScene.initWithDuration(): Argument scene must be non-nil";if(this.init()){this._duration=e,this.setAnchorPoint(0,0),this.setPosition(0,0),this._inScene=t,this._outScene=cc.Director.getInstance().getRunningScene(),this._outScene||(this._outScene=cc.Scene.create(),this._outScene.init());if(this._inScene==this._outScene)throw"cc.TransitionScene.initWithDuration(): Incoming scene must be different from the outgoing scene";return this._sceneOrder(),!0}return!1},finish:function(){this._inScene.setVisible(!0),this._inScene.setPosition(0,0),this._inScene.setScale(1),this._inScene.setRotation(0),cc.renderContextType===cc.WEBGL&&this._inScene.getCamera().restore(),this._outScene.setVisible(!1),this._outScene.setPosition(0,0),this._outScene.setScale(1),this._outScene.setRotation(0),cc.renderContextType===cc.WEBGL&&this._outScene.getCamera().restore(),this.schedule(this._setNewScene,0)},hideOutShowIn:function(){this._inScene.setVisible(!0),this._outScene.setVisible(!1)}}),cc.TransitionScene.create=function(e,t){var n=new cc.TransitionScene;return n!=null&&n.initWithDuration(e,t)?n:null},cc.TransitionSceneOriented=cc.TransitionScene.extend({_orientation:0,initWithDuration:function(e,t,n){return cc.TransitionScene.prototype.initWithDuration.call(this,e,t)&&(this._orientation=n),!0}}),cc.TransitionSceneOriented.create=function(e,t,n){var r=new cc.TransitionSceneOriented;return r.initWithDuration(e,t,n),r},cc.TransitionRotoZoom=cc.TransitionScene.extend({onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this),this._inScene.setScale(.001),this._outScene.setScale(1),this._inScene.setAnchorPoint(.5,.5),this._outScene.setAnchorPoint(.5,.5);var e=cc.Sequence.create(cc.Spawn.create(cc.ScaleBy.create(this._duration/2,.001),cc.RotateBy.create(this._duration/2,720)),cc.DelayTime.create(this._duration/2));this._outScene.runAction(e),this._inScene.runAction(cc.Sequence.create(e.reverse(),cc.CallFunc.create(this.finish,this)))}}),cc.TransitionRotoZoom.create=function(e,t){var n=new cc.TransitionRotoZoom;return n!=null&&n.initWithDuration(e,t)?n:null},cc.TransitionJumpZoom=cc.TransitionScene.extend({onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);var e=cc.Director.getInstance().getWinSize();this._inScene.setScale(.5),this._inScene.setPosition(e.width,0),this._inScene.setAnchorPoint(.5,.5),this._outScene.setAnchorPoint(.5,.5);var t=cc.JumpBy.create(this._duration/4,cc.p(-e.width,0),e.width/4,2),n=cc.ScaleTo.create(this._duration/4,1),r=cc.ScaleTo.create(this._duration/4,.5),i=cc.Sequence.create(r,t),s=cc.Sequence.create(t,n),o=cc.DelayTime.create(this._duration/2);this._outScene.runAction(i),this._inScene.runAction(cc.Sequence.create(o,s,cc.CallFunc.create(this.finish,this)))}}),cc.TransitionJumpZoom.create=function(e,t){var n=new cc.TransitionJumpZoom;return n!=null&&n.initWithDuration(e,t)?n:null},cc.TransitionMoveInL=cc.TransitionScene.extend({onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this),this.initScenes();var e=this.action();this._inScene.runAction(cc.Sequence.create(this.easeActionWithAction(e),cc.CallFunc.create(this.finish,this)))},initScenes:function(){this._inScene.setPosition(-cc.Director.getInstance().getWinSize().width,0)},action:function(){return cc.MoveTo.create(this._duration,cc.p(0,0))},easeActionWithAction:function(e){return cc.EaseOut.create(e,2)}}),cc.TransitionMoveInL.create=function(e,t){var n=new cc.TransitionMoveInL;return n!=null&&n.initWithDuration(e,t)?n:null},cc.TransitionMoveInR=cc.TransitionMoveInL.extend({initScenes:function(){this._inScene.setPosition(cc.Director.getInstance().getWinSize().width,0)}}),cc.TransitionMoveInR.create=function(e,t){var n=new cc.TransitionMoveInR;return n!=null&&n.initWithDuration(e,t)?n:null},cc.TransitionMoveInT=cc.TransitionMoveInL.extend({initScenes:function(){this._inScene.setPosition(0,cc.Director.getInstance().getWinSize().height)}}),cc.TransitionMoveInT.create=function(e,t){var n=new cc.TransitionMoveInT;return n!=null&&n.initWithDuration(e,t)?n:null},cc.TransitionMoveInB=cc.TransitionMoveInL.extend({initScenes:function(){this._inScene.setPosition(0,-cc.Director.getInstance().getWinSize().height)}}),cc.TransitionMoveInB.create=function(e,t){var n=new cc.TransitionMoveInB;return n!=null&&n.initWithDuration(e,t)?n:null},cc.ADJUST_FACTOR=.5,cc.TransitionSlideInL=cc.TransitionScene.extend({_sceneOrder:function(){this._isInSceneOnTop=!1},onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this),this.initScenes();var e=this.action(),t=this.action(),n=this.easeActionWithAction(e),r=cc.Sequence.create(this.easeActionWithAction(t),cc.CallFunc.create(this.finish,this));this._inScene.runAction(n),this._outScene.runAction(r)},initScenes:function(){this._inScene.setPosition(-(cc.Director.getInstance().getWinSize().width-cc.ADJUST_FACTOR),0)},action:function(){return cc.MoveBy.create(this._duration,cc.p(cc.Director.getInstance().getWinSize().width-cc.ADJUST_FACTOR,0))},easeActionWithAction:function(e){return cc.EaseOut.create(e,2)}}),cc.TransitionSlideInL.create=function(e,t){var n=new cc.TransitionSlideInL;return n!=null&&n.initWithDuration(e,t)?n:null},cc.TransitionSlideInR=cc.TransitionSlideInL.extend({_sceneOrder:function(){this._isInSceneOnTop=!0},initScenes:function(){this._inScene.setPosition(cc.Director.getInstance().getWinSize().width-cc.ADJUST_FACTOR,0)},action:function(){return cc.MoveBy.create(this._duration,cc.p(-(cc.Director.getInstance().getWinSize().width-cc.ADJUST_FACTOR),0))}}),cc.TransitionSlideInR.create=function(e,t){var n=new cc.TransitionSlideInR;return n!=null&&n.initWithDuration(e,t)?n:null},cc.TransitionSlideInB=cc.TransitionSlideInL.extend({_sceneOrder:function(){this._isInSceneOnTop=!1},initScenes:function(){this._inScene.setPosition(0,cc.Director.getInstance().getWinSize().height-cc.ADJUST_FACTOR)},action:function(){return cc.MoveBy.create(this._duration,cc.p(0,-(cc.Director.getInstance().getWinSize().height-cc.ADJUST_FACTOR)))}}),cc.TransitionSlideInB.create=function(e,t){var n=new cc.TransitionSlideInB;return n!=null&&n.initWithDuration(e,t)?n:null},cc.TransitionSlideInT=cc.TransitionSlideInL.extend({_sceneOrder:function(){this._isInSceneOnTop=!0},initScenes:function(){this._inScene.setPosition(0,-(cc.Director.getInstance().getWinSize().height-cc.ADJUST_FACTOR))},action:function(){return cc.MoveBy.create(this._duration,cc.p(0,cc.Director.getInstance().getWinSize().height-cc.ADJUST_FACTOR))}}),cc.TransitionSlideInT.create=function(e,t){var n=new cc.TransitionSlideInT;return n!=null&&n.initWithDuration(e,t)?n:null},cc.TransitionShrinkGrow=cc.TransitionScene.extend({onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this),this._inScene.setScale(.001),this._outScene.setScale(1),this._inScene.setAnchorPoint(2/3,.5),this._outScene.setAnchorPoint(1/3,.5);var e=cc.ScaleTo.create(this._duration,.01),t=cc.ScaleTo.create(this._duration,1);this._inScene.runAction(this.easeActionWithAction(t)),this._outScene.runAction(cc.Sequence.create(this.easeActionWithAction(e),cc.CallFunc.create(this.finish,this)))},easeActionWithAction:function(e){return cc.EaseOut.create(e,2)}}),cc.TransitionShrinkGrow.create=function(e,t){var n=new cc.TransitionShrinkGrow;return n!=null&&n.initWithDuration(e,t)?n:null},cc.TransitionFlipX=cc.TransitionSceneOriented.extend({onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);var e,t;this._inScene.setVisible(!1);var n,r,i,s;this._orientation===cc.TRANSITION_ORIENTATION_RIGHT_OVER?(n=90,r=270,i=90,s=0):(n=-90,r=90,i=-90,s=0),e=cc.Sequence.create(cc.DelayTime.create(this._duration/2),cc.Show.create(),cc.OrbitCamera.create(this._duration/2,1,0,r,n,0,0),cc.CallFunc.create(this.finish,this)),t=cc.Sequence.create(cc.OrbitCamera.create(this._duration/2,1,0,s,i,0,0),cc.Hide.create(),cc.DelayTime.create(this._duration/2)),this._inScene.runAction(e),this._outScene.runAction(t)}}),cc.TransitionFlipX.create=function(e,t,n){n==null&&(n=cc.TRANSITION_ORIENTATION_RIGHT_OVER);var r=new cc.TransitionFlipX;return r.initWithDuration(e,t,n),r},cc.TransitionFlipY=cc.TransitionSceneOriented.extend({onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);var e,t;this._inScene.setVisible(!1);var n,r,i,s;this._orientation==cc.TRANSITION_ORIENTATION_UP_OVER?(n=90,r=270,i=90,s=0):(n=-90,r=90,i=-90,s=0),e=cc.Sequence.create(cc.DelayTime.create(this._duration/2),cc.Show.create(),cc.OrbitCamera.create(this._duration/2,1,0,r,n,90,0),cc.CallFunc.create(this.finish,this)),t=cc.Sequence.create(cc.OrbitCamera.create(this._duration/2,1,0,s,i,90,0),cc.Hide.create(),cc.DelayTime.create(this._duration/2)),this._inScene.runAction(e),this._outScene.runAction(t)}}),cc.TransitionFlipY.create=function(e,t,n){n==null&&(n=cc.TRANSITION_ORIENTATION_UP_OVER);var r=new cc.TransitionFlipY;return r.initWithDuration(e,t,n),r},cc.TransitionFlipAngular=cc.TransitionSceneOriented.extend({onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);var e,t;this._inScene.setVisible(!1);var n,r,i,s;this._orientation===cc.TRANSITION_ORIENTATION_RIGHT_OVER?(n=90,r=270,i=90,s=0):(n=-90,r=90,i=-90,s=0),e=cc.Sequence.create(cc.DelayTime.create(this._duration/2),cc.Show.create(),cc.OrbitCamera.create(this._duration/2,1,0,r,n,-45,0),cc.CallFunc.create(this.finish,this)),t=cc.Sequence.create(cc.OrbitCamera.create(this._duration/2,1,0,s,i,45,0),cc.Hide.create(),cc.DelayTime.create(this._duration/2)),this._inScene.runAction(e),this._outScene.runAction(t)}}),cc.TransitionFlipAngular.create=function(e,t,n){n==null&&(n=cc.TRANSITION_ORIENTATION_RIGHT_OVER);var r=new cc.TransitionFlipAngular;return r.initWithDuration(e,t,n),r},cc.TransitionZoomFlipX=cc.TransitionSceneOriented.extend({onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);var e,t;this._inScene.setVisible(!1);var n,r,i,s;this._orientation===cc.TRANSITION_ORIENTATION_RIGHT_OVER?(n=90,r=270,i=90,s=0):(n=-90,r=90,i=-90,s=0),e=cc.Sequence.create(cc.DelayTime.create(this._duration/2),cc.Spawn.create(cc.OrbitCamera.create(this._duration/2,1,0,r,n,0,0),cc.ScaleTo.create(this._duration/2,1),cc.Show.create()),cc.CallFunc.create(this.finish,this)),t=cc.Sequence.create(cc.Spawn.create(cc.OrbitCamera.create(this._duration/2,1,0,s,i,0,0),cc.ScaleTo.create(this._duration/2,.5)),cc.Hide.create(),cc.DelayTime.create(this._duration/2)),this._inScene.setScale(.5),this._inScene.runAction(e),this._outScene.runAction(t)}}),cc.TransitionZoomFlipX.create=function(e,t,n){n==null&&(n=cc.TRANSITION_ORIENTATION_RIGHT_OVER);var r=new cc.TransitionZoomFlipX;return r.initWithDuration(e,t,n),r},cc.TransitionZoomFlipY=cc.TransitionSceneOriented.extend({onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);var e,t;this._inScene.setVisible(!1);var n,r,i,s;this._orientation===cc.TRANSITION_ORIENTATION_UP_OVER?(n=90,r=270,i=90,s=0):(n=-90,r=90,i=-90,s=0),e=cc.Sequence.create(cc.DelayTime.create(this._duration/2),cc.Spawn.create(cc.OrbitCamera.create(this._duration/2,1,0,r,n,90,0),cc.ScaleTo.create(this._duration/2,1),cc.Show.create()),cc.CallFunc.create(this.finish,this)),t=cc.Sequence.create(cc.Spawn.create(cc.OrbitCamera.create(this._duration/2,1,0,s,i,90,0),cc.ScaleTo.create(this._duration/2,.5)),cc.Hide.create(),cc.DelayTime.create(this._duration/2)),this._inScene.setScale(.5),this._inScene.runAction(e),this._outScene.runAction(t)}}),cc.TransitionZoomFlipY.create=function(e,t,n){n==null&&(n=cc.TRANSITION_ORIENTATION_UP_OVER);var r=new cc.TransitionZoomFlipY;return r.initWithDuration(e,t,n),r},cc.TransitionZoomFlipAngular=cc.TransitionSceneOriented.extend({onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);var e,t;this._inScene.setVisible(!1);var n,r,i,s;this._orientation===cc.TRANSITION_ORIENTATION_RIGHT_OVER?(n=90,r=270,i=90,s=0):(n=-90,r=90,i=-90,s=0),e=cc.Sequence.create(cc.DelayTime.create(this._duration/2),cc.Spawn.create(cc.OrbitCamera.create(this._duration/2,1,0,r,n,-45,0),cc.ScaleTo.create(this._duration/2,1),cc.Show.create()),cc.Show.create(),cc.CallFunc.create(this.finish,this)),t=cc.Sequence.create(cc.Spawn.create(cc.OrbitCamera.create(this._duration/2,1,0,s,i,45,0),cc.ScaleTo.create(this._duration/2,.5)),cc.Hide.create(),cc.DelayTime.create(this._duration/2)),this._inScene.setScale(.5),this._inScene.runAction(e),this._outScene.runAction(t)}}),cc.TransitionZoomFlipAngular.create=function(e,t,n){n==null&&(n=cc.TRANSITION_ORIENTATION_RIGHT_OVER);var r=new cc.TransitionZoomFlipAngular;return r.initWithDuration(e,t,n),r},cc.TransitionFade=cc.TransitionScene.extend({_color:null,ctor:function(){cc.TransitionScene.prototype.ctor.call(this),this._color=new cc.Color4B},onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);var e=cc.LayerColor.create(this._color);this._inScene.setVisible(!1),this.addChild(e,2,cc.SCENE_FADE);var t=this.getChildByTag(cc.SCENE_FADE),n=cc.Sequence.create(cc.FadeIn.create(this._duration/2),cc.CallFunc.create(this.hideOutShowIn,this),cc.FadeOut.create(this._duration/2),cc.CallFunc.create(this.finish,this));t.runAction(n)},onExit:function(){cc.TransitionScene.prototype.onExit.call(this),this.removeChildByTag(cc.SCENE_FADE,!1)},initWithDuration:function(e,t,n){return n=n||cc.black(),cc.TransitionScene.prototype.initWithDuration.call(this,e,t)&&(this._color.r=n.r,this._color.g=n.g,this._color.b=n.b,this._color.a=0),!0}}),cc.TransitionFade.create=function(e,t,n){var r=new cc.TransitionFade;return r.initWithDuration(e,t,n),r},cc.TransitionCrossFade=cc.TransitionScene.extend({onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);var e=new cc.Color4B(0,0,0,0),t=cc.Director.getInstance().getWinSize(),n=cc.LayerColor.create(e),r=cc.RenderTexture.create(t.width,t.height);if(null==r)return;r.getSprite().setAnchorPoint(.5,.5),r.setPosition(t.width/2,t.height/2),r.setAnchorPoint(.5,.5),r.begin(),this._inScene.visit(),r.end();var i=cc.RenderTexture.create(t.width,t.height);i.getSprite().setAnchorPoint(.5,.5),i.setPosition(t.width/2,t.height/2),i.setAnchorPoint(.5,.5),i.begin(),this._outScene.visit(),i.end(),r.getSprite().setBlendFunc(gl.ONE,gl.ONE),i.getSprite().setBlendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA),n.addChild(r),n.addChild(i),r.getSprite().setOpacity(255),i.getSprite().setOpacity(255);var s=cc.Sequence.create(cc.FadeTo.create(this._duration,0),cc.CallFunc.create(this.hideOutShowIn,this),cc.CallFunc.create(this.finish,this));i.getSprite().runAction(s),this.addChild(n,2,cc.SCENE_FADE)},onExit:function(){this.removeChildByTag(cc.SCENE_FADE,!1),cc.TransitionScene.prototype.onExit.call(this)},draw:function(){}}),cc.TransitionCrossFade.create=function(e,t){var n=new cc.TransitionCrossFade;return n.initWithDuration(e,t),n},cc.TransitionTurnOffTiles=cc.TransitionScene.extend({_sceneOrder:function(){this._isInSceneOnTop=!1},onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);var e=cc.Director.getInstance().getWinSize(),t=e.width/e.height,n=0|12*t,r=12,i=cc.TurnOffTiles.create(this._duration,cc.size(n,r)),s=this.easeActionWithAction(i);this._outScene.runAction(cc.Sequence.create(s,cc.CallFunc.create(this.finish,this),cc.StopGrid.create()))},easeActionWithAction:function(e){return e}}),cc.TransitionTurnOffTiles.create=function(e,t){var n=new cc.TransitionTurnOffTiles;return n!=null&&n.initWithDuration(e,t)?n:null},cc.TransitionSplitCols=cc.TransitionScene.extend({onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this),this._inScene.setVisible(!1);var e=this.action(),t=cc.Sequence.create(e,cc.CallFunc.create(this.hideOutShowIn,this),e.reverse());this.runAction(cc.Sequence.create(this.easeActionWithAction(t),cc.CallFunc.create(this.finish,this),cc.StopGrid.create()))},easeActionWithAction:function(e){return cc.EaseInOut.create(e,3)},action:function(){return cc.SplitCols.create(this._duration/2,3)}}),cc.TransitionSplitCols.create=function(e,t){var n=new cc.TransitionSplitCols;return n!=null&&n.initWithDuration(e,t)?n:null},cc.TransitionSplitRows=cc.TransitionSplitCols.extend({action:function(){return cc.SplitRows.create(this._duration/2,3)}}),cc.TransitionSplitRows.create=function(e,t){var n=new cc.TransitionSplitRows;return n!=null&&n.initWithDuration(e,t)?n:null},cc.TransitionFadeTR=cc.TransitionScene.extend({_sceneOrder:function(){this._isInSceneOnTop=!1},onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);var e=cc.Director.getInstance().getWinSize(),t=e.width/e.height,n=0|12*t,r=12,i=this.actionWithSize(cc.size(n,r));this._outScene.runAction(cc.Sequence.create(this.easeActionWithAction(i),cc.CallFunc.create(this.finish,this),cc.StopGrid.create()))},easeActionWithAction:function(e){return e},actionWithSize:function(e){return cc.FadeOutTRTiles.create(this._duration,e)}}),cc.TransitionFadeTR.create=function(e,t){var n=new cc.TransitionFadeTR;return n!=null&&n.initWithDuration(e,t)?n:null},cc.TransitionFadeBL=cc.TransitionFadeTR.extend({actionWithSize:function(e){return cc.FadeOutBLTiles.create(this._duration,e)}}),cc.TransitionFadeBL.create=function(e,t){var n=new cc.TransitionFadeBL;return n!=null&&n.initWithDuration(e,t)?n:null},cc.TransitionFadeUp=cc.TransitionFadeTR.extend({actionWithSize:function(e){return cc.FadeOutUpTiles.create(this._duration,e)}}),cc.TransitionFadeUp.create=function(e,t){var n=new cc.TransitionFadeUp;return n!=null&&n.initWithDuration(e,t)?n:null},cc.TransitionFadeDown=cc.TransitionFadeTR.extend({actionWithSize:function(e){return cc.FadeOutDownTiles.create(this._duration,e)}}),cc.TransitionFadeDown.create=function(e,t){var n=new cc.TransitionFadeDown;return n!=null&&n.initWithDuration(e,t)?n:null},cc.SCENE_RADIAL=49153,cc.TransitionProgress=cc.TransitionScene.extend({_to:0,_from:0,_sceneToBeModified:null,onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this),this._setupTransition();var e=cc.Director.getInstance().getWinSize(),t=cc.RenderTexture.create(e.width,e.height);t.getSprite().setAnchorPoint(.5,.5),t.setPosition(e.width/2,e.height/2),t.setAnchorPoint(.5,.5),t.clear(0,0,0,1),t.begin(),this._sceneToBeModified.visit(),t.end(),this._sceneToBeModified==this._outScene&&this.hideOutShowIn();var n=this._progressTimerNodeWithRenderTexture(t),r=cc.Sequence.create(cc.ProgressFromTo.create(this._duration,this._from,this._to),cc.CallFunc.create(this.finish,this));n.runAction(r),this.addChild(n,2,cc.SCENE_RADIAL)},onExit:function(){this.removeChildByTag(cc.SCENE_RADIAL,!0),cc.TransitionScene.prototype.onExit.call(this)},_setupTransition:function(){this._sceneToBeModified=this._outScene,this._from=100,this._to=0},_progressTimerNodeWithRenderTexture:function(e){return cc.log("cc.TransitionProgress._progressTimerNodeWithRenderTexture(): should be overridden in subclass"),null},_sceneOrder:function(){this._isInSceneOnTop=!1}}),cc.TransitionProgress.create=function(e,t){var n=new cc.TransitionProgress;return n!=null&&n.initWithDuration(e,t)?n:null},cc.TransitionProgressRadialCCW=cc.TransitionProgress.extend({_progressTimerNodeWithRenderTexture:function(e){var t=cc.Director.getInstance().getWinSize(),n=cc.ProgressTimer.create(e.getSprite());return cc.renderContextType===cc.WEBGL&&n.getSprite().setFlippedY(!0),n.setType(cc.PROGRESS_TIMER_TYPE_RADIAL),n.setReverseDirection(!1),n.setPercentage(100),n.setPosition(t.width/2,t.height/2),n.setAnchorPoint(.5,.5),n}}),cc.TransitionProgressRadialCCW.create=function(e,t){var n=new cc.TransitionProgressRadialCCW;return n!=null&&n.initWithDuration(e,t)?n:null},cc.TransitionProgressRadialCW=cc.TransitionProgress.extend({_progressTimerNodeWithRenderTexture:function(e){var t=cc.Director.getInstance().getWinSize(),n=cc.ProgressTimer.create(e.getSprite());return cc.renderContextType===cc.WEBGL&&n.getSprite().setFlippedY(!0),n.setType(cc.PROGRESS_TIMER_TYPE_RADIAL),n.setReverseDirection(!0),n.setPercentage(100),n.setPosition(t.width/2,t.height/2),n.setAnchorPoint(.5,.5),n}}),cc.TransitionProgressRadialCW.create=function(e,t){var n=new cc.TransitionProgressRadialCW;return n!=null&&n.initWithDuration(e,t)?n:null},cc.TransitionProgressHorizontal=cc.TransitionProgress.extend({_progressTimerNodeWithRenderTexture:function(e){var t=cc.Director.getInstance().getWinSize(),n=cc.ProgressTimer.create(e.getSprite());return cc.renderContextType===cc.WEBGL&&n.getSprite().setFlippedY(!0),n.setType(cc.PROGRESS_TIMER_TYPE_BAR),n.setMidpoint(cc.p(1,0)),n.setBarChangeRate(cc.p(1,0)),n.setPercentage(100),n.setPosition(t.width/2,t.height/2),n.setAnchorPoint(.5,.5),n}}),cc.TransitionProgressHorizontal.create=function(e,t){var n=new cc.TransitionProgressHorizontal;return n!=null&&n.initWithDuration(e,t)?n:null},cc.TransitionProgressVertical=cc.TransitionProgress.extend({_progressTimerNodeWithRenderTexture:function(e){var t=cc.Director.getInstance().getWinSize(),n=cc.ProgressTimer.create(e.getSprite());return cc.renderContextType===cc.WEBGL&&n.getSprite().setFlippedY(!0),n.setType(cc.PROGRESS_TIMER_TYPE_BAR),n.setMidpoint(cc.p(0,0)),n.setBarChangeRate(cc.p(0,1)),n.setPercentage(100),n.setPosition(t.width/2,t.height/2),n.setAnchorPoint(.5,.5),n}}),cc.TransitionProgressVertical.create=function(e,t){var n=new cc.TransitionProgressVertical;return n!=null&&n.initWithDuration(e,t)?n:null},cc.TransitionProgressInOut=cc.TransitionProgress.extend({_progressTimerNodeWithRenderTexture:function(e){var t=cc.Director.getInstance().getWinSize(),n=cc.ProgressTimer.create(e.getSprite());return cc.renderContextType===cc.WEBGL&&n.getSprite().setFlippedY(!0),n.setType(cc.PROGRESS_TIMER_TYPE_BAR),n.setMidpoint(cc.p(.5,.5)),n.setBarChangeRate(cc.p(1,1)),n.setPercentage(0),n.setPosition(t.width/2,t.height/2),n.setAnchorPoint(.5,.5),n},_sceneOrder:function(){this._isInSceneOnTop=!1},_setupTransition:function(){this._sceneToBeModified=this._inScene,this._from=0,this._to=100}}),cc.TransitionProgressInOut.create=function(e,t){var n=new cc.TransitionProgressInOut;return n!=null&&n.initWithDuration(e,t)?n:null},cc.TransitionProgressOutIn=cc.TransitionProgress.extend({_progressTimerNodeWithRenderTexture:function(e){var t=cc.Director.getInstance().getWinSize(),n=cc.ProgressTimer.create(e.getSprite());return cc.renderContextType===cc.WEBGL&&n.getSprite().setFlippedY(!0),n.setType(cc.PROGRESS_TIMER_TYPE_BAR),n.setMidpoint(cc.p(.5,.5)),n.setBarChangeRate(cc.p(1,1)),n.setPercentage(100),n.setPosition(t.width/2,t.height/2),n.setAnchorPoint(.5,.5),n}}),cc.TransitionProgressOutIn.create=function(e,t){var n=new cc.TransitionProgressOutIn;return n!=null&&n.initWithDuration(e,t)?n:null},cc.TransitionPageTurn=cc.TransitionScene.extend({_back:!0,initWithDuration:function(e,t,n){return this._back=n,cc.TransitionScene.prototype.initWithDuration.call(this,e,t),!0},actionWithSize:function(e){return this._back?cc.ReverseTime.create(cc.PageTurn3D.create(this._duration,e)):cc.PageTurn3D.create(this._duration,e)},onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);var e=cc.Director.getInstance().getWinSize(),t,n;e.width>e.height?(t=16,n=12):(t=12,n=16);var r=this.actionWithSize(cc.size(t,n));this._back?(this._inScene.setVisible(!1),this._inScene.runAction(cc.Sequence.create(cc.Show.create(),r,cc.CallFunc.create(this.finish,this),cc.StopGrid.create()))):this._outScene.runAction(cc.Sequence.create(r,cc.CallFunc.create(this.finish,this),cc.StopGrid.create()))},_sceneOrder:function(){this._isInSceneOnTop=this._back}}),cc.TransitionPageTurn.create=function(e,t,n){var r=new cc.TransitionPageTurn;return r.initWithDuration(e,t,n),r},cc.LabelAtlas=cc.AtlasNode.extend({_string:null,_mapStartChar:null,_textureLoaded:!1,_loadedEventListeners:null,ctor:function(){cc.AtlasNode.prototype.ctor.call(this)},textureLoaded:function(){return this._textureLoaded},addLoadedEventListener:function(e,t){this._loadedEventListeners||(this._loadedEventListeners=[]),this._loadedEventListeners.push({eventCallback:e,eventTarget:t})},_callLoadedEventCallbacks:function(){if(!this._loadedEventListeners)return;this._textureLoaded=!0;var e=this._loadedEventListeners;for(var t=0,n=e.length;t<n;t++){var r=e[t];cc.doCallback(r.eventCallback,r.eventTarget,this)}e.length=0},initWithString:function(e,t,n,r,i){var s=e+"",o,u,a,f;if(arguments.length===2){var l=cc.FileUtils.getInstance(),c=l.fullPathForFilename(t),h=c.substr(0,c.lastIndexOf("/"))+"/",p=l.dictionaryWithContentsOfFileThreadSafe(c);if(parseInt(p.version,10)!==1)return cc.log("cc.LabelAtlas.initWithString(): Unsupported version. Upgrade cocos2d version"),!1;o=h+p.textureFilename;var d=cc.CONTENT_SCALE_FACTOR();u=parseInt(p.itemWidth,10)/d,a=parseInt(p.itemHeight,10)/d,f=String.fromCharCode(parseInt(p.firstChar,10))}else o=t,u=n||0,a=r||0,f=i||" ";var v=null;o instanceof cc.Texture2D?v=o:v=cc.TextureCache.getInstance().addImage(o);var m=v.isLoaded();return this._textureLoaded=m,m||v.addLoadedEventListener(function(e){this.initWithTexture(v,u,a,s.length),this.setString(s),this._callLoadedEventCallbacks()},this),this.initWithTexture(v,u,a,s.length)?(this._mapStartChar=f,this.setString(s),!0):!1},setColor:function(e){cc.AtlasNode.prototype.setColor.call(this,e),this.updateAtlasValues()},getString:function(){return this._string},draw:function(e){cc.AtlasNode.prototype.draw.call(this,e);if(cc.LABELATLAS_DEBUG_DRAW){var t=this.getContentSize(),n=[cc.p(0,0),cc.p(t.width,0),cc.p(t.width,t.height),cc.p(0,t.height)];cc.drawingUtil.drawPoly(n,4,!0)}},updateAtlasValues:null,_updateAtlasValuesForCanvas:function(){var e=this._string,t=e.length,n=this.getTexture(),r=this._itemWidth,i=this._itemHeight;for(var s=0;s<t;s++){var o=e.charCodeAt(s)-this._mapStartChar.charCodeAt(0),u=parseInt(o%this._itemsPerRow,10),a=parseInt(o/this._itemsPerRow,10),f=cc.rect(u*r,a*i,r,i),l=e.charCodeAt(s),c=this.getChildByTag(s);c?l==32?(c.init(),c.setTextureRect(cc.rect(0,0,10,10),!1,cc.SizeZero())):(c.initWithTexture(n,f),c.setVisible(!0),c.setOpacity(this._displayedOpacity)):(c=new cc.Sprite,l==32?(c.init(),c.setTextureRect(cc.rect(0,0,10,10),!1,cc.SizeZero())):c.initWithTexture(n,f),this.addChild(c,0,s)),c.setPosition(s*r+r/2,i/2)}},_updateAtlasValuesForWebGL:function(){var e=this._string,t=e.length,n=this._textureAtlas,r=n.getTexture(),i=r.getPixelsWide(),s=r.getPixelsHigh(),o=this._itemWidth,u=this._itemHeight;this._ignoreContentScaleFactor||(o=this._itemWidth*cc.CONTENT_SCALE_FACTOR(),u=this._itemHeight*cc.CONTENT_SCALE_FACTOR()),t>n.getCapacity()&&cc.log("cc.LabelAtlas._updateAtlasValues(): Invalid String length");var a=n.getQuads(),f=this._displayedColor,l={r:f.r,g:f.g,b:f.b,a:this._displayedOpacity},c=this._itemWidth;for(var h=0;h<t;h++){var p=e.charCodeAt(h)-this._mapStartChar.charCodeAt(0),d=p%this._itemsPerRow,v=0|p/this._itemsPerRow,m,g,y,b;cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL?(m=(2*d*o+1)/(2*
i),g=m+(o*2-2)/(2*i),y=(2*v*u+1)/(2*s),b=y+(u*2-2)/(2*s)):(m=d*o/i,g=m+o/i,y=v*u/s,b=y+u/s);var w=a[h],E=w.tl,S=w.tr,x=w.bl,T=w.br;E.texCoords.u=m,E.texCoords.v=y,S.texCoords.u=g,S.texCoords.v=y,x.texCoords.u=m,x.texCoords.v=b,T.texCoords.u=g,T.texCoords.v=b,x.vertices.x=h*c,x.vertices.y=0,x.vertices.z=0,T.vertices.x=h*c+c,T.vertices.y=0,T.vertices.z=0,E.vertices.x=h*c,E.vertices.y=this._itemHeight,E.vertices.z=0,S.vertices.x=h*c+c,S.vertices.y=this._itemHeight,S.vertices.z=0,E.colors=l,S.colors=l,x.colors=l,T.colors=l}if(t>0){n.setDirty(!0);var N=n.getTotalQuads();t>N&&n.increaseTotalQuadsWith(t-N)}},setString:null,_setStringForCanvas:function(e){e=String(e);var t=e.length;this._string=e,this.setContentSize(t*this._itemWidth,this._itemHeight);if(this._children){var n=this._children;t=n.length;for(var r=0;r<t;r++){var i=n[r];i&&i.setVisible(!1)}}this.updateAtlasValues(),this._quadsToDraw=t},_setStringForWebGL:function(e){e=String(e);var t=e.length;t>this._textureAtlas.getTotalQuads()&&this._textureAtlas.resizeCapacity(t),this._string=e,this.setContentSize(t*this._itemWidth,this._itemHeight),this.updateAtlasValues(),this._quadsToDraw=t},setOpacity:null,_setOpacityForCanvas:function(e){if(this._displayedOpacity!==e){cc.AtlasNode.prototype.setOpacity.call(this,e);var t=this._children;for(var n=0,r=t.length;n<r;n++)t[n]&&t[n].setOpacity(e)}},_setOpacityForWebGL:function(e){this._opacity!==e&&cc.AtlasNode.prototype.setOpacity.call(this,e)}}),cc.Browser.supportWebGL?(cc.LabelAtlas.prototype.updateAtlasValues=cc.LabelAtlas.prototype._updateAtlasValuesForWebGL,cc.LabelAtlas.prototype.setString=cc.LabelAtlas.prototype._setStringForWebGL,cc.LabelAtlas.prototype.setOpacity=cc.LabelAtlas.prototype._setOpacityForWebGL):(cc.LabelAtlas.prototype.updateAtlasValues=cc.LabelAtlas.prototype._updateAtlasValuesForCanvas,cc.LabelAtlas.prototype.setString=cc.LabelAtlas.prototype._setStringForCanvas,cc.LabelAtlas.prototype.setOpacity=cc.LabelAtlas.prototype._setOpacityForCanvas),cc.LabelAtlas.create=function(e,t,n,r,i){var s=new cc.LabelAtlas;return s&&cc.LabelAtlas.prototype.initWithString.apply(s,arguments)?s:null},cc.LABEL_AUTOMATIC_WIDTH=-1,cc.KerningHashElement=function(e,t){this.key=e||0,this.amount=t||0},cc.FontDefHashElement=function(e,t){this.key=e||0,this.fontDef=t||new cc.BMFontDef},cc.BMFontDef=function(e,t,n,r,i){this.charID=e||0,this.rect=t||cc.rect(0,0,.1,.1),this.xOffset=n||0,this.yOffset=r||0,this.xAdvance=i||0},cc.BMFontPadding=function(e,t,n,r){this.left=e||0,this.top=t||0,this.right=n||0,this.bottom=r||0},cc.BMFontConfiguration=cc.Class.extend({commonHeight:0,padding:null,atlasName:null,kerningDictionary:null,fontDefDictionary:null,characterSet:null,ctor:function(){this.padding=new cc.BMFontPadding,this.atlasName="",this.kerningDictionary=new cc.KerningHashElement,this.fontDefDictionary={},this.characterSet=[]},description:function(){return"<cc.BMFontConfiguration | Kernings:"+this.kerningDictionary.amount+" | Image = "+this.atlasName.toString()+">"},getAtlasName:function(){return this.atlasName},setAtlasName:function(e){this.atlasName=e},getCharacterSet:function(){return this.characterSet},initWithFNTfile:function(e){if(!e||e.length==0)throw"cc.BMFontConfiguration.initWithFNTfile(): FNTfile must be non-null and must not be a empty string";return this.characterSet=this._parseConfigFile(e),this.characterSet!=null},_parseConfigFile:function(e){var t=cc.FileUtils.getInstance().fullPathForFilename(e),n=cc.SAXParser.getInstance().getList(t);if(!n)return cc.log("cc.BMFontConfiguration._parseConfigFile)(: Error parsing FNTfile "+e),null;var r=[],i,s,o;s=/padding+[a-z0-9\-= ",]+/gi,i=s.exec(n)[0],i&&this._parseInfoArguments(i),s=/common lineHeight+[a-z0-9\-= ",]+/gi,i=s.exec(n)[0],i&&this._parseCommonArguments(i),s=/page id=[0-9]+ file="[\w\-\.]+/gi,i=s.exec(n)[0],i&&this._parseImageFileName(i,e),s=/chars c+[a-z0-9\-= ",]+/gi,i=s.exec(n)[0],i,s=/char id=\w[a-z0-9\-= ]+/gi,i=n.match(s);if(i)for(o=0;o<i.length;o++){var u=new cc.FontDefHashElement;this._parseCharacterDefinition(i[o],u.fontDef),u.key=u.fontDef.charID,this.fontDefDictionary[u.key]=u,r.push(u.fontDef.charID)}s=/kerning first=\w[a-z0-9\-= ]+/gi,i=n.match(s);if(i)for(o=0;o<i.length;o++)this._parseKerningEntry(i[o]);return r},_parseCharacterDefinition:function(e,t){var n=/id=(\d+)/gi.exec(e)[1];t.charID=n.toString(),n=/x=([\-\d]+)/gi.exec(e)[1],t.rect.x=parseInt(n),n=/y=([\-\d]+)/gi.exec(e)[1],t.rect.y=parseInt(n),n=/width=([\-\d]+)/gi.exec(e)[1],t.rect.width=parseInt(n),n=/height=([\-\d]+)/gi.exec(e)[1],t.rect.height=parseInt(n),n=/xoffset=([\-\d]+)/gi.exec(e)[1],t.xOffset=parseInt(n),n=/yoffset=([\-\d]+)/gi.exec(e)[1],t.yOffset=parseInt(n),n=/xadvance=([\-\d]+)/gi.exec(e)[1],t.xAdvance=parseInt(n)},_parseInfoArguments:function(e){var t=/padding=(\d+)[,](\d+)[,](\d+)[,](\d+)/gi.exec(e);this.padding.left=t[1],this.padding.top=t[2],this.padding.right=t[3],this.padding.bottom=t[4],cc.log("cocos2d: padding: "+this.padding.left+","+this.padding.top+","+this.padding.right+","+this.padding.bottom)},_parseCommonArguments:function(e){var t;this.commonHeight=parseInt(/lineHeight=(\d+)/gi.exec(e)[1]);if(cc.renderContextType===cc.WEBGL){var n=cc.Configuration.getInstance().getMaxTextureSize(),r=parseInt(/scaleW=(\d+)/gi.exec(e)[1]),i=parseInt(/scaleH=(\d+)/gi.exec(e)[1]);(r>n.width||i>n.height)&&cc.log("cc.LabelBMFont._parseCommonArguments(): page can't be larger than supported")}t=/pages=(\d+)/gi.exec(e)[1],parseInt(t)!==1&&cc.log("cc.LabelBMFont._parseCommonArguments(): only supports 1 page")},_parseImageFileName:function(e,t){var n;n=/id=(\d+)/gi.exec(e)[1],parseInt(n)!==0&&cc.log("cc.LabelBMFont._parseImageFileName() : file could not be found"),n=/file="([a-zA-Z0-9\-\._]+)/gi.exec(e)[1],this.atlasName=cc.FileUtils.getInstance().fullPathFromRelativeFile(n,t)},_parseKerningCapacity:function(e){},_parseKerningEntry:function(e){var t=/first=([\-\d]+)/gi.exec(e)[1],n=parseInt(t);t=/second=([\-\d]+)/gi.exec(e)[1];var r=parseInt(t);t=/amount=([\-\d]+)/gi.exec(e)[1];var i=parseInt(t),s=new cc.KerningHashElement;s.amount=i,s.key=n<<16|r&65535,this.kerningDictionary[s.key]=s},_purgeKerningDictionary:function(){this.kerningDictionary=null},_purgeFontDefDictionary:function(){this.fontDefDictionary=null}}),cc.BMFontConfiguration.create=function(e){var t=new cc.BMFontConfiguration;return t.initWithFNTfile(e)?t:null},cc.LabelBMFont=cc.SpriteBatchNode.extend({RGBAProtocol:!0,_opacityModifyRGB:!1,_string:null,_configuration:null,_fntFile:null,_initialString:"",_alignment:null,_width:0,_lineBreakWithoutSpaces:!1,_imageOffset:null,_reusedChar:null,_displayedOpacity:255,_realOpacity:255,_displayedColor:null,_realColor:null,_cascadeColorEnabled:!1,_cascadeOpacityEnabled:!1,_textureLoaded:!1,_loadedEventListeners:null,_setString:function(e,t){t?this._initialString=e:this._string=e;var n=this._children;if(n)for(var r=0;r<n.length;r++){var i=n[r];i&&i.setVisible(!1)}this._textureLoaded&&(this.createFontChars(),t&&this.updateLabel())},ctor:function(){cc.SpriteBatchNode.prototype.ctor.call(this),this._imageOffset=cc.PointZero(),this._string="",this._initialString="",this._alignment=cc.TEXT_ALIGNMENT_CENTER,this._width=-1,this._configuration=null,this._lineBreakWithoutSpaces=!1,this._displayedOpacity=255,this._realOpacity=255,this._displayedColor=cc.white(),this._realColor=cc.white(),this._cascadeColorEnabled=!0,this._cascadeOpacityEnabled=!0,this._opacityModifyRGB=!1,this._fntFile="",this._reusedChar=[]},textureLoaded:function(){return this._textureLoaded},addLoadedEventListener:function(e,t){this._loadedEventListeners||(this._loadedEventListeners=[]),this._loadedEventListeners.push({eventCallback:e,eventTarget:t})},_callLoadedEventCallbacks:function(){if(!this._loadedEventListeners)return;var e=this._loadedEventListeners;for(var t=0,n=e.length;t<n;t++){var r=e[t];cc.doCallback(r.eventCallback,r.eventTarget,this)}e.length=0},draw:function(e){cc.SpriteBatchNode.prototype.draw.call(this,e);if(cc.LABELBMFONT_DEBUG_DRAW){var t=this.getContentSize(),n=cc.p(0|-this._anchorPointInPoints._x,0|-this._anchorPointInPoints._y),r=[cc.p(n.x,n.y),cc.p(n.x+t.width,n.y),cc.p(n.x+t.width,n.y+t.height),cc.p(n.x,n.y+t.height)];cc.drawingUtil.setDrawColor4B(0,255,0,255),cc.drawingUtil.drawPoly(r,4,!0)}},setColor:function(e){if(this._realColor.r==e.r&&this._realColor.g==e.g&&this._realColor.b==e.b)return;this._displayedColor={r:e.r,g:e.g,b:e.b},this._realColor={r:e.r,g:e.g,b:e.b};if(this._textureLoaded&&this._cascadeColorEnabled){var t=cc.white(),n=this._parent;n&&n.RGBAProtocol&&n.isCascadeColorEnabled()&&(t=n.getDisplayedColor()),this.updateDisplayedColor(t)}},isOpacityModifyRGB:function(){return this._opacityModifyRGB},setOpacityModifyRGB:function(e){this._opacityModifyRGB=e;var t=this._children;if(t)for(var n=0;n<t.length;n++){var r=t[n];r&&r.RGBAProtocol&&r.setOpacityModifyRGB(this._opacityModifyRGB)}},getOpacity:function(){return this._realOpacity},getDisplayedOpacity:function(){return this._displayedOpacity},setOpacity:function(e){this._displayedOpacity=this._realOpacity=e;if(this._cascadeOpacityEnabled){var t=255,n=this._parent;n&&n.RGBAProtocol&&n.isCascadeOpacityEnabled()&&(t=n.getDisplayedOpacity()),this.updateDisplayedOpacity(t)}},updateDisplayedOpacity:function(e){this._displayedOpacity=this._realOpacity*e/255;var t=this._children;for(var n=0;n<t.length;n++){var r=t[n];cc.Browser.supportWebGL?r.updateDisplayedOpacity(this._displayedOpacity):(cc.NodeRGBA.prototype.updateDisplayedOpacity.call(r,this._displayedOpacity),r.setNodeDirty())}this._changeTextureColor()},isCascadeOpacityEnabled:function(){return!1},setCascadeOpacityEnabled:function(e){this._cascadeOpacityEnabled=e},getColor:function(){return this._realColor},getDisplayedColor:function(){return this._displayedColor},updateDisplayedColor:function(e){var t=this._displayedColor,n=this._realColor;t.r=n.r*e.r/255,t.g=n.g*e.g/255,t.b=n.b*e.b/255;var r=this._children;for(var i=0;i<r.length;i++){var s=r[i];cc.Browser.supportWebGL?s.updateDisplayedColor(this._displayedColor):(cc.NodeRGBA.prototype.updateDisplayedColor.call(s,this._displayedColor),s.setNodeDirty())}this._changeTextureColor()},_changeTextureColor:function(){if(cc.Browser.supportWebGL)return;var e,t=this.getTexture();if(t&&t.getContentSize().width>0){e=t.getHtmlElementObj();if(!e)return;var n=cc.TextureCache.getInstance().getTextureColors(this._originalTexture.getHtmlElementObj());n&&(e instanceof HTMLCanvasElement&&!this._rectRotated?cc.generateTintImage(e,n,this._displayedColor,null,e):(e=cc.generateTintImage(e,n,this._displayedColor),t=new cc.Texture2D,t.initWithElement(e),t.handleLoadedTexture(),this.setTexture(t)))}},isCascadeColorEnabled:function(){return!1},setCascadeColorEnabled:function(e){this._cascadeColorEnabled=e},init:function(){return this.initWithString(null,null,null,null,null)},initWithString:function(e,t,n,r,i){var s=e||"";this._configuration&&cc.log("cc.LabelBMFont.initWithString(): re-init is no longer supported");var o;if(t){var u=cc.FNTConfigLoadFile(t);if(!u)return cc.log("cc.LabelBMFont.initWithString(): Impossible to create font. Please check file"),!1;this._configuration=u,this._fntFile=t,o=cc.TextureCache.getInstance().addImage(this._configuration.getAtlasName());var a=o.isLoaded();this._textureLoaded=a,a||o.addLoadedEventListener(function(e){this._textureLoaded=!0,this.initWithTexture(e,this._initialString.length),this.setString(this._initialString,!0),this._callLoadedEventCallbacks()},this)}else{o=new cc.Texture2D;var f=new Image;o.initWithElement(f),this._textureLoaded=!1}if(this.initWithTexture(o,s.length)){this._alignment=r||cc.TEXT_ALIGNMENT_LEFT,this._imageOffset=i||cc.PointZero(),this._width=n==null?-1:n,this._displayedOpacity=this._realOpacity=255,this._displayedColor=cc.white(),this._realColor=cc.white(),this._cascadeOpacityEnabled=!0,this._cascadeColorEnabled=!0,this._contentSize._width=0,this._contentSize._height=0,this.setAnchorPoint(.5,.5);if(cc.renderContextType===cc.WEBGL){var l=this._textureAtlas.getTexture();this._opacityModifyRGB=l.hasPremultipliedAlpha(),this._reusedChar=new cc.Sprite,this._reusedChar.initWithTexture(l,cc.rect(0,0,0,0),!1),this._reusedChar.setBatchNode(this)}return this.setString(s,!0),!0}return!1},createFontChars:function(){var e=cc.renderContextType,t=e===cc.CANVAS?this.getTexture():this._textureAtlas.getTexture(),n=0,r=-1,i=0,s=cc.SizeZero(),o=0,u=1,a=this._string?this._string.length:0;if(a===0)return;var f,l=this._configuration.getCharacterSet();for(f=0;f<a-1;f++)this._string.charCodeAt(f)==10&&u++;var c=this._configuration.commonHeight*u,h=-(this._configuration.commonHeight-this._configuration.commonHeight*u);for(f=0;f<a;f++){var p=this._string.charCodeAt(f);if(p===10){n=0,h-=this._configuration.commonHeight;continue}if(l[p]===null){cc.log("cc.LabelBMFont: Attempted to use character not defined in this bitmap: "+this._string[f]);continue}i=this._kerningAmountForFirst(r,p);var d=this._configuration.fontDefDictionary[p];if(!d){p!==0&&p!==10&&cc.log("cocos2d: LabelBMFont: character not found "+this._string[f]);continue}var v=d.fontDef,m=cc.rect(v.rect.x,v.rect.y,v.rect.width,v.rect.height);m=cc.RECT_PIXELS_TO_POINTS(m),m.x+=this._imageOffset.x,m.y+=this._imageOffset.y;var g=this.getChildByTag(f);g?p===32&&e===cc.CANVAS?g.setTextureRect(m,!1,cc.SizeZero()):(g.setTextureRect(m,!1,m._size),g.setVisible(!0)):(g=new cc.Sprite,p===32&&e===cc.CANVAS?g.initWithTexture(t,cc.RectZero(),!1):g.initWithTexture(t,m,!1),g._newTextureWhenChangeColor=!0,this.addChild(g,0,f)),g.setOpacityModifyRGB(this._opacityModifyRGB),cc.Browser.supportWebGL?(g.updateDisplayedColor(this._displayedColor),g.updateDisplayedOpacity(this._displayedOpacity)):(cc.NodeRGBA.prototype.updateDisplayedColor.call(g,this._displayedColor),cc.NodeRGBA.prototype.updateDisplayedOpacity.call(g,this._displayedOpacity),g.setNodeDirty());var y=this._configuration.commonHeight-v.yOffset,b=cc.p(n+v.xOffset+v.rect.width*.5+i,h+y-m.height*.5*cc.CONTENT_SCALE_FACTOR());g.setPosition(cc.POINT_PIXELS_TO_POINTS(b)),n+=v.xAdvance+i,r=p,o<n&&(o=n)}s.width=o,s.height=c,this.setContentSize(cc.SIZE_PIXELS_TO_POINTS(s))},updateString:function(e){var t=this._children;if(t)for(var n=0;n<t.length;n++){var r=t[n];r&&r.setVisible(!1)}this._configuration&&this.createFontChars(),e||this.updateLabel()},getString:function(){return this._initialString},setString:function(e,t){e=String(e),t==null&&(t=!0);if(e==null||typeof e!="string")e+="";this._initialString=e,this._setString(e,t)},setCString:function(e){this.setString(e,!0)},updateLabel:function(){this.setString(this._initialString,!1);if(this._width>0){var e=this._string.length,t=[],n=[],r=1,i=0,s=!1,o=!1,u=-1,a=-1,f=0,l,c;for(l=0;l<this._children.length;l++){var h=0;while(!(c=this.getChildByTag(l+f+h)))h++;f+=h;if(i>=e)break;var p=this._string[i];o||(a=this._getLetterPosXLeft(c),o=!0),s||(u=a,s=!0);if(p.charCodeAt(0)==10){n.push("\n"),t=t.concat(n),n.length=0,o=!1,s=!1,a=-1,u=-1,i+=h,r++;if(i>=e)break;p=this._string[i],a||(a=this._getLetterPosXLeft(c),o=!0),u||(u=a,s=!0),i++;continue}if(cc.isspace_unicode(p)){n.push(p),t=t.concat(n),n.length=0,o=!1,a=-1,i++;continue}if(this._getLetterPosXRight(c)-u>this._width)if(!this._lineBreakWithoutSpaces){n.push(p);var d=t.lastIndexOf(" ");d!=-1?cc.utf8_trim_ws(t):t=[],t.length>0&&t.push("\n"),r++,s=!1,u=-1,i++}else{cc.utf8_trim_ws(n),n.push("\n"),t=t.concat(n),n.length=0,o=!1,s=!1,a=-1,u=-1,r++;if(i>=e)break;a||(a=this._getLetterPosXLeft(c),o=!0),u||(u=a,s=!0),l--}else n.push(p),i++}t=t.concat(n);var v=t.length,m="";for(i=0;i<v;++i)m+=t[i];m+=String.fromCharCode(0),this._setString(m,!1)}if(this._alignment!=cc.TEXT_ALIGNMENT_LEFT){i=0;var g=0,y=this._string.length,b=[];for(var w=0;w<y;w++){if(this._string[w].charCodeAt(0)==10||this._string[w].charCodeAt(0)==0){var E=0,S=b.length,x=i+S-1+g;if(x<0)continue;var T=this.getChildByTag(x);if(T==null)continue;E=T.getPositionX()+T.getContentSize().width/2;var N=0;switch(this._alignment){case cc.TEXT_ALIGNMENT_CENTER:N=this.getContentSize().width/2-E/2;break;case cc.TEXT_ALIGNMENT_RIGHT:N=this.getContentSize().width-E;break;default:}if(N!=0)for(l=0;l<S;l++){x=i+l+g;if(x<0)continue;c=this.getChildByTag(x),c&&c.setPosition(cc.pAdd(c.getPosition(),cc.p(N,0)))}i+=S,g++,b.length=0;continue}b.push(this._string[i])}}},setAlignment:function(e){this._alignment=e,this.updateLabel()},setWidth:function(e){this._width=e,this.updateLabel()},setLineBreakWithoutSpace:function(e){this._lineBreakWithoutSpaces=e,this.updateLabel()},setScale:function(e,t){cc.Node.prototype.setScale.call(this,e,t),this.updateLabel()},setScaleX:function(e){cc.Node.prototype.setScaleX.call(this,e),this.updateLabel()},setScaleY:function(e){cc.Node.prototype.setScaleY.call(this,e),this.updateLabel()},setFntFile:function(e){if(e!=null&&e!=this._fntFile){var t=cc.FNTConfigLoadFile(e);if(!t){cc.log("cc.LabelBMFont.setFntFile() : Impossible to create font. Please check file");return}this._fntFile=e,this._configuration=t;var n=cc.TextureCache.getInstance().addImage(this._configuration.getAtlasName()),r=n.isLoaded();this._textureLoaded=r,this.setTexture(n),cc.renderContextType===cc.CANVAS&&(this._originalTexture=this.getTexture()),r?this.createFontChars():n.addLoadedEventListener(function(e){this._textureLoaded=!0,this.setTexture(e),this.createFontChars(),this._changeTextureColor(),this.updateLabel(),this._callLoadedEventCallbacks()},this)}},getFntFile:function(){return this._fntFile},setAnchorPoint:function(e,t){cc.Node.prototype.setAnchorPoint.call(this,e,t),this.updateLabel()},_atlasNameFromFntFile:function(e){},_kerningAmountForFirst:function(e,t){var n=0,r=e<<16|t&65535;if(this._configuration.kerningDictionary){var i=this._configuration.kerningDictionary[r.toString()];i&&(n=i.amount)}return n},_getLetterPosXLeft:function(e){return e.getPositionX()*this._scaleX+e.getContentSize().width*this._scaleX*e.getAnchorPoint().x},_getLetterPosXRight:function(e){return e.getPositionX()*this._scaleX-e.getContentSize().width*this._scaleX*e.getAnchorPoint().x}}),cc.LabelBMFont.create=function(e,t,n,r,i){var s=new cc.LabelBMFont;return e===undefined?s&&s.init()?s:null:s&&s.initWithString(e,t,n,r,i)?s:null},cc.LabelBMFont._configurations=null,cc.FNTConfigLoadFile=function(e){cc.LabelBMFont._configurations||(cc.LabelBMFont._configurations={});var t=cc.LabelBMFont._configurations[e];return t||(t=cc.BMFontConfiguration.create(e),cc.LabelBMFont._configurations[e]=t),t},cc.LabelBMFont.purgeCachedData=function(){cc.FNTConfigRemoveCache()},cc.FNTConfigRemoveCache=function(){cc.LabelBMFont._configurations&&(cc.LabelBMFont._configurations=null)},cc.isspace_unicode=function(e){return e=e.charCodeAt(0),e>=9&&e<=13||e==32||e==133||e==160||e==5760||e>=8192&&e<=8202||e==8232||e==8233||e==8239||e==8287||e==12288},cc.utf8_trim_ws=function(e){var t=e.length;if(t<=0)return;var n=t-1;if(cc.isspace_unicode(e[n])){for(var r=n-1;r>=0;--r){if(!cc.isspace_unicode(e[r]))break;n=r}cc.utf8_trim_from(e,n)}},cc.utf8_trim_from=function(e,t){var n=e.length;if(t>=n||t<0)return;e.splice(t,n)},cc.Codec={name:"Jacob__Codec"},cc.unzip=function(){return cc.Codec.GZip.gunzip.apply(cc.Codec.GZip,arguments)},cc.unzipBase64=function(){var e=cc.Codec.Base64.decode.apply(cc.Codec.Base64,arguments);return cc.Codec.GZip.gunzip.apply(cc.Codec.GZip,[e])},cc.unzipBase64AsArray=function(e,t){t=t||1;var n=this.unzipBase64(e),r=[],i,s,o;for(i=0,o=n.length/t;i<o;i++){r[i]=0;for(s=t-1;s>=0;--s)r[i]+=n.charCodeAt(i*t+s)<<s*8}return r},cc.unzipAsArray=function(e,t){t=t||1;var n=this.unzip(e),r=[],i,s,o;for(i=0,o=n.length/t;i<o;i++){r[i]=0;for(s=t-1;s>=0;--s)r[i]+=n.charCodeAt(i*t+s)<<s*8}return r},cc.StringToArray=function(e){var t=e.split(","),n=[],r;for(r=0;r<t.length;r++)n.push(parseInt(t[r]));return n},cc.Codec.Base64={name:"Jacob__Codec__Base64"},cc.Codec.Base64._keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",cc.Codec.Base64.decode=function(t){var n=[],r,i,s,o,u,a,f,l=0;t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(l<t.length)o=this._keyStr.indexOf(t.charAt(l++)),u=this._keyStr.indexOf(t.charAt(l++)),a=this._keyStr.indexOf(t.charAt(l++)),f=this._keyStr.indexOf(t.charAt(l++)),r=o<<2|u>>4,i=(u&15)<<4|a>>2,s=(a&3)<<6|f,n.push(String.fromCharCode(r)),a!=64&&n.push(String.fromCharCode(i)),f!=64&&n.push(String.fromCharCode(s));return n=n.join(""),n},cc.Codec.Base64.decodeAsArray=function(t,n){var r=this.decode(t),i=[],s,o,u;for(s=0,u=r.length/n;s<u;s++){i[s]=0;for(o=n-1;o>=0;--o)i[s]+=r.charCodeAt(s*n+o)<<o*8}return i},cc.uint8ArrayToUint32Array=function(e){if(e.length%4!=0)return null;var t=e.length/4,n=window.Uint32Array?new Uint32Array(t):[];for(var r=0;r<t;r++){var i=r*4;n[r]=e[i]+e[i+1]*256+e[i+2]*65536+e[i+3]*(1<<24)}return n},cc.Codec.GZip=function(t){this.data=t,this.debug=!1,this.gpflags=undefined,this.files=0,this.unzipped=[],this.buf32k=new Array(32768),this.bIdx=0,this.modeZIP=!1,this.bytepos=0,this.bb=1,this.bits=0,this.nameBuf=[],this.fileout=undefined,this.literalTree=new Array(cc.Codec.GZip.LITERALS),this.distanceTree=new Array(32),this.treepos=0,this.Places=null,this.len=0,this.fpos=new Array(17),this.fpos[0]=0,this.flens=undefined,this.fmax=undefined},cc.Codec.GZip.gunzip=function(e){e.constructor!==Array&&e.constructor===String;var t=new cc.Codec.GZip(e);return t.gunzip()[0][0]},cc.Codec.GZip.HufNode=function(){this.b0=0,this.b1=0,this.jump=null,this.jumppos=-1},cc.Codec.GZip.LITERALS=288,cc.Codec.GZip.NAMEMAX=256,cc.Codec.GZip.bitReverse=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254,1,129,65,193,33,161,97,225,17,145,81,209,49,177,113,241,9,137,73,201,41,169,105,233,25,153,89,217,57,185,121,249,5,133,69,197,37,165,101,229,21,149,85,213,53,181,117,245,13,141,77,205,45,173,109,237,29,157,93,221,61,189,125,253,3,131,67,195,35,163,99,227,19,147,83,211,51,179,115,243,11,139,75,203,43,171,107,235,27,155,91,219,59,187,123,251,7,135,71,199,39,167,103,231,23,151,87,215,55,183,119,247,15,143,79,207,47,175,111,239,31,159,95,223,63,191,127,255],cc.Codec.GZip.cplens=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],cc.Codec.GZip.cplext=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99],cc.Codec.GZip.cpdist=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],cc.Codec.GZip.cpdext=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],cc.Codec.GZip.border=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],cc.Codec.GZip.prototype.gunzip=function(){return this.outputArr=[],this.nextFile(),this.unzipped},cc.Codec.GZip.prototype.readByte=function(){return this.bits+=8,this.bytepos<this.data.length?this.data.charCodeAt(this.bytepos++):-1},cc.Codec.GZip.prototype.byteAlign=function(){this.bb=1},cc.Codec.GZip.prototype.readBit=function(){var e;return this.bits++,e=this.bb&1,this.bb>>=1,this.bb==0&&(this.bb=this.readByte(),e=this.bb&1,this.bb=this.bb>>1|128),e},cc.Codec.GZip.prototype.readBits=function(e){var t=0,n=e;while(n--)t=t<<1|this.readBit();return e&&(t=cc.Codec.GZip.bitReverse[t]>>8-e),t},cc.Codec.GZip.prototype.flushBuffer=function(){this.bIdx=0},cc.Codec.GZip.prototype.addBuffer=function(e){this.buf32k[this.bIdx++]=e,this.outputArr.push(String.fromCharCode(e)),this.bIdx==32768&&(this.bIdx=0)},cc.Codec.GZip.prototype.IsPat=function(){for(;;){if(this.fpos[this.len]>=this.fmax)return-1;if(this.flens[this.fpos[this.len]]==this.len)return this.fpos[this.len]++;this.fpos[this.len]++}},cc.Codec.GZip.prototype.Rec=function(){var e=this.Places[this.treepos],t;if(this.len==17)return-1;this.treepos++,this.len++,t=this.IsPat();if(t>=0)e.b0=t;else{e.b0=32768;if(this.Rec())return-1}t=this.IsPat();if(t>=0)e.b1=t,e.jump=null;else{e.b1=32768,e.jump=this.Places[this.treepos],e.jumppos=this.treepos;if(this.Rec())return-1}return this.len--,0},cc.Codec.GZip.prototype.CreateTree=function(e,t,n,r){var i;this.Places=e,this.treepos=0,this.flens=n,this.fmax=t;for(i=0;i<17;i++)this.fpos[i]=0;return this.len=0,this.Rec()?-1:0},cc.Codec.GZip.prototype.DecodeValue=function(e){var t,n,r=0,i=e[r],s;for(;;){s=this.readBit();if(s){if(!(i.b1&32768))return i.b1;i=i.jump,t=e.length;for(n=0;n<t;n++)if(e[n]===i){r=n;break}}else{if(!(i.b0&32768))return i.b0;r++,i=e[r]}}return-1},cc.Codec.GZip.prototype.DeflateLoop=function(){var e,t,n,r,i;do{e=this.readBit(),n=this.readBits(2);if(n==0){var s,o;this.byteAlign(),s=this.readByte(),s|=this.readByte()<<8,o=this.readByte(),o|=this.readByte()<<8,(s^~o)&65535&&document.write("BlockLen checksum mismatch\n");while(s--)t=this.readByte(),this.addBuffer(t)}else if(n==1){var u;for(;;){u=cc.Codec.GZip.bitReverse[this.readBits(7)]>>1,u>23?(u=u<<1|this.readBit(),u>199?(u-=128,u=u<<1|this.readBit()):(u-=48,u>143&&(u+=136))):u+=256;if(u<256)this.addBuffer(u);else{if(u==256)break;var i,a;u-=257,i=this.readBits(cc.Codec.GZip.cplext[u])+cc.Codec.GZip.cplens[u],u=cc.Codec.GZip.bitReverse[this.readBits(5)]>>3,cc.Codec.GZip.cpdext[u]>8?(a=this.readBits(8),a|=this.readBits(cc.Codec.GZip.cpdext[u]-8)<<8):a=this.readBits(cc.Codec.GZip.cpdext[u]),a+=cc.Codec.GZip.cpdist[u];for(u=0;u<i;u++){var t=this.buf32k[this.bIdx-a&32767];this.addBuffer(t)}}}}else if(n==2){var u,f,l,c,h,p=new Array(320);l=257+this.readBits(5),c=1+this.readBits(5),h=4+this.readBits(4);for(u=0;u<19;u++)p[u]=0;for(u=0;u<h;u++)p[cc.Codec.GZip.border[u]]=this.readBits(3);i=this.distanceTree.length;for(r=0;r<i;r++)this.distanceTree[r]=new cc.Codec.GZip.HufNode;if(this.CreateTree(this.distanceTree,19,p,0))return this.flushBuffer(),1;f=l+c,r=0;var d=-1;while(r<f){d++,u=this.DecodeValue(this.distanceTree);if(u<16)p[r++]=u;else if(u==16){var v;u=3+this.readBits(2);if(r+u>f)return this.flushBuffer(),1;v=r?p[r-1]:0;while(u--)p[r++]=v}else{u==17?u=3+this.readBits(3):u=11+this.readBits(7);if(r+u>f)return this.flushBuffer(),1;while(u--)p[r++]=0}}i=this.literalTree.length;for(r=0;r<i;r++)this.literalTree[r]=new cc.Codec.GZip.HufNode;if(this.CreateTree(this.literalTree,l,p,0))return this.flushBuffer(),1;i=this.literalTree.length;for(r=0;r<i;r++)this.distanceTree[r]=new cc.Codec.GZip.HufNode;var m=new Array;for(r=l;r<p.length;r++)m[r-l]=p[r];if(this.CreateTree(this.distanceTree,c,m,0))return this.flushBuffer(),1;for(;;){u=this.DecodeValue(this.literalTree);if(u>=256){var i,a;u-=256;if(u==0)break;u--,i=this.readBits(cc.Codec.GZip.cplext[u])+cc.Codec.GZip.cplens[u],u=this.DecodeValue(this.distanceTree),cc.Codec.GZip.cpdext[u]>8?(a=this.readBits(8),a|=this.readBits(cc.Codec.GZip.cpdext[u]-8)<<8):a=this.readBits(cc.Codec.GZip.cpdext[u]),a+=cc.Codec.GZip.cpdist[u];while(i--){var t=this.buf32k[this.bIdx-a&32767];this.addBuffer(t)}}else this.addBuffer(u)}}}while(!e);return this.flushBuffer(),this.byteAlign(),0},cc.Codec.GZip.prototype.unzipFile=function(e){var t;this.gunzip();for(t=0;t<this.unzipped.length;t++)if(this.unzipped[t][1]==e)return this.unzipped[t][0]},cc.Codec.GZip.prototype.nextFile=function(){this.outputArr=[],this.modeZIP=!1;var e=[];e[0]=this.readByte(),e[1]=this.readByte(),e[0]==120&&e[1]==218&&(this.DeflateLoop(),this.unzipped[this.files]=[this.outputArr.join(""),"geonext.gxt"],this.files++),e[0]==31&&e[1]==139&&(this.skipdir(),this.unzipped[this.files]=[this.outputArr.join(""),"file"],this.files++);if(e[0]==80&&e[1]==75){this.modeZIP=!0,e[2]=this.readByte(),e[3]=this.readByte();if(e[2]==3&&e[3]==4){e[0]=this.readByte(),e[1]=this.readByte(),this.gpflags=this.readByte(),this.gpflags|=this.readByte()<<8;var t=this.readByte();t|=this.readByte()<<8,this.readByte(),this.readByte(),this.readByte(),this.readByte();var n=this.readByte();n|=this.readByte()<<8,n|=this.readByte()<<16,n|=this.readByte()<<24;var r=this.readByte();r|=this.readByte()<<8,r|=this.readByte()<<16,r|=this.readByte()<<24;var i=this.readByte();i|=this.readByte()<<8;var s=this.readByte();s|=this.readByte()<<8,u=0,this.nameBuf=[];while(i--){var o=this.readByte();o=="/"|o==":"?u=0:u<cc.Codec.GZip.NAMEMAX-1&&(this.nameBuf[u++]=String.fromCharCode(o))}this.fileout||(this.fileout=this.nameBuf);var u=0;while(u<s)o=this.readByte(),u++;t==8&&(this.DeflateLoop(),this.unzipped[this.files]=[this.outputArr.join(""),this.nameBuf.join("")],this.files++),this.skipdir()}}},cc.Codec.GZip.prototype.skipdir=function(){var e=[],t,n,r,i,s;this.gpflags&8&&(e[0]=this.readByte(),e[1]=this.readByte(),e[2]=this.readByte(),e[3]=this.readByte(),t=this.readByte(),t|=this.readByte()<<8,t|=this.readByte()<<16,t|=this.readByte()<<24,n=this.readByte(),n|=this.readByte()<<8,n|=this.readByte()<<16,n|=this.readByte()<<24),this.modeZIP&&this.nextFile(),e[0]=this.readByte();if(e[0]!=8)return 0;this.gpflags=this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),r=this.readByte();if(this.gpflags&4){e[0]=this.readByte(),e[2]=this.readByte(),this.len=e[0]+256*e[1];for(i=0;i<this.len;i++)this.readByte()}if(this.gpflags&8){i=0,this.nameBuf=[];while(s=this.readByte()){if(s=="7"||s==":")i=0;i<cc.Codec.GZip.NAMEMAX-1&&(this.nameBuf[i++]=s)}}if(this.gpflags&16)while(s=this.readByte());this.gpflags&2&&(this.readByte(),this.readByte()),this.DeflateLoop(),n=this.readByte(),n|=this.readByte()<<8,n|=this.readByte()<<16,n|=this.readByte()<<24,this.modeZIP&&this.nextFile()},function(){"use strict";function e(e){throw e}function i(e,n){var i=e.split("."),s=r;!(i[0]in s)&&s.execScript&&s.execScript("var "+i[0]);for(var o;i.length&&(o=i.shift());)!i.length&&n!==t?s[o]=n:s=s[o]?s[o]:s[o]={}}function o(e){if("string"==typeof e){var t=e.split(""),n,r;n=0;for(r=t.length;n<r;n++)t[n]=(t[n].charCodeAt(0)&255)>>>0;e=t}for(var i=1,s=0,o=e.length,u,a=0;0<o;){u=1024<o?1024:o,o-=u;do i+=e[a++],s+=i;while(--u);i%=65521,s%=65521}return(s<<16|i)>>>0}function u(t,n){this.index="number"==typeof n?n:0,this.i=0,this.buffer=t instanceof(s?Uint8Array:Array)?t:new(s?Uint8Array:Array)(32768),2*this.buffer.length<=this.index&&e(Error("invalid index")),this.buffer.length<=this.index&&this.f()}function v(e){this.buffer=new(s?Uint16Array:Array)(2*e),this.length=0}function m(e){var t=e.length,n=0,r=Number.POSITIVE_INFINITY,i,o,u,a,f,l,c,h,p;for(h=0;h<t;++h)e[h]>n&&(n=e[h]),e[h]<r&&(r=e[h]);i=1<<n,o=new(s?Uint32Array:Array)(i),u=1,a=0;for(f=2;u<=n;){for(h=0;h<t;++h)if(e[h]===u){l=0,c=a;for(p=0;p<u;++p)l=l<<1|c&1,c>>=1;for(p=l;p<i;p+=f)o[p]=u<<16|h;++a}++u,a<<=1,f<<=1}return[o,n,r]}function g(e,t){this.h=y,this.w=0,this.input=e,this.b=0,t&&(t.lazy&&(this.w=t.lazy),"number"==typeof t.compressionType&&(this.h=t.compressionType),t.outputBuffer&&(this.a=s&&t.outputBuffer instanceof Array?new Uint8Array(t.outputBuffer):t.outputBuffer),"number"==typeof t.outputIndex&&(this.b=t.outputIndex)),this.a||(this.a=new(s?Uint8Array:Array)(32768))}function S(e,t){this.length=e,this.G=t}function x(){var t=N;switch(n){case 3===t:return[257,t-3,0];case 4===t:return[258,t-4,0];case 5===t:return[259,t-5,0];case 6===t:return[260,t-6,0];case 7===t:return[261,t-7,0];case 8===t:return[262,t-8,0];case 9===t:return[263,t-9,0];case 10===t:return[264,t-10,0];case 12>=t:return[265,t-11,1];case 14>=t:return[266,t-13,1];case 16>=t:return[267,t-15,1];case 18>=t:return[268,t-17,1];case 22>=t:return[269,t-19,2];case 26>=t:return[270,t-23,2];case 30>=t:return[271,t-27,2];case 34>=t:return[272,t-31,2];case 42>=t:return[273,t-35,3];case 50>=t:return[274,t-43,3];case 58>=t:return[275,t-51,3];case 66>=t:return[276,t-59,3];case 82>=t:return[277,t-67,4];case 98>=t:return[278,t-83,4];case 114>=t:return[279,t-99,4];case 130>=t:return[280,t-115,4];case 162>=t:return[281,t-131,5];case 194>=t:return[282,t-163,5];case 226>=t:return[283,t-195,5];case 257>=t:return[284,t-227,5];case 258===t:return[285,t-258,0];default:e("invalid length: "+t)}}function L(r,i){function o(t,r){var i=t.G,s=[],o=0,u;u=k[t.length],s[o++]=u&65535,s[o++]=u>>16&255,s[o++]=u>>24;var a;switch(n){case 1===i:a=[0,i-1,0];break;case 2===i:a=[1,i-2,0];break;case 3===i:a=[2,i-3,0];break;case 4===i:a=[3,i-4,0];break;case 6>=i:a=[4,i-5,1];break;case 8>=i:a=[5,i-7,1];break;case 12>=i:a=[6,i-9,2];break;case 16>=i:a=[7,i-13,2];break;case 24>=i:a=[8,i-17,3];break;case 32>=i:a=[9,i-25,3];break;case 48>=i:a=[10,i-33,4];break;case 64>=i:a=[11,i-49,4];break;case 96>=i:a=[12,i-65,5];break;case 128>=i:a=[13,i-97,5];break;case 192>=i:a=[14,i-129,6];break;case 256>=i:a=[15,i-193,6];break;case 384>=i:a=[16,i-257,7];break;case 512>=i:a=[17,i-385,7];break;case 768>=i:a=[18,i-513,8];break;case 1024>=i:a=[19,i-769,8];break;case 1536>=i:a=[20,i-1025,9];break;case 2048>=i:a=[21,i-1537
,9];break;case 3072>=i:a=[22,i-2049,10];break;case 4096>=i:a=[23,i-3073,10];break;case 6144>=i:a=[24,i-4097,11];break;case 8192>=i:a=[25,i-6145,11];break;case 12288>=i:a=[26,i-8193,12];break;case 16384>=i:a=[27,i-12289,12];break;case 24576>=i:a=[28,i-16385,13];break;case 32768>=i:a=[29,i-24577,13];break;default:e("invalid distance")}u=a,s[o++]=u[0],s[o++]=u[1],s[o++]=u[2];var f,l;f=0;for(l=s.length;f<l;++f)m[g++]=s[f];b[s[0]]++,w[s[3]]++,y=t.length+r-1,v=null}var u,a,f,l,c,h={},p,d,v,m=s?new Uint16Array(2*i.length):[],g=0,y=0,b=new(s?Uint32Array:Array)(286),w=new(s?Uint32Array:Array)(30),E=r.w,x;if(!s){for(f=0;285>=f;)b[f++]=0;for(f=0;29>=f;)w[f++]=0}b[256]=1,u=0;for(a=i.length;u<a;++u){f=c=0;for(l=3;f<l&&u+f!==a;++f)c=c<<8|i[u+f];h[c]===t&&(h[c]=[]),p=h[c];if(!(0<y--)){for(;0<p.length&&32768<u-p[0];)p.shift();if(u+3>=a){v&&o(v,-1),f=0;for(l=a-u;f<l;++f)x=i[u+f],m[g++]=x,++b[x];break}if(0<p.length){var T=t,N=t,C=0,L=t,A=t,O=t,M=t,_=i.length,A=0,M=p.length;e:for(;A<M;A++){T=p[M-A-1],L=3;if(3<C){for(O=C;3<O;O--)if(i[T+O-1]!==i[u+O-1])continue e;L=C}for(;258>L&&u+L<_&&i[T+L]===i[u+L];)++L;L>C&&(N=T,C=L);if(258===L)break}d=new S(C,u-N),v?v.length<d.length?(x=i[u-1],m[g++]=x,++b[x],o(d,0)):o(v,-1):d.length<E?v=d:o(d,0)}else v?o(v,-1):(x=i[u],m[g++]=x,++b[x])}p.push(u)}return m[g++]=256,b[256]++,r.L=b,r.K=w,s?m.subarray(0,g):m}function A(e,t){function n(e){var t=y[e][b[e]];t===h?(n(e+1),n(e+1)):--m[t],++b[e]}var r=e.length,i=new v(572),o=new(s?Uint8Array:Array)(r),u,a,f,l,c;if(!s)for(l=0;l<r;l++)o[l]=0;for(l=0;l<r;++l)0<e[l]&&i.push(l,e[l]);u=Array(i.length/2),a=new(s?Uint32Array:Array)(i.length/2);if(1===u.length)return o[i.pop().index]=1,o;l=0;for(c=i.length/2;l<c;++l)u[l]=i.pop(),a[l]=u[l].value;var h=a.length,p=new(s?Uint16Array:Array)(t),d=new(s?Uint8Array:Array)(t),m=new(s?Uint8Array:Array)(h),g=Array(t),y=Array(t),b=Array(t),w=(1<<t)-h,E=1<<t-1,S,x,T,N,C;p[t-1]=h;for(x=0;x<t;++x)w<E?d[x]=0:(d[x]=1,w-=E),w<<=1,p[t-2-x]=(p[t-1-x]/2|0)+h;p[0]=d[0],g[0]=Array(p[0]),y[0]=Array(p[0]);for(x=1;x<t;++x)p[x]>2*p[x-1]+d[x]&&(p[x]=2*p[x-1]+d[x]),g[x]=Array(p[x]),y[x]=Array(p[x]);for(S=0;S<h;++S)m[S]=t;for(T=0;T<p[t-1];++T)g[t-1][T]=a[T],y[t-1][T]=T;for(S=0;S<t;++S)b[S]=0;1===d[t-1]&&(--m[0],++b[t-1]);for(x=t-2;0<=x;--x){N=S=0,C=b[x+1];for(T=0;T<p[x];T++)N=g[x+1][C]+g[x+1][C+1],N>a[S]?(g[x][T]=N,y[x][T]=h,C+=2):(g[x][T]=a[S],y[x][T]=S,++S);b[x]=0,1===d[x]&&n(x)}f=m,l=0;for(c=u.length;l<c;++l)o[u[l].index]=f[l];return o}function O(t){var n=new(s?Uint16Array:Array)(t.length),r=[],i=[],o=0,u,a,f,l;u=0;for(a=t.length;u<a;u++)r[t[u]]=(r[t[u]]|0)+1;u=1;for(a=16;u<=a;u++)i[u]=o,o+=r[u]|0,o>1<<u&&e("overcommitted"),o<<=1;65536>o&&e("undercommitted"),u=0;for(a=t.length;u<a;u++){o=i[t[u]],i[t[u]]+=1,f=n[u]=0;for(l=t[u];f<l;f++)n[u]=n[u]<<1|o&1,o>>>=1}return n}function M(e,t){this.input=e,this.a=new(s?Uint8Array:Array)(32768),this.h=_.j;var n={},r;(t||!(t={}))&&"number"==typeof t.compressionType&&(this.h=t.compressionType);for(r in t)n[r]=t[r];n.outputBuffer=this.a,this.z=new g(this.input,n)}function D(t,n){this.k=[],this.l=32768,this.e=this.g=this.c=this.q=0,this.input=s?new Uint8Array(t):t,this.s=!1,this.m=H,this.B=!1;if(n||!(n={}))n.index&&(this.c=n.index),n.bufferSize&&(this.l=n.bufferSize),n.bufferType&&(this.m=n.bufferType),n.resize&&(this.B=n.resize);switch(this.m){case P:this.b=32768,this.a=new(s?Uint8Array:Array)(32768+this.l+258);break;case H:this.b=0,this.a=new(s?Uint8Array:Array)(this.l),this.f=this.J,this.t=this.H,this.o=this.I;break;default:e(Error("invalid inflate mode"))}}function tt(n,r){for(var i=n.g,s=n.e,o=n.input,u=n.c,a;s<r;)a=o[u++],a===t&&e(Error("input buffer is broken")),i|=a<<s,s+=8;return a=i&(1<<r)-1,n.g=i>>>r,n.e=s-r,n.c=u,a}function nt(n,r){for(var i=n.g,s=n.e,o=n.input,u=n.c,a=r[0],f=r[1],l,c,h;s<f;)l=o[u++],l===t&&e(Error("input buffer is broken")),i|=l<<s,s+=8;return c=a[i&(1<<f)-1],h=c>>>16,n.g=i>>h,n.e=s-h,n.c=u,c&65535}function rt(e){function t(e,t,n){var r,i,s,o;for(o=0;o<e;)switch(r=nt(this,t),r){case 16:for(s=3+tt(this,2);s--;)n[o++]=i;break;case 17:for(s=3+tt(this,3);s--;)n[o++]=0;i=0;break;case 18:for(s=11+tt(this,7);s--;)n[o++]=0;i=0;break;default:i=n[o++]=r}return n}var n=tt(e,5)+257,r=tt(e,5)+1,i=tt(e,4)+4,o=new(s?Uint8Array:Array)(F.length),u,a,f,l;for(l=0;l<i;++l)o[F[l]]=tt(e,3);u=m(o),a=new(s?Uint8Array:Array)(n),f=new(s?Uint8Array:Array)(r),e.o(m(t.call(e,n,u,a)),m(t.call(e,r,u,f)))}function it(t,n){var r,i;this.input=t,this.c=0;if(n||!(n={}))n.index&&(this.c=n.index),n.verify&&(this.M=n.verify);r=t[this.c++],i=t[this.c++];switch(r&15){case mt:this.method=mt;break;default:e(Error("unsupported compression method"))}0!==((r<<8)+i)%31&&e(Error("invalid fcheck flag:"+((r<<8)+i)%31)),i&32&&e(Error("fdict flag is not supported")),this.A=new D(t,{index:this.c,bufferSize:n.bufferSize,bufferType:n.bufferType,resize:n.resize})}var t=void 0,n=!0,r=this,s="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array;u.prototype.f=function(){var e=this.buffer,t,n=e.length,r=new(s?Uint8Array:Array)(n<<1);if(s)r.set(e);else for(t=0;t<n;++t)r[t]=e[t];return this.buffer=r},u.prototype.d=function(e,t,n){var r=this.buffer,i=this.index,s=this.i,o=r[i],u;n&&1<t&&(e=8<t?(p[e&255]<<24|p[e>>>8&255]<<16|p[e>>>16&255]<<8|p[e>>>24&255])>>32-t:p[e]>>8-t);if(8>t+s)o=o<<t|e,s+=t;else for(u=0;u<t;++u)o=o<<1|e>>t-u-1&1,8===++s&&(s=0,r[i++]=p[o],o=0,i===r.length&&(r=this.f()));r[i]=o,this.buffer=r,this.i=s,this.index=i},u.prototype.finish=function(){var e=this.buffer,t=this.index,n;return 0<this.i&&(e[t]<<=8-this.i,e[t]=p[e[t]],t++),s?n=e.subarray(0,t):(e.length=t,n=e),n};var a=new(s?Uint8Array:Array)(256),f;for(f=0;256>f;++f){for(var l=f,c=l,h=7,l=l>>>1;l;l>>>=1)c<<=1,c|=l&1,--h;a[f]=(c<<h&255)>>>0}var p=a,d=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];s&&new Uint32Array(d),v.prototype.getParent=function(e){return 2*((e-2)/4|0)},v.prototype.push=function(e,t){var n,r,i=this.buffer,s;n=this.length,i[this.length++]=t;for(i[this.length++]=e;0<n;){if(r=this.getParent(n),!(i[n]>i[r]))break;s=i[n],i[n]=i[r],i[r]=s,s=i[n+1],i[n+1]=i[r+1],i[r+1]=s,n=r}return this.length},v.prototype.pop=function(){var e,t,n=this.buffer,r,i,s;t=n[0],e=n[1],this.length-=2,n[0]=n[this.length],n[1]=n[this.length+1];for(s=0;;){i=2*s+2;if(i>=this.length)break;i+2<this.length&&n[i+2]>n[i]&&(i+=2);if(!(n[i]>n[s]))break;r=n[s],n[s]=n[i],n[i]=r,r=n[s+1],n[s+1]=n[i+1],n[i+1]=r,s=i}return{index:e,value:t,length:this.length}};var y=2,b={NONE:0,r:1,j:y,N:3},w=[],E;for(E=0;288>E;E++)switch(n){case 143>=E:w.push([E+48,8]);break;case 255>=E:w.push([E-144+400,9]);break;case 279>=E:w.push([E-256+0,7]);break;case 287>=E:w.push([E-280+192,8]);break;default:e("invalid literal: "+E)}g.prototype.n=function(){var r,i,o,a,f=this.input;switch(this.h){case 0:o=0;for(a=f.length;o<a;){i=s?f.subarray(o,o+65535):f.slice(o,o+65535),o+=i.length;var l=i,c=o===a,h=t,p=t,d=t,v=t,m=t,g=this.a,b=this.b;if(s){for(g=new Uint8Array(this.a.buffer);g.length<=b+l.length+5;)g=new Uint8Array(g.length<<1);g.set(this.a)}h=c?1:0,g[b++]=h|0,p=l.length,d=~p+65536&65535,g[b++]=p&255,g[b++]=p>>>8&255,g[b++]=d&255,g[b++]=d>>>8&255;if(s)g.set(l,b),b+=l.length,g=g.subarray(0,b);else{v=0;for(m=l.length;v<m;++v)g[b++]=l[v];g.length=b}this.b=b,this.a=g}break;case 1:var E=new u(new Uint8Array(this.a.buffer),this.b);E.d(1,1,n),E.d(1,2,n);var S=L(this,f),x,T,N;x=0;for(T=S.length;x<T;x++)if(N=S[x],u.prototype.d.apply(E,w[N]),256<N)E.d(S[++x],S[++x],n),E.d(S[++x],5),E.d(S[++x],S[++x],n);else if(256===N)break;this.a=E.finish(),this.b=this.a.length;break;case y:var C=new u(new Uint8Array(this.a),this.b),k,M,_,D,P,H=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],B,j,F,I,q,R=Array(19),U,z,W,X,V;k=y,C.d(1,1,n),C.d(k,2,n),M=L(this,f),B=A(this.L,15),j=O(B),F=A(this.K,7),I=O(F);for(_=286;257<_&&0===B[_-1];_--);for(D=30;1<D&&0===F[D-1];D--);var $=_,J=D,K=new(s?Uint32Array:Array)($+J),Q,G,Y,Z,et=new(s?Uint32Array:Array)(316),tt,nt,rt=new(s?Uint8Array:Array)(19);for(Q=G=0;Q<$;Q++)K[G++]=B[Q];for(Q=0;Q<J;Q++)K[G++]=F[Q];if(!s){Q=0;for(Z=rt.length;Q<Z;++Q)rt[Q]=0}Q=tt=0;for(Z=K.length;Q<Z;Q+=G){for(G=1;Q+G<Z&&K[Q+G]===K[Q];++G);Y=G;if(0===K[Q])if(3>Y)for(;0<Y--;)et[tt++]=0,rt[0]++;else for(;0<Y;)nt=138>Y?Y:138,nt>Y-3&&nt<Y&&(nt=Y-3),10>=nt?(et[tt++]=17,et[tt++]=nt-3,rt[17]++):(et[tt++]=18,et[tt++]=nt-11,rt[18]++),Y-=nt;else if(et[tt++]=K[Q],rt[K[Q]]++,Y--,3>Y)for(;0<Y--;)et[tt++]=K[Q],rt[K[Q]]++;else for(;0<Y;)nt=6>Y?Y:6,nt>Y-3&&nt<Y&&(nt=Y-3),et[tt++]=16,et[tt++]=nt-3,rt[16]++,Y-=nt}r=s?et.subarray(0,tt):et.slice(0,tt),q=A(rt,7);for(X=0;19>X;X++)R[X]=q[H[X]];for(P=19;4<P&&0===R[P-1];P--);U=O(q),C.d(_-257,5,n),C.d(D-1,5,n),C.d(P-4,4,n);for(X=0;X<P;X++)C.d(R[X],3,n);X=0;for(V=r.length;X<V;X++)if(z=r[X],C.d(U[z],q[z],n),16<=z){X++;switch(z){case 16:W=2;break;case 17:W=3;break;case 18:W=7;break;default:e("invalid code: "+z)}C.d(r[X],W,n)}var it=[j,B],st=[I,F],ot,ut,at,ft,lt,ct,ht,pt;lt=it[0],ct=it[1],ht=st[0],pt=st[1],ot=0;for(ut=M.length;ot<ut;++ot)if(at=M[ot],C.d(lt[at],ct[at],n),256<at)C.d(M[++ot],M[++ot],n),ft=M[++ot],C.d(ht[ft],pt[ft],n),C.d(M[++ot],M[++ot],n);else if(256===at)break;this.a=C.finish(),this.b=this.a.length;break;default:e("invalid compression type")}return this.a};var T=[],N,C;for(N=3;258>=N;N++)C=x(),T[N]=C[2]<<24|C[1]<<16|C[0];var k=s?new Uint32Array(T):T,_=b;M.prototype.n=function(){var t,n,r,i,u,a,f,l=0;f=this.a,t=mt;switch(t){case mt:n=Math.LOG2E*Math.log(32768)-8;break;default:e(Error("invalid compression method"))}r=n<<4|t,f[l++]=r;switch(t){case mt:switch(this.h){case _.NONE:u=0;break;case _.r:u=1;break;case _.j:u=2;break;default:e(Error("unsupported compression type"))}break;default:e(Error("invalid compression method"))}return i=u<<6|0,f[l++]=i|31-(256*r+i)%31,a=o(this.input),this.z.b=l,f=this.z.n(),l=f.length,s&&(f=new Uint8Array(f.buffer),f.length<=l+4&&(this.a=new Uint8Array(f.length+4),this.a.set(f),f=this.a),f=f.subarray(0,l+4)),f[l++]=a>>24&255,f[l++]=a>>16&255,f[l++]=a>>8&255,f[l++]=a&255,f},i("Zlib.Deflate",M),i("Zlib.Deflate.compress",function(e,t){return(new M(e,t)).n()}),i("Zlib.Deflate.CompressionType",_),i("Zlib.Deflate.CompressionType.NONE",_.NONE),i("Zlib.Deflate.CompressionType.FIXED",_.r),i("Zlib.Deflate.CompressionType.DYNAMIC",_.j);var P=0,H=1,B={D:P,C:H};D.prototype.p=function(){for(;!this.s;){var r=tt(this,3);r&1&&(this.s=n),r>>>=1;switch(r){case 0:var i=this.input,o=this.c,u=this.a,a=this.b,f=t,l=t,c=t,h=u.length,p=t;this.e=this.g=0,f=i[o++],f===t&&e(Error("invalid uncompressed block header: LEN (first byte)")),l=f,f=i[o++],f===t&&e(Error("invalid uncompressed block header: LEN (second byte)")),l|=f<<8,f=i[o++],f===t&&e(Error("invalid uncompressed block header: NLEN (first byte)")),c=f,f=i[o++],f===t&&e(Error("invalid uncompressed block header: NLEN (second byte)")),c|=f<<8,l===~c&&e(Error("invalid uncompressed block header: length verify")),o+l>i.length&&e(Error("input buffer is broken"));switch(this.m){case P:for(;a+l>u.length;){p=h-a,l-=p;if(s)u.set(i.subarray(o,o+p),a),a+=p,o+=p;else for(;p--;)u[a++]=i[o++];this.b=a,u=this.f(),a=this.b}break;case H:for(;a+l>u.length;)u=this.f({v:2});break;default:e(Error("invalid inflate mode"))}if(s)u.set(i.subarray(o,o+l),a),a+=l,o+=l;else for(;l--;)u[a++]=i[o++];this.c=o,this.b=a,this.a=u;break;case 1:this.o(Q,et);break;case 2:rt(this);break;default:e(Error("unknown BTYPE: "+r))}}return this.t()};var j=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],F=s?new Uint16Array(j):j,I=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],q=s?new Uint16Array(I):I,R=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],U=s?new Uint8Array(R):R,z=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],W=s?new Uint16Array(z):z,X=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],V=s?new Uint8Array(X):X,$=new(s?Uint8Array:Array)(288),J,K;J=0;for(K=$.length;J<K;++J)$[J]=143>=J?8:255>=J?9:279>=J?7:8;var Q=m($),G=new(s?Uint8Array:Array)(30),Y,Z;Y=0;for(Z=G.length;Y<Z;++Y)G[Y]=5;var et=m(G);D.prototype.o=function(e,t){var n=this.a,r=this.b;this.u=e;for(var i=n.length-258,s,o,u,a;256!==(s=nt(this,e));)if(256>s)r>=i&&(this.b=r,n=this.f(),r=this.b),n[r++]=s;else{o=s-257,a=q[o],0<U[o]&&(a+=tt(this,U[o])),s=nt(this,t),u=W[s],0<V[s]&&(u+=tt(this,V[s])),r>=i&&(this.b=r,n=this.f(),r=this.b);for(;a--;)n[r]=n[r++ -u]}for(;8<=this.e;)this.e-=8,this.c--;this.b=r},D.prototype.I=function(e,t){var n=this.a,r=this.b;this.u=e;for(var i=n.length,s,o,u,a;256!==(s=nt(this,e));)if(256>s)r>=i&&(n=this.f(),i=n.length),n[r++]=s;else{o=s-257,a=q[o],0<U[o]&&(a+=tt(this,U[o])),s=nt(this,t),u=W[s],0<V[s]&&(u+=tt(this,V[s])),r+a>i&&(n=this.f(),i=n.length);for(;a--;)n[r]=n[r++ -u]}for(;8<=this.e;)this.e-=8,this.c--;this.b=r},D.prototype.f=function(){var e=new(s?Uint8Array:Array)(this.b-32768),t=this.b-32768,n,r,i=this.a;if(s)e.set(i.subarray(32768,e.length));else{n=0;for(r=e.length;n<r;++n)e[n]=i[n+32768]}this.k.push(e),this.q+=e.length;if(s)i.set(i.subarray(t,t+32768));else for(n=0;32768>n;++n)i[n]=i[t+n];return this.b=32768,i},D.prototype.J=function(e){var t,n=this.input.length/this.c+1|0,r,i,o,u=this.input,a=this.a;return e&&("number"==typeof e.v&&(n=e.v),"number"==typeof e.F&&(n+=e.F)),2>n?(r=(u.length-this.c)/this.u[2],o=258*(r/2)|0,i=o<a.length?a.length+o:a.length<<1):i=a.length*n,s?(t=new Uint8Array(i),t.set(a)):t=a,this.a=t},D.prototype.t=function(){var e=0,t=this.a,n=this.k,r,i=new(s?Uint8Array:Array)(this.q+(this.b-32768)),o,u,a,f;if(0===n.length)return s?this.a.subarray(32768,this.b):this.a.slice(32768,this.b);o=0;for(u=n.length;o<u;++o){r=n[o],a=0;for(f=r.length;a<f;++a)i[e++]=r[a]}o=32768;for(u=this.b;o<u;++o)i[e++]=t[o];return this.k=[],this.buffer=i},D.prototype.H=function(){var e,t=this.b;return s?this.B?(e=new Uint8Array(t),e.set(this.a.subarray(0,t))):e=this.a.subarray(0,t):(this.a.length>t&&(this.a.length=t),e=this.a),this.buffer=e},it.prototype.p=function(){var t=this.input,n,r;return n=this.A.p(),this.c=this.A.c,this.M&&(r=(t[this.c++]<<24|t[this.c++]<<16|t[this.c++]<<8|t[this.c++])>>>0,r!==o(n)&&e(Error("invalid adler-32 checksum"))),n},i("Zlib.Inflate",it),i("Zlib.Inflate.BufferType",B),B.ADAPTIVE=B.C,B.BLOCK=B.D,i("Zlib.Inflate.prototype.decompress",it.prototype.p);var st=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];s&&new Uint16Array(st);var ot=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258];s&&new Uint16Array(ot);var ut=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0];s&&new Uint8Array(ut);var at=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577];s&&new Uint16Array(at);var ft=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];s&&new Uint8Array(ft);var lt=new(s?Uint8Array:Array)(288),ct,ht;ct=0;for(ht=lt.length;ct<ht;++ct)lt[ct]=143>=ct?8:255>=ct?9:279>=ct?7:8;m(lt);var pt=new(s?Uint8Array:Array)(30),dt,vt;dt=0;for(vt=pt.length;dt<vt;++dt)pt[dt]=5;m(pt);var mt=8}.call(this),cc.PNGReader=cc.Class.extend({ctor:function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d;this.data=e,this.pos=8,this.palette=[],this.imgData=[],this.transparency={},this.animation=null,this.text={},s=null;for(;;){t=this.readUInt32(),f=function(){var e,t;t=[];for(o=e=0;e<4;o=++e)t.push(String.fromCharCode(this.data[this.pos++]));return t}.call(this).join("");switch(f){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||Infinity,frames:[]};break;case"PLTE":this.palette=this.read(t);break;case"fcTL":s&&this.animation.frames.push(s),this.pos+=4,s={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()},i=this.readUInt16(),r=this.readUInt16()||100,s.delay=1e3*i/r,s.disposeOp=this.data[this.pos++],s.blendOp=this.data[this.pos++],s.data=[];break;case"IDAT":case"fdAT":f==="fdAT"&&(this.pos+=4,t-=4),e=(s!=null?s.data:void 0)||this.imgData;for(o=h=0;0<=t?h<t:h>t;o=0<=t?++h:--h)e.push(this.data[this.pos++]);break;case"tRNS":this.transparency={};switch(this.colorType){case 3:this.transparency.indexed=this.read(t),l=255-this.transparency.indexed.length;if(l>0)for(o=p=0;0<=l?p<l:p>l;o=0<=l?++p:--p)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(t)[0];break;case 2:this.transparency.rgb=this.read(t)}break;case"tEXt":c=this.read(t),u=c.indexOf(0),a=String.fromCharCode.apply(String,c.slice(0,u)),this.text[a]=String.fromCharCode.apply(String,c.slice(u+1));break;case"IEND":s&&this.animation.frames.push(s),this.colors=function(){switch(this.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}.call(this),this.hasAlphaChannel=(d=this.colorType)===4||d===6,n=this.colors+(this.hasAlphaChannel?1:0),this.pixelBitlength=this.bits*n,this.colorSpace=function(){switch(this.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}.call(this),Uint8Array!=Array&&(this.imgData=new Uint8Array(this.imgData));return;default:this.pos+=t}this.pos+=4;if(this.pos>this.data.length)throw new Error("Incomplete or corrupt PNG file")}},read:function(e){var t,n,r;r=[];for(t=n=0;0<=e?n<e:n>e;t=0<=e?++n:--n)r.push(this.data[this.pos++]);return r},readUInt32:function(){var e,t,n,r;return e=this.data[this.pos++]<<24,t=this.data[this.pos++]<<16,n=this.data[this.pos++]<<8,r=this.data[this.pos++],e|t|n|r},readUInt16:function(){var e,t;return e=this.data[this.pos++]<<8,t=this.data[this.pos++],e|t},decodePixels:function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x;e==null&&(e=this.imgData);if(e.length===0)return new Uint8Array(0);var T=new Zlib.Inflate(e,{index:0,verify:!1});e=T.decompress(),h=this.pixelBitlength/8,m=h*this.width,p=new Uint8Array(m*this.height),o=e.length,v=0,d=0,n=0;while(d<o){switch(e[d++]){case 0:for(i=b=0;b<m;i=b+=1)p[n++]=e[d++];break;case 1:for(i=w=0;w<m;i=w+=1)t=e[d++],s=i<h?0:p[n-h],p[n++]=(t+s)%256;break;case 2:for(i=E=0;E<m;i=E+=1)t=e[d++],r=(i-i%h)/h,g=v&&p[(v-1)*m+r*h+i%h],p[n++]=(g+t)%256;break;case 3:for(i=S=0;S<m;i=S+=1)t=e[d++],r=(i-i%h)/h,s=i<h?0:p[n-h],g=v&&p[(v-1)*m+r*h+i%h],p[n++]=(t+Math.floor((s+g)/2))%256;break;case 4:for(i=x=0;x<m;i=x+=1)t=e[d++],r=(i-i%h)/h,s=i<h?0:p[n-h],v===0?g=y=0:(g=p[(v-1)*m+r*h+i%h],y=r&&p[(v-1)*m+(r-1)*h+i%h]),u=s+g-y,a=Math.abs(u-s),l=Math.abs(u-g),c=Math.abs(u-y),a<=l&&a<=c?f=s:l<=c?f=g:f=y,p[n++]=(t+f)%256;break;default:throw new Error("Invalid filter algorithm: "+e[d-1])}v++}return p},copyToImageData:function(e,t){var n,r,i,s,o,u,a,f,l,c,h;r=this.colors,l=null,n=this.hasAlphaChannel,this.palette.length&&(l=(h=this._decodedPalette)!=null?h:this._decodedPalette=this.decodePalette(),r=4,n=!0),i=e.data||e,f=i.length,o=l||t,s=u=0;if(r===1)while(s<f)a=l?t[s/4]*4:u,c=o[a++],i[s++]=c,i[s++]=c,i[s++]=c,i[s++]=n?o[a++]:255,u=a;else while(s<f)a=l?t[s/4]*4:u,i[s++]=o[a++],i[s++]=o[a++],i[s++]=o[a++],i[s++]=n?o[a++]:255,u=a},decodePalette:function(){var e,t,n,r,i,s,o,u,a;n=this.palette,s=this.transparency.indexed||[],i=new Uint8Array((s.length||0)+n.length),r=0,e=0;for(t=o=0,u=n.length;o<u;t=o+=3)i[r++]=n[t],i[r++]=n[t+1],i[r++]=n[t+2],i[r++]=(a=s[e++])!=null?a:255;return i},render:function(e){var t,n;return e.width=this.width,e.height=this.height,t=e.getContext("2d"),n=t.createImageData(this.width,this.height),this.copyToImageData(n,this.decodePixels()),t.putImageData(n,0,0)}}),cc.TIFFReader=cc.Class.extend({_littleEndian:!1,_tiffData:null,_fileDirectories:null,ctor:function(){this._fileDirectories=[]},getUint8:function(e){return this._tiffData[e]},getUint16:function(e){return this._littleEndian?this._tiffData[e+1]<<8|this._tiffData[e]:this._tiffData[e]<<8|this._tiffData[e+1]},getUint32:function(e){var t=this._tiffData;return this._littleEndian?t[e+3]<<24|t[e+2]<<16|t[e+1]<<8|t[e]:t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3]},checkLittleEndian:function(){var e=this.getUint16(0);if(e===18761)this.littleEndian=!0;else{if(e!==19789)throw console.log(e),TypeError("Invalid byte order value.");this.littleEndian=!1}return this.littleEndian},hasTowel:function(){if(this.getUint16(2)!==42)throw RangeError("You forgot your towel!");return!0},getFieldTypeName:function(e){var t=this.fieldTypeNames;return e in t?t[e]:null},getFieldTagName:function(e){var t=this.fieldTagNames;return e in t?t[e]:(console.log("Unknown Field Tag:",e),"Tag"+e)},getFieldTypeLength:function(e){return["BYTE","ASCII","SBYTE","UNDEFINED"].indexOf(e)!==-1?1:["SHORT","SSHORT"].indexOf(e)!==-1?2:["LONG","SLONG","FLOAT"].indexOf(e)!==-1?4:["RATIONAL","SRATIONAL","DOUBLE"].indexOf(e)!==-1?8:null},getFieldValues:function(e,t,n,r){var i=[],s=this.getFieldTypeLength(t),o=s*n;if(o<=4)this.littleEndian===!1?i.push(r>>>(4-s)*8):i.push(r);else for(var u=0;u<n;u++){var a=s*u;s>=8?["RATIONAL","SRATIONAL"].indexOf(t)!==-1?(i.push(this.getUint32(r+a)),i.push(this.getUint32(r+a+4))):cc.log("Can't handle this field type or size"):i.push(this.getBytes(s,r+a))}return t==="ASCII"&&i.forEach(function(e,t,n){n[t]=String.fromCharCode(e)}),i},getBytes:function(e,t){if(e<=0)cc.log("No bytes requested");else{if(e<=1)return this.getUint8(t);if(e<=2)return this.getUint16(t);if(e<=3)return this.getUint32(t)>>>8;if(e<=4)return this.getUint32(t);cc.log("Too many bytes requested")}},getBits:function(e,t,n){n=n||0;var r=Math.floor(n/8),i=t+r,s=n+e,o=32-e,u,a;return s<=0?console.log("No bits requested"):s<=8?(u=24+n,a=this.getUint8(i)):s<=16?(u=16+n,a=this.getUint16(i)):s<=32?(u=n,a=this.getUint32(i)):console.log("Too many bits requested"),{bits:a<<u>>>o,byteOffset:i+Math.floor(s/8),bitOffset:s%8}},parseFileDirectory:function(e){var t=this.getUint16(e),n=[];for(var r=e+2,i=0;i<t;r+=12,i++){var s=this.getUint16(r),o=this.getUint16(r+2),u=this.getUint32(r+4),a=this.getUint32(r+8),f=this.getFieldTagName(s),l=this.getFieldTypeName(o),c=this.getFieldValues(f,l,u,a);n[f]={type:l,values:c}}this.fileDirectories.push(n);var h=this.getUint32(r);h!==0&&this.parseFileDirectory(h)},clampColorSample:function(e,t){var n=Math.pow(2,8-t);return Math.floor(e*n+(n-1))},parseTIFF:function(e,t){t=t||document.createElement("canvas"),this._tiffData=e,this.canvas=t,this.checkLittleEndian();if(!this.hasTowel())return;var n=this.getUint32(4);this.fileDirectories=[],this.parseFileDirectory(n);var r=this.fileDirectories[0],i=r.ImageWidth.values[0],s=r.ImageLength.values[0];this.canvas.width=i,this.canvas.height=s;var o=[],u=r.Compression?r.Compression.values[0]:1,a=r.SamplesPerPixel.values[0],f=[],l=0,c=!1;r.BitsPerSample.values.forEach(function(e,t,n){f[t]={bitsPerSample:e,hasBytesPerSample:!1,bytesPerSample:undefined},e%8===0&&(f[t].hasBytesPerSample=!0,f[t].bytesPerSample=e/8),l+=e},this);if(l%8===0){c=!0;var h=l/8}var p=r.StripOffsets.values,d=p.length;if(r.StripByteCounts)var v=r.StripByteCounts.values;else{cc.log("Missing StripByteCounts!");if(d!==1)throw Error("Cannot recover from missing StripByteCounts");var v=[Math.ceil(i*s*l/8)]}for(var m=0;m<d;m++){var g=p[m];o[m]=[];var y=v[m];for(var b=0,w=0,E=1,S=!0,x=[],T=0,N=0,C=0;b<y;b+=E)switch(u){case 1:for(var k=0,x=[];k<a;k++){if(!f[k].hasBytesPerSample){var A=this.getBits(f[k].bitsPerSample,g+b,w);throw x.push(A.bits),b=A.byteOffset-g,w=A.bitOffset,RangeError("Cannot handle sub-byte bits per sample")}var L=f[k].bytesPerSample*k;x.push(this.getBytes(f[k].bytesPerSample,g+b+L))}o[m].push(x);if(!c)throw E=0,RangeError("Cannot handle sub-byte bits per pixel");E=h;break;case 2:break;case 3:break;case 4:break;case 5:break;case 6:break;case 7:break;case 32773:if(S){S=!1;var O=1,M=1,_=this.getInt8(g+b);_>=0&&_<=127?O=_+1:_>=-127&&_<=-1?M=-_+1:S=!0}else{var D=this.getUint8(g+b);for(var k=0;k<M;k++){if(!f[N].hasBytesPerSample)throw RangeError("Cannot handle sub-byte bits per sample");C=C<<8*T|D,T++,T===f[N].bytesPerSample&&(x.push(C),C=T=0,N++),N===a&&(o[m].push(x),x=[],N=0)}O--,O===0&&(S=!0)}E=1;break;default:}}if(t.getContext){var P=this.canvas.getContext("2d");P.fillStyle="rgba(255, 255, 255, 0)";var H=r.RowsPerStrip?r.RowsPerStrip.values[0]:s,B=o.length,j=s%H,F=j===0?H:j,I=H,q=0,R=r.PhotometricInterpretation.values[0],U=[],z=0;r.ExtraSamples&&(U=r.ExtraSamples.values,z=U.length);if(r.ColorMap)var W=r.ColorMap.values,X=Math.pow(2,f[0].bitsPerSample);for(var m=0;m<B;m++){m+1===B&&(I=F);var V=o[m].length,$=q*m;for(var J=0,K=0;J<I,K<V;J++)for(var Q=0;Q<i;Q++,K++){var G=o[m][K],Y=0,Z=0,et=0,tt=1;if(z>0)for(var nt=0;nt<z;nt++)if(U[nt]===1||U[nt]===2){tt=G[3+nt]/256;break}switch(R){case 0:if(f[0].hasBytesPerSample)var rt=Math.pow(16,f[0].bytesPerSample*2);G.forEach(function(e,t,n){n[t]=rt-e});case 1:Y=Z=et=this.clampColorSample(G[0],f[0].bitsPerSample);break;case 2:Y=this.clampColorSample(G[0],f[0].bitsPerSample),Z=this.clampColorSample(G[1],f[1].bitsPerSample),et=this.clampColorSample(G[2],f[2].bitsPerSample);break;case 3:if(W===undefined)throw Error("Palette image missing color map");var it=G[0];Y=this.clampColorSample(W[it],16),Z=this.clampColorSample(W[X+it],16),et=this.clampColorSample(W[2*X+it],16);break;default:throw RangeError("Unknown Photometric Interpretation:",R)}P.fillStyle="rgba("+Y+", "+Z+", "+et+", "+tt+")",P.fillRect(Q,$+J,1,1)}q=I}}return this.canvas},fieldTagNames:{315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop"},fieldTypeNames:{1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE"}}),cc.TIFFReader.__instance=null,cc.TIFFReader.getInstance=function(){return cc.TIFFReader.__instance||(cc.TIFFReader.__instance=new cc.TIFFReader),cc.TIFFReader.__instance},cc.PARTICLE_SHAPE_MODE=0,cc.PARTICLE_TEXTURE_MODE=1,cc.PARTICLE_STAR_SHAPE=0,cc.PARTICLE_BALL_SHAPE=1,cc.PARTICLE_DURATION_INFINITY=-1,cc.PARTICLE_START_SIZE_EQUAL_TO_END_SIZE=-1,cc.PARTICLE_START_RADIUS_EQUAL_TO_END_RADIUS=-1,cc.PARTICLE_MODE_GRAVITY=0,cc.PARTICLE_MODE_RADIUS=1,cc.PARTICLE_TYPE_FREE=0,cc.PARTICLE_TYPE_RELATIVE=1,cc.PARTICLE_TYPE_GROUPED=2,cc.Particle=function(e,t,n,r,i,s,o,u,a,f,l,c){this.pos=e?e:cc.PointZero(),this.startPos=t?t:cc.PointZero(),this.color=n?n:new cc.Color4F(0,0,0,1),this.deltaColor=r?r:new cc.Color4F(0,0,0,1),this.size=i||0,this.deltaSize=s||0,this.rotation=o||0,this.deltaRotation=u||0,this.timeToLive=a||0,this.atlasIndex=f||0,this.modeA=l?l:new cc.Particle.ModeA,this.modeB=c?c:new cc.Particle.ModeB,this.isChangeColor=!1,this.drawPos=cc.p(0,0)},cc.Particle.ModeA=function(e,t,n){this.dir=e?e:cc.PointZero(),this.radialAccel=t||0,this.tangentialAccel=n||0},cc.Particle.ModeB=function(e,t,n,r){this.angle=e||0,this.degreesPerSecond=t||0,this.radius=n||0,this.deltaRadius=r||0},cc.Particle.TemporaryPoints=[cc.p(),cc.p(),cc.p(),cc.p()],cc.ParticleSystem=cc.Node.extend({_plistFile:"",_elapsed:0,_dontTint:!1,modeA:null,modeB:null,_pointZeroForParticle:cc.p(0,0),_particles:null,_emitCounter:0,_particleIdx:0,_batchNode:null,_atlasIndex:0,_transformSystemDirty:!1,_allocatedParticles:0,_drawMode:cc.PARTICLE_SHAPE_MODE,_shapeType:cc.PARTICLE_BALL_SHAPE,_isActive:!1,_particleCount:0,_duration:0,_sourcePosition:null,_posVar:null,_life:0,_lifeVar:0,_angle:0,_angleVar:0,_startSize:0,_startSizeVar:0,_endSize:0,_endSizeVar:0,_startColor:null,_startColorVar:null,_endColor:null,_endColorVar:null,_startSpin:0,_startSpinVar:0,_endSpin:0,_endSpinVar:0,_emissionRate:0,_totalParticles:0,_texture:null,_blendFunc:null,_opacityModifyRGB:!1,_positionType:cc.PARTICLE_TYPE_FREE,_isAutoRemoveOnFinish:!1,_emitterMode:0,_quads:null,_indices:null,_buffersVBO:null,_pointRect:null,_textureLoaded:null,_quadsArrayBuffer:null,ctor:function(){cc.Node.prototype.ctor.call(this),this._emitterMode=cc.PARTICLE_MODE_GRAVITY,this.modeA=new cc.ParticleSystem.ModeA,this.modeB=new cc.ParticleSystem.ModeB,this._blendFunc={src:cc.BLEND_SRC,dst:cc.BLEND_DST},this._particles=[],this._sourcePosition=new cc.Point(0,0),this._posVar=new cc.Point(0,0),this._startColor=new cc.Color4F(1,1,1,1),this._startColorVar=new cc.Color4F(1,1,1,1),this._endColor=new cc.Color4F(1,1,1,1),this._endColorVar=new cc.Color4F(1,1,1,1),this._plistFile="",this._elapsed=0,this._dontTint=!1,this._pointZeroForParticle=cc.p(0,0),this._emitCounter=0,this._particleIdx=0,this._batchNode=null,this._atlasIndex=0,this._transformSystemDirty=!1,this._allocatedParticles=0
,this._drawMode=cc.PARTICLE_SHAPE_MODE,this._shapeType=cc.PARTICLE_BALL_SHAPE,this._isActive=!1,this._particleCount=0,this._duration=0,this._life=0,this._lifeVar=0,this._angle=0,this._angleVar=0,this._startSize=0,this._startSizeVar=0,this._endSize=0,this._endSizeVar=0,this._startSpin=0,this._startSpinVar=0,this._endSpin=0,this._endSpinVar=0,this._emissionRate=0,this._totalParticles=0,this._texture=null,this._opacityModifyRGB=!1,this._positionType=cc.PARTICLE_TYPE_FREE,this._isAutoRemoveOnFinish=!1,this._buffersVBO=[0,0],this._quads=[],this._indices=[],this._pointRect=cc.RectZero(),this._textureLoaded=!0,cc.renderContextType===cc.WEBGL&&(this._quadsArrayBuffer=null)},initIndices:function(){var e=this._indices;for(var t=0,n=this._totalParticles;t<n;++t){var r=t*6,i=t*4;e[r+0]=i+0,e[r+1]=i+1,e[r+2]=i+2,e[r+5]=i+1,e[r+4]=i+2,e[r+3]=i+3}},initTexCoordsWithRect:function(e){var t=cc.CONTENT_SCALE_FACTOR(),n=cc.rect(e.x*t,e.y*t,e.width*t,e.height*t),r=e.width,i=e.height;this._texture&&(r=this._texture.getPixelsWide(),i=this._texture.getPixelsHigh());if(cc.renderContextType===cc.CANVAS)return;var s,o,u,a;cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL?(s=(n.x*2+1)/(r*2),o=(n.y*2+1)/(i*2),u=s+(n.width*2-2)/(r*2),a=o+(n.height*2-2)/(i*2)):(s=n.x/r,o=n.y/i,u=s+n.width/r,a=o+n.height/i);var f=a;a=o,o=f;var l,c=0,h=0;this._batchNode?(l=this._batchNode.getTextureAtlas().getQuads(),c=this._atlasIndex,h=this._atlasIndex+this._totalParticles):(l=this._quads,c=0,h=this._totalParticles);for(var p=c;p<h;p++){l[p]||(l[p]=cc.V3F_C4B_T2F_QuadZero());var d=l[p];d.bl.texCoords.u=s,d.bl.texCoords.v=o,d.br.texCoords.u=u,d.br.texCoords.v=o,d.tl.texCoords.u=s,d.tl.texCoords.v=a,d.tr.texCoords.u=u,d.tr.texCoords.v=a}},getBatchNode:function(){return this._batchNode},setBatchNode:function(e){if(this._batchNode!=e){var t=this._batchNode;this._batchNode=e;if(e){var n=this._particles;for(var r=0;r<this._totalParticles;r++)n[r].atlasIndex=r}e?t||(this._batchNode.getTextureAtlas()._copyQuadsToTextureAtlas(this._quads,this._atlasIndex),cc.renderContext.deleteBuffer(this._buffersVBO[1])):(this._allocMemory(),this.initIndices(),this.setTexture(t.getTexture()),this._setupVBO())}},getAtlasIndex:function(){return this._atlasIndex},setAtlasIndex:function(e){this._atlasIndex=e},getDrawMode:function(){return this._drawMode},setDrawMode:function(e){this._drawMode=e},getShapeType:function(){return this._shapeType},setShapeType:function(e){this._shapeType=e},isActive:function(){return this._isActive},getParticleCount:function(){return this._particleCount},setParticleCount:function(e){this._particleCount=e},getDuration:function(){return this._duration},setDuration:function(e){this._duration=e},getSourcePosition:function(){return{x:this._sourcePosition.x,y:this._sourcePosition.y}},setSourcePosition:function(e){this._sourcePosition=e},getPosVar:function(){return{x:this._posVar.x,y:this._posVar.y}},setPosVar:function(e){this._posVar=e},getLife:function(){return this._life},setLife:function(e){this._life=e},getLifeVar:function(){return this._lifeVar},setLifeVar:function(e){this._lifeVar=e},getAngle:function(){return this._angle},setAngle:function(e){this._angle=e},getAngleVar:function(){return this._angleVar},setAngleVar:function(e){this._angleVar=e},getGravity:function(){this._emitterMode!==cc.PARTICLE_MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.getGravity() : Particle Mode should be Gravity");var e=this.modeA.gravity;return cc.p(e.x,e.y)},setGravity:function(e){this._emitterMode!==cc.PARTICLE_MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.setGravity() : Particle Mode should be Gravity"),this.modeA.gravity=e},getSpeed:function(){return this._emitterMode!==cc.PARTICLE_MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.getSpeed() : Particle Mode should be Gravity"),this.modeA.speed},setSpeed:function(e){this._emitterMode!==cc.PARTICLE_MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.setSpeed() : Particle Mode should be Gravity"),this.modeA.speed=e},getSpeedVar:function(){return this._emitterMode!==cc.PARTICLE_MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.getSpeedVar() : Particle Mode should be Gravity"),this.modeA.speedVar},setSpeedVar:function(e){this._emitterMode!==cc.PARTICLE_MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.setSpeedVar() : Particle Mode should be Gravity"),this.modeA.speedVar=e},getTangentialAccel:function(){return this._emitterMode!==cc.PARTICLE_MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.getTangentialAccel() : Particle Mode should be Gravity"),this.modeA.tangentialAccel},setTangentialAccel:function(e){this._emitterMode!==cc.PARTICLE_MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.setTangentialAccel() : Particle Mode should be Gravity"),this.modeA.tangentialAccel=e},getTangentialAccelVar:function(){return this._emitterMode!==cc.PARTICLE_MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.getTangentialAccelVar() : Particle Mode should be Gravity"),this.modeA.tangentialAccelVar},setTangentialAccelVar:function(e){this._emitterMode!==cc.PARTICLE_MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.setTangentialAccelVar() : Particle Mode should be Gravity"),this.modeA.tangentialAccelVar=e},getRadialAccel:function(){return this._emitterMode!==cc.PARTICLE_MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.getRadialAccel() : Particle Mode should be Gravity"),this.modeA.radialAccel},setRadialAccel:function(e){this._emitterMode!==cc.PARTICLE_MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.setRadialAccel() : Particle Mode should be Gravity"),this.modeA.radialAccel=e},getRadialAccelVar:function(){return this._emitterMode!==cc.PARTICLE_MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.getRadialAccelVar() : Particle Mode should be Gravity"),this.modeA.radialAccelVar},setRadialAccelVar:function(e){this._emitterMode!==cc.PARTICLE_MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.setRadialAccelVar() : Particle Mode should be Gravity"),this.modeA.radialAccelVar=e},getRotationIsDir:function(){return this._emitterMode!==cc.PARTICLE_MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.getRotationIsDir() : Particle Mode should be Gravity"),this.modeA.rotationIsDir},setRotationIsDir:function(e){this._emitterMode!==cc.PARTICLE_MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.setRotationIsDir() : Particle Mode should be Gravity"),this.modeA.rotationIsDir=e},getStartRadius:function(){return this._emitterMode!==cc.PARTICLE_MODE_RADIUS&&cc.log("cc.ParticleBatchNode.getStartRadius() : Particle Mode should be Radius"),this.modeB.startRadius},setStartRadius:function(e){this._emitterMode!==cc.PARTICLE_MODE_RADIUS&&cc.log("cc.ParticleBatchNode.setStartRadius() : Particle Mode should be Radius"),this.modeB.startRadius=e},getStartRadiusVar:function(){return this._emitterMode!==cc.PARTICLE_MODE_RADIUS&&cc.log("cc.ParticleBatchNode.getStartRadiusVar() : Particle Mode should be Radius"),this.modeB.startRadiusVar},setStartRadiusVar:function(e){this._emitterMode!==cc.PARTICLE_MODE_RADIUS&&cc.log("cc.ParticleBatchNode.setStartRadiusVar() : Particle Mode should be Radius"),this.modeB.startRadiusVar=e},getEndRadius:function(){return this._emitterMode!==cc.PARTICLE_MODE_RADIUS&&cc.log("cc.ParticleBatchNode.getEndRadius() : Particle Mode should be Radius"),this.modeB.endRadius},setEndRadius:function(e){this._emitterMode!==cc.PARTICLE_MODE_RADIUS&&cc.log("cc.ParticleBatchNode.setEndRadius() : Particle Mode should be Radius"),this.modeB.endRadius=e},getEndRadiusVar:function(){return this._emitterMode!==cc.PARTICLE_MODE_RADIUS&&cc.log("cc.ParticleBatchNode.getEndRadiusVar() : Particle Mode should be Radius"),this.modeB.endRadiusVar},setEndRadiusVar:function(e){this._emitterMode!==cc.PARTICLE_MODE_RADIUS&&cc.log("cc.ParticleBatchNode.setEndRadiusVar() : Particle Mode should be Radius"),this.modeB.endRadiusVar=e},getRotatePerSecond:function(){return this._emitterMode!==cc.PARTICLE_MODE_RADIUS&&cc.log("cc.ParticleBatchNode.getRotatePerSecond() : Particle Mode should be Radius"),this.modeB.rotatePerSecond},setRotatePerSecond:function(e){this._emitterMode!==cc.PARTICLE_MODE_RADIUS&&cc.log("cc.ParticleBatchNode.setRotatePerSecond() : Particle Mode should be Radius"),this.modeB.rotatePerSecond=e},getRotatePerSecondVar:function(){return this._emitterMode!==cc.PARTICLE_MODE_RADIUS&&cc.log("cc.ParticleBatchNode.getRotatePerSecondVar() : Particle Mode should be Radius"),this.modeB.rotatePerSecondVar},setRotatePerSecondVar:function(e){this._emitterMode!==cc.PARTICLE_MODE_RADIUS&&cc.log("cc.ParticleBatchNode.setRotatePerSecondVar() : Particle Mode should be Radius"),this.modeB.rotatePerSecondVar=e},setScale:function(e,t){this._transformSystemDirty=!0,cc.Node.prototype.setScale.call(this,e,t)},setRotation:function(e){this._transformSystemDirty=!0,cc.Node.prototype.setRotation.call(this,e)},setScaleX:function(e){this._transformSystemDirty=!0,cc.Node.prototype.setScaleX.call(this,e)},setScaleY:function(e){this._transformSystemDirty=!0,cc.Node.prototype.setScaleY.call(this,e)},getStartSize:function(){return this._startSize},setStartSize:function(e){this._startSize=e},getStartSizeVar:function(){return this._startSizeVar},setStartSizeVar:function(e){this._startSizeVar=e},getEndSize:function(){return this._endSize},setEndSize:function(e){this._endSize=e},getEndSizeVar:function(){return this._endSizeVar},setEndSizeVar:function(e){this._endSizeVar=e},getStartColor:function(){return this._startColor},setStartColor:function(e){e instanceof cc.Color3B&&(e=cc.c4FFromccc3B(e)),this._startColor=e},getStartColorVar:function(){return this._startColorVar},setStartColorVar:function(e){e instanceof cc.Color3B&&(e=cc.c4FFromccc3B(e)),this._startColorVar=e},getEndColor:function(){return this._endColor},setEndColor:function(e){e instanceof cc.Color3B&&(e=cc.c4FFromccc3B(e)),this._endColor=e},getEndColorVar:function(){return this._endColorVar},setEndColorVar:function(e){e instanceof cc.Color3B&&(e=cc.c4FFromccc3B(e)),this._endColorVar=e},getStartSpin:function(){return this._startSpin},setStartSpin:function(e){this._startSpin=e},getStartSpinVar:function(){return this._startSpinVar},setStartSpinVar:function(e){this._startSpinVar=e},getEndSpin:function(){return this._endSpin},setEndSpin:function(e){this._endSpin=e},getEndSpinVar:function(){return this._endSpinVar},setEndSpinVar:function(e){this._endSpinVar=e},getEmissionRate:function(){return this._emissionRate},setEmissionRate:function(e){this._emissionRate=e},getTotalParticles:function(){return this._totalParticles},setTotalParticles:function(e){if(cc.renderContextType===cc.CANVAS){this._totalParticles=e<200?e:200;return}if(e>this._allocatedParticles){var t=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT;this._indices=new Uint16Array(e*6);var n=new ArrayBuffer(e*t),r=this._particles;r.length=0;var i=this._quads;i.length=0;for(var s=0;s<e;s++)r[s]=new cc.Particle,i[s]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,n,s*t);this._allocatedParticles=e,this._totalParticles=e;if(this._batchNode)for(var o=0;o<e;o++)r[o].atlasIndex=o;this._quadsArrayBuffer=n,this.initIndices(),this._setupVBO();if(this._texture){var u=this._texture.getContentSize();this.initTexCoordsWithRect(cc.rect(0,0,u.width,u.height))}}else this._totalParticles=e;this.resetSystem()},getTexture:function(){return this._texture},setTexture:function(e){if(e.isLoaded()){var t=e.getContentSize();this.setTextureWithRect(e,cc.rect(0,0,t.width,t.height))}else this._textureLoaded=!1,e.addLoadedEventListener(function(e){this._textureLoaded=!0;var t=e.getContentSize();this.setTextureWithRect(e,cc.rect(0,0,t.width,t.height))},this)},getBlendFunc:function(){return this._blendFunc},setBlendFunc:function(e,t){if(t===undefined)this._blendFunc!=e&&(this._blendFunc=e,this._updateBlendFunc());else if(this._blendFunc.src!=e||this._blendFunc.dst!=t)this._blendFunc={src:e,dst:t},this._updateBlendFunc()},getOpacityModifyRGB:function(){return this._opacityModifyRGB},setOpacityModifyRGB:function(e){this._opacityModifyRGB=e},isBlendAdditive:function(){return this._blendFunc.src==gl.SRC_ALPHA&&this._blendFunc.dst==gl.ONE||this._blendFunc.src==gl.ONE&&this._blendFunc.dst==gl.ONE},setBlendAdditive:function(e){var t=this._blendFunc;e?(t.src=gl.SRC_ALPHA,t.dst=gl.ONE):cc.renderContextType===cc.WEBGL?this._texture&&!this._texture.hasPremultipliedAlpha()?(t.src=gl.SRC_ALPHA,t.dst=gl.ONE_MINUS_SRC_ALPHA):(t.src=cc.BLEND_SRC,t.dst=cc.BLEND_DST):(t.src=cc.BLEND_SRC,t.dst=cc.BLEND_DST)},getPositionType:function(){return this._positionType},setPositionType:function(e){this._positionType=e},isAutoRemoveOnFinish:function(){return this._isAutoRemoveOnFinish},setAutoRemoveOnFinish:function(e){this._isAutoRemoveOnFinish=e},getEmitterMode:function(){return this._emitterMode},setEmitterMode:function(e){this._emitterMode=e},init:function(){return this.initWithTotalParticles(150)},initWithFile:function(e){this._plistFile=e;var t=cc.FileUtils.getInstance(),n=t.fullPathForFilename(e),r=t.dictionaryWithContentsOfFileThreadSafe(n);return r?this.initWithDictionary(r,""):(cc.log("cc.ParticleSystem.initWithFile(): Particles: file not found"),!1)},getBoundingBoxToWorld:function(){return cc.rect(0,0,cc.canvas.width,cc.canvas.height)},initWithDictionary:function(e,t){var n=!1,r=null,i=null,s=this._valueForKey,o=parseInt(s("maxParticles",e));if(this.initWithTotalParticles(o)){this._angle=parseFloat(s("angle",e)),this._angleVar=parseFloat(s("angleVariance",e)),this._duration=parseFloat(s("duration",e)),this._blendFunc.src=parseInt(s("blendFuncSource",e)),this._blendFunc.dst=parseInt(s("blendFuncDestination",e));var u=this._startColor;u.r=parseFloat(s("startColorRed",e)),u.g=parseFloat(s("startColorGreen",e)),u.b=parseFloat(s("startColorBlue",e)),u.a=parseFloat(s("startColorAlpha",e));var a=this._startColorVar;a.r=parseFloat(s("startColorVarianceRed",e)),a.g=parseFloat(s("startColorVarianceGreen",e)),a.b=parseFloat(s("startColorVarianceBlue",e)),a.a=parseFloat(s("startColorVarianceAlpha",e));var f=this._endColor;f.r=parseFloat(s("finishColorRed",e)),f.g=parseFloat(s("finishColorGreen",e)),f.b=parseFloat(s("finishColorBlue",e)),f.a=parseFloat(s("finishColorAlpha",e));var l=this._endColorVar;l.r=parseFloat(s("finishColorVarianceRed",e)),l.g=parseFloat(s("finishColorVarianceGreen",e)),l.b=parseFloat(s("finishColorVarianceBlue",e)),l.a=parseFloat(s("finishColorVarianceAlpha",e)),this._startSize=parseFloat(s("startParticleSize",e)),this._startSizeVar=parseFloat(s("startParticleSizeVariance",e)),this._endSize=parseFloat(s("finishParticleSize",e)),this._endSizeVar=parseFloat(s("finishParticleSizeVariance",e));var c=parseFloat(s("sourcePositionx",e)),h=parseFloat(s("sourcePositiony",e));this.setPosition(c,h),this._posVar.x=parseFloat(s("sourcePositionVariancex",e)),this._posVar.y=parseFloat(s("sourcePositionVariancey",e)),this._startSpin=parseFloat(s("rotationStart",e)),this._startSpinVar=parseFloat(s("rotationStartVariance",e)),this._endSpin=parseFloat(s("rotationEnd",e)),this._endSpinVar=parseFloat(s("rotationEndVariance",e)),this._emitterMode=parseInt(s("emitterType",e));if(this._emitterMode==cc.PARTICLE_MODE_GRAVITY){var p=this.modeA;p.gravity.x=parseFloat(s("gravityx",e)),p.gravity.y=parseFloat(s("gravityy",e)),p.speed=parseFloat(s("speed",e)),p.speedVar=parseFloat(s("speedVariance",e));var d=s("radialAcceleration",e);p.radialAccel=d?parseFloat(d):0,d=s("radialAccelVariance",e),p.radialAccelVar=d?parseFloat(d):0,d=s("tangentialAcceleration",e),p.tangentialAccel=d?parseFloat(d):0,d=s("tangentialAccelVariance",e),p.tangentialAccelVar=d?parseFloat(d):0;var v=s("rotationIsDir",e).toLowerCase();p.rotationIsDir=v!=null&&(v==="true"||v==="1")}else{if(this._emitterMode!=cc.PARTICLE_MODE_RADIUS)return cc.log("cc.ParticleSystem.initWithDictionary(): Invalid emitterType in config file"),!1;var m=this.modeB;m.startRadius=parseFloat(s("maxRadius",e)),m.startRadiusVar=parseFloat(s("maxRadiusVariance",e)),m.endRadius=parseFloat(s("minRadius",e)),m.endRadiusVar=0,m.rotatePerSecond=parseFloat(s("rotatePerSecond",e)),m.rotatePerSecondVar=parseFloat(s("rotatePerSecondVariance",e))}this._life=parseFloat(s("particleLifespan",e)),this._lifeVar=parseFloat(s("particleLifespanVariance",e)),this._emissionRate=this._totalParticles/this._life;if(!this._batchNode){this._opacityModifyRGB=!1;var g=s("textureFileName",e),y=cc.FileUtils.getInstance(),b=y.fullPathFromRelativeFile(g,this._plistFile),w=cc.TextureCache.getInstance().textureForKey(b);if(w)this.setTexture(w);else{var E=s("textureImageData",e);if(E&&E.length==0){w=cc.TextureCache.getInstance().addImage(b);if(!w)return!1;this.setTexture(w)}else{r=cc.unzipBase64AsArray(E,1);if(!r)return cc.log("cc.ParticleSystem: error decoding or ungzipping textureImageData"),!1;var S=cc.getImageFormatByData(r);if(S!==cc.FMT_TIFF&&S!==cc.FMT_PNG)return cc.log("cc.ParticleSystem: unknown image format with Data"),!1;var x=document.createElement("canvas");if(S===cc.FMT_PNG){var T=new cc.PNGReader(r);T.render(x)}else{var N=cc.TIFFReader.getInstance();N.parseTIFF(r,x)}var C=y.fullPathForFilename(b);cc.TextureCache.getInstance().cacheImage(C,x);var k=cc.TextureCache.getInstance().textureForKey(b);k||cc.log("cc.ParticleSystem.initWithDictionary() : error loading the texture"),this.setTexture(k)}}}n=!0}return n},initWithTotalParticles:function(e){this._totalParticles=e;var t,n=this._particles;n.length=0;for(t=0;t<e;t++)n[t]=new cc.Particle;if(!n)return cc.log("Particle system: not enough memory"),!1;this._allocatedParticles=e;if(this._batchNode)for(t=0;t<this._totalParticles;t++)n[t].atlasIndex=t;this._isActive=!0,this._blendFunc.src=cc.BLEND_SRC,this._blendFunc.dst=cc.BLEND_DST,this._positionType=cc.PARTICLE_TYPE_FREE,this._emitterMode=cc.PARTICLE_MODE_GRAVITY,this._isAutoRemoveOnFinish=!1,this._transformSystemDirty=!1,this.scheduleUpdateWithPriority(1);if(cc.renderContextType===cc.WEBGL){if(!this._allocMemory())return!1;this.initIndices(),this._setupVBO(),this.setShaderProgram(cc.ShaderCache.getInstance().programForKey(cc.SHADER_POSITION_TEXTURECOLOR))}return!0},destroyParticleSystem:function(){this.unscheduleUpdate()},addParticle:function(){if(this.isFull())return!1;var e,t=this._particles;return cc.renderContextType===cc.CANVAS?this._particleCount<t.length?e=t[this._particleCount]:(e=new cc.Particle,t.push(e)):e=t[this._particleCount],this.initParticle(e),++this._particleCount,!0},initParticle:function(e){var t=cc.RANDOM_MINUS1_1;e.timeToLive=this._life+this._lifeVar*t(),e.timeToLive=Math.max(0,e.timeToLive),e.pos.x=this._sourcePosition.x+this._posVar.x*t(),e.pos.y=this._sourcePosition.y+this._posVar.y*t();var n,r,i=this._startColor,s=this._startColorVar,o=this._endColor,u=this._endColorVar;cc.renderContextType===cc.CANVAS?(n=new cc.Color4F(cc.clampf(i.r+s.r*t(),0,1),cc.clampf(i.g+s.g*t(),0,1),cc.clampf(i.b+s.b*t(),0,1),cc.clampf(i.a+s.a*t(),0,1)),r=new cc.Color4F(cc.clampf(o.r+u.r*t(),0,1),cc.clampf(o.g+u.g*t(),0,1),cc.clampf(o.b+u.b*t(),0,1),cc.clampf(o.a+u.a*t(),0,1))):(n={r:cc.clampf(i.r+s.r*t(),0,1),g:cc.clampf(i.g+s.g*t(),0,1),b:cc.clampf(i.b+s.b*t(),0,1),a:cc.clampf(i.a+s.a*t(),0,1)},r={r:cc.clampf(o.r+u.r*t(),0,1),g:cc.clampf(o.g+u.g*t(),0,1),b:cc.clampf(o.b+u.b*t(),0,1),a:cc.clampf(o.a+u.a*t(),0,1)}),e.color=n;var a=e.deltaColor,f=e.timeToLive;a.r=(r.r-n.r)/f,a.g=(r.g-n.g)/f,a.b=(r.b-n.b)/f,a.a=(r.a-n.a)/f;var l=this._startSize+this._startSizeVar*t();l=Math.max(0,l),e.size=l;if(this._endSize===cc.PARTICLE_START_SIZE_EQUAL_TO_END_SIZE)e.deltaSize=0;else{var c=this._endSize+this._endSizeVar*t();c=Math.max(0,c),e.deltaSize=(c-l)/f}var h=this._startSpin+this._startSpinVar*t(),p=this._endSpin+this._endSpinVar*t();e.rotation=h,e.deltaRotation=(p-h)/f,this._positionType==cc.PARTICLE_TYPE_FREE?e.startPos=this.convertToWorldSpace(this._pointZeroForParticle):this._positionType==cc.PARTICLE_TYPE_RELATIVE&&(e.startPos.x=this._position.x,e.startPos.y=this._position.y);var d=cc.DEGREES_TO_RADIANS(this._angle+this._angleVar*t());if(this._emitterMode===cc.PARTICLE_MODE_GRAVITY){var v=this.modeA,m=e.modeA,g=v.speed+v.speedVar*t();m.dir.x=Math.cos(d),m.dir.y=Math.sin(d),cc.pMultIn(m.dir,g),m.radialAccel=v.radialAccel+v.radialAccelVar*t(),m.tangentialAccel=v.tangentialAccel+v.tangentialAccelVar*t(),v.rotationIsDir&&(e.rotation=-cc.RADIANS_TO_DEGREES(cc.pToAngle(m.dir)))}else{var y=this.modeB,b=e.modeB,w=y.startRadius+y.startRadiusVar*t(),E=y.endRadius+y.endRadiusVar*t();b.radius=w,b.deltaRadius=y.endRadius===cc.PARTICLE_START_RADIUS_EQUAL_TO_END_RADIUS?0:(E-w)/f,b.angle=d,b.degreesPerSecond=cc.DEGREES_TO_RADIANS(y.rotatePerSecond+y.rotatePerSecondVar*t())}},stopSystem:function(){this._isActive=!1,this._elapsed=this._duration,this._emitCounter=0},resetSystem:function(){this._isActive=!0,this._elapsed=0;var e=this._particles;for(this._particleIdx=0;this._particleIdx<this._particleCount;++this._particleIdx)e[this._particleIdx].timeToLive=0},isFull:function(){return this._particleCount>=this._totalParticles},updateQuadWithParticle:function(e,t){var n=null;if(this._batchNode){var r=this._batchNode.getTextureAtlas().getQuads();n=r[this._atlasIndex+e.atlasIndex],this._batchNode.getTextureAtlas()._dirty=!0}else n=this._quads[this._particleIdx];var i,s,o,u;this._opacityModifyRGB?(i=0|e.color.r*e.color.a*255,s=0|e.color.g*e.color.a*255,o=0|e.color.b*e.color.a*255,u=0|e.color.a*255):(i=0|e.color.r*255,s=0|e.color.g*255,o=0|e.color.b*255,u=0|e.color.a*255);var a=n.bl.colors;a.r=i,a.g=s,a.b=o,a.a=u,a=n.br.colors,a.r=i,a.g=s,a.b=o,a.a=u,a=n.tl.colors,a.r=i,a.g=s,a.b=o,a.a=u,a=n.tr.colors,a.r=i,a.g=s,a.b=o,a.a=u;var f=e.size/2;if(e.rotation){var l=-f,c=-f,h=f,p=f,d=t.x,v=t.y,m=-cc.DEGREES_TO_RADIANS(e.rotation),g=Math.cos(m),y=Math.sin(m),b=l*g-c*y+d,w=l*y+c*g+v,E=h*g-c*y+d,S=h*y+c*g+v,x=h*g-p*y+d,T=h*y+p*g+v,N=l*g-p*y+d,C=l*y+p*g+v;n.bl.vertices.x=b,n.bl.vertices.y=w,n.br.vertices.x=E,n.br.vertices.y=S,n.tl.vertices.x=N,n.tl.vertices.y=C,n.tr.vertices.x=x,n.tr.vertices.y=T}else n.bl.vertices.x=t.x-f,n.bl.vertices.y=t.y-f,n.br.vertices.x=t.x+f,n.br.vertices.y=t.y-f,n.tl.vertices.x=t.x-f,n.tl.vertices.y=t.y+f,n.tr.vertices.x=t.x+f,n.tr.vertices.y=t.y+f},postStep:function(){if(cc.renderContextType===cc.WEBGL){var e=cc.renderContext;e.bindBuffer(e.ARRAY_BUFFER,this._buffersVBO[0]),e.bufferData(e.ARRAY_BUFFER,this._quadsArrayBuffer,e.DYNAMIC_DRAW)}},update:function(e){if(this._isActive&&this._emissionRate){var t=1/this._emissionRate;this._particleCount<this._totalParticles&&(this._emitCounter+=e);while(this._particleCount<this._totalParticles&&this._emitCounter>t)this.addParticle(),this._emitCounter-=t;this._elapsed+=e,this._duration!=-1&&this._duration<this._elapsed&&this.stopSystem()}this._particleIdx=0;var n=cc.Particle.TemporaryPoints[0];this._positionType==cc.PARTICLE_TYPE_FREE?cc.pIn(n,this.convertToWorldSpace(this._pointZeroForParticle)):this._positionType==cc.PARTICLE_TYPE_RELATIVE&&(n.x=this._position.x,n.y=this._position.y);if(this._visible){var r=cc.Particle.TemporaryPoints[1],i=cc.Particle.TemporaryPoints[2],s=cc.Particle.TemporaryPoints[3],o=this._particles;while(this._particleIdx<this._particleCount){cc.pZeroIn(r),cc.pZeroIn(i),cc.pZeroIn(s);var u=o[this._particleIdx];u.timeToLive-=e;if(u.timeToLive>0){if(this._emitterMode==cc.PARTICLE_MODE_GRAVITY){var a=s,f=r,l=i;u.pos.x||u.pos.y?(cc.pIn(f,u.pos),cc.pNormalizeIn(f)):cc.pZeroIn(f),cc.pIn(l,f),cc.pMultIn(f,u.modeA.radialAccel);var c=l.x;l.x=-l.y,l.y=c,cc.pMultIn(l,u.modeA.tangentialAccel),cc.pIn(a,f),cc.pAddIn(a,l),cc.pAddIn(a,this.modeA.gravity),cc.pMultIn(a,e),cc.pAddIn(u.modeA.dir,a),cc.pIn(a,u.modeA.dir),cc.pMultIn(a,e),cc.pAddIn(u.pos,a)}else{var h=u.modeB;h.angle+=h.degreesPerSecond*e,h.radius+=h.deltaRadius*e,u.pos.x=-Math.cos(h.angle)*h.radius,u.pos.y=-Math.sin(h.angle)*h.radius}this._dontTint||(u.color.r+=u.deltaColor.r*e,u.color.g+=u.deltaColor.g*e,u.color.b+=u.deltaColor.b*e,u.color.a+=u.deltaColor.a*e,u.isChangeColor=!0),u.size+=u.deltaSize*e,u.size=Math.max(0,u.size),u.rotation+=u.deltaRotation*e;var p=r;if(this._positionType==cc.PARTICLE_TYPE_FREE||this._positionType==cc.PARTICLE_TYPE_RELATIVE){var d=i;cc.pIn(d,n),cc.pSubIn(d,u.startPos),cc.pIn(p,u.pos),cc.pSubIn(p,d)}else cc.pIn(p,u.pos);this._batchNode&&(p.x+=this._position._x,p.y+=this._position._y),cc.renderContextType==cc.WEBGL?this.updateQuadWithParticle(u,p):cc.pIn(u.drawPos,p),++this._particleIdx}else{var v=u.atlasIndex;if(this._particleIdx!==this._particleCount-1){var m=o[this._particleIdx];o[this._particleIdx]=o[this._particleCount-1],o[this._particleCount-1]=m}this._batchNode&&(this._batchNode.disableParticle(this._atlasIndex+v),o[this._particleCount-1].atlasIndex=v),--this._particleCount;if(this._particleCount==0&&this._isAutoRemoveOnFinish){this.unscheduleUpdate(),this._parent.removeChild(this,!0);return}}}this._transformSystemDirty=!1}this._batchNode||this.postStep()},updateWithNoTime:function(){this.update(0)},_valueForKey:function(e,t){if(t){var n=t[e];return n!=null?n:""}return""},_updateBlendFunc:function(){if(this._batchNode){cc.log("Can't change blending functions when the particle is being batched");return}var e=this._texture;if(e&&e instanceof cc.Texture2D){this._opacityModifyRGB=!1;var t=this._blendFunc;t.src==cc.BLEND_SRC&&t.dst==cc.BLEND_DST&&(e.hasPremultipliedAlpha()?this._opacityModifyRGB=!0:(t.src=gl.SRC_ALPHA,t.dst=gl.ONE_MINUS_SRC_ALPHA))}},clone:function(){var e=new cc.ParticleSystem;if(e.initWithTotalParticles(this._totalParticles)){e._angle=this._angle,e._angleVar=this._angleVar,e._duration=this._duration,e._blendFunc.src=this._blendFunc.src,e._blendFunc.dst=this._blendFunc.dst;var t=e._startColor,n=this._startColor;t.r=n.r,t.g=n.g,t.b=n.b,t.a=n.a;var r=e._startColorVar,i=this._startColorVar;r.r=i.r,r.g=i.g,r.b=i.b,r.a=i.a;var s=e._endColor,o=this._endColor;s.r=o.r,s.g=o.g,s.b=o.b,s.a=o.a;var u=e._endColorVar,a=this._endColorVar;u.r=a.r,u.g=a.g,u.b=a.b,u.a=a.a,e._startSize=this._startSize,e._startSizeVar=this._startSizeVar,e._endSize=this._endSize,e._endSizeVar=this._endSizeVar,e.setPosition(this._position._x,this._position._y),e._posVar.x=this._posVar.x,e._posVar.y=this._posVar.y,e._startSpin=this._startSpin,e._startSpinVar=this._startSpinVar,e._endSpin=this._endSpin,e._endSpinVar=this._endSpinVar,e._emitterMode=this._emitterMode;if(this._emitterMode==cc.PARTICLE_MODE_GRAVITY){var f=e.modeA,l=this.modeA;f.gravity.x=l.gravity.x,f.gravity.y=l.gravity.y,f.speed=l.speed,f.speedVar=l.speedVar,f.radialAccel=l.radialAccel,f.radialAccelVar=l.radialAccelVar,f.tangentialAccel=l.tangentialAccel,f.tangentialAccelVar=l.tangentialAccelVar}else if(this._emitterMode==cc.PARTICLE_MODE_RADIUS){var c=e.modeB,h=this.modeB;c.startRadius=h.startRadius,c.startRadiusVar=h.startRadiusVar,c.endRadius=h.endRadius,c.endRadiusVar=h.endRadiusVar,c.rotatePerSecond=h.rotatePerSecond,c.rotatePerSecondVar=h.rotatePerSecondVar}e._life=this._life,e._lifeVar=this._lifeVar,e._emissionRate=this._emissionRate,this._batchNode||(e._opacityModifyRGB=this._opacityModifyRGB,e._texture=this._texture)}return e},setDisplayFrame:function(e){var t=e.getOffsetInPixels();(t.x!=0||t.y!=0)&&cc.log("cc.ParticleSystem.setDisplayFrame(): QuadParticle only supports SpriteFrames with no offsets"),cc.renderContextType===cc.WEBGL&&(!this._texture||e.getTexture()._webTextureObj!=this._texture._webTextureObj)&&this.setTexture(e.getTexture())},setTextureWithRect:function(e,t){var n=this._texture;cc.renderContextType===cc.WEBGL?(!n||e._webTextureObj!=n._webTextureObj)&&n!=e&&(this._texture=e,this._updateBlendFunc()):(!n||e!=n)&&n!=e&&(this._texture=e,this._updateBlendFunc()),this._pointRect=t,this.initTexCoordsWithRect(t)},draw:function(e){if(!this._textureLoaded||this._batchNode)return;cc.renderContextType===cc.CANVAS?this._drawForCanvas(e):this._drawForWebGL(e),cc.g_NumberOfDraws++},_drawForCanvas:function(e){var t=e||cc.renderContext;t.save(),this.isBlendAdditive()?t.globalCompositeOperation="lighter":t.globalCompositeOperation="source-over";for(var n=0;n<this._particleCount;n++){var r=this._particles[n],i=0|r.size*.5;if(this._drawMode==cc.PARTICLE_TEXTURE_MODE){var s=this._texture.getHtmlElementObj();if(!s.width||!s.height)continue;t.save(),t.globalAlpha=r.color.a,t.translate(0|r.drawPos.x,-(0|r.drawPos.y));var o=Math.floor(r.size/4)*4,u=this._pointRect.width,a=this._pointRect.height;t.scale(Math.max(1/u*o,1e-6),Math.max(1/a*o,1e-6)),r.rotation&&t.rotate(cc.DEGREES_TO_RADIANS(r.rotation)),t.translate(-(0|u/2),-(0|a/2));if(r.isChangeColor){var f=cc.TextureCache.getInstance().getTextureColors(s);f&&(f.tintCache||(f.tintCache=document.createElement("canvas"),f.tintCache.width=s.width,f.tintCache.height=s.height),cc.generateTintImage(s,f,r.color,this._pointRect,f.tintCache),s=f.tintCache)}t.drawImage(s,0,0),t.restore()}else t.save(),t.globalAlpha=r.color.a,t.translate(0|r.drawPos.x,-(0|r.drawPos.y)),this._shapeType==cc.PARTICLE_STAR_SHAPE?(r.rotation&&t.rotate(cc.DEGREES_TO_RADIANS(r.rotation)),cc.drawingUtil.drawStar(t,i,r.color)):cc.drawingUtil.drawColorBall(t,i,r.color),t.restore()}t.restore()},_drawForWebGL:function(e){if(!this._texture)return;var t=e||cc.renderContext;this._shaderProgram.use(),this._shaderProgram.setUniformForModelViewAndProjectionMatrixWithMat4(),cc.glBindTexture2D(this._texture),cc.glBlendFuncForParticle(this._blendFunc.src,this._blendFunc.dst),cc.glEnableVertexAttribs(cc.VERTEX_ATTRIB_FLAG_POS_COLOR_TEX),t.bindBuffer(t.ARRAY_BUFFER,this._buffersVBO[0]),t.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,3,t.FLOAT,!1,24,0),t.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,t.UNSIGNED_BYTE,!0,24,12),t.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,t.FLOAT,!1,24,16),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._buffersVBO[1]),t.drawElements(t.TRIANGLES,this._particleIdx*6,t.UNSIGNED_SHORT,0)},listenBackToForeground:function(e){cc.TEXTURE_ATLAS_USE_VAO?this._setupVBOandVAO():this._setupVBO()},_setupVBOandVAO:function(){},_setupVBO:function(){if(cc.renderContextType==cc.CANVAS)return;var e=cc.renderContext;this._buffersVBO[0]=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this._buffersVBO[0]),e.bufferData(e.ARRAY_BUFFER,this._quadsArrayBuffer,e.DYNAMIC_DRAW),this._buffersVBO[1]=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._buffersVBO[1]),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this._indices,e.STATIC_DRAW)},_allocMemory:function(){if(cc.renderContextType===cc.CANVAS)return!0;if(this._batchNode)return cc.log("cc.ParticleSystem._allocMemory(): Memory should not be allocated when not using batchNode"),!1;var e=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,t=this._totalParticles,n=this._quads;n.length=0,this._indices=new Uint16Array(t*6);var r=new ArrayBuffer(e*t);for(var i=0;i<t;i++)n[i]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,r,i*e);return!n||!this._indices?(cc.log("cocos2d: Particle system: not enough memory"),!1):(this._quadsArrayBuffer=r,!0)}}),cc.ParticleSystem.create=function(e){var t=new cc.ParticleSystem;if(!e||typeof e=="number"){var n=e||100;return t.setDrawMode(cc.PARTICLE_TEXTURE_MODE),t.initWithTotalParticles(n),t}return t&&t.initWithFile(e)?t:null},cc.ParticleSystem.createWithTotalParticles=function(e){var t=new cc.ParticleSystem;return t&&t.initWithTotalParticles(e)?t:null},cc.ParticleSystem.ModeA=function(e,t,n,r,i,s,o,u){this.gravity=e?e:cc.PointZero(),this.speed=t||0,this.speedVar=n||0,this.tangentialAccel=r||0,this.tangentialAccelVar=i||0,this.radialAccel=s||0,this.radialAccelVar=o||0,this.rotationIsDir=u||!1},cc.ParticleSystem.ModeB=function(e,t,n,r,i,s){this.startRadius=e||0,this.startRadiusVar=t||0,this.endRadius=n||0,this.endRadiusVar=r||0,this.rotatePerSecond=i||0,this.rotatePerSecondVar=s||0},cc.ParticleFire=cc.ParticleSystem.extend({init:function(){return this.initWithTotalParticles(cc.renderContextType===cc.WEBGL?300:150)},initWithTotalParticles:function(e){if(cc.ParticleSystem.prototype.initWithTotalParticles.call(this,e)){this.setDuration(cc.PARTICLE_DURATION_INFINITY),this.setEmitterMode(cc.PARTICLE_MODE_GRAVITY),this.setGravity(cc.p(0,0)),this.setRadialAccel(0),this.setRadialAccelVar(0),this.setSpeed(60),this.setSpeedVar(20),this.setAngle(90),this.setAngleVar(10);var t=cc.Director.getInstance().getWinSize();return this.setPosition(t.width/2,60),this.setPosVar(cc.p(40,20)),this.setLife(3),this.setLifeVar(.25),this.setStartSize(54),this.setStartSizeVar(10),this.setEndSize(cc.PARTICLE_START_SIZE_EQUAL_TO_END_SIZE),this.setEmissionRate(this.getTotalParticles()/this.getLife()),this.setStartColor(cc.c4f(.76,.25,.12,1)),this.setStartColorVar(cc.c4f(0,0,0,0)),this.setEndColor(cc.c4f(0,0,0,1)),this.setEndColorVar(cc.c4f(0,0,0,0)),this.setBlendAdditive(!0),!0}return!1}}),cc.ParticleFire.create=function(){var e=new cc.ParticleFire;return e.init()?e:null},cc.ParticleFireworks=cc.ParticleSystem.extend({init:function(){return this.initWithTotalParticles(cc.renderContextType===cc.WEBGL?1500:150)},initWithTotalParticles:function(e){if(cc.ParticleSystem.prototype.initWithTotalParticles.call(this,e)){this.setDuration(cc.PARTICLE_DURATION_INFINITY),this.setEmitterMode(cc.PARTICLE_MODE_GRAVITY),this.setGravity(cc.p(0,-90)),this
.setRadialAccel(0),this.setRadialAccelVar(0),this.setSpeed(180),this.setSpeedVar(50);var t=cc.Director.getInstance().getWinSize();return this.setPosition(t.width/2,t.height/2),this.setAngle(90),this.setAngleVar(20),this.setLife(3.5),this.setLifeVar(1),this.setEmissionRate(this.getTotalParticles()/this.getLife()),this.setStartColor(cc.c4f(.5,.5,.5,1)),this.setStartColorVar(cc.c4f(.5,.5,.5,1)),this.setEndColor(cc.c4f(.1,.1,.1,.2)),this.setEndColorVar(cc.c4f(.1,.1,.1,.2)),this.setStartSize(8),this.setStartSizeVar(2),this.setEndSize(cc.PARTICLE_START_SIZE_EQUAL_TO_END_SIZE),this.setBlendAdditive(!1),!0}return!1}}),cc.ParticleFireworks.create=function(){var e=new cc.ParticleFireworks;return e.init()?e:null},cc.ParticleSun=cc.ParticleSystem.extend({init:function(){return this.initWithTotalParticles(cc.renderContextType===cc.WEBGL?350:150)},initWithTotalParticles:function(e){if(cc.ParticleSystem.prototype.initWithTotalParticles.call(this,e)){this.setBlendAdditive(!0),this.setDuration(cc.PARTICLE_DURATION_INFINITY),this.setEmitterMode(cc.PARTICLE_MODE_GRAVITY),this.setGravity(cc.p(0,0)),this.setRadialAccel(0),this.setRadialAccelVar(0),this.setSpeed(20),this.setSpeedVar(5),this.setAngle(90),this.setAngleVar(360);var t=cc.Director.getInstance().getWinSize();return this.setPosition(t.width/2,t.height/2),this.setPosVar(cc.PointZero()),this.setLife(1),this.setLifeVar(.5),this.setStartSize(30),this.setStartSizeVar(10),this.setEndSize(cc.PARTICLE_START_SIZE_EQUAL_TO_END_SIZE),this.setEmissionRate(this.getTotalParticles()/this.getLife()),this.setStartColor(cc.c4f(.76,.25,.12,1)),this.setStartColorVar(cc.c4f(0,0,0,0)),this.setEndColor(cc.c4f(0,0,0,1)),this.setEndColorVar(cc.c4f(0,0,0,0)),!0}return!1}}),cc.ParticleSun.create=function(){var e=new cc.ParticleSun;return e.init()?e:null},cc.ParticleGalaxy=cc.ParticleSystem.extend({init:function(){return this.initWithTotalParticles(cc.renderContextType===cc.WEBGL?200:100)},initWithTotalParticles:function(e){if(cc.ParticleSystem.prototype.initWithTotalParticles.call(this,e)){this.setDuration(cc.PARTICLE_DURATION_INFINITY),this.setEmitterMode(cc.PARTICLE_MODE_GRAVITY),this.setGravity(cc.p(0,0)),this.setSpeed(60),this.setSpeedVar(10),this.setRadialAccel(-80),this.setRadialAccelVar(0),this.setTangentialAccel(80),this.setTangentialAccelVar(0),this.setAngle(90),this.setAngleVar(360);var t=cc.Director.getInstance().getWinSize();return this.setPosition(t.width/2,t.height/2),this.setPosVar(cc.PointZero()),this.setLife(4),this.setLifeVar(1),this.setStartSize(37),this.setStartSizeVar(10),this.setEndSize(cc.PARTICLE_START_SIZE_EQUAL_TO_END_SIZE),this.setEmissionRate(this.getTotalParticles()/this.getLife()),this.setStartColor(cc.c4f(.12,.25,.76,1)),this.setStartColorVar(cc.c4f(0,0,0,0)),this.setEndColor(cc.c4f(0,0,0,1)),this.setEndColorVar(cc.c4f(0,0,0,0)),this.setBlendAdditive(!0),!0}return!1}}),cc.ParticleGalaxy.create=function(){var e=new cc.ParticleGalaxy;return e.init()?e:null},cc.ParticleFlower=cc.ParticleSystem.extend({init:function(){return this.initWithTotalParticles(cc.renderContextType===cc.WEBGL?250:100)},initWithTotalParticles:function(e){if(cc.ParticleSystem.prototype.initWithTotalParticles.call(this,e)){this.setDuration(cc.PARTICLE_DURATION_INFINITY),this.setEmitterMode(cc.PARTICLE_MODE_GRAVITY),this.setGravity(cc.p(0,0)),this.setSpeed(80),this.setSpeedVar(10),this.setRadialAccel(-60),this.setRadialAccelVar(0),this.setTangentialAccel(15),this.setTangentialAccelVar(0),this.setAngle(90),this.setAngleVar(360);var t=cc.Director.getInstance().getWinSize();return this.setPosition(t.width/2,t.height/2),this.setPosVar(cc.PointZero()),this.setLife(4),this.setLifeVar(1),this.setStartSize(30),this.setStartSizeVar(10),this.setEndSize(cc.PARTICLE_START_SIZE_EQUAL_TO_END_SIZE),this.setEmissionRate(this.getTotalParticles()/this.getLife()),this.setStartColor(cc.c4f(.5,.5,.5,1)),this.setStartColorVar(cc.c4f(.5,.5,.5,.5)),this.setEndColor(cc.c4f(0,0,0,1)),this.setEndColorVar(cc.c4f(0,0,0,0)),this.setBlendAdditive(!0),!0}return!1}}),cc.ParticleFlower.create=function(){var e=new cc.ParticleFlower;return e.init()?e:null},cc.ParticleMeteor=cc.ParticleSystem.extend({init:function(){return this.initWithTotalParticles(cc.renderContextType===cc.WEBGL?150:100)},initWithTotalParticles:function(e){if(cc.ParticleSystem.prototype.initWithTotalParticles.call(this,e)){this.setDuration(cc.PARTICLE_DURATION_INFINITY),this.setEmitterMode(cc.PARTICLE_MODE_GRAVITY),this.setGravity(cc.p(-200,200)),this.setSpeed(15),this.setSpeedVar(5),this.setRadialAccel(0),this.setRadialAccelVar(0),this.setTangentialAccel(0),this.setTangentialAccelVar(0),this.setAngle(90),this.setAngleVar(360);var t=cc.Director.getInstance().getWinSize();return this.setPosition(t.width/2,t.height/2),this.setPosVar(cc.PointZero()),this.setLife(2),this.setLifeVar(1),this.setStartSize(60),this.setStartSizeVar(10),this.setEndSize(cc.PARTICLE_START_SIZE_EQUAL_TO_END_SIZE),this.setEmissionRate(this.getTotalParticles()/this.getLife()),this.setStartColor(cc.c4f(.2,.4,.7,1)),this.setStartColorVar(cc.c4f(0,0,.2,.1)),this.setEndColor(cc.c4f(0,0,0,1)),this.setEndColorVar(cc.c4f(0,0,0,0)),this.setBlendAdditive(!0),!0}return!1}}),cc.ParticleMeteor.create=function(){var e=new cc.ParticleMeteor;return e.init()?e:null},cc.ParticleSpiral=cc.ParticleSystem.extend({init:function(){return this.initWithTotalParticles(cc.renderContextType===cc.WEBGL?500:100)},initWithTotalParticles:function(e){if(cc.ParticleSystem.prototype.initWithTotalParticles.call(this,e)){this.setDuration(cc.PARTICLE_DURATION_INFINITY),this.setEmitterMode(cc.PARTICLE_MODE_GRAVITY),this.setGravity(cc.p(0,0)),this.setSpeed(150),this.setSpeedVar(0),this.setRadialAccel(-380),this.setRadialAccelVar(0),this.setTangentialAccel(45),this.setTangentialAccelVar(0),this.setAngle(90),this.setAngleVar(0);var t=cc.Director.getInstance().getWinSize();return this.setPosition(t.width/2,t.height/2),this.setPosVar(cc.PointZero()),this.setLife(12),this.setLifeVar(0),this.setStartSize(20),this.setStartSizeVar(0),this.setEndSize(cc.PARTICLE_START_SIZE_EQUAL_TO_END_SIZE),this.setEmissionRate(this.getTotalParticles()/this.getLife()),this.setStartColor(cc.c4f(.5,.5,.5,1)),this.setStartColorVar(cc.c4f(.5,.5,.5,0)),this.setEndColor(cc.c4f(.5,.5,.5,1)),this.setEndColorVar(cc.c4f(.5,.5,.5,0)),this.setBlendAdditive(!1),!0}return!1}}),cc.ParticleSpiral.create=function(){var e=new cc.ParticleSpiral;return e.init()?e:null},cc.ParticleExplosion=cc.ParticleSystem.extend({init:function(){return this.initWithTotalParticles(cc.renderContextType===cc.WEBGL?700:300)},initWithTotalParticles:function(e){if(cc.ParticleSystem.prototype.initWithTotalParticles.call(this,e)){this.setDuration(.1),this.setEmitterMode(cc.PARTICLE_MODE_GRAVITY),this.setGravity(cc.p(0,0)),this.setSpeed(70),this.setSpeedVar(40),this.setRadialAccel(0),this.setRadialAccelVar(0),this.setTangentialAccel(0),this.setTangentialAccelVar(0),this.setAngle(90),this.setAngleVar(360);var t=cc.Director.getInstance().getWinSize();return this.setPosition(t.width/2,t.height/2),this.setPosVar(cc.PointZero()),this.setLife(5),this.setLifeVar(2),this.setStartSize(15),this.setStartSizeVar(10),this.setEndSize(cc.PARTICLE_START_SIZE_EQUAL_TO_END_SIZE),this.setEmissionRate(this.getTotalParticles()/this.getDuration()),this.setStartColor(cc.c4f(.7,.1,.2,1)),this.setStartColorVar(cc.c4f(.5,.5,.5,0)),this.setEndColor(cc.c4f(.5,.5,.5,0)),this.setEndColorVar(cc.c4f(.5,.5,.5,0)),this.setBlendAdditive(!1),!0}return!1}}),cc.ParticleExplosion.create=function(){var e=new cc.ParticleExplosion;return e.init()?e:null},cc.ParticleSmoke=cc.ParticleSystem.extend({init:function(){return this.initWithTotalParticles(cc.renderContextType===cc.WEBGL?200:100)},initWithTotalParticles:function(e){if(cc.ParticleSystem.prototype.initWithTotalParticles.call(this,e)){this.setDuration(cc.PARTICLE_DURATION_INFINITY),this.setEmitterMode(cc.PARTICLE_MODE_GRAVITY),this.setGravity(cc.p(0,0)),this.setRadialAccel(0),this.setRadialAccelVar(0),this.setSpeed(25),this.setSpeedVar(10),this.setAngle(90),this.setAngleVar(5);var t=cc.Director.getInstance().getWinSize();return this.setPosition(t.width/2,0),this.setPosVar(cc.p(20,0)),this.setLife(4),this.setLifeVar(1),this.setStartSize(60),this.setStartSizeVar(10),this.setEndSize(cc.PARTICLE_START_SIZE_EQUAL_TO_END_SIZE),this.setEmissionRate(this.getTotalParticles()/this.getLife()),this.setStartColor(cc.c4f(.8,.8,.8,1)),this.setStartColorVar(cc.c4f(.02,.02,.02,0)),this.setEndColor(cc.c4f(0,0,0,1)),this.setEndColorVar(cc.c4f(0,0,0,0)),this.setBlendAdditive(!1),!0}return!1}}),cc.ParticleSmoke.create=function(){var e=new cc.ParticleSmoke;return e.init()?e:null},cc.ParticleSnow=cc.ParticleSystem.extend({init:function(){return this.initWithTotalParticles(cc.renderContextType===cc.WEBGL?700:250)},initWithTotalParticles:function(e){if(cc.ParticleSystem.prototype.initWithTotalParticles.call(this,e)){this.setDuration(cc.PARTICLE_DURATION_INFINITY),this.setEmitterMode(cc.PARTICLE_MODE_GRAVITY),this.setGravity(cc.p(0,-1)),this.setSpeed(5),this.setSpeedVar(1),this.setRadialAccel(0),this.setRadialAccelVar(1),this.setTangentialAccel(0),this.setTangentialAccelVar(1);var t=cc.Director.getInstance().getWinSize();return this.setPosition(t.width/2,t.height+10),this.setPosVar(cc.p(t.width/2,0)),this.setAngle(-90),this.setAngleVar(5),this.setLife(45),this.setLifeVar(15),this.setStartSize(10),this.setStartSizeVar(5),this.setEndSize(cc.PARTICLE_START_SIZE_EQUAL_TO_END_SIZE),this.setEmissionRate(10),this.setStartColor(cc.c4f(1,1,1,1)),this.setStartColorVar(cc.c4f(0,0,0,0)),this.setEndColor(cc.c4f(1,1,1,0)),this.setEndColorVar(cc.c4f(0,0,0,0)),this.setBlendAdditive(!1),!0}return!1}}),cc.ParticleSnow.create=function(){var e=new cc.ParticleSnow;return e.init()?e:null},cc.ParticleRain=cc.ParticleSystem.extend({init:function(){return this.initWithTotalParticles(cc.renderContextType===cc.WEBGL?1e3:300)},initWithTotalParticles:function(e){if(cc.ParticleSystem.prototype.initWithTotalParticles.call(this,e)){this.setDuration(cc.PARTICLE_DURATION_INFINITY),this.setEmitterMode(cc.PARTICLE_MODE_GRAVITY),this.setGravity(cc.p(10,-10)),this.setRadialAccel(0),this.setRadialAccelVar(1),this.setTangentialAccel(0),this.setTangentialAccelVar(1),this.setSpeed(130),this.setSpeedVar(30),this.setAngle(-90),this.setAngleVar(5);var t=cc.Director.getInstance().getWinSize();return this.setPosition(t.width/2,t.height),this.setPosVar(cc.p(t.width/2,0)),this.setLife(4.5),this.setLifeVar(0),this.setStartSize(4),this.setStartSizeVar(2),this.setEndSize(cc.PARTICLE_START_SIZE_EQUAL_TO_END_SIZE),this.setEmissionRate(20),this.setStartColor(cc.c4f(.7,.8,1,1)),this.setStartColorVar(cc.c4f(0,0,0,0)),this.setEndColor(cc.c4f(.7,.8,1,.5)),this.setEndColorVar(cc.c4f(0,0,0,0)),this.setBlendAdditive(!1),!0}return!1}}),cc.ParticleRain.create=function(){var e=new cc.ParticleRain;return e.init()?e:null},cc.PARTICLE_DEFAULT_CAPACITY=500,cc.ParticleBatchNode=cc.Node.extend({TextureProtocol:!0,_blendFunc:null,_textureAtlas:null,ctor:function(){cc.Node.prototype.ctor.call(this),this._blendFunc={src:cc.BLEND_SRC,dst:cc.BLEND_DST}},initWithTexture:function(e,t){return this._textureAtlas=new cc.TextureAtlas,this._textureAtlas.initWithTexture(e,t),this._children.length=0,cc.renderContextType===cc.WEBGL&&this.setShaderProgram(cc.ShaderCache.getInstance().programForKey(cc.SHADER_POSITION_TEXTURECOLOR)),!0},initWithFile:function(e,t){var n=cc.TextureCache.getInstance().addImage(e);return this.initWithTexture(n,t)},init:function(e,t){var n=cc.TextureCache.getInstance().addImage(e);return this.initWithTexture(n,t)},addChild:function(e,t,n){if(!e)throw"cc.ParticleBatchNode.addChild() : child should be non-null";if(!(e instanceof cc.ParticleSystem))throw"cc.ParticleBatchNode.addChild() : only supports cc.ParticleSystem as children";t=t==null?e.getZOrder():t,n=n==null?e.getTag():n;if(e.getTexture()!=this._textureAtlas.getTexture())throw"cc.ParticleSystem.addChild() : the child is not using the same texture id";var r=e.getBlendFunc();if(this._children.length===0)this.setBlendFunc(r);else if(r.src!=this._blendFunc.src||r.dst!=this._blendFunc.dst){cc.log("cc.ParticleSystem.addChild() : Can't add a ParticleSystem that uses a different blending function");return}var i=this._addChildHelper(e,t,n),s=0;if(i!=0){var o=this._children[i-1];s=o.getAtlasIndex()+o.getTotalParticles()}else s=0;this.insertChild(e,s),e.setBatchNode(this)},insertChild:function(e,t){var n=e.getTotalParticles(),r=this._textureAtlas,i=r.getTotalQuads();e.setAtlasIndex(t),i+n>r.getCapacity()&&(this._increaseAtlasCapacityTo(i+n),r.fillWithEmptyQuadsFromIndex(r.getCapacity()-n,n)),e.getAtlasIndex()+n!=i&&r.moveQuadsFromIndex(t,t+n),r.increaseTotalQuadsWith(n),this._updateAllAtlasIndexes()},removeChild:function(e,t){if(e==null)return;if(!(e instanceof cc.ParticleSystem))throw"cc.ParticleBatchNode.removeChild(): only supports cc.ParticleSystem as children";if(this._children.indexOf(e)==-1){cc.log("cc.ParticleBatchNode.removeChild(): doesn't contain the sprite. Can't remove it");return}cc.Node.prototype.removeChild.call(this,e,t);var n=this._textureAtlas;n.removeQuadsAtIndex(e.getAtlasIndex(),e.getTotalParticles()),n.fillWithEmptyQuadsFromIndex(n.getTotalQuads(),e.getTotalParticles()),e.setBatchNode(null),this._updateAllAtlasIndexes()},reorderChild:function(e,t){if(!e)throw"cc.ParticleBatchNode.reorderChild(): child should be non-null";if(!(e instanceof cc.ParticleSystem))throw"cc.ParticleBatchNode.reorderChild(): only supports cc.QuadParticleSystems as children";if(this._children.indexOf(e)===-1){cc.log("cc.ParticleBatchNode.reorderChild(): Child doesn't belong to batch");return}if(t==e.getZOrder())return;if(this._children.length>1){var n=this._getCurrentIndex(e,t);if(n.oldIndex!=n.newIndex){cc.ArrayRemoveObjectAtIndex(this._children,n.oldIndex),this._children=cc.ArrayAppendObjectToIndex(this._children,e,n.newIndex);var r=e.getAtlasIndex();this._updateAllAtlasIndexes();var i=0,s=this._children;for(var o=0;o<s.length;o++){var u=s[o];if(u==e){i=e.getAtlasIndex();break}}this._textureAtlas.moveQuadsFromIndex(r,e.getTotalParticles(),i),e.updateWithNoTime()}}e._setZOrder(t)},removeChildAtIndex:function(e,t){this.removeChild(this._children[i],t)},removeAllChildren:function(e){var t=this._children;for(var n=0;n<t.length;n++)t[n].setBatchNode(null);cc.Node.prototype.removeAllChildren.call(this,e),this._textureAtlas.removeAllQuads()},disableParticle:function(e){var t=this._textureAtlas.getQuads()[e];t.br.vertices.x=t.br.vertices.y=t.tr.vertices.x=t.tr.vertices.y=t.tl.vertices.x=t.tl.vertices.y=t.bl.vertices.x=t.bl.vertices.y=0,this._textureAtlas._setDirty(!0)},draw:function(e){if(cc.renderContextType===cc.CANVAS)return;if(this._textureAtlas.getTotalQuads()==0)return;cc.NODE_DRAW_SETUP(this),cc.glBlendFuncForParticle(this._blendFunc.src,this._blendFunc.dst),this._textureAtlas.drawQuads()},getTexture:function(){return this._textureAtlas.getTexture()},setTexture:function(e){this._textureAtlas.setTexture(e);var t=this._blendFunc;e&&!e.hasPremultipliedAlpha()&&t.src==gl.BLEND_SRC&&t.dst==gl.BLEND_DST&&(t.src=gl.SRC_ALPHA,t.dst=gl.ONE_MINUS_SRC_ALPHA)},setBlendFunc:function(e,t){t===undefined?(this._blendFunc.src=e.src,this._blendFunc.dst=e.dst):(this._blendFunc.src=e,this._blendFunc.src=t)},getBlendFunc:function(){return{src:this._blendFunc.src,dst:this._blendFunc.dst}},visit:function(e){if(cc.renderContextType===cc.CANVAS)return;if(!this._visible)return;cc.kmGLPushMatrix(),this._grid&&this._grid.isActive()&&(this._grid.beforeDraw(),this.transformAncestors()),this.transform(e),this.draw(e),this._grid&&this._grid.isActive()&&this._grid.afterDraw(this),cc.kmGLPopMatrix()},_updateAllAtlasIndexes:function(){var e=0,t=this._children;for(var n=0;n<t.length;n++){var r=t[n];r.setAtlasIndex(e),e+=r.getTotalParticles()}},_increaseAtlasCapacityTo:function(e){cc.log("cocos2d: cc.ParticleBatchNode: resizing TextureAtlas capacity from ["+this._textureAtlas.getCapacity()+"] to ["+e+"]."),this._textureAtlas.resizeCapacity(e)||cc.log("cc.ParticleBatchNode._increaseAtlasCapacityTo() : WARNING: Not enough memory to resize the atlas")},_searchNewPositionInChildrenForZ:function(e){var t=this._children,n=t.length;for(var r=0;r<n;r++)if(t[r].getZOrder()>e)return r;return n},_getCurrentIndex:function(e,t){var n=!1,r=!1,i=0,s=0,o=0,u=this._children,a=u.length;for(var f=0;f<a;f++){var l=u[f];if(l.getZOrder()>t&&!r){i=f,r=!0;if(n&&r)break}if(e==l){s=f,n=!0,r||(o=-1);if(n&&r)break}}return r||(i=a),i+=o,{newIndex:i,oldIndex:s}},_addChildHelper:function(e,t,n){if(!e)throw"cc.ParticleBatchNode._addChildHelper(): child should be non-null";if(e.getParent())return cc.log("cc.ParticleBatchNode._addChildHelper(): child already added. It can't be added again"),null;this._children||(this._children=[]);var r=this._searchNewPositionInChildrenForZ(t);return this._children=cc.ArrayAppendObjectToIndex(this._children,e,r),e.setTag(n),e._setZOrder(t),e.setParent(this),this._running&&(e.onEnter(),e.onEnterTransitionDidFinish()),r},_updateBlendFunc:function(){this._textureAtlas.getTexture().hasPremultipliedAlpha()||(this._blendFunc.src=gl.SRC_ALPHA,this._blendFunc.dst=gl.ONE_MINUS_SRC_ALPHA)},getTextureAtlas:function(){return this._textureAtlas},setTextureAtlas:function(e){this._textureAtlas=e}}),cc.ParticleBatchNode.createWithTexture=function(e,t){var n=new cc.ParticleBatchNode;return n&&n.initWithTexture(e,t)?n:null},cc.ParticleBatchNode.create=function(e,t){var n=new cc.ParticleBatchNode;return n&&n.init(e,t)?n:null},cc.Touch=cc.Class.extend({_point:null,_prevPoint:cc.PointZero(),_id:0,ctor:function(e,t,n){this._point=cc.p(e||0,t||0),this._id=n||0},getLocation:function(){return this._point},getPreviousLocation:function(){return this._prevPoint},getDelta:function(){return cc.pSub(this._point,this._prevPoint)},getID:function(){return this._id},getId:function(){return this._id},setTouchInfo:function(e,t,n){this._prevPoint=this._point,this._point=cc.p(t||0,n||0),this._id=e},_setPrevPoint:function(e,t){this._prevPoint=cc.p(e||0,t||0)}}),cc.TouchDelegate=cc.Class.extend({_eventTypeFuncMap:null,onTouchBegan:function(e,t){return!1},onTouchMoved:function(e,t){},onTouchEnded:function(e,t){},onTouchCancelled:function(e,t){},onTouchesBegan:function(e,t){},onTouchesMoved:function(e,t){},onTouchesEnded:function(e,t){},onTouchesCancelled:function(e,t){},touchDelegateRetain:function(){},touchDelegateRelease:function(){}}),cc.TargetedTouchDelegate=cc.TouchDelegate.extend({onTouchBegan:function(e,t){return!1},onTouchMoved:function(e,t){},onTouchEnded:function(e,t){},onTouchCancelled:function(e,t){}}),cc.StandardTouchDelegate=cc.TouchDelegate.extend({onTouchesBegan:function(e,t){},onTouchesMoved:function(e,t){},onTouchesEnded:function(e,t){},onTouchesCancelled:function(e,t){}}),cc.TouchHandler=cc.Class.extend({_delegate:null,_priority:0,_enabledSelectors:0,getDelegate:function(){return this._delegate},setDelegate:function(e){this._delegate=e},getPriority:function(){return this._priority},setPriority:function(e){this._priority=e},getEnabledSelectors:function(){return this._enabledSelectors},setEnalbedSelectors:function(e){this._enabledSelectors=e},initWithDelegate:function(e,t){if(!e)throw"cc.TouchHandler.initWithDelegate(): touch delegate should not be null";return this._delegate=e,this._priority=t,this._enabledSelectors=0,!0}}),cc.TouchHandler.create=function(e,t){var n=new cc.TouchHandler;return n&&n.initWithDelegate(e,t),n},cc.StandardTouchHandler=cc.TouchHandler.extend({initWithDelegate:function(e,t){return cc.TouchHandler.prototype.initWithDelegate.call(this,e,t)}}),cc.StandardTouchHandler.create=function(e,t){var n=new cc.StandardTouchHandler;return n&&n.initWithDelegate(e,t),n},cc.TargetedTouchHandler=cc.TouchHandler.extend({_swallowsTouches:!1,_claimedTouches:null,isSwallowsTouches:function(){return this._swallowsTouches},setSwallowsTouches:function(e){this._swallowsTouches=e},getClaimedTouches:function(){return this._claimedTouches},initWithDelegate:function(e,t,n){return cc.TouchHandler.prototype.initWithDelegate.call(this,e,t)?(this._claimedTouches=[],this._swallowsTouches=n,!0):!1}}),cc.TargetedTouchHandler.create=function(e,t,n){var r=new cc.TargetedTouchHandler;return r&&r.initWithDelegate(e,t,n),r},cc.TouchSelectorBeganBit=1,cc.TouchSelectorMovedBit=2,cc.TouchSelectorEndedBit=4,cc.TouchSelectorCancelledBit=8,cc.TouchSelectorAllBits=cc.TouchSelectorBeganBit|cc.TouchSelectorMovedBit|cc.TouchSelectorEndedBit|cc.TouchSelectorCancelledBit,cc.TOUCH_BEGAN=0,cc.TOUCH_MOVED=1,cc.TOUCH_ENDED=2,cc.TOUCH_CANCELLED=3,cc.TouchMax=4,cc.less=function(e,t){return e.getPriority()>t.getPriority()},cc.TouchHandlerHelperData=function(e){this.type=e},cc.TouchDispatcher=cc.Class.extend({_mousePressed:!1,_targetedHandlers:null,_standardHandlers:null,_locked:!1,_toAdd:!1,_toRemove:!1,_handlersToAdd:null,_handlersToRemove:null,_toQuit:!1,_dispatchEvents:!1,_handlerHelperData:[new cc.TouchHandlerHelperData(cc.TOUCH_BEGAN),new cc.TouchHandlerHelperData(cc.TOUCH_MOVED),new cc.TouchHandlerHelperData(cc.TOUCH_ENDED),new cc.TouchHandlerHelperData(cc.TOUCH_CANCELLED)],init:function(){return this._dispatchEvents=!0,this._targetedHandlers=[],this._standardHandlers=[],this._handlersToAdd=[],this._handlersToRemove=[],this._toRemove=!1,this._toAdd=!1,this._toQuit=!1,this._locked=!1,this._mousePressed=!1,cc.TouchDispatcher.registerHtmlElementEvent(cc.canvas),!0},_setMousePressed:function(e){this._mousePressed=e},_getMousePressed:function(){return this._mousePressed},isDispatchEvents:function(){return this._dispatchEvents},setDispatchEvents:function(e){this._dispatchEvents=e},_addStandardDelegate:function(e,t){t=t||0;var n=cc.StandardTouchHandler.create(e,t);if(!this._locked)this._standardHandlers=this.forceAddHandler(n,this._standardHandlers);else{if(this._handlersToRemove.indexOf(e)!=-1){cc.ArrayRemoveObject(this._handlersToRemove,e);return}this._handlersToAdd.push(n),this._toAdd=!0}},_addTargetedDelegate:function(e,t,n){var r=cc.TargetedTouchHandler.create(e,t,n);if(!this._locked)this._targetedHandlers=this.forceAddHandler(r,this._targetedHandlers);else{if(this._handlersToRemove.indexOf(e)!=-1){cc.ArrayRemoveObject(this._handlersToRemove,e);return}this._handlersToAdd.push(r),this._toAdd=!0}},forceAddHandler:function(e,t){var n=0,r;for(var i=0;i<t.length;i++){r=t[i];if(r){r.getPriority()<e.getPriority()&&++n;if(r.getDelegate()==e.getDelegate())return cc.log("cc.TouchDispatcher.forceAddHandler(): The handler has been added."),t}}return cc.ArrayAppendObjectToIndex(t,e,n)},forceRemoveAllDelegates:function(){this._standardHandlers.length=0,this._targetedHandlers.length=0},_removeDelegate:function(e){if(e==null)return;if(!this._locked)this.forceRemoveDelegate(e);else{var t=this.findHandler(this._handlersToAdd,e);if(t){cc.ArrayRemoveObject(this._handlersToAdd,t);return}this._handlersToRemove.push(e),this._toRemove=!0}},removeAllDelegates:function(){this._locked?this._toQuit=!0:this.forceRemoveAllDelegates()},setPriority:function(e,t){if(!t)throw"cc.TouchDispatcher.setPriority(): delegate should be non-null.";var n=this.findHandler(t);if(!n){cc.log("cc.TouchDispatcher.setPriority(): Can't find TouchHandler.");return}n.getPriority()!=e&&(n.setPriority(e),this.rearrangeHandlers(this._targetedHandlers),this.rearrangeHandlers(this._standardHandlers))},touches:function(e,t,n){if(n<0||n>=4)throw"cc.TouchDispatcher.touches(): invalid index";this._locked=!0;var r=this._targetedHandlers.length,i=this._standardHandlers.length,s=r&&i,o=s?e.slice():e,u=this._handlerHelperData[n];if(r>0){var a,f,l;for(var c=0;c<e.length;c++){a=e[c];for(var h=0;h<this._targetedHandlers.length;h++){f=this._targetedHandlers[h];if(!f)break;l=!1;if(n==cc.TOUCH_BEGAN)f.getDelegate().onTouchBegan&&(l=f.getDelegate().onTouchBegan(a,t),l&&f.getClaimedTouches().push(a));else if(f.getClaimedTouches().length>0){l=!0;switch(u.type){case cc.TOUCH_MOVED:cc.Browser.isMobile?f.getDelegate().onTouchMoved&&f.getDelegate().onTouchMoved(a,t):this._mousePressed&&f.getDelegate().onTouchMoved&&f.getDelegate().onTouchMoved(a,t);break;case cc.TOUCH_ENDED:f.getDelegate().onTouchEnded&&f.getDelegate().onTouchEnded(a,t),f.getClaimedTouches().length=0;break;case cc.TOUCH_CANCELLED:f.getDelegate().onTouchCancelled&&f.getDelegate().onTouchCancelled(a,t),f.getClaimedTouches().length=0}}if(l&&f.isSwallowsTouches()){s&&cc.ArrayRemoveObject(o,a);break}}}}if(i>0)for(c=0;c<this._standardHandlers.length;c++){f=this._standardHandlers[c];if(!f)break;switch(u.type){case cc.TOUCH_BEGAN:o.length>0&&f.getDelegate().onTouchesBegan&&f.getDelegate().onTouchesBegan(o,t);break;case cc.TOUCH_MOVED:o.length>0&&(cc.Browser.isMobile?f.getDelegate().onTouchesMoved&&f.getDelegate().onTouchesMoved(o,t):this._mousePressed&&f.getDelegate().onTouchesMoved&&f.getDelegate().onTouchesMoved(o,t));break;case cc.TOUCH_ENDED:f.getDelegate().onTouchesEnded&&f.getDelegate().onTouchesEnded(o,t);break;case cc.TOUCH_CANCELLED:f.getDelegate().onTouchesCancelled&&f.getDelegate().onTouchesCancelled(o,t)}}s&&(o=null),this._locked=!1;if(this._toRemove){this._toRemove=!1;for(c=0;c<this._handlersToRemove.length;c++)this.forceRemoveDelegate(this._handlersToRemove[c]);this._handlersToRemove.length=0}if(this._toAdd){this._toAdd=!1;for(c=0;c<this._handlersToAdd.length;c++){f=this._handlersToAdd[c];if(!f)break;f instanceof cc.TargetedTouchHandler?this._targetedHandlers=this.forceAddHandler(f,this._targetedHandlers):this._standardHandlers=this.forceAddHandler(f,this._standardHandlers)}this._handlersToAdd.length=0}this._toQuit&&(this._toQuit=!1,this.forceRemoveAllDelegates())},touchesBegan:function(e,t){this._dispatchEvents&&this.touches(e,t,cc.TOUCH_BEGAN)},touchesMoved:function(e,t){this._dispatchEvents&&this.touches(e,t,cc.TOUCH_MOVED)},touchesEnded:function(e,t){this._dispatchEvents&&this.touches(e,t,cc.TOUCH_ENDED)},touchesCancelled:function(e,t){this._dispatchEvents&&this.touches(e,t,cc.TOUCH_CANCELLED)},findHandler:function(e,t){switch(arguments.length){case 1:t=arguments[0];if(!t)throw"cc.TouchDispatcher.findHandler(): delegate should be non-null.";for(var n=0;n<this._targetedHandlers.length;n++)if(this._targetedHandlers[n].getDelegate()==t)return this._targetedHandlers[n];for(n=0;n<this._standardHandlers.length;n++)if(this._standardHandlers[n].getDelegate()==t)return this._standardHandlers[n];return null;case 2:if(!e)throw"cc.TouchDispatcher.findHandler(): array should be non-null.";if(!t)throw"cc.TouchDispatcher.findHandler(): delegate should be non-null.";for(n=0;n<e.length;n++)if(e[n].getDelegate()==t)return e[n];return null;default:throw"Argument must be non-nil "}},forceRemoveDelegate:function(e){var t;for(var n=0;n<this._standardHandlers.length;n++){t=this._standardHandlers[n];if(t&&t.getDelegate()==e){cc.ArrayRemoveObject(this._standardHandlers,t);break}}for(n=0;n<this._targetedHandlers.length;n++){t=this._targetedHandlers[n];if(t&&t.getDelegate()==e){cc.ArrayRemoveObject(this._targetedHandlers,t);break}}},rearrangeHandlers:function(e){e.sort(cc.less)}}),cc.TouchDispatcher.preTouchPoint=cc.p(0,0),cc.TouchDispatcher.isRegisterEvent=!1,cc.getHTMLElementPosition=function(e){var t=document.documentElement,n=window,r=null;return typeof e.getBoundingClientRect=="function"?r=e.getBoundingClientRect():e instanceof HTMLCanvasElement?r={left:0,top:0,width:e.width,height:e.height}:r={left:0,top:0,width:parseInt(e.style.width),height:parseInt(e.style.height)},{left:r.left+n.pageXOffset-t.clientLeft,top:r.top+n.pageYOffset-t.clientTop,width:r.width,height:r.height}},cc.ProcessMouseupEvent=function(e,t){var n=cc.getHTMLElementPosition(e),r,i;t.pageX!=null?(r=t.pageX,i=t.pageY):(n.left-=document.body.scrollLeft,n.top-=document.body.scrollTop,r=t.clientX,i=t.clientY);var s=cc.EGLView.getInstance().convertToLocationInView(r,i,n),o=new cc.Touch(s.x,s.y);o._setPrevPoint(cc.TouchDispatcher.preTouchPoint.x,cc.TouchDispatcher.preTouchPoint.y),cc.TouchDispatcher.preTouchPoint.x=s.x,cc.TouchDispatcher.preTouchPoint.y=s.y;var u=[];u.push(o),cc.EGLView.getInstance().touchesEnded(u,null)},cc.TouchDispatcher.registerHtmlElementEvent=function(e){if(cc.TouchDispatcher.isRegisterEvent)return;if(!cc.Browser.isMobile)window.addEventListener("mousedown",function(e){cc.Director.getInstance().getTouchDispatcher()._setMousePressed(!0)}),window.addEventListener("mouseup",function(t){cc.Director.getInstance().getTouchDispatcher()._setMousePressed(!1);var n=cc.getHTMLElementPosition(e),r,i;t.pageX!=null?(r=t.pageX,i=t.pageY):(n.left-=document.body.scrollLeft,n.top-=document.body.scrollTop,r=t.clientX,i=t.clientY);if(!cc.rectContainsPoint(new cc.Rect(n.left,n.top,n.width,n.height),cc.p(r,i))){var s=cc.EGLView.getInstance().convertToLocationInView(r,i,n),o=new cc.Touch(s.x,s.y);o._setPrevPoint(cc.TouchDispatcher.preTouchPoint.x,cc.TouchDispatcher.preTouchPoint.y),cc.TouchDispatcher.preTouchPoint.x=s.x,cc.TouchDispatcher.preTouchPoint.y=s.y;var u=[];u.push(o),cc.EGLView.getInstance().touchesEnded(u,null)}}),e.addEventListener("mousedown",function(t){var n=cc.getHTMLElementPosition(e),r,i;t.pageX!=null?(r=t.pageX,i=t.pageY):(n.left-=document.body.scrollLeft,n.top-=document.body.scrollTop,r=t.clientX,i=t.clientY);var s=cc.EGLView.getInstance().convertToLocationInView(r,i,n),o=new cc.Touch(s.x,s.y);o._setPrevPoint(cc.TouchDispatcher.preTouchPoint.x,cc.TouchDispatcher.preTouchPoint.y),cc.TouchDispatcher.preTouchPoint.x=s.x,cc.TouchDispatcher.preTouchPoint.y=s.y;var u=[];u.push(o),cc.EGLView.getInstance().touchesBegan(u,null)}),e.addEventListener("mouseup",function(t){cc.ProcessMouseupEvent(e,t)}),e.addEventListener("mousemove",function(t){var n=cc.getHTMLElementPosition(e),r,i;t.pageX!=null?(r=t.pageX,i=t.pageY):(n.left-=document.body.scrollLeft,n.top-=document.body.scrollTop,r=t.clientX,i=t.clientY);var s=cc.EGLView.getInstance().convertToLocationInView(r,i,n),o=new cc.Touch(s.x,s.y);o._setPrevPoint(cc.TouchDispatcher.preTouchPoint.x,cc.TouchDispatcher.preTouchPoint.y),cc.TouchDispatcher.preTouchPoint.x=s.x,cc.TouchDispatcher.preTouchPoint.y=s.y;var u=[];u.push(o),cc.EGLView.getInstance().touchesMoved(u,null)});else if(window.navigator.msPointerEnabled){var t={MSPointerDown:"touchesBegan",MSPointerMove:"touchesMoved",MSPointerUp:"touchesEnded",MSPointerCancel:"touchesCancelled"};for(var n in t)(function(t,n){e.addEventListener(t,function(t){var r=cc.getHTMLElementPosition(e);r.left-=document.body.scrollLeft,r.top-=document.body.scrollTop;var i,s,o,u;i=t.clientX,s=t.clientY;var a=cc.EGLView.getInstance().convertToLocationInView(i,s,r),o=new cc.Touch(a.x,a.y);o._setPrevPoint(cc.TouchDispatcher.preTouchPoint.x,cc.TouchDispatcher.preTouchPoint.y),cc.TouchDispatcher.preTouchPoint.x=a.x,cc.TouchDispatcher.preTouchPoint.y=a.y,cc.Director.getInstance().getTouchDispatcher()[n]([o],null),t.stopPropagation(),t.preventDefault()},!1)})(n,t[n])}else e.addEventListener("touchstart",function(t){if(!t.changedTouches)return;var n=[],r=cc.getHTMLElementPosition(e);r.left-=document.body.scrollLeft,r.top-=document.body.scrollTop;var i,s,o,u,a,f=t.changedTouches.length;for(var l=0;l<f;l++){i=t.changedTouches[l];if(i){s=i.clientX,o=i.clientY;var c=cc.EGLView.getInstance().convertToLocationInView(s,o,r);u=null,i.identifier?(u=new cc.Touch(c.x,c.y,i.identifier),a=cc.TouchDispatcher._getPreTouch(u).getLocation(),u._setPrevPoint(a.x,a.y),cc.TouchDispatcher._setPreTouch(u)):(u=new cc.Touch(c.x,c.y),u._setPrevPoint(cc.TouchDispatcher.preTouchPoint.x,cc.TouchDispatcher.preTouchPoint.y)),cc.TouchDispatcher.preTouchPoint.x=c.x,cc.TouchDispatcher.preTouchPoint.y=c.y,n.push(u)}}cc.EGLView.getInstance().touchesBegan(n,null),t.stopPropagation(),t.preventDefault()},!1),e.addEventListener("touchmove",function(t){if(!t.changedTouches)return;var n=[],r=cc.getHTMLElementPosition(e);r.left-=document.body.scrollLeft,r.top-=document.body.scrollTop;var i,s,o,u,a,f=t.changedTouches.length;for(var l=0;l<f;l++){i=t.changedTouches[l];if(i){s=i.clientX,o=i.clientY;var c=cc.EGLView.getInstance().convertToLocationInView(s,o,r);u=null,i.identifier?(u=new cc.Touch(c.x,c.y,i.identifier),a=cc.TouchDispatcher._getPreTouch(u).getLocation(),u._setPrevPoint(a.x,a.y),cc.TouchDispatcher._setPreTouch(u)):(u=new cc.Touch(c.x,c.y),u._setPrevPoint(cc.TouchDispatcher.preTouchPoint.x,cc.TouchDispatcher.preTouchPoint.y)),cc.TouchDispatcher.preTouchPoint.x=c.x,cc.TouchDispatcher.preTouchPoint.y=c.y,n.push(u)}}cc.EGLView.getInstance().touchesMoved(n,null),t.stopPropagation(),t.preventDefault()},!1),e.addEventListener("touchend",function(t){if(!t.changedTouches)return;var n=[],r=cc.getHTMLElementPosition(e);r.left-=document.body.scrollLeft,r.top-=document.body.scrollTop;var i,s,o,u,a,f=t.changedTouches.length;for(var l=0;l<f;l++){i=t.changedTouches[l];if(i){s=i.clientX,o=i.clientY;var c=cc.EGLView.getInstance().convertToLocationInView(s,o,r);u=null,i.identifier?(u=new 
cc.Touch(c.x,c.y,i.identifier),a=cc.TouchDispatcher._getPreTouch(u).getLocation(),u._setPrevPoint(a.x,a.y),cc.TouchDispatcher._deletePreTouchWithSameId(u)):(u=new cc.Touch(c.x,c.y),u._setPrevPoint(cc.TouchDispatcher.preTouchPoint.x,cc.TouchDispatcher.preTouchPoint.y)),cc.TouchDispatcher.preTouchPoint.x=c.x,cc.TouchDispatcher.preTouchPoint.y=c.y,n.push(u)}}cc.EGLView.getInstance().touchesEnded(n,null),t.stopPropagation(),t.preventDefault()},!1),e.addEventListener("touchcancel",function(t){if(!t.changedTouches)return;var n=[],r=cc.getHTMLElementPosition(e);r.left-=document.body.scrollLeft,r.top-=document.body.scrollTop;var i,s,o,u,a,f=t.changedTouches.length;for(var l=0;l<f;l++){i=t.changedTouches[l];if(i){s=i.clientX,o=i.clientY;var c=cc.EGLView.getInstance().convertToLocationInView(s,o,r);u=null,i.identifier?(u=new cc.Touch(c.x,c.y,i.identifier),a=cc.TouchDispatcher._getPreTouch(u).getLocation(),u._setPrevPoint(a.x,a.y),cc.TouchDispatcher._deletePreTouchWithSameId(u)):(u=new cc.Touch(c.x,c.y),u._setPrevPoint(cc.TouchDispatcher.preTouchPoint.x,cc.TouchDispatcher.preTouchPoint.y)),cc.TouchDispatcher.preTouchPoint.x=c.x,cc.TouchDispatcher.preTouchPoint.y=c.y,n.push(u)}}cc.EGLView.getInstance().touchesCancelled(n,null),t.stopPropagation(),t.preventDefault()},!1);cc.TouchDispatcher.isRegisterEvent=!0},cc.TouchDispatcher._getPreTouch=function(e){var t=null,n=cc.TouchDispatcher._preTouchPool,r=e.getId();for(var i=n.length-1;i>=0;i--)if(n[i].getId()==r){t=n[i];break}return t||(t=e),t},cc.TouchDispatcher._setPreTouch=function(e){var t=!1,n=cc.TouchDispatcher._preTouchPool,r=e.getId();for(var i=n.length-1;i>=0;i--)if(n[i].getId()==r){n[i]=e,t=!0;break}t||(n.length<=50?n.push(e):(n[cc.TouchDispatcher._preTouchPoolPointer]=e,cc.TouchDispatcher._preTouchPoolPointer=(cc.TouchDispatcher._preTouchPoolPointer+1)%50))},cc.TouchDispatcher._deletePreTouchWithSameId=function(e){var t,n=cc.TouchDispatcher._preTouchPool,r=e.getId();for(var i=n.length-1;i>=0;i--)if(n[i].getId()==r){t=n.pop(),i!=n.length&&(n[i]=t);break}},cc.TouchDispatcher._preTouchPool=[],cc.TouchDispatcher._preTouchPoolPointer=0,cc.registerTargetedDelegate=function(e,t,n){cc.Director.getInstance().getTouchDispatcher()._addTargetedDelegate(n,e,t)},cc.registerStandardDelegate=function(e,t){cc.Director.getInstance().getTouchDispatcher()._addStandardDelegate(e,t)},cc.unregisterTouchDelegate=function(e){cc.Director.getInstance().getTouchDispatcher()._removeDelegate(e)},cc.MOUSE_DOWN=1,cc.MOUSE_MOVED=2,cc.MOUSE_DRAGGED=4,cc.MOUSE_UP=8,cc.RIGHT_MOUSE_DOWN=16,cc.RIGHT_MOUSE_DRAGGED=32,cc.RIGHT_MOUSE_UP=64,cc.OTHER_MOUSE_DOWN=128,cc.OTHER_MOUSE_DRAGGED=256,cc.OTHER_MOUSE_UP=512,cc.SCROLL_WHEEL=1024,cc.MOUSE_ENTERED=2048,cc.MOUSE_EXITED=4096,cc.MOUSE_LEFTBUTTON=0,cc.MOUSE_MIDDLEBUTTON=1,cc.MOUSE_RIGHTBUTTON=2,cc.MouseEventDelegate=cc.Class.extend({onMouseDown:function(e){return!1},onMouseDragged:function(e){return!1},onMouseMoved:function(e){return!1},onMouseUp:function(e){return!1},onRightMouseDown:function(e){return!1},onRightMouseDragged:function(e){return!1},onRightMouseUp:function(e){return!1},onOtherMouseDown:function(e){return!1},onOtherMouseDragged:function(e){return!1},onOtherMouseUp:function(e){return!1},onScrollWheel:function(e){return!1},onMouseEntered:function(e){return!1},onMouseExited:function(e){return!1}}),cc.Mouse=cc.Touch.extend({_wheelDelta:0,_button:cc.MOUSE_LEFTBUTTON,getWheelDelta:function(){return this._wheelDelta},setWheelDelta:function(e){this._wheelDelta=e},getButton:function(){return this._button},setButton:function(e){this._button=e}}),cc.MouseHandler=cc.Class.extend({_delegate:null,_priority:0,_enabledSelectors:0,getDelegate:function(){return this._delegate},setDelegate:function(e){this._delegate=e},getPriority:function(){return this._priority},setPriority:function(e){this._priority=e},getEnabledSelectors:function(){return this._enabledSelectors},setEnalbedSelectors:function(e){this._enabledSelectors=e},initWithDelegate:function(e,t){this._delegate=e,this._priority=t}}),cc.MouseHandler.create=function(e,t){var n=new cc.MouseHandler;return n.initWithDelegate(e,t),n},cc.MouseDispatcher=cc.Class.extend({_mousePressed:!1,_rightMousePressed:!1,_mouseDelegateHandlers:null,_dispatchEvents:!1,init:function(){return this._dispatchEvents=!0,this._mouseDelegateHandlers=[],this._mousePressed=!1,this._rightMousePressed=!1,cc.MouseDispatcher._registerHtmlElementEvent(cc.canvas),!0},_setMousePressed:function(e){this._mousePressed=e},_getMousePressed:function(){return this._mousePressed},_setRightMousePressed:function(e){this._rightMousePressed=e},_getRightMousePressed:function(){return this._rightMousePressed},addMouseDelegate:function(e,t){var n=cc.MouseHandler.create(e,t);this._mouseDelegateHandlers=this.forceAddHandler(n,this._mouseDelegateHandlers)},forceAddHandler:function(e,t){var n=0;for(var r=0;r<t.length;r++){var i=t[r];if(i){i.getPriority()<e.getPriority()&&++n;if(i.getDelegate()==e.getDelegate())return cc.log("cc.MouseDispatcher.forceAddHandler(): handler has been added."),t}}return cc.ArrayAppendObjectToIndex(t,e,n)},removeMouseDelegate:function(e){if(e==null)return;for(var t=0;t<this._mouseDelegateHandlers.length;t++){var n=this._mouseDelegateHandlers[t];if(n&&n.getDelegate()==e){cc.ArrayRemoveObject(this._mouseDelegateHandlers,n);break}}},_findHandler:function(e){for(var t=0;t<this._mouseDelegateHandlers.length;t++)if(this._mouseDelegateHandlers[t]&&this._mouseDelegateHandlers[t].getDelegate()==e)return this._mouseDelegateHandlers[t];return null},setPriority:function(e,t){if(!t)throw"cc.MouseDispatcher.setPriority(): delegate should be non-null";var n=this._findHandler(t);if(!n){cc.log("cc.MouseDispatcher.setPriority(): Can't find MouseHandler in array");return}n.getPriority()!=e&&(n.setPriority(e),this._mouseDelegateHandlers.sort(cc.less))},removeAllMouseDelegates:function(){this._mouseDelegateHandlers.length=0},mouseHandle:function(e,t,n){for(var r=0;r<this._mouseDelegateHandlers.length;r++){var i=this._mouseDelegateHandlers[r];switch(n){case cc.MOUSE_DOWN:e.getButton()==cc.MOUSE_RIGHTBUTTON?i.getDelegate().onRightMouseDown&&i.getDelegate().onRightMouseDown(e):i.getDelegate().onMouseDown&&i.getDelegate().onMouseDown(e);break;case cc.MOUSE_UP:e.getButton()==cc.MOUSE_RIGHTBUTTON?i.getDelegate().onRightMouseUp&&i.getDelegate().onRightMouseUp(e):i.getDelegate().onMouseUp&&i.getDelegate().onMouseUp(e);break;case cc.MOUSE_MOVED:this._mousePressed?i.getDelegate().onMouseDragged&&i.getDelegate().onMouseDragged(e):this._rightMousePressed?i.getDelegate().onRightMouseDragged&&i.getDelegate().onRightMouseDragged(e):i.getDelegate().onMouseMoved&&i.getDelegate().onMouseMoved(e);break;case cc.MOUSE_ENTERED:i.getDelegate().onMouseEntered&&i.getDelegate().onMouseEntered(e);break;case cc.MOUSE_EXITED:i.getDelegate().onMouseExited&&i.getDelegate().onMouseExited(e);break;case cc.SCROLL_WHEEL:i.getDelegate().onScrollWheel&&i.getDelegate().onScrollWheel(e)}}}}),cc.MouseDispatcher._preMousePoint=cc.p(0,0),cc.MouseDispatcher._isRegisterEvent=!1,cc.MouseDispatcher._registerHtmlElementEvent=function(e){function t(t){var n=cc.getHTMLElementPosition(e),r=t.pageX,i=t.pageY,s=cc.EGLView.getInstance(),o=s.getDevicePixelRatio(),u=(r-n.left)*o/s.getScaleX(),a=(n.height-(i-n.top))*o/s.getScaleY(),f=new cc.Mouse(u,a);return f._setPrevPoint(cc.MouseDispatcher._preMousePoint.x,cc.MouseDispatcher._preMousePoint.y),f.setButton(t.button),cc.MouseDispatcher._preMousePoint.x=u,cc.MouseDispatcher._preMousePoint.y=a,f}if(cc.MouseDispatcher._isRegisterEvent)return;window.addEventListener("mousedown",function(e){e.button==cc.MOUSE_RIGHTBUTTON?cc.Director.getInstance().getMouseDispatcher()._setRightMousePressed(!0):cc.Director.getInstance().getMouseDispatcher()._setMousePressed(!0)}),window.addEventListener("mouseup",function(e){e.button==cc.MOUSE_RIGHTBUTTON?cc.Director.getInstance().getMouseDispatcher()._setRightMousePressed(!1):cc.Director.getInstance().getMouseDispatcher()._setMousePressed(!1)}),e.addEventListener("mousedown",function(e){cc.Director.getInstance().getMouseDispatcher().mouseHandle(t(e),e,cc.MOUSE_DOWN)}),e.addEventListener("mouseup",function(e){cc.Director.getInstance().getMouseDispatcher().mouseHandle(t(e),e,cc.MOUSE_UP)}),e.addEventListener("mousemove",function(e){cc.Director.getInstance().getMouseDispatcher().mouseHandle(t(e),e,cc.MOUSE_MOVED)}),e.addEventListener("mousewheel",function(e){var n=t(e);n.setWheelDelta(e.wheelDelta),cc.Director.getInstance().getMouseDispatcher().mouseHandle(n,e,cc.SCROLL_WHEEL)},!1),e.addEventListener("DOMMouseScroll",function(e){var n=t(e);n.setWheelDelta(e.detail*-120),cc.Director.getInstance().getMouseDispatcher().mouseHandle(n,e,cc.SCROLL_WHEEL)}),e.addEventListener("mouseout",function(e){cc.Director.getInstance().getMouseDispatcher().mouseHandle(t(e),e,cc.MOUSE_EXITED)},!1),e.addEventListener("mouseover",function(e){cc.Director.getInstance().getMouseDispatcher().mouseHandle(t(e),e,cc.MOUSE_ENTERED)},!1)},cc.KeyboardDelegate=cc.Class.extend({onKeyDown:function(e){},onKeyUp:function(e){}}),cc.KeyboardHandler=cc.Class.extend({getDelegate:function(){return this._delegate},setDelegate:function(e){this._delegate=e},initWithDelegate:function(e){if(!e)throw"cc.KeyboardHandler.initWithDelegate(): delegate must be non-null";return this._delegate=e,!0},_delegate:null}),cc.KeyboardHandler.create=function(e){var t=new cc.KeyboardHandler;return t.initWithDelegate(e),t},cc.TYPE_BACK_CLICKED=1,cc.TYPE_MENU_CLICKED=2,cc.KeyboardDispatcher=cc.Class.extend({addDelegate:function(e){if(!e)return;this._locked?(this._handlersToAdd.push(e),this._toAdd=!0):this.forceAddDelegate(e)},removeDelegate:function(e){if(!e)return;this._locked?(this._handlersToRemove.push(e),this._toRemove=!0):this.forceRemoveDelegate(e)},forceAddDelegate:function(e){var t=cc.KeyboardHandler.create(e);if(t){var n=this._delegates;for(var r=0,i=n.length;r<i;r++)if(n[r].getDelegate()==t.getDelegate()){cc.log("cc.KeyboardDispatcher.forceAddDelegate(): the delegate has been added.");return}this._delegates.push(t)}},forceRemoveDelegate:function(e){var t=this._delegates;for(var n=0,r=t.length;n<r;n++)if(t[n].getDelegate()==e){t.splice(n,1);return}},dispatchKeyboardMSG:function(e,t){this._locked=!0,e.stopPropagation(),e.preventDefault();var n=0;if(t&&e)for(n=0;n<this._delegates.length;n++)this._delegates[n].getDelegate()&&this._delegates[n].getDelegate().onKeyDown&&this._delegates[n].getDelegate().onKeyDown(e.keyCode);else if(!t&&e)for(n=0;n<this._delegates.length;n++)this._delegates[n].getDelegate()&&this._delegates[n].getDelegate().onKeyUp&&this._delegates[n].getDelegate().onKeyUp(e.keyCode);this._locked=!1;if(this._toRemove){this._toRemove=!1;var r=this._handlersToRemove;for(n=0;n<r.length;++n)this.forceRemoveDelegate(r[n]);r.length=0}if(this._toAdd){this._toAdd=!1;var i=this._handlersToAdd;for(n=0;n<i.length;++n)this.forceAddDelegate(i[n]);i.length=0}return!0},_delegates:[],_locked:!1,_toAdd:!1,_toRemove:!1,_handlersToAdd:[],_handlersToRemove:[]}),cc.KeyboardDispatcher.getInstance=function(){return cc.keyboardDispatcher||(cc.keyboardDispatcher=new cc.KeyboardDispatcher,cc.canvas.setAttribute("tabindex",1),cc.canvas.style.outline="none",cc.canvas.style.cursor="default",cc.canvas.addEventListener("keydown",function(e){cc.keyboardDispatcher.dispatchKeyboardMSG(e,!0)}),cc.canvas.addEventListener("keyup",function(e){cc.keyboardDispatcher.dispatchKeyboardMSG(e,!1)})),cc.keyboardDispatcher},cc.KeyboardDispatcher.purgeSharedDispatcher=function(){cc.keyboardDispatcher&&(delete cc.keyboardDispatcher,cc.keyboardDispatcher=null)},cc.UIInterfaceOrientationLandscapeLeft=-90,cc.UIInterfaceOrientationLandscapeRight=90,cc.UIInterfaceOrientationPortraitUpsideDown=180,cc.UIInterfaceOrientationPortrait=0,cc.Acceleration=function(e,t,n,r){this.x=e||0,this.y=t||0,this.z=n||0,this.timestamp=r||0},cc.Accelerometer=cc.Class.extend({setDelegate:function(e){cc.AccelerometerDispatcher.getInstance().addDelegate(e)},setAccelerometerInterval:function(e){cc.AccelerometerDispatcher.getInstance().setAccelerometerInterval(e)}}),cc.AccelerometerDispatcher=cc.Class.extend({_delegate:null,_acceleration:null,_deviceEvent:null,_interval:1/30,_minus:1,_curTime:0,init:function(){this._acceleration=new cc.Acceleration;var e=window;this._deviceEvent=e.DeviceMotionEvent||e.DeviceOrientationEvent,cc.Browser.type=="mqqbrowser"&&(this._deviceEvent=window.DeviceOrientationEvent),this._deviceEventType=this._deviceEvent==e.DeviceMotionEvent?"devicemotion":"deviceorientation";var t=navigator.userAgent;if(/Android/.test(t)||/Adr/.test(t)&&cc.Browser.type=="ucbrowser")this._minus=-1},getDelegate:function(){return this._delegate},addDelegate:function(e){this._delegate=e;var t=this.didAccelerate.bind(this),n=window,r=cc.Director.getInstance().getScheduler();this._delegate?(n.addEventListener(this._deviceEventType,t,!1),r.scheduleUpdateForTarget(this)):(n.removeEventListener(this._deviceEventType,t),r.unscheduleUpdateForTarget(this))},setAccelerometerInterval:function(e){this._interval!==e&&(this._interval=e)},didAccelerate:function(e){if(!this._delegate)return;var t=this._acceleration;if(this._deviceEvent==window.DeviceMotionEvent){var n=e.accelerationIncludingGravity;t.x=this._minus*n.x*.1,t.y=this._minus*n.y*.1,t.z=n.z*.1}else t.x=e.gamma/90*.981,t.y=-(e.beta/90)*.981,t.z=e.alpha/90*.981;t.timestamp=e.timeStamp||Date.now();var r=t.x;switch(window.orientation){case cc.UIInterfaceOrientationLandscapeRight:t.x=-t.y,t.y=r;break;case cc.UIInterfaceOrientationLandscapeLeft:t.x=t.y,t.y=-r;break;case cc.UIInterfaceOrientationPortraitUpsideDown:t.x=-t.x,t.y=-t.y;break;case cc.UIInterfaceOrientationPortrait:}},update:function(e){this._curTime>this._interval&&(this._curTime-=this._interval,this._delegate.onAccelerometer(this._acceleration)),this._curTime+=e}}),cc.AccelerometerDispatcher.getInstance=function(){return this._instance||(this._instance=new cc.AccelerometerDispatcher,this._instance.init()),this._instance},cc.IMEKeyboardNotificationInfo=function(e,t,n){this.begin=e||cc.RectZero(),this.end=t||cc.RectZero(),this.duration=n||0},cc.IMEDelegate=cc.Class.extend({ctor:function(){cc.IMEDispatcher.getInstance().addDelegate(this)},removeDelegate:function(){cc.IMEDispatcher.getInstance().removeDelegate(this)},attachWithIME:function(){return cc.IMEDispatcher.getInstance().attachDelegateWithIME(this)},detachWithIME:function(){return cc.IMEDispatcher.getInstance().detachDelegateWithIME(this)},canAttachWithIME:function(){return!1},didAttachWithIME:function(){},canDetachWithIME:function(){return!1},didDetachWithIME:function(){},insertText:function(e,t){},deleteBackward:function(){},getContentText:function(){return""},keyboardWillShow:function(e){},keyboardDidShow:function(e){},keyboardWillHide:function(e){},keyboardDidHide:function(e){}}),cc.IMEDispatcher=cc.Class.extend({_domInputControl:null,impl:null,_currentInputString:"",_lastClickPosition:null,ctor:function(){this.impl=new cc.IMEDispatcher.Impl,this._lastClickPosition=cc.p(0,0)},init:function(){if(cc.Browser.isMobile)return;this._domInputControl=cc.$("#imeDispatcherInput"),this._domInputControl||(this._domInputControl=cc.$new("input"),this._domInputControl.setAttribute("type","text"),this._domInputControl.setAttribute("id","imeDispatcherInput"),this._domInputControl.resize(0,0),this._domInputControl.translates(0,0),this._domInputControl.style.opacity="0",this._domInputControl.style.fontSize="1px",this._domInputControl.setAttribute("tabindex",2),this._domInputControl.style.position="absolute",this._domInputControl.style.top=0,this._domInputControl.style.left=0,document.body.appendChild(this._domInputControl));var e=this;this._domInputControl.addEventListener("input",function(){e._processDomInputString(e._domInputControl.value)},!1),this._domInputControl.addEventListener("keydown",function(t){t.keyCode===cc.KEY.tab?(t.stopPropagation(),t.preventDefault()):t.keyCode==cc.KEY.enter&&(e.dispatchInsertText("\n",1),t.stopPropagation(),t.preventDefault())},!1),/msie/i.test(navigator.userAgent)&&this._domInputControl.addEventListener("keyup",function(t){t.keyCode==cc.KEY.backspace&&e._processDomInputString(e._domInputControl.value)},!1),window.addEventListener("mousedown",function(t){var n=t.pageX||0,r=t.pageY||0;e._lastClickPosition.x=n,e._lastClickPosition.y=r},!1)},_processDomInputString:function(e){var t,n,r=this._currentInputString.length<e.length?this._currentInputString.length:e.length;for(n=0;n<r;n++)if(e[n]!==this._currentInputString[n])break;var i=this._currentInputString.length-n,s=e.length-n;for(t=0;t<i;t++)this.dispatchDeleteBackward();for(t=0;t<s;t++)this.dispatchInsertText(e[n+t],1);this._currentInputString=e},dispatchInsertText:function(e,t){if(!this.impl||!e||t<=0)return;if(!this.impl._delegateWithIme)return;this.impl._delegateWithIme.insertText(e,t)},dispatchDeleteBackward:function(){if(!this.impl)return;if(!this.impl._delegateWithIme)return;this.impl._delegateWithIme.deleteBackward()},getContentText:function(){if(this.impl&&this.impl._delegateWithIme){var e=this.impl._delegateWithIme.getContentText();return e?e:""}return""},dispatchKeyboardWillShow:function(e){if(this.impl)for(var t=0;t<this.impl._delegateList.length;t++){var n=this.impl._delegateList[t];n&&n.keyboardWillShow(e)}},dispatchKeyboardDidShow:function(e){if(this.impl)for(var t=0;t<this.impl._delegateList.length;t++){var n=this.impl._delegateList[t];n&&n.keyboardDidShow(e)}},dispatchKeyboardWillHide:function(e){if(this.impl)for(var t=0;t<this.impl._delegateList.length;t++){var n=this.impl._delegateList[t];n&&n.keyboardWillHide(e)}},dispatchKeyboardDidHide:function(e){if(this.impl)for(var t=0;t<this.impl._delegateList.length;t++){var n=this.impl._delegateList[t];n&&n.keyboardDidHide(e)}},addDelegate:function(e){if(!e||!this.impl)return;if(this.impl._delegateList.indexOf(e)>-1)return;this.impl._delegateList=cc.ArrayAppendObjectToIndex(this.impl._delegateList,e,0)},attachDelegateWithIME:function(e){if(!this.impl||!e)return!1;if(this.impl._delegateList.indexOf(e)==-1)return!1;if(this.impl._delegateWithIme){if(!this.impl._delegateWithIme.canDetachWithIME()||!e.canAttachWithIME())return!1;var t=this.impl._delegateWithIme;return this.impl._delegateWithIme=null,t.didDetachWithIME(),this._focusDomInput(e),!0}return e.canAttachWithIME()?(this._focusDomInput(e),!0):!1},_focusDomInput:function(e){if(cc.Browser.isMobile){this.impl._delegateWithIme=e,e.didAttachWithIME(),this._currentInputString=e.getString?e.getString():"";var t=prompt("please enter your word:",this._currentInputString);t!=null&&this._processDomInputString(t),this.dispatchInsertText("\n",1)}else this.impl._delegateWithIme=e,this._currentInputString=e.getString?e.getString():"",e.didAttachWithIME(),this._domInputControl.focus(),this._domInputControl.value=this._currentInputString,this._domInputControlTranslate()},_domInputControlTranslate:function(){/msie/i.test(navigator.userAgent)?(this._domInputControl.style.left=this._lastClickPosition.x+"px",this._domInputControl.style.top=this._lastClickPosition.y+"px"):this._domInputControl.translates(this._lastClickPosition.x,this._lastClickPosition.y)},detachDelegateWithIME:function(e){return!this.impl||!e?!1:this.impl._delegateWithIme!=e?!1:e.canDetachWithIME()?(this.impl._delegateWithIme=null,e.didDetachWithIME(),cc.canvas.focus(),!0):!1},removeDelegate:function(e){if(!this.impl||!e)return;if(this.impl._delegateList.indexOf(e)==-1)return;this.impl._delegateWithIme&&e==this.impl._delegateWithIme&&(this.impl._delegateWithIme=null),cc.ArrayRemoveObject(this.impl._delegateList,e)},processKeycode:function(e){e<32?e==cc.KEY.backspace?this.dispatchDeleteBackward():e==cc.KEY.enter?this.dispatchInsertText("\n",1):e!=cc.KEY.tab&&e==cc.KEY.escape:e<255&&this.dispatchInsertText(String.fromCharCode(e),1)}}),cc.IMEDispatcher.Impl=cc.Class.extend({_delegateWithIme:null,_delegateList:null,ctor:function(){this._delegateList=[]},findDelegate:function(e){for(var t=0;t<this._delegateList.length;t++)if(this._delegateList[t]==e)return t;return null}}),cc.IMEDispatcher.getInstance=function(){return cc.IMEDispatcher.instance||(cc.IMEDispatcher.instance=new cc.IMEDispatcher,cc.IMEDispatcher.instance.init()),cc.IMEDispatcher.instance},cc.IMEDispatcher.instance=null,cc.TextFieldDelegate=cc.Class.extend({onTextFieldAttachWithIME:function(e){return!1},onTextFieldDetachWithIME:function(e){return!1},onTextFieldInsertText:function(e,t,n){return!1},onTextFieldDeleteBackward:function(e,t,n){return!1},onDraw:function(e){return!1}}),cc.TextFieldTTF=cc.LabelTTF.extend({_lens:null,_inputText:"",_placeHolder:"",_charCount:0,_delegate:null,_ColorSpaceHolder:null,ctor:function(){this._ColorSpaceHolder=new cc.Color3B(127,127,127),cc.IMEDispatcher.getInstance().addDelegate(this),cc.LabelTTF.prototype.ctor.call(this)},getDelegate:function(){return this._delegate},setDelegate:function(e){this._delegate=e},getCharCount:function(){return this._charCount},getColorSpaceHolder:function(){return this._ColorSpaceHolder},setColorSpaceHolder:function(e){this._ColorSpaceHolder=e},initWithPlaceHolder:function(e,t,n,r,i){switch(arguments.length){case 5:return e&&(this._placeHolder=e),this.initWithString(this._placeHolder,r,i,t,n);case 3:return e&&(this._placeHolder=e),r=arguments[1],i=arguments[2],this.initWithString(this._placeHolder,r,i);default:throw"Argument must be non-nil "}},setString:function(e){e=String(e),this._inputText=e||"",this._inputText.length?cc.LabelTTF.prototype.setString.call(this,this._inputText):cc.LabelTTF.prototype.setString.call(this,this._placeHolder),this._charCount=this._inputText.length},getString:function(){return this._inputText},setPlaceHolder:function(e){this._placeHolder=e||"",this._inputText.length||cc.LabelTTF.prototype.setString.call(this,this._placeHolder)},getPlaceHolder:function(){return this._placeHolder},draw:function(e){var t=e||cc.renderContext;if(this._delegate&&this._delegate.onDraw(this))return;if(this._inputText&&this._inputText.length>0){cc.LabelTTF.prototype.draw.call(this,t);return}var n=this.getColor();this.setColor(this._ColorSpaceHolder),cc.renderContextType===cc.CANVAS&&this._updateTexture(),cc.LabelTTF.prototype.draw.call(this,t),this.setColor(n)},attachWithIME:function(){return cc.IMEDispatcher.getInstance().attachDelegateWithIME(this)},detachWithIME:function(){return cc.IMEDispatcher.getInstance().detachDelegateWithIME(this)},canAttachWithIME:function(){return this._delegate?!this._delegate.onTextFieldAttachWithIME(this):!0},didAttachWithIME:function(){},canDetachWithIME:function(){return this._delegate?!this._delegate.onTextFieldDetachWithIME(this):!0},didDetachWithIME:function(){},deleteBackward:function(){var e=this._inputText.length;if(e==0)return;var t=1;if(this._delegate&&this._delegate.onTextFieldDeleteBackward(this,this._inputText[e-t],t))return;if(e<=t){this._inputText="",this._charCount=0,cc.LabelTTF.prototype.setString.call(this,this._placeHolder);return}var n=this._inputText.substring(0,e-t);this.setString(n)},removeDelegate:function(){cc.IMEDispatcher.getInstance().removeDelegate(this)},insertText:function(e,t){var n=e,r=n.indexOf("\n");r>-1&&(n=n.substring(0,r));if(n.length>0){if(this._delegate&&this._delegate.onTextFieldInsertText(this,n,n.length))return;var i=this._inputText+n;this._charCount=i.length,this.setString(i)}if(r==-1)return;if(this._delegate&&this._delegate.onTextFieldInsertText(this,"\n",1))return;this.detachWithIME()},getContentText:function(){return this._inputText},keyboardWillShow:function(e){},keyboardDidShow:function(e){},keyboardWillHide:function(e){},keyboardDidHide:function(e){}}),cc.TextFieldTTF.create=function(e,t,n,r,i){var s;switch(arguments.length){case 5:s=new cc.TextFieldTTF;if(s&&s.initWithPlaceHolder("",t,n,r,i))return e&&s.setPlaceHolder(e),s;return null;case 3:s=new cc.TextFieldTTF,r=arguments[1],i=arguments[2];if(s&&s.initWithString("",r,i))return e&&s.setPlaceHolder(e),s;return null;default:throw"Argument must be non-nil "}},cc.ITEM_SIZE=32,cc._globalFontSize=cc.ITEM_SIZE,cc._globalFontName="Arial",cc._globalFontNameRelease=!1,cc.CURRENT_ITEM=3233828865,cc.ZOOM_ACTION_TAG=3233828866,cc.NORMAL_TAG=8801,cc.SELECTED_TAG=8802,cc.DISABLE_TAG=8803,cc.MenuItem=cc.NodeRGBA.extend({_target:null,_callback:null,_isSelected:!1,_isEnabled:!1,ctor:function(){cc.NodeRGBA.prototype.ctor.call(this),this._target=null,this._callback=null,this._isSelected=!1,this._isEnabled=!1},isSelected:function(){return this._isSelected},setOpacityModifyRGB:function(e){},isOpacityModifyRGB:function(){return!1},setTarget:function(e,t){this._target=t,this._callback=e},isEnabled:function(){return this._isEnabled},setEnabled:function(e){this._isEnabled=e},initWithCallback:function(e,t){return this.setAnchorPoint(.5,.5),this._target=t,this._callback=e,this._isEnabled=!0,this._isSelected=!1,!0},rect:function(){var e=this._position,t=this._contentSize,n=this._anchorPoint;return cc.rect(e._x-t._width*n._x,e._y-t._height*n._y,t._width,t._height)},selected:function(){this._isSelected=!0},unselected:function(){this._isSelected=!1},setCallback:function(e,t){this._target=t,this._callback=e},activate:function(){this._isEnabled&&cc.doCallback(this._callback,this._target,this)}}),cc.MenuItem.create=function(e,t){var n=new cc.MenuItem;return n.initWithCallback(e,t),n},cc.MenuItemLabel=cc.MenuItem.extend({_disabledColor:null,_label:null,_orginalScale:0,_colorBackup:null,ctor:function(){cc.MenuItem.prototype.ctor.call(this),this._disabledColor=null,this._label=null,this._orginalScale=0,this._colorBackup=null},getDisabledColor:function(){return this._disabledColor},setDisabledColor:function(e){this._disabledColor=e},getLabel:function(){return this._label},setLabel:function(e){e&&(this.addChild(e),e.setAnchorPoint(0,0),this.setContentSize(e.getContentSize())),this._label&&this.removeChild(this._label,!0),this._label=e},setEnabled:function(e){if(this._isEnabled!=e){var t=this._label;e?t.setColor(this._colorBackup):(this._colorBackup=t.getColor(),t.setColor(this._disabledColor))}cc.MenuItem.prototype.setEnabled.call(this,e)},setOpacity:function(e){this._label.setOpacity(e)},getOpacity:function(){return this._label.getOpacity()},setColor:function(e){this._label.setColor(e)},getColor:function(){return this._label.getColor()},initWithLabel:function(e,t,n){return this.initWithCallback(t,n),this._originalScale=1,this._colorBackup=cc.white(),this._disabledColor=cc.c3b(126,126,126),this.setLabel(e),this.setCascadeColorEnabled(!0),this.setCascadeOpacityEnabled(!0),!0},setString:function(e){this._label.setString(e),this.setContentSize(this._label.getContentSize())},activate:function(){this._isEnabled&&(this.stopAllActions(),this.setScale(this._originalScale),cc.MenuItem.prototype.activate.call(this))},selected:function(){if(this._isEnabled){cc.MenuItem.prototype.selected.call(this);var e=this.getActionByTag(cc.ZOOM_ACTION_TAG);e?this.stopAction(e):this._originalScale=this.getScale();var t=cc.ScaleTo.create(.1,this._originalScale*1.2);t.setTag(cc.ZOOM_ACTION_TAG),this.runAction(t)}},unselected:function(){if(this._isEnabled){cc.MenuItem.prototype.unselected.call(this),this.stopActionByTag(cc.ZOOM_ACTION_TAG);var e=cc.ScaleTo.create(.1,this._originalScale);e.setTag(cc.ZOOM_ACTION_TAG),this.runAction(e)}}}),cc.MenuItemLabel.create=function(e,t,n){var r=new cc.MenuItemLabel;return r.initWithLabel(e,t,n),r},cc.MenuItemAtlasFont=cc.MenuItemLabel.extend({initWithString:function(e,t,n,r,i,s,o){if(!e||e.length==0)throw"cc.MenuItemAtlasFont.initWithString(): value should be non-null and its length should be greater than 0";var u=new cc.LabelAtlas;return u.initWithString(e,t,n,r,i),this.initWithLabel(u,s,o),!0}}),cc.MenuItemAtlasFont.create=function(e,t,n,r,i,s,o){var u=new cc.MenuItemAtlasFont;return u.initWithString(e,t,n,r,i,s,o),u},cc.MenuItemFont=cc.MenuItemLabel.extend({_fontSize:null,_fontName:null,ctor:function(){cc.MenuItemLabel.prototype.ctor.call(this),this._fontSize=0,this._fontName=""},initWithString:function(e,t,n){if(!e||e.length==0)throw"Value should be non-null and its length should be greater than 0";this._fontName=cc._globalFontName,this._fontSize=cc._globalFontSize;var r=cc.LabelTTF.create(e,this._fontName,this._fontSize);return this.initWithLabel(r,t,n),!0},setFontSize:function(e){this._fontSize=e,this._recreateLabel()},fontSize:function(){return this._fontSize},setFontName:function(e){this._fontName=e,this._recreateLabel()},fontName:function(){return this._fontName},_recreateLabel:function(){var e=cc.LabelTTF.create(this._label.getString(),this._fontName,this._fontSize);this.setLabel(e)}}),cc.MenuItemFont.setFontSize=function(e){cc._globalFontSize=e},cc.MenuItemFont.fontSize=function(){return cc._globalFontSize},cc.MenuItemFont.setFontName=function(e){cc._globalFontNameRelease&&(cc._globalFontName=""),cc._globalFontName=e,cc._globalFontNameRelease=!0},cc.MenuItemFont.fontName=function(){return cc._globalFontName},cc.MenuItemFont.create=function(e,t,n){var r=new cc.MenuItemFont;return r.initWithString(e,t,n),r},cc.MenuItemSprite=cc.MenuItem.extend({_normalImage:null,_selectedImage:null,_disabledImage:null,ctor:function(){cc.MenuItem.prototype.ctor.call(this),this._normalImage=null,this._selectedImage=null,this._disabledImage=null},getNormalImage:function(){return this._normalImage},setNormalImage:function(e){if(this._normalImage==e)return;e&&(this.addChild(e,0,cc.NORMAL_TAG),e.setAnchorPoint(0,0)),this._normalImage&&this.removeChild(this._normalImage,!0),this._normalImage=e,this.setContentSize(this._normalImage.getContentSize()),this._updateImagesVisibility(),e.textureLoaded&&!e.textureLoaded()&&e.addLoadedEventListener(function(e){this.setContentSize(e.getContentSize())},this)},getSelectedImage:function(){return this._selectedImage},setSelectedImage:function(e){if(this._selectedImage==e)return;e&&(this.addChild(e,0,cc.SELECTED_TAG),e.setAnchorPoint(0,0)),this._selectedImage&&this.removeChild(this._selectedImage,!0),this._selectedImage=e,this._updateImagesVisibility()},getDisabledImage:function(){return this._disabledImage},setDisabledImage:function(e){if(this._disabledImage==e)return;e&&(this.addChild(e,0,cc.DISABLE_TAG),e.setAnchorPoint(0,0)),this._disabledImage&&this.removeChild(this._disabledImage,!0),this._disabledImage=e,this._updateImagesVisibility()},initWithNormalSprite:function(e,t,n,r,i){this.initWithCallback(r,i),this.setNormalImage(e),this.setSelectedImage(t),this.setDisabledImage(n);var s=this._normalImage;return s&&(this.setContentSize(s.getContentSize()),s.textureLoaded&&!s.textureLoaded()&&s.addLoadedEventListener(function(e){this.setContentSize(e.getContentSize()),this.setCascadeColorEnabled(!0),this.setCascadeOpacityEnabled(!0)},this)),this.setCascadeColorEnabled(!0),this.setCascadeOpacityEnabled(!0),!0},setColor:function(e){this._normalImage.setColor(e),this._selectedImage&&this._selectedImage.setColor(e),this._disabledImage&&this._disabledImage.setColor(e)},getColor:function(){return this._normalImage.getColor()},setOpacity:function(e){this._normalImage.setOpacity(e),this._selectedImage&&this._selectedImage.setOpacity(e),this._disabledImage&&this._disabledImage.setOpacity(e)},getOpacity:function(){return this._normalImage.getOpacity()},selected:function(){cc.MenuItem.prototype.selected.call(this),this._normalImage&&(this._disabledImage&&this._disabledImage.setVisible(!1),this._selectedImage?(this._normalImage.setVisible(!1),this._selectedImage.setVisible(!0)):this._normalImage.setVisible(!0))},unselected:function(){cc.MenuItem.prototype.unselected.call(this),this._normalImage&&(this._normalImage.setVisible(!0),this._selectedImage&&this._selectedImage.setVisible(!1),this._disabledImage&&this._disabledImage.setVisible(!1))},setEnabled:function(e){this._isEnabled!=e&&(cc.MenuItem.prototype.setEnabled.call(this,e),this._updateImagesVisibility())},_updateImagesVisibility:function(){var e=this._normalImage,t=this._selectedImage,n=this._disabledImage;this._isEnabled?(e&&e.setVisible(!0),t&&t.setVisible(!1),n&&n.setVisible(!1)):n?(e&&e.setVisible(!1),t&&t.setVisible(!1),n&&n.setVisible(!0)):(e&&e.setVisible(!0),t&&t.setVisible(!1))}}),cc.MenuItemSprite.create=function(e,t,n,r,i){var s=arguments.length;e=arguments[0],t=arguments[1];var o,u,a,f=new cc.MenuItemSprite;return s==5?(o=arguments[2],a=arguments[3],u=arguments[4]):s==4&&typeof arguments[3]=="function"?(o=arguments[2],a=arguments[3]):s==4&&typeof arguments[2]=="function"?(u=arguments[3],a=arguments[2]):s<=2&&(o=arguments[2]),f.initWithNormalSprite(e,t,o,a,u),f},cc.MenuItemImage=cc.MenuItemSprite.extend({setNormalSpriteFrame:function(e){this.setNormalImage(cc.Sprite.createWithSpriteFrame(e))},setSelectedSpriteFrame:function(e){this.setSelectedImage(cc.Sprite.createWithSpriteFrame(e))},setDisabledSpriteFrame:function(e){this.setDisabledImage(cc.Sprite.createWithSpriteFrame(e))},initWithNormalImage
:function(e,t,n,r,i){var s=null,o=null,u=null;return e&&(s=cc.Sprite.create(e)),t&&(o=cc.Sprite.create(t)),n&&(u=cc.Sprite.create(n)),this.initWithNormalSprite(s,o,u,r,i)}}),cc.MenuItemImage.create=function(e,t,n,r,i){if(e===undefined)return cc.MenuItemImage.create(null,null,null,null,null);if(r===undefined)return cc.MenuItemImage.create(e,t,null,n,null);if(i===undefined)return cc.MenuItemImage.create(e,t,null,n,r);var s=new cc.MenuItemImage;return s.initWithNormalImage(e,t,n,r,i)?s:null},cc.MenuItemToggle=cc.MenuItem.extend({_selectedIndex:0,_subItems:null,_opacity:null,_color:null,ctor:function(){cc.MenuItem.prototype.ctor.call(this),this._selectedIndex=0,this._subItems=[],this._opacity=0,this._color=cc.white()},getOpacity:function(){return this._opacity},setOpacity:function(e){this._opacity=e;if(this._subItems&&this._subItems.length>0)for(var t=0;t<this._subItems.length;t++)this._subItems[t].setOpacity(e)},getColor:function(){return this._color},setColor:function(e){this._color=e;if(this._subItems&&this._subItems.length>0)for(var t=0;t<this._subItems.length;t++)this._subItems[t].setColor(e)},getSelectedIndex:function(){return this._selectedIndex},setSelectedIndex:function(e){if(e!=this._selectedIndex){this._selectedIndex=e;var t=this.getChildByTag(cc.CURRENT_ITEM);t&&t.removeFromParent(!1);var n=this._subItems[this._selectedIndex];this.addChild(n,0,cc.CURRENT_ITEM);var r=n.getContentSize();this.setContentSize(r),n.setPosition(r.width/2,r.height/2)}},getSubItems:function(){return this._subItems},setSubItems:function(e){this._subItems=e},initWithItems:function(e){var t=e.length;typeof e[e.length-2]=="function"?(this.initWithCallback(e[e.length-2],e[e.length-1]),t-=2):typeof e[e.length-1]=="function"?(this.initWithCallback(e[e.length-1],null),t-=1):this.initWithCallback(null,null);var n=this._subItems;n.length=0;for(var r=0;r<t;r++)e[r]&&n.push(e[r]);return this._selectedIndex=cc.UINT_MAX,this.setSelectedIndex(0),this.setCascadeColorEnabled(!0),this.setCascadeOpacityEnabled(!0),!0},addSubItem:function(e){this._subItems.push(e)},activate:function(){if(this._isEnabled){var e=(this._selectedIndex+1)%this._subItems.length;this.setSelectedIndex(e)}cc.MenuItem.prototype.activate.call(this)},selected:function(){cc.MenuItem.prototype.selected.call(this),this._subItems[this._selectedIndex].selected()},unselected:function(){cc.MenuItem.prototype.unselected.call(this),this._subItems[this._selectedIndex].unselected()},setEnabled:function(e){if(this._isEnabled!=e){cc.MenuItem.prototype.setEnabled.call(this,e);var t=this._subItems;if(t&&t.length>0)for(var n=0;n<t.length;n++)t[n].setEnabled(e)}},selectedItem:function(){return this._subItems[this._selectedIndex]},onEnter:function(){cc.Node.prototype.onEnter.call(this),this.setSelectedIndex(this._selectedIndex)}}),cc.MenuItemToggle.create=function(){arguments.length>0&&arguments[arguments.length-1]==null&&cc.log("parameters should not be ending with null in Javascript");var e=new cc.MenuItemToggle;return e.initWithItems(arguments),e},cc.MENU_STATE_WAITING=0,cc.MENU_STATE_TRACKING_TOUCH=1,cc.MENU_HANDLER_PRIORITY=-128,cc.DEFAULT_PADDING=5,cc.Menu=cc.LayerRGBA.extend({_color:null,_enabled:!1,_opacity:0,_selectedItem:null,_state:-1,ctor:function(){cc.LayerRGBA.prototype.ctor.call(this),this._color=cc.white(),this._enabled=!1,this._opacity=255,this._selectedItem=null,this._state=-1},getColor:function(){return this._color},setColor:function(e){this._color=e;var t=this._children;if(t&&t.length>0)for(var n=0;n<t.length;n++)t[n].setColor(e)},getOpacity:function(){return this._opacity},setOpacity:function(e){this._opacity=e;var t=this._children;if(t&&t.length>0)for(var n=0;n<t.length;n++)t[n].setOpacity(e)},isEnabled:function(){return this._enabled},setEnabled:function(e){this._enabled=e},initWithItems:function(e){var t=[];if(e)for(var n=0;n<e.length;n++)e[n]&&t.push(e[n]);return this.initWithArray(t)},initWithArray:function(e){if(this.init()){this.setTouchPriority(cc.MENU_HANDLER_PRIORITY),this.setTouchMode(cc.TOUCH_ONE_BY_ONE),this.setTouchEnabled(!0),this._enabled=!0;var t=cc.Director.getInstance().getWinSize();this.ignoreAnchorPointForPosition(!0),this.setAnchorPoint(.5,.5),this.setContentSize(t),this.setPosition(t.width/2,t.height/2);if(e)for(var n=0;n<e.length;n++)this.addChild(e[n],n);return this._selectedItem=null,this._state=cc.MENU_STATE_WAITING,this.setCascadeColorEnabled(!0),this.setCascadeOpacityEnabled(!0),!0}return!1},addChild:function(e,t,n){if(!(e instanceof cc.MenuItem))throw"cc.Menu.addChild() : Menu only supports MenuItem objects as children";cc.Layer.prototype.addChild.call(this,e,t,n)},alignItemsVertically:function(){this.alignItemsVerticallyWithPadding(cc.DEFAULT_PADDING)},alignItemsVerticallyWithPadding:function(e){var t=-e,n=this._children,r,i,s,o,u;if(n&&n.length>0){for(i=0,r=n.length;i<r;i++)t+=n[i].getContentSize().height*n[i].getScaleY()+e;var a=t/2;for(i=0,r=n.length;i<r;i++)u=n[i],o=u.getContentSize().height,s=u.getScaleY(),u.setPosition(0,a-o*s/2),a-=o*s+e}},alignItemsHorizontally:function(){this.alignItemsHorizontallyWithPadding(cc.DEFAULT_PADDING)},alignItemsHorizontallyWithPadding:function(e){var t=-e,n=this._children,r,i,s,o,u;if(n&&n.length>0){for(r=0,i=n.length;r<i;r++)t+=n[r].getContentSize().width*n[r].getScaleX()+e;var a=-t/2;for(r=0,i=n.length;r<i;r++)u=n[r],s=u.getScaleX(),o=n[r].getContentSize().width,u.setPosition(a+o*s/2,0),a+=o*s+e}},alignItemsInColumns:function(){arguments.length>0&&arguments[arguments.length-1]==null&&cc.log("parameters should not be ending with null in Javascript");var e=[];for(var t=0;t<arguments.length;t++)e.push(arguments[t]);var n=-5,r=0,i=0,s=0,o,u,a,f=this._children;if(f&&f.length>0)for(t=0,a=f.length;t<a;t++){if(r>=e.length)continue;o=e[r];if(!o)continue;u=f[t].getContentSize().height,i=i>=u||isNaN(u)?i:u,++s,s>=o&&(n+=i+5,s=0,i=0,++r)}var l=cc.Director.getInstance().getWinSize();r=0,i=0,o=0;var c=0,h=0,p=n/2;if(f&&f.length>0)for(t=0,a=f.length;t<a;t++){var d=f[t];o==0&&(o=e[r],c=l.width/(1+o),h=c),u=d.getContentSize().height,i=i>=u||isNaN(u)?i:u,d.setPosition(h-l.width/2,p-u/2),h+=c,++s,s>=o&&(p-=i+5,s=0,o=0,i=0,++r)}},alignItemsInRows:function(){arguments.length>0&&arguments[arguments.length-1]==null&&cc.log("parameters should not be ending with null in Javascript");var e=[],t;for(t=0;t<arguments.length;t++)e.push(arguments[t]);var n=[],r=[],i=-10,s=-5,o=0,u=0,a=0,f,l,c,h,p,d=this._children;if(d&&d.length>0)for(t=0,c=d.length;t<c;t++){l=d[t];if(o>=e.length)continue;f=e[o];if(!f)continue;p=l.getContentSize(),h=p.width,u=u>=h||isNaN(h)?u:h,s+=p.height+5,++a,a>=f&&(n.push(u),r.push(s),i+=u+10,a=0,u=0,s=-5,++o)}var v=cc.Director.getInstance().getWinSize();o=0,u=0,f=0;var m=-i/2,g=0;if(d&&d.length>0)for(t=0,c=d.length;t<c;t++)l=d[t],f==0&&(f=e[o],g=r[o]),p=l.getContentSize(),h=p.width,u=u>=h||isNaN(h)?u:h,l.setPosition(m+n[o]/2,g-v.height/2),g-=p.height+10,++a,a>=f&&(m+=u+5,a=0,f=0,u=0,++o)},registerWithTouchDispatcher:function(){cc.registerTargetedDelegate(this.getTouchPriority(),!0,this)},removeChild:function(e,t){if(e==null)return;if(!(e instanceof cc.MenuItem)){cc.log("cc.Menu.removeChild():Menu only supports MenuItem objects as children");return}this._selectedItem==e&&(this._selectedItem=null),cc.Node.prototype.removeChild.call(this,e,t)},onTouchBegan:function(e,t){if(this._state!=cc.MENU_STATE_WAITING||!this._visible||!this._enabled)return!1;for(var n=this._parent;n!=null;n=n.getParent())if(!n.isVisible())return!1;return this._selectedItem=this._itemForTouch(e),this._selectedItem?(this._state=cc.MENU_STATE_TRACKING_TOUCH,this._selectedItem.selected(),!0):!1},onTouchEnded:function(e,t){if(this._state!==cc.MENU_STATE_TRACKING_TOUCH){cc.log("cc.Menu.onTouchEnded(): invalid state");return}this._selectedItem&&(this._selectedItem.unselected(),this._selectedItem.activate()),this._state=cc.MENU_STATE_WAITING},onTouchCancelled:function(e,t){if(this._state!==cc.MENU_STATE_TRACKING_TOUCH){cc.log("cc.Menu.onTouchCancelled(): invalid state");return}this._selectedItem&&this._selectedItem.unselected(),this._state=cc.MENU_STATE_WAITING},onTouchMoved:function(e,t){if(this._state!==cc.MENU_STATE_TRACKING_TOUCH){cc.log("cc.Menu.onTouchMoved(): invalid state");return}var n=this._itemForTouch(e);n!=this._selectedItem&&(this._selectedItem&&this._selectedItem.unselected(),this._selectedItem=n,this._selectedItem&&this._selectedItem.selected())},onExit:function(){this._state==cc.MENU_STATE_TRACKING_TOUCH&&(this._selectedItem&&(this._selectedItem.unselected(),this._selectedItem=null),this._state=cc.MENU_STATE_WAITING),cc.Layer.prototype.onExit.call(this)},setOpacityModifyRGB:function(e){},isOpacityModifyRGB:function(){return!1},_itemForTouch:function(e){var t=e.getLocation(),n=this._children,r;if(n&&n.length>0)for(var i=0;i<n.length;i++){r=n[i];if(r.isVisible()&&r.isEnabled()){var s=r.convertToNodeSpace(t),o=r.rect();o.x=0,o.y=0;if(cc.rectContainsPoint(o,s))return r}}return null},setHandlerPriority:function(e){cc.Director.getInstance().getTouchDispatcher().setPriority(e,this)}}),cc.Menu.create=function(e){arguments.length>0&&arguments[arguments.length-1]==null&&cc.log("parameters should not be ending with null in Javascript");var t=new cc.Menu;if(arguments.length==0)t.initWithItems(null,null);else if(arguments.length==1&&arguments[0]instanceof Array)return t.initWithArray(arguments[0]),t;return t.initWithItems(arguments),t},cc.TGA_OK=0,cc.TGA_ERROR_FILE_OPEN=1,cc.TGA_ERROR_READING_FILE=2,cc.TGA_ERROR_INDEXED_COLOR=3,cc.TGA_ERROR_MEMORY=4,cc.TGA_ERROR_COMPRESSED_FILE=5,cc.ImageTGA=function(e,t,n,r,i,s,o){this.status=e||0,this.type=t||0,this.pixelDepth=n||0,this.width=r||0,this.height=i||0,this.imageData=s||[],this.flipped=o||0},cc.tgaLoadHeader=function(e,t,n){var r=2;if(r+1>t)return!1;var i=new cc.BinaryStreamReader(e);i.setOffset(r),n.type=i.readByte(),r+=10;if(r+4+1>t)return!1;i.setOffset(r),n.width=i.readUnsignedShort(),n.height=i.readUnsignedInteger(),n.pixelDepth=i.readByte(),r+=5;if(r+1>t)return!1;var s=i.readByte();return n.flipped=0,s&32&&(n.flipped=1),!0},cc.tgaLoadImageData=function(e,t,n){var r,i,s,o,u=18;r=0|n.pixelDepth/2,i=n.height*n.width*r;if(u+i>t)return!1;n.imageData=cc.__getSubArray(e,u,u+i);if(r>=3)for(s=0;s<i;s+=r)o=n.imageData[s],n.imageData[s]=n.imageData[s+2],n.imageData[s+2]=o;return!0},cc.tgaLoad=function(e){var t=cc.FileUtils.getInstance().getFileData(e,"rb"),n=t.length;if(t==null)return null;var r=new cc.ImageTGA;if(!cc.tgaLoadHeader(t,n,r))return r.status=cc.TGA_ERROR_MEMORY,r;if(r.type===1)return r.status=cc.TGA_ERROR_INDEXED_COLOR,r;if(r.type!=2&&r.type!=3&&r.type!=10)return r.status=cc.TGA_ERROR_COMPRESSED_FILE,r;var i=!1;return r.type==10?i=cc.tgaLoadRLEImageData(t,n,r):i=cc.tgaLoadImageData(t,n,r),i?(r.status=cc.TGA_OK,r.flipped&&(cc.tgaFlipImage(r),r.flipped&&(r.status=cc.TGA_ERROR_MEMORY)),t=null,r):(r.status=cc.TGA_ERROR_READING_FILE,r)},cc.tgaRGBtogreyscale=function(e){var t,n;if(e.pixelDepth===8)return;var r=e.pixelDepth/8,i=new Uint8Array(e.height*e.width);if(i===null)return;for(t=0,n=0;n<e.width*e.height;t+=r,n++)i[n]=.3*e.imageData[t]+.59*e.imageData[t+1]+.11*e.imageData[t+2];e.pixelDepth=8,e.type=3,e.imageData=i},cc.tgaDestroy=function(e){if(!e)return;e.imageData=null,e=null},cc.tgaLoadRLEImageData=function(e,t,n){var r,i,s,o=0,u=0,a=0,f=[],l=0,c=18;r=n.pixelDepth/8,i=n.height*n.width;for(s=0;s<i;s++){if(l!=0)l--,u=a!=0;else{if(c+1>t)break;l=e[c],c+=1,a=l&128,a&&(l-=128),u=0}if(!u){if(c+r>t)break;f=cc.__getSubArray(e,c,c+r),c+=r;if(r>=3){var h=f[0];f[0]=f[2],f[2]=h}}for(var p=0;p<r;p++)n.imageData[o+p]=f[p];o+=r}return!0},cc.tgaFlipImage=function(e){var t=e.pixelDepth/8,n=e.width*t;for(var r=0;r<e.height/2;r++){var i=cc.__getSubArray(e.imageData,r*n,r*n+n);cc.__setDataToArray(cc.__getSubArray(e.imageData,(e.height-(r+1))*n,n),e.imageData,r*n),cc.__setDataToArray(i,e.imageData,(e.height-(r+1))*n)}e.flipped=0},cc.__getSubArray=function(e,t,n){return e instanceof Array?e.slice(t,n):e.subarray(t,n)},cc.__setDataToArray=function(e,t,n){for(var r=0;r<e.length;r++)t[n+r]=e[r]},cc.BinaryStreamReader=cc.Class.extend({_binaryData:null,_offset:0,ctor:function(e){this._binaryData=e},setBinaryData:function(e){this._binaryData=e,this._offset=0},getBinaryData:function(){return this._binaryData},_checkSize:function(e){if(!(this._offset+Math.ceil(e/8)<this._data.length))throw new Error("Index out of bound")},_decodeFloat:function(e,t){var n=e+t+1,r=n>>3;this._checkSize(n);var i=Math.pow(2,t-1)-1,s=this._readBits(e+t,1,r),o=this._readBits(e,t,r),u=0,a=2,f=0;do{var l=this._readByte(++f,r),c=e%8||8,h=1<<c;while(h>>=1)l&h&&(u+=1/a),a*=2}while(e-=c);return this._offset+=r,o==(i<<1)+1?u?NaN:s?-Infinity:+Infinity:(1+s*-2)*(o||u?o?Math.pow(2,o-i)*(1+u):Math.pow(2,-i+1)*u:0)},_readByte:function(e,t){return this._data[this._offset+t-e-1]},_decodeInt:function(e,t){var n=this._readBits(0,e,e/8),r=Math.pow(2,e),i=t&&n>=r/2?n-r:n;return this._offset+=e/8,i},_shl:function(e,t){for(++t;--t;e=((e%=2147483647+1)&1073741824)==1073741824?e*2:(e-1073741824)*2+2147483647+1);return e},_readBits:function(e,t,n){var r=(e+t)%8,i=e%8,s=n-(e>>3)-1,o=n+(-(e+t)>>3),u=s-o,a=this._readByte(s,n)>>i&(1<<(u?8-i:t))-1;u&&r&&(a+=(this._readByte(o++,n)&(1<<r)-1)<<(u--<<3)-i);while(u)a+=this._shl(this._readByte(o++,n),(u--<<3)-i);return a},readInteger:function(){return this._decodeInt(32,!0)},readUnsignedInteger:function(){return this._decodeInt(32,!1)},readSingle:function(){return this._decodeFloat(23,8)},readShort:function(){return this._decodeInt(16,!0)},readUnsignedShort:function(){return this._decodeInt(16,!1)},readByte:function(){var e=this._data[this._offset];return this._offset+=1,e},readData:function(e,t){return this._binaryData instanceof Array?this._binaryData.slice(e,t):this._binaryData.subarray(e,t)},setOffset:function(e){this._offset=e},getOffset:function(){return this._offset}}),cc.TMX_ORIENTATION_ORTHO=0,cc.TMX_ORIENTATION_HEX=1,cc.TMX_ORIENTATION_ISO=2,cc.TMXTiledMap=cc.NodeRGBA.extend({_mapSize:null,_tileSize:null,_properties:null,_objectGroups:null,_mapOrientation:null,_tileProperties:null,ctor:function(){cc.Node.prototype.ctor.call(this),this._mapSize=cc.SizeZero(),this._tileSize=cc.SizeZero(),this._properties=null,this._objectGroups=null,this._mapOrientation=null,this._tileProperties=null},getMapSize:function(){return cc.size(this._mapSize.width,this._mapSize.height)},setMapSize:function(e){this._mapSize.width=e.width,this._mapSize.height=e.height},getTileSize:function(){return cc.size(this._tileSize.width,this._tileSize.height)},setTileSize:function(e){this._tileSize.width=e.width,this._tileSize.height=e.height},getMapOrientation:function(){return this._mapOrientation},setMapOrientation:function(e){this._mapOrientation=e},getObjectGroups:function(){return this._objectGroups},setObjectGroups:function(e){this._objectGroups=e},getProperties:function(){return this._properties},setProperties:function(e){this._properties=e},initWithTMXFile:function(e,t){if(!e||e.length==0)throw"cc.TMXTiledMap.initWithTMXFile(): tmxFile should be non-null or non-empty string.";this.setContentSize(0,0);var n=cc.TMXMapInfo.create(e,t);if(!n)return!1;var r=n.getTilesets();return(!r||r.length===0)&&cc.log("cc.TMXTiledMap.initWithTMXFile(): Map not found. Please check the filename."),this._buildWithMapInfo(n),!0},initWithXML:function(e,t){this.setContentSize(0,0);var n=cc.TMXMapInfo.createWithXML(e,t),r=n.getTilesets();return(!r||r.length===0)&&cc.log("cc.TMXTiledMap.initWithXML(): Map not found. Please check the filename."),this._buildWithMapInfo(n),!0},_buildWithMapInfo:function(e){this._mapSize=e.getMapSize(),this._tileSize=e.getTileSize(),this._mapOrientation=e.getOrientation(),this._objectGroups=e.getObjectGroups(),this._properties=e.getProperties(),this._tileProperties=e.getTileProperties();var t=0,n=e.getLayers();if(n){var r=null;for(var i=0,s=n.length;i<s;i++){r=n[i];if(r&&r.visible){var o=this._parseLayer(r,e);this.addChild(o,t,t);var u=o.getContentSize(),a=this.getContentSize();this.setContentSize(cc.size(Math.max(a.width,u.width),Math.max(a.height,u.height))),t++}}}},allLayers:function(){var e=[],t=this._children;for(var n=0,r=t.length;n<r;n++){var i=t[n];i&&i instanceof cc.TMXLayer&&e.push(i)}return e},getLayer:function(e){if(!e||e.length===0)throw"cc.TMXTiledMap.getLayer(): layerName should be non-null or non-empty string.";var t=this._children;for(var n=0;n<t.length;n++){var r=t[n];if(r&&r.getLayerName()==e)return r}return null},getObjectGroup:function(e){if(!e||e.length===0)throw"cc.TMXTiledMap.getObjectGroup(): groupName should be non-null or non-empty string.";if(this._objectGroups)for(var t=0;t<this._objectGroups.length;t++){var n=this._objectGroups[t];if(n&&n.getGroupName()==e)return n}return null},getProperty:function(e){return this._properties[e.toString()]},propertiesForGID:function(e){return this._tileProperties[e]},_parseLayer:function(e,t){var n=this._tilesetForLayer(e,t),r=cc.TMXLayer.create(n,e,t);return e.ownTiles=!1,r.setupTiles(),r},_tilesetForLayer:function(e,t){var n=e._layerSize,r=t.getTilesets();if(r)for(var i=r.length-1;i>=0;i--){var s=r[i];if(s)for(var o=0;o<n.height;o++)for(var u=0;u<n.width;u++){var a=u+n.width*o,f=e._tiles[a];if(f!=0&&(f&cc.TMX_TILE_FLIPPED_MASK)>>>0>=s.firstGid)return s}}return cc.log("cocos2d: Warning: TMX Layer "+e.name+" has no tiles"),null}}),cc.TMXTiledMap.create=function(e,t){var n=new cc.TMXTiledMap;return n.initWithTMXFile(e,t)?n:null},cc.TMXTiledMap.createWithXML=function(e,t){var n=new cc.TMXTiledMap;return n.initWithXML(e,t)?n:null},cc.TMX_LAYER_ATTRIB_NONE=1,cc.TMX_LAYER_ATTRIB_BASE64=2,cc.TMX_LAYER_ATTRIB_GZIP=4,cc.TMX_LAYER_ATTRIB_ZLIB=8,cc.TMX_PROPERTY_NONE=0,cc.TMX_PROPERTY_MAP=1,cc.TMX_PROPERTY_LAYER=2,cc.TMX_PROPERTY_OBJECTGROUP=3,cc.TMX_PROPERTY_OBJECT=4,cc.TMX_PROPERTY_TILE=5,cc.TMX_TILE_HORIZONTAL_FLAG=2147483648,cc.TMX_TILE_VERTICAL_FLAG=1073741824,cc.TMX_TILE_DIAGONAL_FLAG=536870912,cc.TMX_TILE_FLIPPED_ALL=(cc.TMX_TILE_HORIZONTAL_FLAG|cc.TMX_TILE_VERTICAL_FLAG|cc.TMX_TILE_DIAGONAL_FLAG)>>>0,cc.TMX_TILE_FLIPPED_MASK=~cc.TMX_TILE_FLIPPED_ALL>>>0,cc.TMXLayerInfo=cc.Class.extend({_properties:null,name:"",_layerSize:null,_tiles:null,visible:null,_opacity:null,ownTiles:!0,_minGID:1e5,_maxGID:0,offset:null,ctor:function(){this._properties=[],this.name="",this._layerSize=null,this._tiles=[],this.visible=!0,this._opacity=0,this.ownTiles=!0,this._minGID=1e5,this._maxGID=0,this.offset=cc.PointZero()},getProperties:function(){return this._properties},setProperties:function(e){this._properties=e}}),cc.TMXTilesetInfo=cc.Class.extend({name:"",firstGid:0,_tileSize:null,spacing:0,margin:0,sourceImage:"",imageSize:null,ctor:function(){this._tileSize=cc.SizeZero(),this.imageSize=cc.SizeZero()},rectForGID:function(e){var t=cc.RectZero();t._size=this._tileSize,e&=cc.TMX_TILE_FLIPPED_MASK,e-=parseInt(this.firstGid,10);var n=parseInt((this.imageSize.width-this.margin*2+this.spacing)/(this._tileSize.width+this.spacing),10);return t._origin.x=parseInt(e%n*(this._tileSize.width+this.spacing)+this.margin,10),t._origin.y=parseInt(parseInt(e/n,10)*(this._tileSize.height+this.spacing)+this.margin,10),t}}),cc.TMXMapInfo=cc.SAXParser.extend({_orientation:null,_mapSize:null,_tileSize:null,_layers:null,_tileSets:null,_objectGroups:null,_parentElement:null,_parentGID:null,_layerAttribs:0,_storingCharacters:!1,_properties:null,_TMXFileName:null,_currentString:null,_tileProperties:null,_resources:"",_currentFirstGID:0,ctor:function(){this._mapSize=cc.SizeZero(),this._tileSize=cc.SizeZero(),this._layers=[],this._tileSets=[],this._objectGroups=[],this._properties=[],this._tileProperties={},this._currentFirstGID=0},getOrientation:function(){return this._orientation},setOrientation:function(e){this._orientation=e},getMapSize:function(){return cc.size(this._mapSize.width,this._mapSize.height)},setMapSize:function(e){this._mapSize.width=e.width,this._mapSize.height=e.height},getTileSize:function(){return cc.size(this._tileSize.width,this._tileSize.height)},setTileSize:function(e){this._tileSize.width=e.width,this._tileSize.height=e.height},getLayers:function(){return this._layers},setLayers:function(e){this._layers.push(e)},getTilesets:function(){return this._tileSets},setTilesets:function(e){this._tileSets.push(e)},getObjectGroups:function(){return this._objectGroups},setObjectGroups:function(e){this._objectGroups.push(e)},getParentElement:function(){return this._parentElement},setParentElement:function(e){this._parentElement=e},getParentGID:function(){return this._parentGID},setParentGID:function(e){this._parentGID=e},getLayerAttribs:function(){return this._layerAttribs},setLayerAttribs:function(e){this._layerAttribs=e},getStoringCharacters:function(){return this._storingCharacters},setStoringCharacters:function(e){this._storingCharacters=e},getProperties:function(){return this._properties},setProperties:function(e){this._properties=e},initWithTMXFile:function(e,t){return this._internalInit(e,t),this.parseXMLFile(this._TMXFileName)},initWithXML:function(e,t){return this._internalInit(null,t),this.parseXMLString(e)},parseXMLFile:function(e,t){t=t||!1,e=cc.FileUtils.getInstance().fullPathForFilename(e);var n=cc.SAXParser.getInstance().tmxParse(e,t),r,i,s=n.documentElement,o=s.getAttribute("version"),u=s.getAttribute("orientation");if(s.nodeName=="map"){o!="1.0"&&o!==null&&cc.log("cocos2d: TMXFormat: Unsupported TMX version:"+o),u=="orthogonal"?this.setOrientation(cc.TMX_ORIENTATION_ORTHO):u=="isometric"?this.setOrientation(cc.TMX_ORIENTATION_ISO):u=="hexagonal"?this.setOrientation(cc.TMX_ORIENTATION_HEX):u!==null&&cc.log("cocos2d: TMXFomat: Unsupported orientation:"+this.getOrientation());var a=cc.size(0,0);a.width=parseFloat(s.getAttribute("width")),a.height=parseFloat(s.getAttribute("height")),this.setMapSize(a),a=cc.size(0,0),a.width=parseFloat(s.getAttribute("tilewidth")),a.height=parseFloat(s.getAttribute("tileheight")),this.setTileSize(a);var f=s.querySelectorAll("map > properties >  property");if(f){var l={};for(r=0;r<f.length;r++)l[f[r].getAttribute("name")]=f[r].getAttribute("value");this.setProperties(l)}}var c=s.getElementsByTagName("tileset");s.nodeName!=="map"&&(c=[],c.push(s));for(r=0;r<c.length;r++){var h=c[r],p=h.getAttribute("source");if(p)this.parseXMLFile(cc.FileUtils.getInstance().fullPathFromRelativeFile(p,t?this._resources+"/":e));else{var d=new cc.TMXTilesetInfo;d.name=h.getAttribute("name")||"",d.firstGid=parseInt(h.getAttribute("firstgid"))||0,d.spacing=parseInt(h.getAttribute("spacing"))||0,d.margin=parseInt(h.getAttribute("margin"))||0;var v=cc.size(0,0);v.width=parseFloat(h.getAttribute("tilewidth")),v.height=parseFloat(h.getAttribute("tileheight")),d._tileSize=v;var m=h.getElementsByTagName("image")[0],g=m.getAttribute("source"),y=-1;this._TMXFileName&&(y=this._TMXFileName.lastIndexOf("/"));if(y!==-1){var b=this._TMXFileName.substr(0,y+1);d.sourceImage=b+g}else d.sourceImage=this._resources+(this._resources?"/":"")+g;this.setTilesets(d)}}var w=s.querySelectorAll("tile");if(w)for(r=0;r<w.length;r++){var E=this._tileSets[0],S=w[r];this.setParentGID(parseInt(E.firstGid)+parseInt(S.getAttribute("id")||0));var x=S.querySelectorAll("properties > property");if(x){var T={};for(i=0;i<x.length;i++){var N=x[i].getAttribute("name");T[N]=x[i].getAttribute("value")}this._tileProperties[this.getParentGID()]=T}}var C=s.getElementsByTagName("layer");if(C)for(r=0;r<C.length;r++){var k=C[r],L=k.getElementsByTagName("data")[0],A=new cc.TMXLayerInfo;A.name=k.getAttribute("name");var O=cc.size(0,0);O.width=parseFloat(k.getAttribute("width")),O.height=parseFloat(k.getAttribute("height")),A._layerSize=O;var M=k.getAttribute("visible");A.visible=M!="0";var _=k.getAttribute("opacity")||1;_?A._opacity=parseInt(255*parseFloat(_)):A._opacity=255,A.offset=cc.p(parseFloat(k.getAttribute("x"))||0,parseFloat(k.getAttribute("y"))||0);var D="";for(i=0;i<L.childNodes.length;i++)D+=L.childNodes[i].nodeValue;D=D.trim();var P=L.getAttribute("compression"),H=L.getAttribute("encoding");if(P&&P!=="gzip"&&P!=="zlib")return cc.log("cc.TMXMapInfo.parseXMLFile(): unsupported compression method"),null;switch(P){case"gzip":A._tiles=cc.unzipBase64AsArray(D,4);break;case"zlib":var B=new Zlib.Inflate(cc.Codec.Base64.decodeAsArray(D,1));A._tiles=cc.uint8ArrayToUint32Array(B.decompress());break;case null:case"":if(H=="base64")A._tiles=cc.Codec.Base64.decodeAsArray(D,4);else if(H==="csv"){A._tiles=[];var j=D.split(",");for(var F=0;F<j.length;F++)A._tiles.push(parseInt(j[F]))}else{var I=L.getElementsByTagName("tile");A._tiles=[];for(var q=0;q<I.length;q++)A._tiles.push(parseInt(I[q].getAttribute("gid")))}break;default:this.getLayerAttribs()==cc.TMX_LAYER_ATTRIB_NONE&&cc.log("cc.TMXMapInfo.parseXMLFile(): Only base64 and/or gzip/zlib maps are supported")}var R=k.querySelectorAll("properties > property");if(R){var U={};for(i=0;i<R.length;i++)U[R[i].getAttribute("name")]=R[i].getAttribute("value");A.setProperties(U)}this.setLayers(A)}var z=s.getElementsByTagName("objectgroup");if(z)for(r=0;r<z.length;r++){var W=z[r],X=new cc.TMXObjectGroup;X.setGroupName(W.getAttribute("name")),X.setPositionOffset(cc.p(parseFloat(W.getAttribute("x"))*this.getTileSize().width||0,parseFloat(W.getAttribute("y"))*this.getTileSize().height||0));var V=W.querySelectorAll("objectgroup > properties > property");if(V)for(i=0;i<V.length;i++){var $={};$[V[i].getAttribute("name")]=V[i].getAttribute("value"),X.setProperties($)}var J=W.querySelectorAll("object");if(J)for(i=0;i<J.length;i++){var K=J[i],Q={};Q.name=K.getAttribute("name")||"",Q.type=K.getAttribute("type")||"",Q.x=parseInt(K.getAttribute("x")||0)+X.getPositionOffset().x;var G=parseInt(K.getAttribute("y")||0)+X.getPositionOffset().y;Q.width=parseInt(K.getAttribute("width"))||0,Q.height=parseInt(K.getAttribute("height"))||0,Q.y=parseInt(this.getMapSize().height*this.getTileSize().height)-G-Q.height;var Y=K.querySelectorAll("properties > property");if(Y)for(var Z=0;Z<Y.length;Z++)Q[Y[Z].getAttribute("name")]=Y[Z].getAttribute("value");var et=K.querySelectorAll("polygon");if(et&&et.length>0){var tt=et[0].getAttribute("points");tt&&(Q.polygonPoints=this._parsePointsString(tt))}var nt=K.querySelectorAll("polyline");if(nt&&nt.length>0){var rt=nt[0].getAttribute("points");rt&&(Q.polylinePoints=this._parsePointsString(rt))}X.setObjects(Q)}this.setObjectGroups(X)}return s},_parsePointsString:function(e){if(!e)return null;var t=[],n=e.split(" ");for(var r=0;r<n.length;r++){var i=n[r].split(",");t.push({x:i[0],y:i[1]})}return t},parseXMLString:function(e){return this.parseXMLFile(e,!0)},getTileProperties:function(){return this._tileProperties},setTileProperties:function(e){this._tileProperties.push(e)},getCurrentString:function(){return this._currentString},setCurrentString:function(e){this._currentString=e},getTMXFileName:function(){return this._TMXFileName},setTMXFileName:function(e){this._TMXFileName=e},_internalInit:function(e,t){this._tileSets.length=0,this._layers.length=0,this._TMXFileName=e,t&&(this._resources=t),this._objectGroups.length=0,this._properties.length=0,this._tileProperties.length=0,this._currentString="",this._storingCharacters=!1,this._layerAttribs=cc.TMX_LAYER_ATTRIB_NONE,this._parentElement=cc.TMX_PROPERTY_NONE,this._currentFirstGID=0}}),cc.TMXMapInfo.create=function(e,t){var n=new cc.TMXMapInfo;return n.initWithTMXFile(e,t)?n:null},cc.TMXMapInfo.createWithXML=function(e,t){var n=new cc.TMXMapInfo;return n.initWithXML(e,t)?n:null},cc.TMXObjectGroup=cc.Class.extend({_groupName:null,_positionOffset:null,_properties:null,_objects:null,ctor:function(){this._groupName="",this._positionOffset=cc._pConst(0,0),this._properties=[],this._objects=[]},getPositionOffset:function(){return this._positionOffset},setPositionOffset:function(e){this._positionOffset._x=e.x,this._positionOffset._y=e.y},getProperties:function(){return this._properties},setProperties:function(e){this._properties.push(e)},getGroupName:function(){return this._groupName.toString()},setGroupName:function(e){this._groupName=e},propertyNamed:function(e){return this._properties[e]},objectNamed:function(e){if(this._objects&&this._objects.length>0){var t=this._objects;for(var n=0,r=t.length;n<r;n++){var i=t[n].name;if(i&&i==e)return t[n]}}return null},getObjects:function(){return this._objects},setObjects:function(e){this._objects.push(e)}}),cc.TMXLayer=cc.SpriteBatchNode.extend({_layerSize:null,_mapTileSize:null,_tiles:null,_tileSet:null,_layerOrientation:null,_properties:null,_layerName:"",_opacity:255,_minGID:null,_maxGID:null,_vertexZvalue:null,_useAutomaticVertexZ:null,_alphaFuncValue:null,_reusedTile:null,_atlasIndexArray:null,_contentScaleFactor:null,_cacheCanvas:null,_cacheContext:null,_cacheTexture:null,_subCacheCanvas:null,_subCacheContext:null,_subCacheCount:0,_subCacheWidth:0,_maxCachePixel:1e7,ctor:function(){cc.SpriteBatchNode.prototype.ctor.call(this),this._descendants=[],this._layerSize=cc.SizeZero(),this._mapTileSize=cc.SizeZero();if(cc.renderContextType===cc.CANVAS){var e=cc.canvas,t=document.createElement("canvas");t.width=e.width,t.height=e.height,this._cacheCanvas=t,this._cacheContext=this._cacheCanvas.getContext("2d");var n=new cc.Texture2D;n.initWithElement(t),n.handleLoadedTexture(),this._cacheTexture=n,this.setContentSize(e.width,e.height)}},setContentSize:function(e,t){var n=this._contentSize;cc.Node.prototype.setContentSize.call(this,e,t);if(cc.renderContextType===cc.CANVAS){var r=this._cacheCanvas,i=cc.CONTENT_SCALE_FACTOR();r.width=0|n._width*1.5*i,r.height=0|n._height*1.5*i,this._cacheContext.translate(0,r.height);var s=this._cacheTexture._contentSize;s._width=r.width,s._height=r.height;var o=r.width*r.height;if(o>this._maxCachePixel){this._subCacheCanvas||(this._subCacheCanvas=[]),this._subCacheContext||(this._subCacheContext=[]),this._subCacheCount=Math.ceil(o/this._maxCachePixel);var u=this._subCacheCanvas,a;for(a=0;a<this._subCacheCount;a++){u[a]||(u[a]=document.createElement("canvas"),this._subCacheContext[a]=u[a].getContext("2d"));var f=u[a];f.width=this._subCacheWidth=Math.round(r.width/this._subCacheCount),f.height=r.height}for(a=this._subCacheCount;a<u.length;a++)f.width=0,f.height=0}else this._subCacheCount=0}},getTexture:function(){return cc.renderContextType===cc.CANVAS?this._cacheTexture:cc.SpriteBatchNode.prototype.getTexture.call(this)},visit:null,_visitForCanvas:function(e){var t=e||cc.renderContext;if(!this._visible)return;t.save(),this.transform(e);var n,r=this._children;if(this._cacheDirty){var i=cc.EGLView.getInstance();i._setScaleXYForRenderTexture();var s=this._cacheContext,o=this._cacheCanvas;s.clearRect(0,0,o.width,-o.height),s.save(),s.translate(this._anchorPointInPoints._x,-this._anchorPointInPoints._y);if(r){this.sortAllChildren();for(n=0;n<r.length;n++)r[n]&&r[n].visit(s)}s.restore();if(this._subCacheCount>0){var u=this._subCacheWidth,a=o.height;for(n=0;n<this._subCacheCount;n++)this._subCacheContext[n].drawImage(o,n*u,0,u,a,0,0,u,a)}i._resetScale(),this._cacheDirty=!1}this.draw(e),t.restore()},draw:null,_drawForCanvas:function(e){var t=e||cc.renderContext,n=0|-this._anchorPointInPoints._x,r=0|-this._anchorPointInPoints._y,i=cc.EGLView.getInstance(),s=this._cacheCanvas;if(s){var o=this._subCacheCount,u=s.height*i._scaleY;if(o>0){var a=this._subCacheCanvas;for(var f=0;f<o;f++){var l=a[f];t.drawImage(a[f],0,0,l.width,l.height,n+f*this._subCacheWidth,-(r+u),l.width*i._scaleX,u)}}else t.drawImage(s,0,0,s.width,s.height,n,-(r+u),s.width*i._scaleX,u)}},getLayerSize:function(){return cc.size(this._layerSize.width,this._layerSize.height)},setLayerSize:function(e){this._layerSize.width=e.width,this._layerSize.height=e.height},getMapTileSize:function(){return cc.size(this._mapTileSize.width,this._mapTileSize.height)},setMapTileSize:function(e){this._mapTileSize.width=e.width,this._mapTileSize.height=e.height},getTiles:function(){return this._tiles},setTiles:function(e){this._tiles=e},getTileSet:function(){return this._tileSet},setTileSet:function(e){this._tileSet=e},getLayerOrientation:function(){return this._layerOrientation},setLayerOrientation:function(e){this._layerOrientation=e},getProperties:function(){return this._properties},setProperties:function(e){this._properties=e},initWithTilesetInfo:function(e,t,n){var r=t._layerSize,i=parseInt(r.width*r.height),s=i*.35+1,o;e&&(o=cc.TextureCache.getInstance().addImage(e.sourceImage));if(this.initWithTexture(o,s)){this._layerName=t.name,this._layerSize=r,this._tiles=t._tiles,this._minGID=t._minGID,this._maxGID=t._maxGID,this._opacity=t._opacity,this.setProperties(t.getProperties()),this._contentScaleFactor=cc.Director.getInstance().getContentScaleFactor(),this._tileSet=e,this._mapTileSize=n.getTileSize(),this._layerOrientation=n.getOrientation();var u=this._calculateLayerOffset(t.offset);return this.setPosition(cc.POINT_PIXELS_TO_POINTS(u)),this._atlasIndexArray=[],this.setContentSize
(cc.SIZE_PIXELS_TO_POINTS(cc.size(this._layerSize.width*this._mapTileSize.width,this._layerSize.height*this._mapTileSize.height))),this._useAutomaticVertexZ=!1,this._vertexZvalue=0,!0}return!1},releaseMap:function(){this._tiles&&(this._tiles=null),this._atlasIndexArray&&(this._atlasIndexArray=null)},getTileAt:function(e){if(!e)throw"cc.TMXLayer.getTileAt(): pos should be non-null";if(e.x>=this._layerSize.width||e.y>=this._layerSize.height||e.x<0||e.y<0)throw"cc.TMXLayer.getTileAt(): invalid position";if(!this._tiles||!this._atlasIndexArray)return cc.log("cc.TMXLayer.getTileAt(): TMXLayer: the tiles map has been released"),null;var t=null,n=this.getTileGIDAt(e);if(n===0)return t;var r=0|e.x+e.y*this._layerSize.width;t=this.getChildByTag(r);if(!t){var i=this._tileSet.rectForGID(n);i=cc.RECT_PIXELS_TO_POINTS(i),t=new cc.Sprite,t.initWithTexture(this.getTexture(),i),t.setBatchNode(this),t.setPosition(this.getPositionAt(e)),t.setVertexZ(this._vertexZForPos(e)),t.setAnchorPoint(0,0),t.setOpacity(this._opacity);var s=this._atlasIndexForExistantZ(r);this.addSpriteWithoutQuad(t,s,r)}return t},getTileGIDAt:function(e){if(!e)throw"cc.TMXLayer.getTileGIDAt(): pos should be non-null";if(e.x>=this._layerSize.width||e.y>=this._layerSize.height||e.x<0||e.y<0)throw"cc.TMXLayer.getTileGIDAt(): invalid position";if(!this._tiles||!this._atlasIndexArray)return cc.log("cc.TMXLayer.getTileGIDAt(): TMXLayer: the tiles map has been released"),null;var t=0|e.x+e.y*this._layerSize.width,n=this._tiles[t];return(n&cc.TMX_TILE_FLIPPED_MASK)>>>0},getTileFlagsAt:function(e){if(!e)throw"cc.TMXLayer.getTileFlagsAt(): pos should be non-null";if(e.x>=this._layerSize.width||e.y>=this._layerSize.height||e.x<0||e.y<0)throw"cc.TMXLayer.getTileFlagsAt(): invalid position";if(!this._tiles||!this._atlasIndexArray)return cc.log("cc.TMXLayer.getTileFlagsAt(): TMXLayer: the tiles map has been released"),null;var t=0|e.x+e.y*this._layerSize.width,n=this._tiles[t];return(n&cc.TMX_TILE_FLIPPED_ALL)>>>0},setTileGID:function(e,t,n){if(!t)throw"cc.TMXLayer.setTileGID(): pos should be non-null";if(t.x>=this._layerSize.width||t.y>=this._layerSize.height||t.x<0||t.y<0)throw"cc.TMXLayer.setTileGID(): invalid position";if(!this._tiles||!this._atlasIndexArray)return cc.log("cc.TMXLayer.setTileGID(): TMXLayer: the tiles map has been released"),null;if(e!==0&&e<this._tileSet.firstGid)return cc.log("cc.TMXLayer.setTileGID(): invalid gid:"+e),null;n=n||0,this._setNodeDirtyForCache();var r=this.getTileFlagsAt(t),i=this.getTileGIDAt(t);if(i!=e||r!=n){var s=(e|n)>>>0;if(e===0)this.removeTileAt(t);else if(i===0)this._insertTileForGID(s,t);else{var o=t.x+t.y*this._layerSize.width,u=this.getChildByTag(o);if(u){var a=this._tileSet.rectForGID(e);a=cc.RECT_PIXELS_TO_POINTS(a),u.setTextureRect(a,!1,a._size),n!=null&&this._setupTileSprite(u,t,s),this._tiles[o]=s}else this._updateTileForGID(s,t)}}},removeTileAt:function(e){if(!e)throw"cc.TMXLayer.removeTileAt(): pos should be non-null";if(e.x>=this._layerSize.width||e.y>=this._layerSize.height||e.x<0||e.y<0)throw"cc.TMXLayer.removeTileAt(): invalid position";if(!this._tiles||!this._atlasIndexArray)return cc.log("cc.TMXLayer.removeTileAt(): TMXLayer: the tiles map has been released"),null;var t=this.getTileGIDAt(e);if(t!==0){cc.renderContextType===cc.CANVAS&&this._setNodeDirtyForCache();var n=0|e.x+e.y*this._layerSize.width,r=this._atlasIndexForExistantZ(n);this._tiles[n]=0,cc.ArrayRemoveObjectAtIndex(this._atlasIndexArray,r);var i=this.getChildByTag(n);if(i)cc.SpriteBatchNode.prototype.removeChild.call(this,i,!0);else{cc.renderContextType===cc.WEBGL&&this._textureAtlas.removeQuadAtIndex(r);if(this._children){var s=this._children;for(var o=0,u=s.length;o<u;o++){var a=s[o];if(a){var f=a.getAtlasIndex();f>=r&&a.setAtlasIndex(f-1)}}}}}},getPositionAt:function(e){var t=cc.PointZero();switch(this._layerOrientation){case cc.TMX_ORIENTATION_ORTHO:t=this._positionForOrthoAt(e);break;case cc.TMX_ORIENTATION_ISO:t=this._positionForIsoAt(e);break;case cc.TMX_ORIENTATION_HEX:t=this._positionForHexAt(e)}return cc.POINT_PIXELS_TO_POINTS(t)},getProperty:function(e){return this._properties[e]},setupTiles:function(){cc.renderContextType===cc.CANVAS?this._tileSet.imageSize=this._originalTexture.getContentSizeInPixels():(this._tileSet.imageSize=this._textureAtlas.getTexture().getContentSizeInPixels(),this._textureAtlas.getTexture().setAliasTexParameters()),this._parseInternalProperties(),cc.renderContextType===cc.CANVAS&&this._setNodeDirtyForCache();var e=this._layerSize.height,t=this._layerSize.width;for(var n=0;n<e;n++)for(var r=0;r<t;r++){var i=r+t*n,s=this._tiles[i];s!==0&&(this._appendTileForGID(s,cc.p(r,n)),this._minGID=Math.min(s,this._minGID),this._maxGID=Math.max(s,this._maxGID))}this._maxGID>=this._tileSet.firstGid&&this._minGID>=this._tileSet.firstGid||cc.log("cocos2d:TMX: Only 1 tileset per layer is supported")},addChild:function(e,t,n){cc.log("addChild: is not supported on cc.TMXLayer. Instead use setTileGID or tileAt.")},removeChild:function(e,t){if(!e)return;if(this._children.indexOf(e)===-1){cc.log("cc.TMXLayer.removeChild(): Tile does not belong to TMXLayer");return}cc.renderContextType===cc.CANVAS&&this._setNodeDirtyForCache();var n=e.getAtlasIndex(),r=this._atlasIndexArray[n];this._tiles[r]=0,cc.ArrayRemoveObjectAtIndex(this._atlasIndexArray,n),cc.SpriteBatchNode.prototype.removeChild.call(this,e,t)},getLayerName:function(){return this._layerName.toString()},setLayerName:function(e){this._layerName=e},_positionForIsoAt:function(e){return cc.p(this._mapTileSize.width/2*(this._layerSize.width+e.x-e.y-1),this._mapTileSize.height/2*(this._layerSize.height*2-e.x-e.y-2))},_positionForOrthoAt:function(e){return cc.p(e.x*this._mapTileSize.width,(this._layerSize.height-e.y-1)*this._mapTileSize.height)},_positionForHexAt:function(e){var t=e.x%2==1?-this._mapTileSize.height/2:0;return cc.p(e.x*this._mapTileSize.width*3/4,(this._layerSize.height-e.y-1)*this._mapTileSize.height+t)},_calculateLayerOffset:function(e){var t=cc.PointZero();switch(this._layerOrientation){case cc.TMX_ORIENTATION_ORTHO:t=cc.p(e.x*this._mapTileSize.width,-e.y*this._mapTileSize.height);break;case cc.TMX_ORIENTATION_ISO:t=cc.p(this._mapTileSize.width/2*(e.x-e.y),this._mapTileSize.height/2*(-e.x-e.y));break;case cc.TMX_ORIENTATION_HEX:(e.x!==0||e.y!==0)&&cc.log("offset for hexagonal map not implemented yet")}return t},_appendTileForGID:function(e,t){var n=this._tileSet.rectForGID(e);n=cc.RECT_PIXELS_TO_POINTS(n);var r=0|t.x+t.y*this._layerSize.width,i=this._reusedTileWithRect(n);this._setupTileSprite(i,t,e);var s=this._atlasIndexArray.length;return this.insertQuadFromSprite(i,s),this._atlasIndexArray=cc.ArrayAppendObjectToIndex(this._atlasIndexArray,r,s),i},_insertTileForGID:function(e,t){var n=this._tileSet.rectForGID(e);n=cc.RECT_PIXELS_TO_POINTS(n);var r=0|t.x+t.y*this._layerSize.width,i=this._reusedTileWithRect(n);this._setupTileSprite(i,t,e);var s=this._atlasIndexForNewZ(r);this.insertQuadFromSprite(i,s),this._atlasIndexArray=cc.ArrayAppendObjectToIndex(this._atlasIndexArray,r,s);if(this._children){var o=this._children;for(var u=0,a=o.length;u<a;u++){var f=o[u];if(f){var l=f.getAtlasIndex();l>=s&&f.setAtlasIndex(l+1)}}}return this._tiles[r]=e,i},_updateTileForGID:function(e,t){var n=this._tileSet.rectForGID(e),r=this._contentScaleFactor;n=cc.rect(n.x/r,n.y/r,n.width/r,n.height/r);var i=t.x+t.y*this._layerSize.width,s=this._reusedTileWithRect(n);this._setupTileSprite(s,t,e);var o=this._atlasIndexForExistantZ(i);return s.setAtlasIndex(o),s.setDirty(!0),s.updateTransform(),this._tiles[i]=e,s},_parseInternalProperties:function(){var e=this.getProperty("cc_vertexz");if(e)if(e=="automatic"){this._useAutomaticVertexZ=!0;var t=this.getProperty("cc_alpha_func"),n=0;t&&(n=parseFloat(t));if(cc.renderContextType===cc.WEBGL){this.setShaderProgram(cc.ShaderCache.getInstance().programForKey(cc.SHADER_POSITION_TEXTURECOLORALPHATEST));var r=cc.renderContext.getUniformLocation(this.getShaderProgram().getProgram(),cc.UNIFORM_ALPHA_TEST_VALUE_S);this.getShaderProgram().use(),this.getShaderProgram().setUniformLocationWith1f(r,n)}}else this._vertexZvalue=parseInt(e,10)},_setupTileSprite:function(e,t,n){var r=t.x+t.y*this._layerSize.width;e.setPosition(this.getPositionAt(t)),cc.renderContextType===cc.WEBGL?e.setVertexZ(this._vertexZForPos(t)):e.setTag(r),e.setAnchorPoint(0,0),e.setOpacity(this._opacity),cc.renderContextType===cc.WEBGL&&e.setRotation(0),e.setFlippedX(!1),e.setFlippedY(!1);if((n&cc.TMX_TILE_DIAGONAL_FLAG)>>>0){e.setAnchorPoint(.5,.5),e.setPosition(this.getPositionAt(t).x+e.getContentSize().height/2,this.getPositionAt(t).y+e.getContentSize().width/2);var i=(n&(cc.TMX_TILE_HORIZONTAL_FLAG|cc.TMX_TILE_VERTICAL_FLAG)>>>0)>>>0;i==cc.TMX_TILE_HORIZONTAL_FLAG?e.setRotation(90):i==cc.TMX_TILE_VERTICAL_FLAG?e.setRotation(270):i==(cc.TMX_TILE_VERTICAL_FLAG|cc.TMX_TILE_HORIZONTAL_FLAG)>>>0?(e.setRotation(90),e.setFlippedX(!0)):(e.setRotation(270),e.setFlippedX(!0))}else(n&cc.TMX_TILE_HORIZONTAL_FLAG)>>>0&&e.setFlippedX(!0),(n&cc.TMX_TILE_VERTICAL_FLAG)>>>0&&e.setFlippedY(!0)},_reusedTileWithRect:function(e){return cc.renderContextType===cc.WEBGL?this._reusedTile?(this._reusedTile.setBatchNode(null),this._reusedTile.setTextureRect(e,!1,e._size),this._reusedTile.setBatchNode(this)):(this._reusedTile=new cc.Sprite,this._reusedTile.initWithTexture(this.getTexture(),e,!1),this._reusedTile.setBatchNode(this)):(this._reusedTile=new cc.Sprite,this._reusedTile.initWithTexture(this._textureForCanvas,e,!1),this._reusedTile.setBatchNode(this),this._reusedTile.setParent(this)),this._reusedTile},_vertexZForPos:function(e){var t=0,n=0;if(this._useAutomaticVertexZ)switch(this._layerOrientation){case cc.TMX_ORIENTATION_ISO:n=this._layerSize.width+this._layerSize.height,t=-(n-(e.x+e.y));break;case cc.TMX_ORIENTATION_ORTHO:t=-(this._layerSize.height-e.y);break;case cc.TMX_ORIENTATION_HEX:cc.log("TMX Hexa zOrder not supported");break;default:cc.log("TMX invalid value")}else t=this._vertexZvalue;return t},_atlasIndexForExistantZ:function(e){var t;if(this._atlasIndexArray){var n=this._atlasIndexArray;for(var r=0,i=n.length;r<i;r++){t=n[r];if(t==e)break}}return t||cc.log("cc.TMXLayer._atlasIndexForExistantZ(): TMX atlas index not found. Shall not happen"),r},_atlasIndexForNewZ:function(e){var t=this._atlasIndexArray;for(var n=0,r=t.length;n<r;n++){var i=t[n];if(e<i)break}return n}}),cc.Browser.supportWebGL?(cc.TMXLayer.prototype.draw=cc.SpriteBatchNode.prototype.draw,cc.TMXLayer.prototype.visit=cc.SpriteBatchNode.prototype.visit):(cc.TMXLayer.prototype.draw=cc.TMXLayer.prototype._drawForCanvas,cc.TMXLayer.prototype.visit=cc.TMXLayer.prototype._visitForCanvas),cc.TMXLayer.create=function(e,t,n){var r=new cc.TMXLayer;return r.initWithTilesetInfo(e,t,n)?r:null},cc.PointObject=cc.Class.extend({_ratio:null,_offset:null,_child:null,getRatio:function(){return this._ratio},setRatio:function(e){this._ratio=e},getOffset:function(){return this._offset},setOffset:function(e){this._offset=e},getChild:function(){return this._child},setChild:function(e){this._child=e},initWithCCPoint:function(e,t){return this._ratio=e,this._offset=t,this._child=null,!0}}),cc.PointObject.create=function(e,t){var n=new cc.PointObject;return n.initWithCCPoint(e,t),n},cc.ParallaxNode=cc.NodeRGBA.extend({_lastPosition:null,_parallaxArray:null,getParallaxArray:function(){return this._parallaxArray},setParallaxArray:function(e){this._parallaxArray=e},ctor:function(){cc.NodeRGBA.prototype.ctor.call(this),this._parallaxArray=[],this._lastPosition=cc.p(-100,-100)},addChild:function(e,t,n,r){if(arguments.length===3){cc.log("ParallaxNode: use addChild(child, z, ratio, offset) instead");return}if(!e)throw"cc.ParallaxNode.addChild(): child should be non-null";var i=cc.PointObject.create(n,r);i.setChild(e),this._parallaxArray.push(i);var s=cc.p(this._position._x,this._position._y);s.x=s.x*n.x+r.x,s.y=s.y*n.y+r.y,e.setPosition(s),cc.NodeRGBA.prototype.addChild.call(this,e,t,e.getTag())},removeChild:function(e,t){var n=this._parallaxArray;for(var r=0;r<n.length;r++){var i=n[r];if(i.getChild()==e){n.splice(r,1);break}}cc.NodeRGBA.prototype.removeChild.call(this,e,t)},removeAllChildren:function(e){this._parallaxArray.length=0,cc.NodeRGBA.prototype.removeAllChildren.call(this,e)},visit:function(){var e=this._absolutePosition();if(!cc.pointEqualToPoint(e,this._lastPosition)){var t=this._parallaxArray;for(var n=0,r=t.length;n<r;n++){var i=t[n],s=-e.x+e.x*i.getRatio().x+i.getOffset().x,o=-e.y+e.y*i.getRatio().y+i.getOffset().y;i.getChild().setPosition(s,o)}this._lastPosition=e}cc.NodeRGBA.prototype.visit.call(this)},_absolutePosition:function(){var e=this._position,t=this;while(t.getParent()!=null)t=t.getParent(),e=cc.pAdd(e,t.getPosition());return e}}),cc.ParallaxNode.create=function(){return new cc.ParallaxNode};var cc=cc||{};cc.AudioEngine=cc.Class.extend({_audioID:0,_audioIDList:null,_supportedFormat:null,_soundSupported:!1,_effectsVolume:1,_playingMusic:null,_resPath:"",_pausedPlayings:null,ctor:function(){this._audioIDList={},this._supportedFormat=[],this._pausedPlayings=[]},setResPath:function(e){if(!e||e.length==0)return;this._resPath=e.substring(e.length-1)=="/"?e:e+"/"},_checkCanPlay:function(e){var t=document.createElement("audio");if(t.canPlayType){var n=function(e){var n=t.canPlayType(e);return n!="no"&&n!=""};e.mp3=n("audio/mpeg"),e.mp4=n("audio/mp4"),e.m4a=n("audio/x-m4a")||n("audio/aac"),e.ogg=n('audio/ogg; codecs="vorbis"'),e.wav=n('audio/wav; codecs="1"')}else{var r=["mp3","mp4","m4a","ogg","wav"];for(var i in r)e[r[i]]=!1}},_getPathWithoutExt:function(e){if(typeof e!="string")return null;var t=e.lastIndexOf(".");return t!==-1?e.substring(0,t):e},_getExtFromFullPath:function(e){var t=e.lastIndexOf(".");return t!==-1?e.substring(t+1,e.length):-1},willPlayMusic:function(){return!1},preloadMusic:function(e,t,n){this.preloadSound(e,t,n)},preloadEffect:function(e,t,n){this.preloadSound(e,t,n)},isFormatSupported:function(e){var t=this._supportedFormat;for(var n=0,r=t.length;n<r;n++)if(t[n]==e)return!0;return!1},getEffectsVolume:function(){return this._effectsVolume}}),cc.SimpleSFX=function(e,t){this.audio=e,this.ext=t||".ogg"},cc.SimpleAudioEngine=cc.AudioEngine.extend({_effectList:null,_soundList:null,_maxAudioInstance:5,_canPlay:!0,_musicListenerBound:null,_musicIsStopped:!1,ctor:function(){cc.AudioEngine.prototype.ctor.call(this),this._effectList={},this._soundList={},this._musicListenerBound=this._musicListener.bind(this);var e=navigator.userAgent;if(/Mobile/.test(e)&&(/iPhone OS/.test(e)||/iPad/.test(e)||/Firefox/.test(e))||/MSIE/.test(e))this._canPlay=!1},init:function(){var e={};this._checkCanPlay(e);var t=["ogg","mp3","wav","mp4","m4a"],n=this._supportedFormat;for(var r in t){var i=t[r];e[i]&&n.push(i)}return this._soundSupported=n.length>0,this._soundSupported},preloadSound:function(e,t,n){if(this._soundSupported){var r=this._resPath+e,i=this._getExtFromFullPath(e),s=this._getPathWithoutExt(e);if(!this._soundList[s]&&this.isFormatSupported(i)&&this._canPlay){var o=new cc.SimpleSFX;o.ext=i,o.audio=new Audio(r),o.audio.preload="auto";var u=function(){cc.doCallback(t,n),this.removeEventListener("canplaythrough",u,!1),this.removeEventListener("error",a,!1)},a=function(e){cc.doCallback(t,n,e.srcElement.src),this.removeEventListener("canplaythrough",u,!1),this.removeEventListener("error",a,!1)};o.audio.addEventListener("canplaythrough",u,!1),o.audio.addEventListener("error",a,!1),this._soundList[s]=o,o.audio.load();return}}cc.doCallback(t,n)},playMusic:function(e,t){if(!this._soundSupported)return;var n=this._getPathWithoutExt(e),r=this._getExtFromFullPath(e),i,s=this._soundList;s[this._playingMusic]&&s[this._playingMusic].audio.pause(),this._playingMusic=n;if(s[this._playingMusic])i=s[this._playingMusic].audio;else{var o=new cc.SimpleSFX;o.ext=r,i=o.audio=new Audio(e),o.audio.preload="auto",s[n]=o,o.audio.load()}i.addEventListener("pause",this._musicListenerBound,!1),i.loop=t||!1,i.play(),cc.AudioEngine.isMusicPlaying=!0,this._musicIsStopped=!1},_musicListener:function(e){cc.AudioEngine.isMusicPlaying=!1;if(this._soundList[this._playingMusic]){var t=this._soundList[this._playingMusic].audio;t.removeEventListener("pause",this._musicListener,!1)}},stopMusic:function(e){var t=this._soundList,n=this._playingMusic;if(t[n]){var r=t[n].audio;r.pause(),r.duration&&(r.currentTime=r.duration),e&&delete t[n],cc.AudioEngine.isMusicPlaying=!1,this._musicIsStopped=!0}},pauseMusic:function(){if(!this._musicIsStopped&&this._soundList[this._playingMusic]){var e=this._soundList[this._playingMusic].audio;e.pause(),cc.AudioEngine.isMusicPlaying=!1}},resumeMusic:function(){if(!this._musicIsStopped&&this._soundList[this._playingMusic]){var e=this._soundList[this._playingMusic].audio;e.play(),e.addEventListener("pause",this._musicListenerBound,!1),cc.AudioEngine.isMusicPlaying=!0}},rewindMusic:function(){if(this._soundList[this._playingMusic]){var e=this._soundList[this._playingMusic].audio;e.currentTime=0,e.play(),e.addEventListener("pause",this._musicListenerBound,!1),cc.AudioEngine.isMusicPlaying=!0,this._musicIsStopped=!1}},getMusicVolume:function(){return this._soundList[this._playingMusic]?this._soundList[this._playingMusic].audio.volume:0},setMusicVolume:function(e){if(this._soundList[this._playingMusic]){var t=this._soundList[this._playingMusic].audio;e>1?t.volume=1:e<0?t.volume=0:t.volume=e}},isMusicPlaying:function(){return cc.AudioEngine.isMusicPlaying},playEffect:function(e,t){if(!this._soundSupported)return null;var n=this._getPathWithoutExt(e),r;this._soundList[n]?r=this._soundList[n].ext:r=this._getExtFromFullPath(e);var i=this._getEffectList(n),s;if(i.length>0)for(var o=0;o<i.length;o++)if(i[o].ended){s=i[o],s.currentTime=0,window.chrome&&s.load();break}if(!s){if(i.length>=this._maxAudioInstance)return cc.log("Error: "+e+" greater than "+this._maxAudioInstance),null;s=new Audio(n+"."+r),s.volume=this._effectsVolume,i.push(s)}t&&(s.loop=t),s.play();var u=this._audioID++;return this._audioIDList[u]=s,u},setEffectsVolume:function(e){e>1?this._effectsVolume=1:e<0?this._effectsVolume=0:this._effectsVolume=e;var t,n,r=this._effectList;for(var i in r){t=r[i];if(t.length>0)for(var s=0;s<t.length;s++)n=t[s],n.volume=this._effectsVolume}},pauseEffect:function(e){if(e==null)return;if(this._audioIDList[e]){var t=this._audioIDList[e];t.ended||t.pause()}},pauseAllEffects:function(){var e,t,n=this._effectList;for(var r in n){e=n[r];for(var i=0;i<e.length;i++)t=e[i],t.ended||t.pause()}},resumeEffect:function(e){if(e==null)return;if(this._audioIDList[e]){var t=this._audioIDList[e];t.ended||t.play()}},resumeAllEffects:function(){var e,t,n=this._effectList;for(var r in n){e=n[r];if(e.length>0)for(var i=0;i<e.length;i++)t=e[i],t.ended||t.play()}},stopEffect:function(e){if(e==null)return;if(this._audioIDList[e]){var t=this._audioIDList[e];t.ended||(t.loop=!1,t.duration&&(t.currentTime=t.duration))}},stopAllEffects:function(){var e,t,n=this._effectList;for(var r in n){e=n[r];for(var i=0;i<e.length;i++)t=e[i],t.ended||(t.loop=!1,t.duration&&(t.currentTime=t.duration))}},unloadEffect:function(e){if(!e)return;var t=this._getPathWithoutExt(e);this._effectList[t]&&delete this._effectList[t];var n,r,i=this._audioIDList;for(var s in i)n=i[s],r=this._getPathWithoutExt(n.src),r.indexOf(t)>-1&&(this.stopEffect(s),delete i[s])},_getEffectList:function(e){var t=this._effectList;return t[e]?t[e]:(t[e]=[],t[e])},_pausePlaying:function(){var e=this._pausedPlayings,t=this._soundList,n,r;!this._musicIsStopped&&t[this._playingMusic]&&(r=t[this._playingMusic].audio,r.paused||(r.pause(),cc.AudioEngine.isMusicPlaying=!1,e.push(r)));var i=this._effectList;for(var s in i){n=i[s];for(var o=0;o<n.length;o++)r=n[o],!r.ended&&!r.paused&&(r.pause(),e.push(r))}},_resumePlaying:function(){var e=this._pausedPlayings,t=this._soundList,n,r;!this._musicIsStopped&&t[this._playingMusic]&&(r=t[this._playingMusic].audio,e.indexOf(r)!==-1&&(r.play(),r.addEventListener("pause",this._musicListenerBound,!1),cc.AudioEngine.isMusicPlaying=!0));var i=this._effectList;for(var s in i){n=i[s];for(var o=0;o<n.length;o++)r=n[o],!r.ended&&e.indexOf(r)!==-1&&r.play()}e.length=0}}),cc.PlayingTask=function(e,t,n,r){this.id=e,this.audio=t,this.isLoop=n||!1,this.status=r||cc.PlayingTaskStatus.stop},cc.PlayingTaskStatus={playing:1,pause:2,stop:3,waiting:4},cc.SimpleAudioEngineForMobile=cc.SimpleAudioEngine.extend({_playingList:null,_currentTask:null,_isPauseForList:!1,_checkFlag:!0,_audioEndedCallbackBound:null,ctor:function(){cc.SimpleAudioEngine.prototype.ctor.call(this),this._maxAudioInstance=2,this._playingList=[],this._isPauseForList=!1,this._checkFlag=!0,this._audioEndedCallbackBound=this._audioEndCallback.bind(this)},_stopAllEffectsForList:function(){var e,t,n=this._effectList;for(var r in n){e=n[r];for(var i=0;i<e.length;i++)t=e[i],t.ended||(t.removeEventListener("ended",this._audioEndedCallbackBound,!1),t.loop=!1,t.duration&&(t.currentTime=t.duration))}this._playingList.length=0,this._currentTask=null},playMusic:function(e,t){if(!this._soundSupported)return;this._stopAllEffectsForList();var n=this._getPathWithoutExt(e),r=this._getExtFromFullPath(e),i,s=this._soundList;if(s[this._playingMusic]){var o=s[this._playingMusic];o.audio.removeEventListener("pause",this._musicListenerBound,!1),o.audio.pause()}this._playingMusic=n;if(s[this._playingMusic])i=s[this._playingMusic].audio;else{var u=new cc.SimpleSFX;u.ext=r,i=u.audio=new Audio(e),u.audio.preload="auto",s[n]=u,u.audio.load()}i.addEventListener("pause",this._musicListenerBound,!1),i.loop=t||!1,i.play(),cc.AudioEngine.isMusicPlaying=!0,this._musicIsStopped=!1},isMusicPlaying:function(){var e=this._soundList,t=this._playingMusic;if(e[t]){var n=e[t].audio;return!n.paused&&!n.ended}return!1},_musicListener:function(){cc.AudioEngine.isMusicPlaying=!1;if(this._soundList[this._playingMusic]){var e=this._soundList[this._playingMusic].audio;e.removeEventListener("pause",this._musicListener,!1)}this._checkFlag?this._isPauseForList=!1:this._checkFlag=!0},_stopExpiredTask:function(e){var t=this._playingList,n=this._audioIDList;for(var r=0;r<t.length;){var i=t[r];if(i.status===cc.PlayingTaskStatus.waiting){if(i.audio.currentTime+e>=i.audio.duration){t.splice(r,1);if(n[i.id]){var s=n[i.id];s.ended||(s.removeEventListener("ended",this._audioEndedCallbackBound,!1),s.loop=!1,s.duration&&(s.currentTime=s.duration))}continue}i.audio.currentTime=i.audio.currentTime+e}r++}},_audioEndCallback:function(){var e=this._currentTask,t=e.audio.currentTime;this._stopExpiredTask(t);if(e.isLoop){e.audio.play();return}e.audio.removeEventListener("ended",this._audioEndedCallbackBound,!1),cc.ArrayRemoveObject(this._playingList,e),e=this._getNextTaskToPlay(),e?(this._currentTask=e,e.status=cc.PlayingTaskStatus.playing,e.audio.play()):(this._currentTask=null,this._isPauseForList&&(this._isPauseForList=!1,this.resumeMusic()))},_pushingPlayingTask:function(e){if(!e)throw"cc.SimpleAudioEngineForMobile._pushingPlayingTask(): playingTask should be non-null.";var t=this._playingList;this._currentTask?(this._currentTask.status=cc.PlayingTaskStatus.waiting,this._currentTask.audio.pause()):this.isMusicPlaying()&&(this._checkFlag=!1,this.pauseMusic(),this._isPauseForList=!0),t.push(e),this._currentTask=e,this._playingAudioTask(e)},_playingAudioTask:function(e){e.audio.addEventListener("ended",this._audioEndedCallbackBound,!1),e.audio.play(),e.status=cc.PlayingTaskStatus.playing},_getPlayingTaskFromList:function(e){var t=this._playingList;for(var n=0,r=t.length;n<r;n++)if(t[n].id===e)return t[n];return null},_getNextTaskToPlay:function(){var e=this._playingList;for(var t=e.length-1;t>=0;t--){var n=e[t];if(n.status===cc.PlayingTaskStatus.waiting)return n}return null},_playingNextTask:function(){var e=this._currentTask=this._getNextTaskToPlay();e?(e.status=cc.PlayingTaskStatus.playing,e.audio.play()):this._isPauseForList&&(this._isPauseForList=!1,this.resumeMusic())},_deletePlayingTaskFromList:function(e){var t=this._playingList;for(var n=0,r=t.length;n<r;n++){var i=t[n];if(i.id===e){t.splice(n,1),i==this._currentTask&&this._playingNextTask();return}}},_pausePlayingTaskFromList:function(e){var t=this._playingList;for(var n=0,r=t.length;n<r;n++){var i=t[n];if(i.id===e){i.status=cc.PlayingTaskStatus.pause,i==this._currentTask&&this._playingNextTask();return}}},_resumePlayingTaskFromList:function(e){var t=this._playingList;for(var n=0,r=t.length;n<r;n++){var i=t[n];if(i.id===e){i.status=cc.PlayingTaskStatus.waiting;if(!this._currentTask){var s=this._getNextTaskToPlay();s&&(this.isMusicPlaying()&&(this._checkFlag=!1,this.pauseMusic(),this._isPauseForList=!0),s.status=cc.PlayingTaskStatus.playing,s.audio.play())}return}}},playEffect:function(e,t){if(!this._soundSupported)return null;var n=this._getPathWithoutExt(e),r;this._soundList[n]?r=this._soundList[n].ext:r=this._getExtFromFullPath(e);var i=this._getEffectList(n),s;if(i.length>0)for(var o=0;o<i.length;o++)if(i[o].ended){s=i[o],s.currentTime=0,window.chrome&&s.load();break}if(!s){if(i.length>=this._maxAudioInstance)return cc.log("Error: "+e+" greater than "+this._maxAudioInstance),null;s=new Audio(n+"."+r),s.volume=this._effectsVolume,i.push(s)}var u=new cc.PlayingTask(this._audioID++,s,t);return this._pushingPlayingTask(u),this._audioIDList[u.id]=s,u.id},pauseEffect:function(e){if(e==null)return;var t=e.toString();if(this._audioIDList[t]){var n=this._audioIDList[t];n.ended||n.pause()}this._pausePlayingTaskFromList(e)},pauseAllEffects:function(){var e,t,n=this._effectList;for(var r in n){e=n[r];for(var i=0;i<e.length;i++)t=e[i],t.ended||t.pause()}var s=this._playingList;for(var o=0,u=s.length;o<u;o++)s[o].status=cc.PlayingTaskStatus.pause;this._currentTask=null,this._isPauseForList&&(this._isPauseForList=!1,this.resumeMusic())},resumeEffect:function(e){if(e==null)return;if(this._audioIDList[e]){var t=this._audioIDList[e];t.ended||t.play()}this._resumePlayingTaskFromList(e)},resumeAllEffects:function(){var e,t,n=this._effectList;for(var r in n){e=n[r];if(e.length>0)for(var i=0;i<e.length;i++)t=e[i],t.ended||t.play()}var s=this._playingList;for(var o=0,u=s.length;o<u;o++){var a=s[o];a.status===cc.PlayingTaskStatus.pause&&(a.status=cc.PlayingTaskStatus.waiting)}if(this._currentTask==null){var f=this._getNextTaskToPlay();f&&(this.isMusicPlaying()&&(this._checkFlag=!1,this.pauseMusic(),this._isPauseForList=!0),f.status=cc.PlayingTaskStatus.playing,f.audio.play())}},stopEffect:function(e){if(e==null)return;if(this._audioIDList[e]){var t=this._audioIDList[e];t.ended||(t.removeEventListener("ended",this._audioEndedCallbackBound,!1),t.loop=!1,t.duration&&(t.currentTime=t.duration))}this._deletePlayingTaskFromList(e)},stopAllEffects:function(){var e,t,n=this._effectList;for(var r in n){e=n[r];for(var i=0;i<e.length;i++)t=e[i],t.ended||(t.removeEventListener("ended",this._audioEndedCallbackBound,!1),t.loop=!1,t.duration&&(t.currentTime=t.duration))}this._playingList.length=0,this._currentTask=null,this._isPauseForList&&(this._isPauseForList=!1,this.resumeMusic())},_pausePlaying:function(){var e=this._pausedPlayings,t=this._soundList,n;!this._musicIsStopped&&t[this._playingMusic]&&(n=t[this._playingMusic].audio,n.paused||(n.pause(),cc.AudioEngine.isMusicPlaying=!1,e.push(n))),this.stopAllEffects()},_resumePlaying:function(){var e=this._pausedPlayings,t=this._soundList,n;!this._musicIsStopped&&t[this._playingMusic]&&(n=t[this._playingMusic].audio,e.indexOf(n)!==-1&&(n.play(),n.addEventListener("pause",this._musicListenerBound,!1),cc.AudioEngine.isMusicPlaying=!0)),e.length=0}}),cc.WebAudioSFX=function(e,t,n,r,i){this.key=e,this.sourceNode=t,this.volumeNode=n,this.startTime=r||0,this.pauseTime=i||0,this.isPaused=!1},cc.WebAudioEngine=cc.AudioEngine.extend({_ctx:null,_audioData:null,_audiosLoading:null,_musicVolume:1,_effects:null,ctor:function(){cc.AudioEngine.prototype.ctor.call(this),this._audioData={},this._audiosLoading={},this._effects={}},init:function(){this._ctx=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext);var e={};this._checkCanPlay(e);var t=["ogg","mp3","wav","mp4","m4a"],n=this._supportedFormat;for(var r in t){var i=t[r];e[i]&&n.push(i)}return this._soundSupported=n.length>0,this._soundSupported},_fetchData:function(e,t,n){var r=new window.XMLHttpRequest,i=this._resPath+e;r.open("GET",i,!0),r.responseType="arraybuffer";var s=this;r.onload=function(){s._ctx.decodeAudioData(r.response,t,n)},r.onerror=n,r.send()},preloadSound:function(e,t,n){if(!this._soundSupported)return;var r=this._getExtFromFullPath(e),i=this._getPathWithoutExt(e);if(this._audioData[i]||this._audiosLoading[i]||!this.isFormatSupported(r)){cc.doCallback(t,n);return}this._audiosLoading[i]=!0;var s=this;this._fetchData(e,function(e){s._audioData[i]=e,delete s._audiosLoading[i],cc.doCallback(t,n)},function(){delete s._audiosLoading[i],cc.doCallback(t,n,e)})},_beginSound:function(e,t,n,r){var i=new cc.WebAudioSFX;t=t==null?!1:t,n=n==null?1:n,r=r||0;var s=this._ctx;i.key=e,i.sourceNode=this._ctx.createBufferSource(),i.sourceNode.buffer=this._audioData[e],i.sourceNode.loop=t,s.createGain?i.volumeNode=this._ctx.createGain():i.volumeNode=this._ctx.createGainNode(),i.volumeNode.gain.value=n,i.sourceNode.connect(i.volumeNode),i.volumeNode.connect(this._ctx.destination);if(i.sourceNode.start)i.sourceNode.start(0,r);else if(i.sourceNode.noteGrainOn){var o=i.sourceNode.buffer.duration;t?i.sourceNode.noteGrainOn(0,r,o):i.sourceNode.noteGrainOn(0,r,o-r)}else i.sourceNode.noteOn(0);return i.startTime=this._ctx.currentTime-r,i.pauseTime=i.startTime,i.isPaused=!1,i},_isSoundPlaying:function(e){return e.sourceNode.playbackState==2},_isSoundPaused:function(e){return this._isSoundPlaying(e)?!1:e.isPaused},isMusicPlaying:function(){return this._playingMusic?this._isSoundPlaying(this._playingMusic):!1},playMusic:function(e,t){var n=this._getPathWithoutExt(e),r=this._getExtFromFullPath(e);t=t||!1,this._playingMusic&&this.stopMusic();if(this._audioData[n])this._playingMusic=this._beginSound(n,t,this._musicVolume);else if(!this._audiosLoading[n]&&this.isFormatSupported(r)){this._audiosLoading[n]=!0;var i=this;this._fetchData(e,function(r){i._audioData[n]=r,delete i._audiosLoading[n],i.playMusic(e,t)},function(){delete i._audiosLoading[n]})}},_endSound:function(e){if(e.sourceNode.playbackState&&e.sourceNode.playbackState==3)return;e.sourceNode.stop?e.sourceNode.stop(0):e.sourceNode.noteOff(0)},stopMusic:function(e){var t=this._playingMusic;if(!t)return;var n=t.key;this._endSound(t),this._playingMusic=null,e&&delete this._audioData[n]},_pauseSound:function(e){e.pauseTime=this._ctx.currentTime,e.isPaused=!0,this._endSound(e)},pauseMusic:function(){if(!this.isMusicPlaying())return;this._pauseSound(this._playingMusic)},_resumeSound:function(e,t){var n=e.key,r=e.sourceNode.loop,i=(e.pauseTime-e.startTime)%e.sourceNode.buffer.duration;return this._beginSound(n,r,t,i)},resumeMusic:function(){var e=this._playingMusic;if(!e||!this._isSoundPaused(e))return;this._playingMusic=this._resumeSound(e,this.getMusicVolume())},rewindMusic:function(){var e=this._playingMusic;if(!e)return;var t=e.key,n=e.sourceNode.loop,r=this.getMusicVolume();this._endSound(e),this._playingMusic=this._beginSound(t,n,r)},getMusicVolume:function(){return this._musicVolume},_setSoundVolume:function(e,t){e.volumeNode.gain.value=t},setMusicVolume:function(e){e>1?e=1:e<0&&(e=0);if(this.getMusicVolume()==e)return;this._musicVolume=e,this._playingMusic&&this._setSoundVolume(this._playingMusic,e)},playEffect:function(e,t){var n=this._getPathWithoutExt(e),r=this._getExtFromFullPath(e),i;t=t||!1;if(this._audioData[n]){var s=this._effects;s[n]||(s[n]=[]);var o=s[n];for(var u=0,a=o.length;u<a;u++){var f=o[u];if(!this._isSoundPlaying(f)&&!this._isSoundPaused(f))return o[u]=this._beginSound(n,t,this.getEffectsVolume()),i=this._audioID++,this._audioIDList[i]=o[u],i}var l=this._beginSound(n,t,this.getEffectsVolume());return o.push(l),i=this._audioID++,this._audioIDList[i]=l,i}if(!this._audiosLoading[n]&&this.isFormatSupported(r)){this._audiosLoading[n]=!0;var c=this;return i=this._audioID++,this._audioIDList[i]=null,this._fetchData(e,function(e){c._audioData[n]=e,delete c._audiosLoading[n];var r=c._beginSound(n,t,c.getEffectsVolume());c._audioIDList[i]=r;var s=c._effects;s[n]||(s[n]=[]),s[n].push(r)},function(){delete c._audiosLoading[n],delete c._audioIDList[i]}),i}return null},setEffectsVolume:function(e){e>1?e=1:e<0&&(e=0);if(this._effectsVolume==e)return;this._effectsVolume=e;var t=this._effects;for(var n in t){var r=t[n];for(var i=0,s=r.length;i<s;i++)this._setSoundVolume(r[i],e)}},_pauseSoundList:function(e){for(var t=0,n=e.length;t<n;t++){var r=e[t];r&&this._isSoundPlaying(r)&&this._pauseSound(r)}},pauseEffect:function(e){if(e==null)return;if(this._audioIDList[e]){var t=this
._audioIDList[e];t&&this._isSoundPlaying(t)&&this._pauseSound(t)}},pauseAllEffects:function(){for(var e in this._effects)this._pauseSoundList(this._effects[e])},_resumeSoundList:function(e,t){for(var n=0,r=e.length;n<r;n++){var i=e[n];this._isSoundPaused(i)&&(e[n]=this._resumeSound(i,t),this._updateEffectsList(i,e[n]))}},resumeEffect:function(e){if(e==null)return;if(this._audioIDList[e]){var t=this._audioIDList[e];t&&this._isSoundPaused(t)&&(this._audioIDList[e]=this._resumeSound(t,this.getEffectsVolume()),this._updateEffectsList(t,this._audioIDList[e]))}},_updateEffectsList:function(e,t){var n=this._effects,r;for(var i in n){r=n[i];for(var s=0;s<r.length;s++)r[s]==e&&(r[s]=t)}},resumeAllEffects:function(){var e=this._effects;for(var t in e)this._resumeSoundList(e[t],this.getEffectsVolume())},stopEffect:function(e){if(e==null)return;var t=this._audioIDList;t[e]&&this._endSound(t[e])},stopAllEffects:function(){var e=this._effects;for(var t in e){var n=e[t];for(var r=0,i=n.length;r<i;r++)this._endSound(n[r]);delete e[t]}},unloadEffect:function(e){if(!e)return;var t=this._getPathWithoutExt(e);if(this._effects[t]){var n=this._effects[t];delete this._effects[t];var r=this._audioIDList;for(var i in r)n.indexOf(r[i])>-1&&(this.stopEffect(i),delete r[i])}this._audioData[t]&&delete this._audioData[t]},_pausePlaying:function(){var e=this._pausedPlayings;this.isMusicPlaying()&&(e.push(this._playingMusic),this._pauseSound(this._playingMusic));var t=this._effects;for(var n in t){var r=t[n];for(var i=0,s=r.length;i<s;i++){var o=r[i];o&&this._isSoundPlaying(o)&&(e.push(o),this._pauseSound(o))}}},_resumePlaying:function(){var e=this._pausedPlayings,t=this.getMusicVolume(),n=this._playingMusic;n&&this._isSoundPaused(n)&&e.indexOf(n)!=-1&&(this._playingMusic=this._resumeSound(n,t));var r=this._effects;for(var i in r){var s=r[i];for(var o=0,u=s.length;o<u;o++){var a=s[o];this._isSoundPaused(a)&&e.indexOf(a)!=-1&&(s[o]=this._resumeSound(a,t),this._updateEffectsList(a,s[o]))}}e.length=0}}),cc.AudioEngine._instance=null,cc.AudioEngine.isMusicPlaying=!1,cc.AudioEngine.getInstance=function(){return this._instance||(cc.Browser.supportWebAudio?this._instance=new cc.WebAudioEngine:cc.Browser.multipleAudioWhiteList.indexOf(cc.Browser.type)!==-1?this._instance=new cc.SimpleAudioEngine:this._instance=new cc.SimpleAudioEngineForMobile,this._instance.init()),this._instance},cc.AudioEngine.end=function(){this._instance&&(this._instance.stopMusic(),this._instance.stopAllEffects()),this._instance=null},cc.UserDefault=cc.Class.extend({_db:null,init:function(){return this._db=this._getLocalStorage(),!0},_getLocalStorage:function(){try{if(!!sys.localStorage)return sys.localStorage}catch(e){return undefined}},_getWebSqlDatabase:function(){},getBoolForKey:function(e,t){cc.log("getBoolForKey is deprecated. Use sys.localStorage.getItem instead.");var n=this._getValueForKey(e),r=t||!1;return n=="true"?!0:n=="false"?!1:n?Boolean(n):r},getIntegerForKey:function(e,t){cc.log("getIntegerForKey is deprecated. Use sys.localStorage.getItem instead.");var n=this._getValueForKey(e),r=t||0;return n?parseInt(n):r},getFloatForKey:function(e,t){cc.log("getFloatForKey is deprecated. Use sys.localStorage.getItem instead.");var n=this._getValueForKey(e),r=t||0;return n?parseFloat(n):r},getDoubleForKey:function(e,t){return cc.log("getDoubleForKey is deprecated. Use sys.localStorage.getItem instead."),this.getFloatForKey(e,t)},getStringForKey:function(e,t){cc.log("getStringForKey is deprecated. Use sys.localStorage.getItem instead.");var n=this._getValueForKey(e),r=t||"";return n?String(n):r},_getValueForKey:function(e){var t;return this._db&&(t=this._db.getItem(e)),t},setBoolForKey:function(e,t){cc.log("setBoolForKey is deprecated. Use sys.localStorage.setItem instead."),this.setStringForKey(e,String(t))},setIntegerForKey:function(e,t){cc.log("setIntegerForKey is deprecated. Use sys.localStorage.setItem instead.");if(!e)return;this._setValueForKey(e,parseInt(t))},setFloatForKey:function(e,t){cc.log("setFloatForKey is deprecated. Use sys.localStorage.setItem instead.");if(!e)return;this._setValueForKey(e,parseFloat(t))},setDoubleForKey:function(e,t){return cc.log("setDoubleForKey is deprecated. Use sys.localStorage.setItem instead."),this.setFloatForKey(e,t)},setStringForKey:function(e,t){cc.log("setStringForKey is deprecated. Use sys.localStorage.setItem instead.");if(!e)return;this._setValueForKey(e,String(t))},_setValueForKey:function(e,t){this._db&&this._db.setItem(e,t)}}),cc.UserDefault.getInstance=function(){return cc.log("cc.UserDefault is deprecated. Use sys.localStorage instead."),this._sUserDefault||(this._sUserDefault=new cc.UserDefault,this._sUserDefault.init()),this._sUserDefault},cc.UserDefault.purgeInstanceUserDefault=function(){cc.Browser&&this._db&&this._db.clear()},cc.UserDefault._sUserDefault=null,cc.UserDefault._isFilePathInitialized=!1,cc.ALIGN_CENTER=51,cc.ALIGN_TOP=19,cc.ALIGN_TOP_RIGHT=18,cc.ALIGN_RIGHT=50,cc.ALIGN_BOTTOM_RIGHT=34,cc.ALIGN_BOTTOM=35,cc.ALIGN_BOTTOM_LEFT=33,cc.ALIGN_LEFT=49,cc.ALIGN_TOP_LEFT=17,cc.RGB_PREMULTIPLY_APLHA=function(e,t,n,r){return e*(r+1)>>8|t*(r+1)>>8<<8|n*(r+1)>>8<<16|r<<24},cc.tImageSource=function(e,t,n){this.data=e,this.size=t||0,this.offset=n||0},cc.pngReadCallback=function(e,t,n){var r=new cc.tImageSource;r=cc.png_get_io_ptr(e),r.offset+n<=r.size?(cc.memcpy(t,r.data+r.offset,n),r.offset+=n):cc.png_error(e,"pngReaderCallback failed")},cc.Image=cc.Class.extend({_width:0,_height:0,_bitsPerComponent:0,_data:0,_hasAlpha:!1,_preMulti:!1,initWithImageFile:function(e,t){var n=cc.FileUtils.getInstance().getFileData(e,"rb"),r=n.length;return n!=null&&n.length>0?this.initWithImageData(n,n.length,t):!1},initWithImageFileThreadSafe:function(e,t){return this.initWithImageFile(e,t)},initWithImageData:function(e,t,n,r,i,s){s=s||8,r=r||0,i=i||0,n=n||cc.FMT_UNKNOWN;if(!e||t<=0)return!1;if(cc.FMT_PNG==n)return this._initWithPngData(e,t);if(cc.FMT_JPG==n)return this._initWithJpgData(e,t);if(cc.FMT_TIFF==n)return this._initWithTiffData(e,t);if(cc.FMT_RAWDATA==n)return this._initWithRawData(e,t,r,i,s);if(t>8&&e[0]==137&&e[1]==80&&e[2]==78&&e[3]==71&&e[4]==13&&e[5]==10&&e[6]==26&&e[7]==10)return this._initWithPngData(e,t);if(t>2){if(e[0]==73&&e[1]==73||e[0]==77&&e[1]==77)return this._initWithTiffData(e,t);if(e[0]==255&&e[1]==216)return this._initWithTiffData(e,t)}return!1},getData:function(){return this._data},getDataLen:function(){return this._width*this._height},hasAlpha:function(){return this._hasAlpha},isPremultipliedAlpha:function(){return this._preMulti},getWidth:function(){return this._width},getHeight:function(){return this._height},getBitsPerComponent:function(){return this._bitsPerComponent},saveToFile:function(e,t){return cc.log("doesn't support saveToFile on Cocos2d-Html5"),!1},_initWithJpgData:function(e,t){return!1},_initWithPngData:function(e,t){return!1},_initWithTiffData:function(e,t){return!1},_initWithRawData:function(e,t,n,r,i){return!1},_saveImageToPNG:function(e,t){return!1},_saveImageToJPG:function(e){return!1},initWithString:function(e,t,n,r,i,s){return!1}})
